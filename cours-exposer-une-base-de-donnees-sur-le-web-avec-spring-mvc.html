
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/java-spring-dec-2015/cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc.html">
      
      
        <link rel="prev" href="td-implementation-de-la-couche-dao-du-td-avec-spring-data.html">
      
      
        <link rel="next" href="td-exposition-sur-le-web-de-la-couche-metier.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>13. [Cours] : Exposer une base de données sur le web avec Spring MVC - Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#13-cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-header__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              13. [Cours] : Exposer une base de données sur le web avec Spring MVC
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-nav__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-le-probleme.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. [TD] : Le problème
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-classes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. [TD] : Classes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-architectures-en-couches.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. [TD] : Architectures en couches
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-au-framework-spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. [Cours] : Introduction au framework Spring
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-a-lapi-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. [Cours] : Introduction à l'API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-lapi-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. [TD] : Implémentation de la couche [DAO] du TD avec l'API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. [TD] : La couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-un-programme-console.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. [TD] : Implémentation de la couche [ui] avec un programme console
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-une-interface-swing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. [TD] : Implémentation de la couche [ui] avec une interface Swing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. [Cours] : Gestion des bases de données relationnelles avec Spring Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. [TD] : Implémentation de la couche [DAO] du TD avec [Spring Data]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    13. [Cours] : Exposer une base de données sur le web avec Spring MVC
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    13. [Cours] : Exposer une base de données sur le web avec Spring MVC
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#131-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.1. Support
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#132-la-place-de-spring-mvc-dans-une-application-web" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.2. La place de Spring MVC dans une application Web
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#133-le-modele-de-developpement-de-spring-mvc" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.3. Le modèle de développement de Spring MVC
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#134-un-projet-web-json-avec-spring-mvc" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4. Un projet web / jSON avec Spring MVC
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.4. Un projet web / jSON avec Spring MVC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1341-le-projet-de-demonstration" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.1. Le projet de démonstration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1342-configuration-maven" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.2. Configuration Maven
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1343-larchitecture-dun-service-spring-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.3. L'architecture d'un service Spring [web / jSON]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1344-le-controleur-c" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.4. Le contrôleur C
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1345-le-modele-m" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.5. Le modèle M
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1346-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.6. Exécution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1347-execution-du-projet" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.7. Exécution du projet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1348-creation-dune-archive-executable" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.8. Création d'une archive exécutable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1349-deployer-lapplication-sur-un-serveur-tomcat" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.9. Déployer l'application sur un serveur Tomcat
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13410-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.4.10. Conclusion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#135-exposer-la-base-dbintrospringdata-sur-le-web" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5. Exposer la base [dbintrospringdata] sur le web
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.5. Exposer la base [dbintrospringdata] sur le web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1351-architecture-du-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.1. Architecture du service web / jSON
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1352-installation-de-la-base-de-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.2. Installation de la base de données
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1353-le-projet-eclipse-du-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.3. Le projet Eclipse du service web / jSON
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.5.3. Le projet Eclipse du service web / jSON">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#13531-configuration-de-la-couche-web" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.3.1. Configuration de la couche [web]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1354-le-modele-de-lapplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.4. Le modèle de l'application
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1355-le-controleur" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5. Le contrôleur
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.5.5. Le contrôleur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#13551-les-url-exposees" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5.1. Les URL exposées
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13552-le-squelette-du-controleur" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5.2. Le squelette du contrôleur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13553-la-reponse-des-methodes-du-controleur" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5.3. La réponse des méthodes du contrôleur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13554-lurl-addproduits" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5.4. L'URL [/addProduits]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13555-lurl-getallproduits" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5.5. L'URL [/getAllProduits]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13556-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.5.6. Conclusion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1356-la-classe-dexecution-du-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.6. La classe d'exécution du service web / jSON
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1357-tests-du-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.5.7. Tests du service web / jSON
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#136-un-client-programme-pour-le-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6. Un client programmé pour le service web / jSON
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.6. Un client programmé pour le service web / jSON">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1361-le-projet-eclipse" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.1. Le projet Eclipse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1362-configuration-maven-du-projet" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.2. Configuration Maven du projet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1363-implementation-de-la-couche-dao" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3. Implémentation de la couche [DAO]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.6.3. Implémentation de la couche [DAO]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#13631-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.1. Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13632-les-entites" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.2. Les entités
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13633-la-classe-daoexception" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.3. La classe [DaoException]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13634-linterface-de-la-couche-dao" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.4. L'interface de la couche [DAO]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13635-la-reponse-du-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.5. La réponse du service web / jSON
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13636-implementation-des-echanges-avec-le-service-web-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.6. Implémentation des échanges avec le service web / jSON
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13637-implementation-de-linterface-idao" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.3.7. Implémentation de l'interface [IDao]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1364-le-test-junit" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.6.4. Le test JUnit
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-exposition-sur-le-web-de-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. [TD] : Exposition sur le web de la couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-creation-dun-client-pour-le-service-web.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. [TD] : création d'un client pour le service web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-securiser-lacces-a-un-service-web-avec-spring-security.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. [Cours] : Sécuriser l'accès à un service web avec Spring Security
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-securisation-du-serveur-web--json-des-elections.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. [TD] : sécurisation du serveur web / jSON des élections
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-acces-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. [Cours] : Gestion des accès inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-elections-avec-des-requetes-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. [TD] Elections avec des requêtes inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="programmation-asynchrone-avec-rxjava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Programmation asynchrone avec RxJava
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="annexes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="13-cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc">13. [Cours] : Exposer une base de données sur le web avec Spring MVC</h1>
<p><strong>Mots clés</strong> : architecture multicouche, Spring, injection de dépendances, service web / jSON, client / serveur</p>
<h2 id="131-support">13.1. Support</h2>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000CD0000009ABDAFF778.png" style="display:inline-block; margin:4px;width:3.799cm;height:2.85cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E100000073CE9A20C0.png" style="display:inline-block; margin:4px;width:4.17cm;height:2.131cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Les projets de ce chapitre seront trouvés dans le dossier [support / chap-13]. Le script SQL [dbintrospringdata.sql] permet de créer la base MySQL nécessaire aux tests.</p>
<h2 id="132-la-place-de-spring-mvc-dans-une-application-web">13.2. La place de Spring MVC dans une application Web</h2>
<p>Situons Spring MVC dans le développement d'une application Web. Le plus souvent, celle-ci sera bâtie sur une architecture multicouche telle que la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000050B00000136980366E7.png" style="display:inline-block; margin:4px;width:17.08cm;height:4.101cm;" /></td></tr></table>

<ul>
<li>la couche [<strong>Web</strong>] est la couche en contact avec l'utilisateur de l'application Web. Celui-ci interagit avec l'application Web au travers de pages Web visualisées par un navigateur. <strong>C'est dans cette couche que se situe Spring MVC et uniquement dans cette couche ;</strong></li>
<li>la couche [<strong>métier</strong>] implémente les règles de gestion de l'application, tels que le calcul d'un salaire ou d'une facture. Cette couche utilise des données provenant de l'utilisateur via la couche [Web] et du SGBD via la couche [DAO] ;</li>
<li>la couche [<strong>DAO</strong>] (Data Access Objects), la couche [<strong>ORM</strong>] (Object Relational Mapper) et le pilote JDBC gèrent l'accès aux données du SGBD. La couche [<strong>ORM</strong>]  fait un pont entre les objets manipulés par la couche [DAO] et les lignes et les colonnes des tables d'une base de données relationnelle. La spécification JPA (Java Persistence API) permet de s'abstraire de l'ORM utilisé si celui-ci implémente ces spécifications. Ce sera le cas ici et nous appellerons désormais la couche ORM, la couche JPA ;</li>
<li>l'intégration des couches est faite par le framework Spring ;</li>
</ul>
<h2 id="133-le-modele-de-developpement-de-spring-mvc">13.3. Le modèle de développement de Spring MVC</h2>
<p>Spring MVC implémente le modèle d'architecture dit MVC (Modèle – Vue – Contrôleur) de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000063700000237FD3DB044.png" style="display:inline-block; margin:4px;width:17.999cm;height:6.414cm;" /></td></tr></table>

<p>Le traitement d'une demande d'un client se déroule de la façon suivante :</p>
<ol>
<li><strong>demande</strong> - les URL demandées sont de la forme http://machine:port/contexte/Action/param1/param2/....?p1=v1&amp;p2=v2&amp;... Le [Front Controller] utilise un fichier de configuration ou des annotations Java pour " router " la demande vers le bon contrôleur et la bonne action au sein de ce contrôleur. Pour cela, il utilise le champ [Action] de l'URL. Le reste de l'URL [/param1/param2/...] est formé de paramètres facultatifs qui seront transmis à l'action. Le <strong>C</strong> de MVC est ici la chaîne [Front Controller, Contrôleur, Action]. Si aucun contrôleur ne peut traiter l'action demandée, le serveur Web répondra que l'URL demandée n'a pas été trouvée.</li>
<li><strong>traitement</strong> </li>
<li>l'action choisie peut exploiter les paramètres parami que le [Front Controller] lui a transmis. Ceux-ci peuvent provenir de plusieurs sources :</li>
<li>du chemin [/param1/param2/...] de l'URL,</li>
<li>des paramètres [p1=v1&amp;p2=v2] de l'URL,</li>
<li>de paramètres postés par le navigateur avec sa demande ;</li>
<li>dans le traitement de la demande de l'utilisateur, l'action peut avoir besoin de la couche [métier] [2b]. Une fois la demande du client traitée, celle-ci peut appeler diverses réponses. Un exemple classique est :</li>
<li>une page d'erreur si la demande n'a pu être traitée correctement</li>
<li>une page de confirmation sinon</li>
<li>l'action demande à une certaine vue de s'afficher [3]. Cette vue va afficher des données qu'on appelle le <strong>modèle de la vue</strong>. C'est le <strong>M</strong> de MVC. L'action va créer ce modèle M [2c] et demander à une vue <strong>V</strong> de s'afficher [3] ;</li>
<li><strong>réponse</strong> - la vue <strong>V</strong> choisie utilise le modèle <strong>M</strong> construit par l'action pour initialiser les parties dynamiques de la réponse HTML qu'elle doit envoyer au client puis envoie cette réponse.</li>
</ol>
<p>Pour un service web / jSON, l'architecture précédente est légèrement modifiée :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000046B0000015D36B32E26.png" style="display:inline-block; margin:4px;width:14.963cm;height:4.618cm;" /></td></tr></table>

<ul>
<li>en [4a], le modèle qui est une classe Java est transformé en chaîne jSON par une bibliothèque jSON ;</li>
<li>en [4b], cette chaîne jSON est envoyée au navigateur ;</li>
</ul>
<p>Maintenant, précisons le lien entre architecture web MVC et architecture en couches. Selon la définition qu'on donne au <strong>modèle</strong>, ces deux concepts sont liés ou non. Prenons une application web Spring MVC à une couche :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003DE00000164C5D9CDE1.png" style="display:inline-block; margin:4px;width:13.097cm;height:4.71cm;" /></td></tr></table>

<p>Si nous implémentons la couche [Web] avec Spring MVC, nous aurons bien une architecture web MVC mais pas une architecture multicouche. Ici, la couche [web] s'occupera de tout : présentation, métier, accès aux données. Ce sont les actions qui feront ce travail.</p>
<p>Maintenant, considérons une architecture Web multicouche :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004650000011CDD30A7F5.png" style="display:inline-block; margin:4px;width:14.884cm;height:3.757cm;" /></td></tr></table>

<p>La couche [Web] peut être implémentée sans framework et sans suivre le modèle MVC. On a bien alors une architecture multicouche mais la couche Web n'implémente pas le modèle MVC.</p>
<p>Par exemple, dans le monde .NET la couche [Web] ci-dessus peut être implémentée avec ASP.NET MVC et on a alors une architecture en couches avec une couche [Web] de type MVC. Ceci fait, on peut remplacer cette couche ASP.NET MVC par une couche ASP.NET classique (WebForms) tout en gardant le reste (métier, DAO, ORM) <strong>à l'identique</strong>.  On a alors une architecture en couches avec une couche [Web] qui n'est plus de type MVC.</p>
<p>Dans MVC, nous avons dit que le modèle M était celui de la vue V, c.a.d. l'ensemble des données affichées par la vue V. Une autre définition du modèle M de MVC est donnée :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000048E000001172B31577C.png" style="display:inline-block; margin:4px;width:15.425cm;height:3.692cm;" /></td></tr></table>

<p>Beaucoup d'auteurs considèrent que ce qui est à droite de la couche [Web] forme le modèle M du MVC. Pour éviter les ambigüités on peut parler :</p>
<ul>
<li>du <strong>modèle du domaine</strong> lorsqu'on désigne tout ce qui est à droite de la couche [Web]</li>
<li>du <strong>modèle de la vue</strong> lorsqu'on désigne les données affichées par une vue V</li>
</ul>
<p>Dans la suite, le terme " modèle M " désignera exclusivement le <strong>modèle d'une vue</strong> V.</p>
<h2 id="134-un-projet-web-json-avec-spring-mvc">13.4. Un projet web / jSON avec Spring MVC</h2>
<p>Le site [<a href="http://spring.io/guides"><u>http://spring.io/guides</u></a>] offre des tutoriels de démarrage pour découvrir l'écosystème Spring. Nous allons suivre l'un d'eux pour découvrir la configuration Maven nécessaire à un projet Spring MVC.</p>
<h3 id="1341-le-projet-de-demonstration">13.4.1. Le projet de démonstration</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003780000013C8AAFD577.png" style="display:inline-block; margin:4px;width:11.748cm;height:4.18cm;" /></td></tr></table>

<ul>
<li>en [1], nous importons l'un des guides Spring ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004E4000002E98F346916.png" style="display:inline-block; margin:4px;width:16.563cm;height:9.857cm;" /></td></tr></table>

<ul>
<li>en [2], nous choisissons l'exemple [Rest Service] ;</li>
<li>en [3], on choisit le projet Maven ;</li>
<li>en [4], on prend la version finale du guide ;</li>
<li>en [5], on valide ;</li>
<li>en [6], le projet importé ;</li>
</ul>
<p>Les services web accessibles via des URL standard et qui délivrent du texte jSON sont souvent appelés des services REST (REpresentational State Transfer). Un service est dit Restful s'il respecte certaines règles.</p>
<p>Examinons maintenant le projet importé, d'abord sa configuration Maven.</p>
<h3 id="1342-configuration-maven">13.4.2. Configuration Maven</h3>
<p>Le fichier [pom.xml] est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>gs-rest-service<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.1.0<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.2.RELEASE<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="nt">&lt;start-class&gt;</span>hello.Application<span class="nt">&lt;/start-class&gt;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">        </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="nt">&lt;repositories&gt;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">        </span><span class="nt">&lt;repository&gt;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">            </span><span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-release<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">        </span><span class="nt">&lt;/repository&gt;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">    </span><span class="nt">&lt;/repositories&gt;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="nt">&lt;pluginRepositories&gt;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">        </span><span class="nt">&lt;pluginRepository&gt;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">            </span><span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-release<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">        </span><span class="nt">&lt;/pluginRepository&gt;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="nt">&lt;/pluginRepositories&gt;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 6-8 : les propriétés du projet Maven. Manque une balise [&lt;packaging&gt;] indiquant le type du fichier produit par la compilation Maven. En l'absence de celle-ci, c'est le type [jar] qui est utilisé. L'application est donc une application exécutable de type console, et non une application web où le packaging serait alors [war] ;</li>
<li>lignes 10-14 : le projet Maven a un projet parent [spring-boot-starter-parent]. C'est lui qui définit l'essentiel des dépendances du projet. Elles peuvent être suffisantes, auquel cas on n'en rajoute pas, ou pas, auquel cas on rajoute les dépendances manquantes ;</li>
<li>lignes 17-20 : l'artifact [spring-boot-starter-web] amène avec lui les bibliothèques nécessaires à un projet Spring MVC de type service web où il n'y a pas de vues générées. Cet artifact amène avec lui un très grand nombre de bibliothèques dont celles d'un serveur Tomcat embarqué. C'est sur ce serveur que l'application sera exécutée ;</li>
</ul>
<p>Les bibliothèques amenées par cette configuration sont très nombreuses :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000013900000130C601B465.png" style="display:inline-block; margin:4px;width:5.791cm;height:5.63cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F700000110A13A7F1F.png" style="display:inline-block; margin:4px;width:4.57cm;height:5.039cm;" /></td></tr></table>

<p>Ci-dessus on voit les trois archives du serveur Tomcat.</p>
<h3 id="1343-larchitecture-dun-service-spring-web-json">13.4.3. L'architecture d'un service Spring [web / jSON]</h3>
<p>Pour un service web / jSON, Spring MVC implémente le modèle MVC de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000046200000164D2C28E83.png" style="display:inline-block; margin:4px;width:14.843cm;height:4.71cm;" /></td></tr></table>

<ul>
<li>en [4a], le modèle qui est une classe Java est transformé en chaîne jSON par une bibliothèque jSON ;</li>
<li>en [4b], cette chaîne jSON est envoyée au navigateur ;</li>
</ul>
<h3 id="1344-le-controleur-c">13.4.4. Le contrôleur C</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000ED000000AB6C6D3DB3.png" style="display:inline-block; margin:4px;width:4.39cm;height:3.17cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>L'application importée a le contrôleur suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.atomic.AtomicLong</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="nd">@RestController</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GreetingController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, %s!&quot;</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AtomicLong</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AtomicLong</span><span class="p">();</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/greeting&quot;</span><span class="p">)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Greeting</span><span class="w"> </span><span class="nf">greeting</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">defaultValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Greeting</span><span class="p">(</span><span class="n">counter</span><span class="p">.</span><span class="na">incrementAndGet</span><span class="p">(),</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">template</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">));</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : l'annotation [@<strong>RestController</strong>] fait de la classe [GreetingController] un contrôleur Spring, ç-à-d que ses méthodes sont enregistrées pour traiter des URL. Nous avons vu l'annotation similaire [@<strong>Controller</strong>]. Le résultat des méthodes de ce contrôleur était un type [String] qui était le nom de la vue à afficher. Ici c'est différent. Les méthodes d'un contrôleur de type [@<strong>RestController</strong>] rendent des objets qui sont sérialisés pour être envoyés au navigateur. Le type de sérialisation opérée dépend de la configuration de Spring MVC. Ici, ils seront sérialisés en jSON. C'est la présence d'une bibliothèque jSON dans les dépendances du projet qui fait que Spring Boot va, par autoconfiguration, configurer le projet de cette façon ;</li>
<li>ligne 14 : l'annotation [@<strong>RequestMapping</strong>] indique l'URL que traite la méthode, ici l'URL [/greeting] ;</li>
<li>ligne 15 : nous avons déjà expliqué l'annotation [@RequestParam]. Le résultat rendu par la méthode est un objet de type [Greeting].</li>
<li>ligne 12 : un entier long de type atomique. Cela signifie qu'il supporte la concurrence d'accès. Plusieurs threads peuvent vouloir incrémenter la variable [counter] en même temps. Cela se fera proprement. Un thread ne peut lire la valeur du compteur que si le thread en train de le modifier a terminé sa modification.</li>
</ul>
<h3 id="1345-le-modele-m">13.4.5. Le modèle M</h3>
<p>Le modèle M produit par la méthode précédente est l'objet [Greeting] suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000ED000000ABFE40A4F7.png" style="display:inline-block; margin:4px;width:4.39cm;height:3.17cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greeting</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Greeting</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">content</span><span class="p">;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getContent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">content</span><span class="p">;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>La transformation jSON de cet objet créera la chaîne de caractères <strong>{"id":n,"content":"texte"}</strong>. Au final, la chaîne jSON produite par la méthode du contrôleur sera de la forme :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>{&quot;id&quot;:2,&quot;content&quot;:&quot;Hello, World!&quot;}
</code></pre></div></td></tr></table></div>
<p>ou </p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>{&quot;id&quot;:2,&quot;content&quot;:&quot;Hello, John!&quot;}
</code></pre></div></td></tr></table></div>
<h3 id="1346-execution">13.4.6. Exécution</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000ED000000AB6B43BC81.png" style="display:inline-block; margin:4px;width:4.39cm;height:3.17cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [Application.java] est la classe exécutable du projet. Son code est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="nd">@ComponentScan</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="nd">@EnableAutoConfiguration</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Application</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Nous avons déjà rencontré et expliqué ce code dans l'exemple précédent.</p>
<h3 id="1347-execution-du-projet">13.4.7. Exécution du projet</h3>
<p>Exécutons le projet :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002100000014566557274.png" style="display:inline-block; margin:4px;width:9.781cm;height:6.02cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On obtient les logs console suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="w">  </span><span class="p">.</span><span class="w">   </span><span class="nx">____</span><span class="w">          </span><span class="nx">_</span><span class="w">            </span><span class="nx">__</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">_</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w"> </span><span class="o">/</span><span class="err">\\</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">___</span><span class="s1">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="s1">( ( )\___ | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;_| | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="err">\</span><span class="o">/</span><span class="w"> </span><span class="nx">_</span><span class="sb">` | \ \ \ \</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="sb"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="sb">  &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="sb"> =========|_|==============|___/=/_/_/_/</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="sb"> :: Spring Boot ::        (v1.1.9.RELEASE)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="sb">2014-11-28 15:22:55.005  INFO 3152 --- [           main] hello.Application                        : Starting Application on Gportpers3 with PID 3152 (started by ST in D:\data\istia-1415\spring mvc\dvp-final\gs-rest-service)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="sb">2014-11-28 15:22:55.046  INFO 3152 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@62e136d3: startup date [Fri Nov 28 15:22:55 CET 2014]; root of context hierarchy</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="sb">2014-11-28 15:22:55.762  INFO 3152 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Overriding bean definition for bean &#39;beanNameViewResolver&#39;: replacing [Root bean: class [null]; scope=; abstract=false; lazyInit=false; autowireMode=3; dependencyCheck=0; autowireCandidate=true; primary=false; factoryBeanName=org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration$WhitelabelErrorViewConfiguration; factoryMethodName=beanNameViewResolver; initMethodName=null; destroyMethodName=(inferred); defined in class path resource [org/springframework/boot/autoconfigure/web/ErrorMvcAutoConfiguration$WhitelabelErrorViewConfiguration.class]] with [Root bean: class [null]; scope=; abstract=false; lazyInit=false; autowireMode=3; dependencyCheck=0; autowireCandidate=true; primary=false; factoryBeanName=org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration$WebMvcAutoConfigurationAdapter; factoryMethodName=beanNameViewResolver; initMethodName=null; destroyMethodName=(inferred); defined in class path resource [org/springframework/boot/autoconfigure/web/WebMvcAutoConfiguration$WebMvcAutoConfigurationAdapter.class]]</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="sb">2014-11-28 15:22:56.567  INFO 3152 --- [           main] .t.TomcatEmbeddedServletContainerFactory : Server initialized with port: 8080</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="sb">2014-11-28 15:22:56.738  INFO 3152 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="sb">2014-11-28 15:22:56.740  INFO 3152 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/7.0.56</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="sb">2014-11-28 15:22:56.869  INFO 3152 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="sb">2014-11-28 15:22:56.870  INFO 3152 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1827 ms</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="sb">2014-11-28 15:22:57.478  INFO 3152 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: &#39;dispatcherServlet&#39; to [/]</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="sb">2014-11-28 15:22:57.481  INFO 3152 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: &#39;hiddenHttpMethodFilter&#39; to: [/*]</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="sb">2014-11-28 15:22:57.685  INFO 3152 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="sb">2014-11-28 15:22:57.879  INFO 3152 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/greeting],methods=[],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public hello.Greeting hello.GreetingController.greeting(java.lang.String)</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="sb">2014-11-28 15:22:57.884  INFO 3152 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/error],methods=[],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="sb">2014-11-28 15:22:57.885  INFO 3152 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/error],methods=[],params=[],headers=[],consumes=[],produces=[text/html],custom=[]}&quot; onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="sb">2014-11-28 15:22:57.906  INFO 3152 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="sb">2014-11-28 15:22:57.907  INFO 3152 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="sb">2014-11-28 15:22:58.231  INFO 3152 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="sb">2014-11-28 15:22:58.318  INFO 3152 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080/http</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="sb">2014-11-28 15:22:58.319  INFO 3152 --- [           main] hello.Application                        : Started Application in 3.788 seconds (JVM running for 4.424)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : le serveur Tomcat démarre sur le port 8080 (ligne 12) ;</li>
<li>ligne 17 : la servlet [DispatcherServlet] est présente ;</li>
<li>ligne 20 : la méthode [GreetingController.greeting] a été découverte ;</li>
</ul>
<p>Pour tester l'application web, on demande l'URL [http://localhost:8080/greeting] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000145000000802108509F.png" style="display:inline-block; margin:4px;width:5.609cm;height:2.208cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000019F00000085614557B2.png" style="display:inline-block; margin:4px;width:7.68cm;height:2.461cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>On reçoit bien la chaîne jSON attendue. Il peut être intéressant de voir les entêtes HTTP envoyés par le serveur. Pour cela, on va utiliser l'extension de Chrome appelée [Advanced Rest Client] (Chrome / Ctrl-T / Menu [Applications] / [Advanced Rest Client] - cf Annexes page 420) :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000535000004DB0D231B7F.png" style="display:inline-block; margin:4px;width:17.635cm;height:16.445cm;" /></td></tr></table>

<ul>
<li>en [1], l'URL demandée ;</li>
<li>en [2], la méthode GET est utilisée ;</li>
<li>en [3], la réponse jSON ;</li>
<li>en [4], le serveur a indiqué qu'il envoyait une réponse au format jSON ;</li>
<li>en [5], on demande la même URL mais cette fois-ci avec un POST ;</li>
<li>en [7], les informations sont envoyées au serveur sous la forme [urlencoded] ;</li>
<li>en [6], le paramètre <strong>name</strong> avec sa valeur ;</li>
<li>en [8], le navigateur indique au serveur qu'il lui envoie des informations [urlencoded] ;</li>
<li>en [9], la réponse jSON du serveur ;</li>
</ul>
<h3 id="1348-creation-dune-archive-executable">13.4.8. Création d'une archive exécutable</h3>
<p>Nous créons maintenant une archive exécutable :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000030400000174D6BA9782.png" style="display:inline-block; margin:4px;width:10.213cm;height:4.921cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000418000003580007FFB3.png" style="display:inline-block; margin:4px;width:13.864cm;height:11.324cm;" /></td></tr></table>

<ul>
<li>en [1] : on exécute une cible Maven ;</li>
<li>en [2] : il y a deux cibles (goals) : [clean] pour supprimer le dossier [target] du projet Maven, [package] pour le régénérer ;</li>
<li>en [3] : le dossier [target] généré, le sera dans ce dossier ;</li>
<li>en [4] : on génère la cible ;</li>
</ul>
<p>Dans les logs qui apparaissent dans la console, il est important de voir apparaître le plugin [spring-boot-maven-plugin]. C'est lui qui génère l'archive exécutable.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">maven</span><span class="o">-</span><span class="n">plugin</span><span class="p">:</span><span class="mf">1.1.0</span><span class="p">.</span><span class="na">RELEASE</span><span class="p">:</span><span class="n">repackage</span><span class="w"> </span><span class="p">(</span><span class="k">default</span><span class="p">)</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">gs</span><span class="o">-</span><span class="n">rest</span><span class="o">-</span><span class="n">service</span><span class="w"> </span><span class="o">---</span>
</code></pre></div></td></tr></table></div>
<p>Avec une console, on se place dans le dossier généré :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>D:\Temp\wksSTS\gs-rest-service\target&gt;dir
<a id="__codelineno-8-2" name="__codelineno-8-2"></a> ...
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>11/06/2014  15:30    &lt;DIR&gt;          classes
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>11/06/2014  15:30    &lt;DIR&gt;          generated-sources
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>11/06/2014  15:30        11 073 572 gs-rest-service-0.1.0.jar
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>11/06/2014  15:30             3 690 gs-rest-service-0.1.0.jar.original
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>11/06/2014  15:30    &lt;DIR&gt;          maven-archiver
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>11/06/2014  15:30    &lt;DIR&gt;          maven-status
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>...
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5 : l'archive générée ;</li>
</ul>
<p>Cette archive est exécutée de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nx">D</span><span class="o">:</span><span class="err">\</span><span class="nx">Temp</span><span class="err">\</span><span class="nx">wksSTS</span><span class="err">\</span><span class="nx">gs</span><span class="o">-</span><span class="nx">rest</span><span class="o">-</span><span class="nx">service</span><span class="o">-</span><span class="nx">complete</span><span class="err">\</span><span class="nx">target</span><span class="o">&gt;</span><span class="nx">java</span><span class="w"> </span><span class="o">-</span><span class="nx">jar</span><span class="w"> </span><span class="nx">gs</span><span class="o">-</span><span class="nx">rest</span><span class="o">-</span><span class="nx">service</span><span class="o">-</span><span class="mf">0.1.0</span><span class="p">.</span><span class="nx">jar</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="p">.</span><span class="w">   </span><span class="nx">____</span><span class="w">          </span><span class="nx">_</span><span class="w">            </span><span class="nx">__</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">_</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w"> </span><span class="o">/</span><span class="err">\\</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">___</span><span class="s1">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="s1">( ( )\___ | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;_| | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="err">\</span><span class="o">/</span><span class="w"> </span><span class="nx">_</span><span class="sb">` | \ \ \ \</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="sb"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="sb">  &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="sb"> =========|_|==============|___/=/_/_/_/</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="sb"> :: Spring Boot ::        (v1.1.0.RELEASE)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="sb">2014-06-11 15:32:47.088  INFO 4972 --- [           main] hello.Application</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="sb">                  : Starting Application on Gportpers3 with PID 4972 (D:\Temp\wk</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="sb">sSTS\gs-rest-service-complete\target\gs-rest-service-0.1.0.jar started by ST in</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="sb">D:\Temp\wksSTS\gs-rest-service-complete\target)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="sb">...</span>
</code></pre></div></td></tr></table></div>
<p>Maintenant que l'application web est lancée, on peut l'interroger avec un navigateur :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001470000007FCF70CA67.png" style="display:inline-block; margin:4px;width:6.05cm;height:2.35cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h3 id="1349-deployer-lapplication-sur-un-serveur-tomcat">13.4.9. Déployer l'application sur un serveur Tomcat</h3>
<p>Comme il a été fait pour le projet précédent, nous modifions le fichier [pom.xml] de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>gs-rest-service<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.1.0<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span>...
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : il faut indiquer qu'on va générer une archive war (Web ARchive) ;</li>
</ul>
<p>Il faut par ailleurs configurer l'application web. En l'absence de fichier [web.xml], cela se fait avec une classe héritant de [SpringBootServletInitializer] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000102000000D1A9F9B1A9.png" style="display:inline-block; margin:4px;width:4.78cm;height:3.87cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [ApplicationInitializer] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.builder.SpringApplicationBuilder</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.context.web.SpringBootServletInitializer</span><span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationInitializer</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SpringBootServletInitializer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">SpringApplicationBuilder</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">SpringApplicationBuilder</span><span class="w"> </span><span class="n">application</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">application</span><span class="p">.</span><span class="na">sources</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 6 : la classe [ApplicationInitializer] étend la classe [SpringBootServletInitializer] ;</li>
<li>ligne 9 : la méthode [configure] est redéfinie (ligne 8) ;</li>
<li>ligne 10 : on fournit la classe qui configure le projet ;</li>
</ul>
<p>Pour exécuter le projet, on peut procéder ainsi :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004E700000158F9710373.png" style="display:inline-block; margin:4px;width:16.603cm;height:4.551cm;" /></td></tr></table>

<ul>
<li>en [1-2], on exécute le projet sur l'un des serveurs enregistrés dans l'IDE Eclipse ;</li>
</ul>
<p>Ceci fait, on peut demander l'URL [http://localhost:8080/gs-rest-service/greeting/?name=Mitchell] dans un navigateur :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000022B0000008EA361FFF2.png" style="display:inline-block; margin:4px;width:10.28cm;height:2.63cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h3 id="13410-conclusion">13.4.10. Conclusion</h3>
<p>Nous avons introduit un type de projets Spring MVC où l'application web envoie un flux jSON au navigateur. Nous allons développer maintenant une application web / jSON pour exposer sur le web la base [dbintrospringdata] étudiée dans le tutoriel [Introduction à Spring Data].</p>
<h2 id="135-exposer-la-base-dbintrospringdata-sur-le-web">13.5. Exposer la base [dbintrospringdata] sur le web</h2>
<h3 id="1351-architecture-du-service-web-json">13.5.1. Architecture du service web / jSON</h3>
<p>Nous allons mettre en place l'architecture suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000462000001676F190154.png" style="display:inline-block; margin:4px;width:14.843cm;height:4.75cm;" /></td></tr></table>

<p>Les couches [DAO] et [JPA] sont implémentées par l'application écrite dans le tutoriel [Introduction à Spring Data].</p>
<h3 id="1352-installation-de-la-base-de-donnees">13.5.2. Installation de la base de données</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E10000006A162CCEFA.png" style="display:inline-block; margin:4px;width:4.17cm;height:1.96cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le script SQL [dbintrospringdata.sql] permet de créer la base MySQL nécessaire aux tests.</p>
<h3 id="1353-le-projet-eclipse-du-service-web-json">13.5.3. Le projet Eclipse du service web / jSON</h3>
<p>Le projet Eclipse du service web / jSON est le suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E2000001136FF077F3.png" style="display:inline-block; margin:4px;width:4.189cm;height:5.091cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>C'est un projet Maven dont le fichier [pom.xml] est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>istia.st.webjson<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>intro-server-webjson01<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>intro-server-webjson01<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>démo<span class="w"> </span>spring<span class="w"> </span>mvc<span class="nt">&lt;/description&gt;</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.7.RELEASE<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>istia.st.springdata<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>intro-spring-data-01<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">            </span><span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">        </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">                </span><span class="nt">&lt;version&gt;</span>2.18.1<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
<a id="__codelineno-12-46" name="__codelineno-12-46"></a>
<a id="__codelineno-12-47" name="__codelineno-12-47"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 11-15 : le projet Maven parent déjà utilisé pour la couche [DAO] ;</li>
<li>lignes 18-22 : la dépendance sur la couche [DAO] ;</li>
<li>lignes 23-26 : la dépendance sur l'artifact [spring-boot-starter-web]. Cet artifact amène avec lui toutes les dépendances nécessaires à la création d'un service web / jSON. Il amène aussi des bibliothèques inutiles. Une configuration plus précise serait donc nécessaire. Mais cette configuration est pratique pour démarrer ;</li>
<li>lignes 28-30 : la dépendance sur l'artifact [spring-boot-starter] permet de gérer les annotation Spring Boot ;</li>
</ul>
<p>Les dépendances amenées par cette configuration sont les suivantes :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004F80000021C318645BE.png" style="display:inline-block; margin:4px;width:16.828cm;height:7.144cm;" /></td></tr></table>

<ul>
<li>en [1], on voit qu'Eclipse a vu la dépendance sur l'archive du projet [intro-spring-data-01] ;</li>
</ul>
<p>Les dépendances ci-dessus sont à la fois celles de la couche [DAO] et de la couche [web].</p>
<h4 id="13531-configuration-de-la-couche-web">13.5.3.1. Configuration de la couche [web]</h4>
<p>La couche [web] est configurée par un fichier [AppConfig] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F7000000CD6A8D0755.png" style="display:inline-block; margin:4px;width:4.57cm;height:3.799cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [WebConfig] configure la couche [web] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span>
<span class="normal"><a href="#__codelineno-13-41">41</a></span>
<span class="normal"><a href="#__codelineno-13-42">42</a></span>
<span class="normal"><a href="#__codelineno-13-43">43</a></span>
<span class="normal"><a href="#__codelineno-13-44">44</a></span>
<span class="normal"><a href="#__codelineno-13-45">45</a></span>
<span class="normal"><a href="#__codelineno-13-46">46</a></span>
<span class="normal"><a href="#__codelineno-13-47">47</a></span>
<span class="normal"><a href="#__codelineno-13-48">48</a></span>
<span class="normal"><a href="#__codelineno-13-49">49</a></span>
<span class="normal"><a href="#__codelineno-13-50">50</a></span>
<span class="normal"><a href="#__codelineno-13-51">51</a></span>
<span class="normal"><a href="#__codelineno-13-52">52</a></span>
<span class="normal"><a href="#__codelineno-13-53">53</a></span>
<span class="normal"><a href="#__codelineno-13-54">54</a></span>
<span class="normal"><a href="#__codelineno-13-55">55</a></span>
<span class="normal"><a href="#__codelineno-13-56">56</a></span>
<span class="normal"><a href="#__codelineno-13-57">57</a></span>
<span class="normal"><a href="#__codelineno-13-58">58</a></span>
<span class="normal"><a href="#__codelineno-13-59">59</a></span>
<span class="normal"><a href="#__codelineno-13-60">60</a></span>
<span class="normal"><a href="#__codelineno-13-61">61</a></span>
<span class="normal"><a href="#__codelineno-13-62">62</a></span>
<span class="normal"><a href="#__codelineno-13-63">63</a></span>
<span class="normal"><a href="#__codelineno-13-64">64</a></span>
<span class="normal"><a href="#__codelineno-13-65">65</a></span>
<span class="normal"><a href="#__codelineno-13-66">66</a></span>
<span class="normal"><a href="#__codelineno-13-67">67</a></span>
<span class="normal"><a href="#__codelineno-13-68">68</a></span>
<span class="normal"><a href="#__codelineno-13-69">69</a></span>
<span class="normal"><a href="#__codelineno-13-70">70</a></span>
<span class="normal"><a href="#__codelineno-13-71">71</a></span>
<span class="normal"><a href="#__codelineno-13-72">72</a></span>
<span class="normal"><a href="#__codelineno-13-73">73</a></span>
<span class="normal"><a href="#__codelineno-13-74">74</a></span>
<span class="normal"><a href="#__codelineno-13-75">75</a></span>
<span class="normal"><a href="#__codelineno-13-76">76</a></span>
<span class="normal"><a href="#__codelineno-13-77">77</a></span>
<span class="normal"><a href="#__codelineno-13-78">78</a></span>
<span class="normal"><a href="#__codelineno-13-79">79</a></span>
<span class="normal"><a href="#__codelineno-13-80">80</a></span>
<span class="normal"><a href="#__codelineno-13-81">81</a></span>
<span class="normal"><a href="#__codelineno-13-82">82</a></span>
<span class="normal"><a href="#__codelineno-13-83">83</a></span>
<span class="normal"><a href="#__codelineno-13-84">84</a></span>
<span class="normal"><a href="#__codelineno-13-85">85</a></span>
<span class="normal"><a href="#__codelineno-13-86">86</a></span>
<span class="normal"><a href="#__codelineno-13-87">87</a></span>
<span class="normal"><a href="#__codelineno-13-88">88</a></span>
<span class="normal"><a href="#__codelineno-13-89">89</a></span>
<span class="normal"><a href="#__codelineno-13-90">90</a></span>
<span class="normal"><a href="#__codelineno-13-91">91</a></span>
<span class="normal"><a href="#__codelineno-13-92">92</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.config</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.context.embedded.EmbeddedServletContainerFactory</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.context.embedded.ServletRegistrationBean</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedServletContainerFactory</span><span class="p">;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.context.WebApplicationContext</span><span class="p">;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.DispatcherServlet</span><span class="p">;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="p">;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="p">;</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter</span><span class="p">;</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider</span><span class="p">;</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="nd">@EnableWebMvc</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfig</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">WebMvcConfigurerAdapter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="w">    </span><span class="c1">// -------------------------------- configuration couche [web]</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a><span class="w">    </span><span class="nd">@Bean</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DispatcherServlet</span><span class="w"> </span><span class="nf">dispatcherServlet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="w">        </span><span class="n">DispatcherServlet</span><span class="w"> </span><span class="n">servlet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DispatcherServlet</span><span class="p">((</span><span class="n">WebApplicationContext</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">servlet</span><span class="p">;</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a><span class="w">    </span><span class="nd">@Bean</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ServletRegistrationBean</span><span class="w"> </span><span class="nf">servletRegistrationBean</span><span class="p">(</span><span class="n">DispatcherServlet</span><span class="w"> </span><span class="n">dispatcherServlet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServletRegistrationBean</span><span class="p">(</span><span class="n">dispatcherServlet</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/*&quot;</span><span class="p">);</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a><span class="w">    </span><span class="nd">@Bean</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">EmbeddedServletContainerFactory</span><span class="w"> </span><span class="nf">embeddedServletContainerFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TomcatEmbeddedServletContainerFactory</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8080</span><span class="p">);</span>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a><span class="w">    </span><span class="c1">// filtres jSON</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-13-43" name="__codelineno-13-43"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-44" name="__codelineno-13-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-13-45" name="__codelineno-13-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-46" name="__codelineno-13-46"></a>
<a id="__codelineno-13-47" name="__codelineno-13-47"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-13-48" name="__codelineno-13-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperCategorieWithProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-49" name="__codelineno-13-49"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-13-50" name="__codelineno-13-50"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-13-51" name="__codelineno-13-51"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-13-52" name="__codelineno-13-52"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span>
<a id="__codelineno-13-53" name="__codelineno-13-53"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">())</span>
<a id="__codelineno-13-54" name="__codelineno-13-54"></a><span class="w">                        </span><span class="p">.</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;categorie&quot;</span><span class="p">)));</span>
<a id="__codelineno-13-55" name="__codelineno-13-55"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-13-56" name="__codelineno-13-56"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-13-57" name="__codelineno-13-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-58" name="__codelineno-13-58"></a>
<a id="__codelineno-13-59" name="__codelineno-13-59"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-13-60" name="__codelineno-13-60"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperProduitWithCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-61" name="__codelineno-13-61"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-13-62" name="__codelineno-13-62"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-13-63" name="__codelineno-13-63"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-13-64" name="__codelineno-13-64"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span>
<a id="__codelineno-13-65" name="__codelineno-13-65"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">())</span>
<a id="__codelineno-13-66" name="__codelineno-13-66"></a><span class="w">                        </span><span class="p">.</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;produits&quot;</span><span class="p">)));</span>
<a id="__codelineno-13-67" name="__codelineno-13-67"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-13-68" name="__codelineno-13-68"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-13-69" name="__codelineno-13-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-70" name="__codelineno-13-70"></a>
<a id="__codelineno-13-71" name="__codelineno-13-71"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-13-72" name="__codelineno-13-72"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperCategorieWithoutProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-73" name="__codelineno-13-73"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-13-74" name="__codelineno-13-74"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-13-75" name="__codelineno-13-75"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-13-76" name="__codelineno-13-76"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span>
<a id="__codelineno-13-77" name="__codelineno-13-77"></a><span class="w">                </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;produits&quot;</span><span class="p">)));</span>
<a id="__codelineno-13-78" name="__codelineno-13-78"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-13-79" name="__codelineno-13-79"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-13-80" name="__codelineno-13-80"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-81" name="__codelineno-13-81"></a>
<a id="__codelineno-13-82" name="__codelineno-13-82"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-13-83" name="__codelineno-13-83"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperProduitWithoutCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-84" name="__codelineno-13-84"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-13-85" name="__codelineno-13-85"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-13-86" name="__codelineno-13-86"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-13-87" name="__codelineno-13-87"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">,</span>
<a id="__codelineno-13-88" name="__codelineno-13-88"></a><span class="w">                </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;categorie&quot;</span><span class="p">)));</span>
<a id="__codelineno-13-89" name="__codelineno-13-89"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-13-90" name="__codelineno-13-90"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-13-91" name="__codelineno-13-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-92" name="__codelineno-13-92"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 18 : l'annotation [@EnableWebMvc] induit des configurations automatiques pour le framework Spring MVC ;</li>
<li>ligne 19 : la classe [WebConfig] étend la classe Spring [WebMvcConfigurerAdapter] pour en redéfinir certains beans (lignes 26-40) ;</li>
<li>lignes 22-23 : injection du contexte Spring ;</li>
<li>lignes 25-29 : définition de la servlet du framework Spring MVC, celle qui route les requêtes HTTP vers le bon contrôleur et la bonne méthode. [DispatcherServlet] est une classe de Spring ;</li>
<li>lignes 31-34 : on indique que cette servlet traite toutes les URL ;</li>
<li>lignes 36-39 : c'est la présence de ce bean qui va activer le serveur Tomcat présent dans les archives du projet. Il attendra les requêtes sur le port 8080 ;</li>
<li>lignes 42-91 : des beans qui seront utilisés pour gérer des filtres jSON ;</li>
<li>lignes 42-45 : un mappeur jSON sans filtres ;</li>
<li>lignes 47-57 : le mappeur jSON qui permet d'avoir une catégorie avec ses produits. On notera que lorsqu'on demande une catégorie avec ses produits, il faut à la fois configurer le filtre jSON de la classe [Categorie] et celui de la classe [Produit]. Il en est toujours ainsi. Lorsqu'on sérialise / désérialise une classe en jSON, il faut configurer le filtre jSON de la classe et ceux de toutes les dépendances à inclure dans celle-ci ;</li>
<li>lignes 59-69 : le mappeur jSON qui permet d'avoir un produit avec sa catégorie ;</li>
<li>lignes 71-80 : le mappeur jSON qui permet d'avoir une catégorie sans ses produits ;</li>
<li>lignes 82-91 : le mappeur jSON qui permet d'avoir un produit sans sa catégorie ;</li>
</ul>
<p>La classe [AppConfig] configure l'ensemble de l'application, ç-à-d les couches [web] et [DAO] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.config</span><span class="p">;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.config.DaoConfig</span><span class="p">;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;spring.webjson&quot;</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="nd">@Import</span><span class="p">({</span><span class="w"> </span><span class="n">DaoConfig</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">WebConfig</span><span class="p">.</span><span class="na">class</span><span class="p">})</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppConfig</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : on importe les beans de la couche [DAO] et ceux de la couche [web] ;</li>
<li>ligne 8 : indique dans quels packages trouver d'autres beans Spring ;</li>
</ul>
<p>On notera que nulle part, nous n'avons utilisé l'annotation [@EnableAutoConfiguration]. Nous avons préféré contrôler la configuration nous-mêmes.</p>
<h3 id="1354-le-modele-de-lapplication">13.5.4. Le modèle de l'application</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F5000000A53F2ECF2A.png" style="display:inline-block; margin:4px;width:4.54cm;height:3.06cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [ApplicationModel] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span>
<span class="normal"><a href="#__codelineno-15-69">69</a></span>
<span class="normal"><a href="#__codelineno-15-70">70</a></span>
<span class="normal"><a href="#__codelineno-15-71">71</a></span>
<span class="normal"><a href="#__codelineno-15-72">72</a></span>
<span class="normal"><a href="#__codelineno-15-73">73</a></span>
<span class="normal"><a href="#__codelineno-15-74">74</a></span>
<span class="normal"><a href="#__codelineno-15-75">75</a></span>
<span class="normal"><a href="#__codelineno-15-76">76</a></span>
<span class="normal"><a href="#__codelineno-15-77">77</a></span>
<span class="normal"><a href="#__codelineno-15-78">78</a></span>
<span class="normal"><a href="#__codelineno-15-79">79</a></span>
<span class="normal"><a href="#__codelineno-15-80">80</a></span>
<span class="normal"><a href="#__codelineno-15-81">81</a></span>
<span class="normal"><a href="#__codelineno-15-82">82</a></span>
<span class="normal"><a href="#__codelineno-15-83">83</a></span>
<span class="normal"><a href="#__codelineno-15-84">84</a></span>
<span class="normal"><a href="#__codelineno-15-85">85</a></span>
<span class="normal"><a href="#__codelineno-15-86">86</a></span>
<span class="normal"><a href="#__codelineno-15-87">87</a></span>
<span class="normal"><a href="#__codelineno-15-88">88</a></span>
<span class="normal"><a href="#__codelineno-15-89">89</a></span>
<span class="normal"><a href="#__codelineno-15-90">90</a></span>
<span class="normal"><a href="#__codelineno-15-91">91</a></span>
<span class="normal"><a href="#__codelineno-15-92">92</a></span>
<span class="normal"><a href="#__codelineno-15-93">93</a></span>
<span class="normal"><a href="#__codelineno-15-94">94</a></span>
<span class="normal"><a href="#__codelineno-15-95">95</a></span>
<span class="normal"><a href="#__codelineno-15-96">96</a></span>
<span class="normal"><a href="#__codelineno-15-97">97</a></span>
<span class="normal"><a href="#__codelineno-15-98">98</a></span>
<span class="normal"><a href="#__codelineno-15-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.models</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.dao.IDao</span><span class="p">;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="nd">@Component</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationModel</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IDao</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">    </span><span class="c1">// la couche [DAO]</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">IDao</span><span class="w"> </span><span class="n">dao</span><span class="p">;</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">addProduits</span><span class="p">(</span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteAllProduits</span><span class="p">();</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">updateProduits</span><span class="p">(</span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">();</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">addCategories</span><span class="p">(</span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllCategories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">updateCategories</span><span class="p">(</span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllCategories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">();</span>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a>
<a id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-71" name="__codelineno-15-71"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-73" name="__codelineno-15-73"></a>
<a id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-75" name="__codelineno-15-75"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-76" name="__codelineno-15-76"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-15-77" name="__codelineno-15-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-78" name="__codelineno-15-78"></a>
<a id="__codelineno-15-79" name="__codelineno-15-79"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-80" name="__codelineno-15-80"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-81" name="__codelineno-15-81"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-15-82" name="__codelineno-15-82"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-83" name="__codelineno-15-83"></a>
<a id="__codelineno-15-84" name="__codelineno-15-84"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-85" name="__codelineno-15-85"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-86" name="__codelineno-15-86"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-15-87" name="__codelineno-15-87"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-88" name="__codelineno-15-88"></a>
<a id="__codelineno-15-89" name="__codelineno-15-89"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-90" name="__codelineno-15-90"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithoutCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">        </span>
<a id="__codelineno-15-91" name="__codelineno-15-91"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithoutCategorie</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-15-92" name="__codelineno-15-92"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-93" name="__codelineno-15-93"></a>
<a id="__codelineno-15-94" name="__codelineno-15-94"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-95" name="__codelineno-15-95"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-96" name="__codelineno-15-96"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-15-97" name="__codelineno-15-97"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-98" name="__codelineno-15-98"></a>
<a id="__codelineno-15-99" name="__codelineno-15-99"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 12 : la classe est un singleton Spring ;</li>
<li>ligne 13 : qui implémente l'interface [IDao] de la couche [DAO] ;</li>
<li>lignes 16-17 : injection d'une référence sur la couche [DAO] ;</li>
<li>lignes 19-99 : implémentation de l'interface [IDao] ;</li>
</ul>
<p>L'architecture de la couche web évolue comme suit :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000466000001628820A007.png" style="display:inline-block; margin:4px;width:14.896cm;height:4.683cm;" /></td></tr></table>

<ul>
<li>en [2b], les méthodes du ou des contrôleurs communiquent avec le singleton [ApplicationModel] ;</li>
</ul>
<p>Cette stratégie amène de la souplesse quant à la gestion d'un éventuel cache. La classe [ApplicationModel] peut servir à mémoriser des informations obtenues auprès de la couche [DAO] ou encore des données de configuration. Cela peut être utile lorsqu'on n'a pas la maîtrise de la couche [DAO]. Cette stratégie de cache peut évoluer au fil du temps. Les modifications n'auront aucun impact sur le code du ou des contrôleurs.</p>
<h3 id="1355-le-controleur">13.5.5. Le contrôleur</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004550000016BDC470FEB.png" style="display:inline-block; margin:4px;width:14.672cm;height:4.803cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F2000000A33600291A.png" style="display:inline-block; margin:4px;width:4.48cm;height:3.02cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Nous n'avons ici qu'un contrôleur, la classe [MyController].</p>
<h4 id="13551-les-url-exposees">13.5.5.1. Les URL exposées</h4>
<p>Les URL exposées par ce contrôleur sont les suivantes :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="w">    </span><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/addProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">POST</span><span class="p">,</span><span class="w"> </span><span class="nx">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">addProduits</span><span class="p">(</span><span class="nx">HttpServletRequest</span><span class="w"> </span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="p">...</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Ajoute des produits dans la base. Ceux-ci sont postés. La réponse est la chaîne jSON la liste des produits ajoutés avec leur clé primaire.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="w">    </span><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/deleteAllProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">GET</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">deleteAllProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="p">..</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Supprime tous les produits de la base.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="w">    </span><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/updateProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">POST</span><span class="p">,</span><span class="w"> </span><span class="nx">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">updateProduits</span><span class="p">(</span><span class="nx">HttpServletRequest</span><span class="w"> </span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="p">..</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Met à jour des produits dans la base. Ceux-ci sont postés. La réponse est chaîne jSON de la liste des produits mis à jour.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a>    @RequestMapping(value = &quot;/getAllProduits&quot;, method = RequestMethod.GET)
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>    public String getAllProduits() {
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>..
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON de tous les produits.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="w">    </span><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/addCategories&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">POST</span><span class="p">,</span><span class="w"> </span><span class="nx">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">addCategories</span><span class="p">(</span><span class="nx">HttpServletRequest</span><span class="w"> </span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="p">..</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Ajoute des catégories dans la base. Ceux-ci sont postés. La réponse est la chaîne jSON de la liste des catégories ajoutées avec leur clé primaire. Si les catégories contiennent des produits, ceux-ci sont également ajoutés à la base.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="w">    </span><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/deleteAllCategories&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">GET</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">deleteAllCategories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="p">...</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Supprime toutes les catégories de la base ainsi que tous les produits de celles-ci. Après la base est vide.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="w">    </span><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/updateCategories&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">POST</span><span class="p">,</span><span class="w"> </span><span class="nx">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">updateCategories</span><span class="p">(</span><span class="nx">HttpServletRequest</span><span class="w"> </span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="p">...</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Met à jour des catégories dans la base. Ceux-ci sont postés. La réponse est la liste des catégories mises à jour. Si les catégories contiennent des produits, ceux-ci sont également mis à jour dans la base. Rend la chaîne jSON des catégories modifiées ;</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>    @RequestMapping(value = &quot;/getAllCategories&quot;, method = RequestMethod.GET)
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    public String getAllCategories() {
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>...
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON de toutes les catégories.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>    @RequestMapping(value = &quot;/getProduitByIdWithCategorie/{idProduit}&quot;, method = RequestMethod.GET)
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>    public String getProduitByIdWithCategorie(@PathVariable(&quot;idProduit&quot;) Long idProduit) {
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>...
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'un produit désigné par son id, avec sa catégorie.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>    @RequestMapping(value = &quot;/getProduitByIdWithoutCategorie/{idProduit}&quot;, method = RequestMethod.GET)
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>    public String getProduitByIdWithoutCategorie(@PathVariable(&quot;idProduit&quot;) Long idProduit) {
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>...
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'un produit désigné par son id, sans sa catégorie.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>    @RequestMapping(value = &quot;/getProduitByNameWithCategorie/{nom}&quot;, method = RequestMethod.GET)
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>    public String getProduitByNameWithCategorie(@PathVariable(&quot;nom&quot;) String nom) {
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>...
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'un produit désigné par son nom, avec sa catégorie.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>    @RequestMapping(value = &quot;/getProduitByNameWithoutCategorie/{nom}&quot;, method = RequestMethod.GET)
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>    public String getProduitByNameWithoutCategorie(@PathVariable(&quot;nom&quot;) String nom) {
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>...
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'un produit désigné par son nom, sans sa catégorie.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>    @RequestMapping(value = &quot;/getCategorieByIdWithProduits/{idCategorie}&quot;, method = RequestMethod.GET)
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>    public String getCategorieByIdWithProduits(@PathVariable(&quot;idCategorie&quot;) Long idCategorie) {
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>...
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'une catégorie désignée par son id, avec ses produits.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>    @RequestMapping(value = &quot;/getCategorieByNameWithProduits/{nom}&quot;, method = RequestMethod.GET)
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>    public String getCategorieByNameWithProduits(@PathVariable(&quot;nom&quot;) String nom) {
<a id="__codelineno-29-3" name="__codelineno-29-3"></a>...
<a id="__codelineno-29-4" name="__codelineno-29-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'une catégorie désignée par son nom, avec ses produits.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>    @RequestMapping(value = &quot;/getCategorieByNameWithoutProduits/{nom}&quot;, method = RequestMethod.GET)
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>    public String getCategorieByNameWithoutProduits(@PathVariable(&quot;nom&quot;) String nom) {
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>...
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'une catégorie désignée par son nom, sans ses produits.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>    @RequestMapping(value = &quot;/getCategorieByIdWithoutProduits/{idCategorie}&quot;, method = RequestMethod.GET)
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>    public String getCategorieByIdWithoutProduits(@PathVariable(&quot;idCategorie&quot;) Long idCategorie) {
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>...
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>    }
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Obtient la chaîne jSON d'une catégorie désignée par son id sans ses produits.</p></td></tr></table>

<p>Les URL exposées correspondent aux méthodes de l'interface [IDao] de la couche [DAO]. Les méthodes du service web / jSON sont toutes bâties sur le même modèle. Nous allons en examiner quelques unes.</p>
<h4 id="13552-le-squelette-du-controleur">13.5.5.2. Le squelette du contrôleur</h4>
<p>Le squelette du contrôleur est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span>
<span class="normal"><a href="#__codelineno-32-24">24</a></span>
<span class="normal"><a href="#__codelineno-32-25">25</a></span>
<span class="normal"><a href="#__codelineno-32-26">26</a></span>
<span class="normal"><a href="#__codelineno-32-27">27</a></span>
<span class="normal"><a href="#__codelineno-32-28">28</a></span>
<span class="normal"><a href="#__codelineno-32-29">29</a></span>
<span class="normal"><a href="#__codelineno-32-30">30</a></span>
<span class="normal"><a href="#__codelineno-32-31">31</a></span>
<span class="normal"><a href="#__codelineno-32-32">32</a></span>
<span class="normal"><a href="#__codelineno-32-33">33</a></span>
<span class="normal"><a href="#__codelineno-32-34">34</a></span>
<span class="normal"><a href="#__codelineno-32-35">35</a></span>
<span class="normal"><a href="#__codelineno-32-36">36</a></span>
<span class="normal"><a href="#__codelineno-32-37">37</a></span>
<span class="normal"><a href="#__codelineno-32-38">38</a></span>
<span class="normal"><a href="#__codelineno-32-39">39</a></span>
<span class="normal"><a href="#__codelineno-32-40">40</a></span>
<span class="normal"><a href="#__codelineno-32-41">41</a></span>
<span class="normal"><a href="#__codelineno-32-42">42</a></span>
<span class="normal"><a href="#__codelineno-32-43">43</a></span>
<span class="normal"><a href="#__codelineno-32-44">44</a></span>
<span class="normal"><a href="#__codelineno-32-45">45</a></span>
<span class="normal"><a href="#__codelineno-32-46">46</a></span>
<span class="normal"><a href="#__codelineno-32-47">47</a></span>
<span class="normal"><a href="#__codelineno-32-48">48</a></span>
<span class="normal"><a href="#__codelineno-32-49">49</a></span>
<span class="normal"><a href="#__codelineno-32-50">50</a></span>
<span class="normal"><a href="#__codelineno-32-51">51</a></span>
<span class="normal"><a href="#__codelineno-32-52">52</a></span>
<span class="normal"><a href="#__codelineno-32-53">53</a></span>
<span class="normal"><a href="#__codelineno-32-54">54</a></span>
<span class="normal"><a href="#__codelineno-32-55">55</a></span>
<span class="normal"><a href="#__codelineno-32-56">56</a></span>
<span class="normal"><a href="#__codelineno-32-57">57</a></span>
<span class="normal"><a href="#__codelineno-32-58">58</a></span>
<span class="normal"><a href="#__codelineno-32-59">59</a></span>
<span class="normal"><a href="#__codelineno-32-60">60</a></span>
<span class="normal"><a href="#__codelineno-32-61">61</a></span>
<span class="normal"><a href="#__codelineno-32-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.service</span><span class="p">;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.servlet.http.HttpServletRequest</span><span class="p">;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="p">;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="p">;</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="p">;</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.type.TypeReference</span><span class="p">;</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.io.CharStreams</span><span class="p">;</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.dao.DaoException</span><span class="p">;</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.webjson.models.ApplicationModel</span><span class="p">;</span>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.webjson.models.Response</span><span class="p">;</span>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a><span class="nd">@Controller</span>
<a id="__codelineno-32-29" name="__codelineno-32-29"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-30" name="__codelineno-32-30"></a>
<a id="__codelineno-32-31" name="__codelineno-32-31"></a><span class="w">    </span><span class="c1">// dépendances Spring</span>
<a id="__codelineno-32-32" name="__codelineno-32-32"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-32-33" name="__codelineno-32-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ApplicationModel</span><span class="w"> </span><span class="n">application</span><span class="p">;</span>
<a id="__codelineno-32-34" name="__codelineno-32-34"></a>
<a id="__codelineno-32-35" name="__codelineno-32-35"></a><span class="w">    </span><span class="c1">// filtres jSON</span>
<a id="__codelineno-32-36" name="__codelineno-32-36"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-32-37" name="__codelineno-32-37"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-32-38" name="__codelineno-32-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">;</span>
<a id="__codelineno-32-39" name="__codelineno-32-39"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-32-40" name="__codelineno-32-40"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-32-41" name="__codelineno-32-41"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">;</span>
<a id="__codelineno-32-42" name="__codelineno-32-42"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-32-43" name="__codelineno-32-43"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-32-44" name="__codelineno-32-44"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithCategorie</span><span class="p">;</span>
<a id="__codelineno-32-45" name="__codelineno-32-45"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-32-46" name="__codelineno-32-46"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-32-47" name="__codelineno-32-47"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">;</span>
<a id="__codelineno-32-48" name="__codelineno-32-48"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-32-49" name="__codelineno-32-49"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-32-50" name="__codelineno-32-50"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">;</span>
<a id="__codelineno-32-51" name="__codelineno-32-51"></a>
<a id="__codelineno-32-52" name="__codelineno-32-52"></a><span class="w">    </span><span class="c1">// la classe [MyController] est un singleton et n&#39;est instanciée qu&#39;une fois le bean</span>
<a id="__codelineno-32-53" name="__codelineno-32-53"></a>
<a id="__codelineno-32-54" name="__codelineno-32-54"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyController</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-55" name="__codelineno-32-55"></a><span class="w">        </span><span class="c1">// System.out.println(&quot;MyController&quot;);</span>
<a id="__codelineno-32-56" name="__codelineno-32-56"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-57" name="__codelineno-32-57"></a>
<a id="__codelineno-32-58" name="__codelineno-32-58"></a><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/addProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span><span class="w"> </span><span class="n">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;application/json; charset=UTF-8&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-32-59" name="__codelineno-32-59"></a><span class="w">    </span><span class="nd">@ResponseBody</span>
<a id="__codelineno-32-60" name="__codelineno-32-60"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-61" name="__codelineno-32-61"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-32-62" name="__codelineno-32-62"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 28 : l'annotation [@Controller] fait de la classe un composant Spring ;</li>
<li>lignes 32-33 : injection d'une référence sur la classe [ApplicationModel] ;</li>
<li>lignes 36-50 : injections de références sur les mappeurs jSON ;</li>
<li>ligne 58 : l'URL exposée est [/addProduits]. Le client doit utiliser une méthode [POST] pour faire sa requête (method = RequestMethod.<strong>POST</strong>). Il doit envoyer la valeur postée sous forme d'une chaîne jSON (consumes = "application/json; charset=UTF-8"). La méthode renvoie elle-même la réponse au client (ligne 59). Ce sera une chaîne de caractères (ligne 60). L'entête HTTP [Content-type : application/json; charset=UTF-8] sera envoyé au client pour lui indiquer qu'il va recevoir une chaîne jSON (ligne 58) ;</li>
<li>ligne 60 : la méthode [addProduits] rend la chaîne jSON de la liste des produits ajoutés dans la base ;</li>
</ul>
<h4 id="13553-la-reponse-des-methodes-du-controleur">13.5.5.3. La réponse des méthodes du contrôleur</h4>
<p>Toutes les méthodes du contrôleur rendent la réponse de type [Response] suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F8000000B7C9BEFCEE.png" style="display:inline-block; margin:4px;width:4.59cm;height:3.39cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span>
<span class="normal"><a href="#__codelineno-33-22">22</a></span>
<span class="normal"><a href="#__codelineno-33-23">23</a></span>
<span class="normal"><a href="#__codelineno-33-24">24</a></span>
<span class="normal"><a href="#__codelineno-33-25">25</a></span>
<span class="normal"><a href="#__codelineno-33-26">26</a></span>
<span class="normal"><a href="#__codelineno-33-27">27</a></span>
<span class="normal"><a href="#__codelineno-33-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.service</span><span class="p">;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">    </span><span class="c1">// ----------------- propriétés</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">    </span><span class="c1">// statut de l&#39;opération</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">    </span><span class="c1">// les éventuels messages d&#39;erreur</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">;</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">    </span><span class="c1">// le corps de la réponse</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">body</span><span class="p">;</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Response</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Response</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">;</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="p">;</span>
<a id="__codelineno-33-24" name="__codelineno-33-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-25" name="__codelineno-33-25"></a>
<a id="__codelineno-33-26" name="__codelineno-33-26"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-33-27" name="__codelineno-33-27"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-33-28" name="__codelineno-33-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5 : la réponse encapsule un type T ;</li>
<li>ligne 13 : la réponse de type T ;</li>
<li>lignes 9-11 : il est possible qu'une méthode rencontre une exception. Dans ce cas, elle rendra une réponse avec :</li>
<li>ligne 9 : status!=0 ;</li>
<li>ligne 11 : la liste des erreurs rencontrées ;</li>
</ul>
<h4 id="13554-lurl-addproduits">13.5.5.4. L'URL [/addProduits]</h4>
<p>L'URL [/addProduits] est traitée par la méthode suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span>
<span class="normal"><a href="#__codelineno-34-24">24</a></span>
<span class="normal"><a href="#__codelineno-34-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/addProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">POST</span><span class="p">,</span><span class="w"> </span><span class="nx">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">    </span><span class="err">@</span><span class="nx">ResponseBody</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">addProduits</span><span class="p">(</span><span class="nx">HttpServletRequest</span><span class="w"> </span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="kr">throws</span><span class="w"> </span><span class="nx">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">        </span><span class="c1">// réponse</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">        </span><span class="nx">Response</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">            </span><span class="c1">// on récupère la valeur postée</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">            </span><span class="nb">String</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CharStreams</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">getReader</span><span class="p">());</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">            </span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">jsonMapperProduitWithoutCategorie</span><span class="p">.</span><span class="nx">readValue</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TypeReference</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">            </span><span class="p">});</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="w">            </span><span class="c1">// on rétablit le lien entre produits et catégories</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">Produit</span><span class="w"> </span><span class="nx">produit</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="w">                </span><span class="nx">produit</span><span class="p">.</span><span class="nx">setCategorie</span><span class="p">(</span><span class="nx">application</span><span class="p">.</span><span class="nx">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="nx">produit</span><span class="p">.</span><span class="nx">getIdCategorie</span><span class="p">()));</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="w">            </span><span class="c1">// on persiste les produits</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">            </span><span class="nx">application</span><span class="p">.</span><span class="nx">addProduits</span><span class="p">(</span><span class="nx">produits</span><span class="p">);</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Respon</span><span class="w">    </span><span class="nx">se</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">produits</span><span class="p">);</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">DaoException</span><span class="w"> </span><span class="nx">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Response</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mf">1000</span><span class="p">,</span><span class="w"> </span><span class="nx">e1</span><span class="p">.</span><span class="nx">getErreurs</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">Exception</span><span class="w"> </span><span class="nx">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Response</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mf">1000</span><span class="p">,</span><span class="w"> </span><span class="nx">getErreursForException</span><span class="p">(</span><span class="nx">e2</span><span class="p">),</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a><span class="w">        </span><span class="c1">// réponse jSON</span>
<a id="__codelineno-34-24" name="__codelineno-34-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">jsonMapperProduitWithoutCategorie</span><span class="p">.</span><span class="nx">writeValueAsString</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<a id="__codelineno-34-25" name="__codelineno-34-25"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 3 : la méthode admet pour paramètre [HttpServletRequest request] qui encapsule toutes les informations sur la requête du client ;</li>
<li>ligne 5 : la réponse qui sera envoyée au client : une liste de produits ;</li>
<li>ligne 8 : on récupère la valeur postée. La classe [CharStreams] appartient à la bibliothèque [Google Guava] dont on a ajouté la référence dans le fichier [pom.xml]. On obtient la chaîne jSON postée par le client. Il faut la désérialiser pour en faire quelque chose ;</li>
<li>lignes 8-10 : la désérialisation est faite. On obtient une liste de produits où chaque produit a un champ [categorie=null] ;</li>
<li>lignes 12-14 : on réinitialise le champ [categorie] de tous les produits de la liste. Pour cela, on utilise le champ [idCategorie] du produit qui lui, est initialisé ;</li>
<li>ligne 16 : les produits sont insérés dans la base ;</li>
<li>ligne 17 : l'objet [response] est initialisé avec la liste de produits ;</li>
<li>lignes 18-19 : cas où la méthode rencontre une exception de la couche [DAO]. On initialise la réponse avec [status=1000] (code d'erreur) [messages=e1.getMessages()], ç-à-d qu'on transmet au client la liste des erreurs rencontrées côté serveur ;</li>
<li>lignes 20-21 : cas où la méthode rencontre un autre type d'exception. On initialise la réponse avec [status=1000] (code d'erreur) [messages=getErreursForException(e)] où [getErreursForException] est une méthode privée de la classe qui rend la liste des erreurs associées aux exceptions de la pile d'exceptions de e, et [body=null] ;</li>
<li>ligne 24 : on rend la chaîne jSON de la réponse ;</li>
</ul>
<h4 id="13555-lurl-getallproduits">13.5.5.5. L'URL [/getAllProduits]</h4>
<p>L'URL [/getAllProduits] est traitée par la méthode suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>    @RequestMapping(value = &quot;/getAllProduits&quot;, method = RequestMethod.GET, produces = &quot;application/json; charset=UTF-8&quot;)
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>    @ResponseBody
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>    public String getAllProduits() throws JsonProcessingException {
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>        // réponse
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>        Response&lt;List&lt;Produit&gt;&gt; response;
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>        try {
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>            response = new Response&lt;List&lt;Produit&gt;&gt;(0, null, application.getAllProduits());
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>        } catch (DaoException e1) {
<a id="__codelineno-35-9" name="__codelineno-35-9"></a>            response = new Response&lt;List&lt;Produit&gt;&gt;(1003, e1.getErreurs(), null);
<a id="__codelineno-35-10" name="__codelineno-35-10"></a>        } catch (Exception e2) {
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>            response = new Response&lt;List&lt;Produit&gt;&gt;(1003, getErreursForException(e2), null);
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>        }
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>        // réponse jSON
<a id="__codelineno-35-14" name="__codelineno-35-14"></a>        return jsonMapperProduitWithoutCategorie.writeValueAsString(response);
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>}
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : l'URL [/getAllProduits] est demandée avec une opération [GET]. Elle produit du jSON ;</li>
<li>ligne 2 : la méthode envoie elle-même la réponse jSON au client ;</li>
<li>ligne 5 : la méthode envoie la chaîne jSON d'un type [Response&lt;List&lt;Produit&gt;&gt;] ;</li>
<li>ligne 7 : les produits sont demandés sans leur catégorie ;</li>
<li>lignes 8-12 : en cas d'erreur, la réponse est initialisée avec un code et des messages d'erreur ;</li>
<li>ligne 14 : la réponse jSON de la réponse est envoyée au client ;</li>
</ul>
<h4 id="13556-conclusion">13.5.5.6. Conclusion</h4>
<p>Nous n'allons pas présenter les autres méthodes du contrôleur. Elles ressemblent à l'une ou l'autre des deux méthodes que nous enons de présenter.</p>
<h3 id="1356-la-classe-dexecution-du-service-web-json">13.5.6. La classe d'exécution du service web / jSON</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E9000000A2EB61237D.png" style="display:inline-block; margin:4px;width:4.309cm;height:3cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [Boot] est la classe exécutable du projet :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.boot</span><span class="p">;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.webjson.server.config.AppConfig</span><span class="p">;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Boot</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 10 : la méthode statique [SpringApplication.run] est exécutée. La classe [SpringApplication] est une classe du projet [Spring Boot] (ligne 3). On lui passe deux paramètres :</li>
<li>[AppConfig.<strong>class</strong>] : la classe qui configure la totalité de l'application ;</li>
<li>[args] : les éventuels arguments passés à la méthode [main] ligne 9. Ce paramètre n'est pas utilisé ici ;</li>
</ul>
<p>Lorsqu'on exécute cette classe, on a les logs suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span>
<span class="normal"><a href="#__codelineno-37-26">26</a></span>
<span class="normal"><a href="#__codelineno-37-27">27</a></span>
<span class="normal"><a href="#__codelineno-37-28">28</a></span>
<span class="normal"><a href="#__codelineno-37-29">29</a></span>
<span class="normal"><a href="#__codelineno-37-30">30</a></span>
<span class="normal"><a href="#__codelineno-37-31">31</a></span>
<span class="normal"><a href="#__codelineno-37-32">32</a></span>
<span class="normal"><a href="#__codelineno-37-33">33</a></span>
<span class="normal"><a href="#__codelineno-37-34">34</a></span>
<span class="normal"><a href="#__codelineno-37-35">35</a></span>
<span class="normal"><a href="#__codelineno-37-36">36</a></span>
<span class="normal"><a href="#__codelineno-37-37">37</a></span>
<span class="normal"><a href="#__codelineno-37-38">38</a></span>
<span class="normal"><a href="#__codelineno-37-39">39</a></span>
<span class="normal"><a href="#__codelineno-37-40">40</a></span>
<span class="normal"><a href="#__codelineno-37-41">41</a></span>
<span class="normal"><a href="#__codelineno-37-42">42</a></span>
<span class="normal"><a href="#__codelineno-37-43">43</a></span>
<span class="normal"><a href="#__codelineno-37-44">44</a></span>
<span class="normal"><a href="#__codelineno-37-45">45</a></span>
<span class="normal"><a href="#__codelineno-37-46">46</a></span>
<span class="normal"><a href="#__codelineno-37-47">47</a></span>
<span class="normal"><a href="#__codelineno-37-48">48</a></span>
<span class="normal"><a href="#__codelineno-37-49">49</a></span>
<span class="normal"><a href="#__codelineno-37-50">50</a></span>
<span class="normal"><a href="#__codelineno-37-51">51</a></span>
<span class="normal"><a href="#__codelineno-37-52">52</a></span>
<span class="normal"><a href="#__codelineno-37-53">53</a></span>
<span class="normal"><a href="#__codelineno-37-54">54</a></span>
<span class="normal"><a href="#__codelineno-37-55">55</a></span>
<span class="normal"><a href="#__codelineno-37-56">56</a></span>
<span class="normal"><a href="#__codelineno-37-57">57</a></span>
<span class="normal"><a href="#__codelineno-37-58">58</a></span>
<span class="normal"><a href="#__codelineno-37-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="p">.</span><span class="w">   </span><span class="nx">____</span><span class="w">          </span><span class="nx">_</span><span class="w">            </span><span class="nx">__</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">_</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w"> </span><span class="o">/</span><span class="err">\\</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">___</span><span class="s1">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="s1">( ( )\___ | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;_| | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="err">\</span><span class="o">/</span><span class="w"> </span><span class="nx">_</span><span class="sb">` | \ \ \ \</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="sb"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="sb">  &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="sb"> =========|_|==============|___/=/_/_/_/</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="sb"> :: Spring Boot ::        (v1.2.2.RELEASE)</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="sb">2015-03-24 16:22:46.608  INFO 9492 --- [           main] spring.webjson.server.boot.Boot          : Starting Boot on Gportpers3 with PID 9492 (D:\data\istia-1415\eclipse\intro-web-json\intro-webjson-server-02\target\classes started by ST in D:\data\istia-1415\eclipse\intro-web-json\intro-webjson-server-02)</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="sb">2015-03-24 16:22:46.654  INFO 9492 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@1d7acb34: startup date [Tue Mar 24 16:22:46 CET 2015]; root of context hierarchy</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="sb">2015-03-24 16:22:47.521  INFO 9492 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Overriding bean definition for bean &#39;beanNameViewResolver&#39;: replacing [Root bean: class [null]; scope=; abstract=false; lazyInit=false; autowireMode=3; dependencyCheck=0; autowireCandidate=true; primary=false; factoryBeanName=org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration$WhitelabelErrorViewConfiguration; factoryMethodName=beanNameViewResolver; initMethodName=null; destroyMethodName=(inferred); defined in class path resource [org/springframework/boot/autoconfigure/web/ErrorMvcAutoConfiguration$WhitelabelErrorViewConfiguration.class]] with [Root bean: class [null]; scope=; abstract=false; lazyInit=false; autowireMode=3; dependencyCheck=0; autowireCandidate=true; primary=false; factoryBeanName=org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration$WebMvcAutoConfigurationAdapter; factoryMethodName=beanNameViewResolver; initMethodName=null; destroyMethodName=(inferred); defined in class path resource [org/springframework/boot/autoconfigure/web/WebMvcAutoConfiguration$WebMvcAutoConfigurationAdapter.class]]</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="sb">2015-03-24 16:22:47.569  INFO 9492 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Overriding bean definition for bean &#39;entityManagerFactory&#39;: replacing [Root bean: class [null]; scope=; abstract=false; lazyInit=false; autowireMode=3; dependencyCheck=0; autowireCandidate=true; primary=false; factoryBeanName=spring.data.config.DaoConfig; factoryMethodName=entityManagerFactory; initMethodName=null; destroyMethodName=(inferred); defined in class spring.data.config.DaoConfig] with [Root bean: class [null]; scope=; abstract=false; lazyInit=false; autowireMode=3; dependencyCheck=0; autowireCandidate=true; primary=true; factoryBeanName=org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration; factoryMethodName=entityManagerFactory; initMethodName=null; destroyMethodName=(inferred); defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.class]]</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="sb">2015-03-24 16:22:48.137  INFO 9492 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration&#39; of type [class org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration$$EnhancerBySpringCGLIB$$405db6ba] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="sb">2015-03-24 16:22:48.162  INFO 9492 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;transactionAttributeSource&#39; of type [class org.springframework.transaction.annotation.AnnotationTransactionAttributeSource] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="sb">2015-03-24 16:22:48.172  INFO 9492 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;transactionInterceptor&#39; of type [class org.springframework.transaction.interceptor.TransactionInterceptor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="sb">2015-03-24 16:22:48.178  INFO 9492 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.transaction.config.internalTransactionAdvisor&#39; of type [class org.springframework.transaction.interceptor.BeanFactoryTransactionAttributeSourceAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="sb">2015-03-24 16:22:48.586  INFO 9492 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="sb">2015-03-24 16:22:48.850  INFO 9492 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="sb">2015-03-24 16:22:48.852  INFO 9492 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.0.20</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="sb">2015-03-24 16:22:48.992  INFO 9492 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="sb">2015-03-24 16:22:48.992  INFO 9492 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 2342 ms</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="sb">2015-03-24 16:22:49.645  INFO 9492 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: &#39;dispatcherServlet&#39; to [/]</span>
<a id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="sb">2015-03-24 16:22:49.650  INFO 9492 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: &#39;characterEncodingFilter&#39; to: [/*]</span>
<a id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="sb">2015-03-24 16:22:49.651  INFO 9492 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: &#39;hiddenHttpMethodFilter&#39; to: [/*]</span>
<a id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="sb">2015-03-24 16:22:50.380  INFO 9492 --- [           main] j.LocalContainerEntityManagerFactoryBean : Building JPA container EntityManagerFactory for persistence unit &#39;default&#39;</span>
<a id="__codelineno-37-26" name="__codelineno-37-26"></a><span class="sb">2015-03-24 16:22:50.392  INFO 9492 --- [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [</span>
<a id="__codelineno-37-27" name="__codelineno-37-27"></a><span class="sb">    name: default</span>
<a id="__codelineno-37-28" name="__codelineno-37-28"></a><span class="sb">    ...]</span>
<a id="__codelineno-37-29" name="__codelineno-37-29"></a><span class="sb">2015-03-24 16:22:50.478  INFO 9492 --- [           main] org.hibernate.Version                    : HHH000412: Hibernate Core {4.3.8.Final}</span>
<a id="__codelineno-37-30" name="__codelineno-37-30"></a><span class="sb">2015-03-24 16:22:50.480  INFO 9492 --- [           main] org.hibernate.cfg.Environment            : HHH000206: hibernate.properties not found</span>
<a id="__codelineno-37-31" name="__codelineno-37-31"></a><span class="sb">2015-03-24 16:22:50.483  INFO 9492 --- [           main] org.hibernate.cfg.Environment            : HHH000021: Bytecode provider name : javassist</span>
<a id="__codelineno-37-32" name="__codelineno-37-32"></a><span class="sb">2015-03-24 16:22:50.697  INFO 9492 --- [           main] o.hibernate.annotations.common.Version   : HCANN000001: Hibernate Commons Annotations {4.0.5.Final}</span>
<a id="__codelineno-37-33" name="__codelineno-37-33"></a><span class="sb">2015-03-24 16:22:50.806  INFO 9492 --- [           main] org.hibernate.dialect.Dialect            : HHH000400: Using dialect: org.hibernate.dialect.MySQLDialect</span>
<a id="__codelineno-37-34" name="__codelineno-37-34"></a><span class="sb">2015-03-24 16:22:51.058  INFO 9492 --- [           main] o.h.h.i.ast.ASTQueryTranslatorFactory    : HHH000397: Using ASTQueryTranslatorFactory</span>
<a id="__codelineno-37-35" name="__codelineno-37-35"></a><span class="sb">2015-03-24 16:22:52.581  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@1d7acb34: startup date [Tue Mar 24 16:22:46 CET 2015]; root of context hierarchy</span>
<a id="__codelineno-37-36" name="__codelineno-37-36"></a><span class="sb">2015-03-24 16:22:52.654  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/addProduits],methods=[POST],params=[],headers=[],consumes=[application/json;charset=UTF-8],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.util.List&lt;spring.data.entities.Produit&gt;&gt; spring.webjson.server.service.Controller.addProduits(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-37-37" name="__codelineno-37-37"></a><span class="sb">2015-03-24 16:22:52.655  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/updateProduits],methods=[POST],params=[],headers=[],consumes=[application/json;charset=UTF-8],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.util.List&lt;spring.data.entities.Produit&gt;&gt; spring.webjson.server.service.Controller.updateProduits(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-37-38" name="__codelineno-37-38"></a><span class="sb">2015-03-24 16:22:52.655  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getAllProduits],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.util.List&lt;spring.data.entities.Produit&gt;&gt; spring.webjson.server.service.Controller.getAllProduits()</span>
<a id="__codelineno-37-39" name="__codelineno-37-39"></a><span class="sb">2015-03-24 16:22:52.655  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getAllCategories],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.util.List&lt;spring.data.entities.Categorie&gt;&gt; spring.webjson.server.service.Controller.getAllCategories()</span>
<a id="__codelineno-37-40" name="__codelineno-37-40"></a><span class="sb">2015-03-24 16:22:52.655  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/addCategories],methods=[POST],params=[],headers=[],consumes=[application/json;charset=UTF-8],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.util.List&lt;spring.data.entities.Categorie&gt;&gt; spring.webjson.server.service.Controller.addCategories(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-37-41" name="__codelineno-37-41"></a><span class="sb">2015-03-24 16:22:52.655  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/updateCategories],methods=[POST],params=[],headers=[],consumes=[application/json;charset=UTF-8],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.util.List&lt;spring.data.entities.Categorie&gt;&gt; spring.webjson.server.service.Controller.updateCategories(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-37-42" name="__codelineno-37-42"></a><span class="sb">2015-03-24 16:22:52.656  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getCategorieByNameWithoutProduits/{nom}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Categorie&gt; spring.webjson.server.service.Controller.getCategorieByNameWithoutProduits(java.lang.String)</span>
<a id="__codelineno-37-43" name="__codelineno-37-43"></a><span class="sb">2015-03-24 16:22:52.656  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getProduitByNameWithoutCategorie/{nom}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Produit&gt; spring.webjson.server.service.Controller.getProduitByNameWithoutCategorie(java.lang.String)</span>
<a id="__codelineno-37-44" name="__codelineno-37-44"></a><span class="sb">2015-03-24 16:22:52.656  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getProduitByNameWithCategorie/{nom}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Produit&gt; spring.webjson.server.service.Controller.getProduitByNameWithCategorie(java.lang.String)</span>
<a id="__codelineno-37-45" name="__codelineno-37-45"></a><span class="sb">2015-03-24 16:22:52.656  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getProduitByIdWithCategorie/{idProduit}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Produit&gt; spring.webjson.server.service.Controller.getProduitByIdWithCategorie(java.lang.Long)</span>
<a id="__codelineno-37-46" name="__codelineno-37-46"></a><span class="sb">2015-03-24 16:22:52.656  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getCategorieByNameWithProduits/{nom}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Categorie&gt; spring.webjson.server.service.Controller.getCategorieByNameWithProduits(java.lang.String)</span>
<a id="__codelineno-37-47" name="__codelineno-37-47"></a><span class="sb">2015-03-24 16:22:52.657  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getCategorieByIdWithProduits/{idCategorie}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Categorie&gt; spring.webjson.server.service.Controller.getCategorieByIdWithProduits(java.lang.Long)</span>
<a id="__codelineno-37-48" name="__codelineno-37-48"></a><span class="sb">2015-03-24 16:22:52.657  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/deleteAllCategories],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.lang.Void&gt; spring.webjson.server.service.Controller.deleteAllCategories()</span>
<a id="__codelineno-37-49" name="__codelineno-37-49"></a><span class="sb">2015-03-24 16:22:52.657  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getCategorieByIdWithoutProduits/{idCategorie}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Categorie&gt; spring.webjson.server.service.Controller.getCategorieByIdWithoutProduits(java.lang.Long)</span>
<a id="__codelineno-37-50" name="__codelineno-37-50"></a><span class="sb">2015-03-24 16:22:52.657  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/deleteAllProduits],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;java.lang.Void&gt; spring.webjson.server.service.Controller.deleteAllProduits()</span>
<a id="__codelineno-37-51" name="__codelineno-37-51"></a><span class="sb">2015-03-24 16:22:52.658  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/getProduitByIdWithoutCategorie/{idProduit}],methods=[GET],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public spring.webjson.webjson.models.Response&lt;spring.data.entities.Produit&gt; spring.webjson.server.service.Controller.getProduitByIdWithoutCategorie(java.lang.Long)</span>
<a id="__codelineno-37-52" name="__codelineno-37-52"></a><span class="sb">2015-03-24 16:22:52.659  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/error],methods=[],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot; onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-37-53" name="__codelineno-37-53"></a><span class="sb">2015-03-24 16:22:52.659  INFO 9492 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;{[/error],methods=[],params=[],headers=[],consumes=[],produces=[text/html],custom=[]}&quot; onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest)</span>
<a id="__codelineno-37-54" name="__codelineno-37-54"></a><span class="sb">2015-03-24 16:22:52.691  INFO 9492 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span>
<a id="__codelineno-37-55" name="__codelineno-37-55"></a><span class="sb">2015-03-24 16:22:52.692  INFO 9492 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span>
<a id="__codelineno-37-56" name="__codelineno-37-56"></a><span class="sb">2015-03-24 16:22:52.742  INFO 9492 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span>
<a id="__codelineno-37-57" name="__codelineno-37-57"></a><span class="sb">2015-03-24 16:22:53.001  INFO 9492 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span>
<a id="__codelineno-37-58" name="__codelineno-37-58"></a><span class="sb">2015-03-24 16:22:53.106  INFO 9492 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)</span>
<a id="__codelineno-37-59" name="__codelineno-37-59"></a><span class="sb">2015-03-24 16:22:53.108  INFO 9492 --- [           main] spring.webjson.server.boot.Boot          : Started Boot in 6.752 seconds (JVM running for 7.433)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 17-19 : démarrage du serveur Tomcat qui va exécuter le service web / jSON ;</li>
<li>lignes 25-33 : construction de la couche [DAO] ;</li>
<li>lignes 32-51 : les URL exposées sont découvertes ;</li>
</ul>
<h3 id="1357-tests-du-service-web-json">13.5.7. Tests du service web / jSON</h3>
<p>Pour faire les tests, nous générons la base de données MySQL [dbintrospringdata] à partir du script SQL [dbintrospringdata.sql] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000B70000007E76D27739.png" style="display:inline-block; margin:4px;width:3.39cm;height:2.33cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Ceci fait, nous utilisons le client [Advanced Rest Client] (cf page 420) pour interroger les URL exposées par le service web / jSON (le service web / jSON doit être lancé). </p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003DB000001FB88B90933.png" style="display:inline-block; margin:4px;width:13.058cm;height:6.708cm;" /></td></tr></table>

<ul>
<li>en [1-3], nous demandons l'URL [/getAllCategories] via une commande HTTP GET ;</li>
</ul>
<p>Nous obtenons la réponse suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000031C000002CDA89C5976.png" style="display:inline-block; margin:4px;width:10.53cm;height:9.486cm;" /></td></tr></table>

<ul>
<li>en [1], la requête HTTP du client ;</li>
<li>en [2], la réponse HTTP du serveur ;</li>
<li>en [3], le statut [200 OK] indique que le serveur a correctement traité la demande ;</li>
<li>en [4], la réponse jSON du serveur ;</li>
</ul>
<p>La réponse jSON complète est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>{&quot;status&quot;:0,&quot;messages&quot;:null,&quot;body&quot;:[{&quot;id&quot;:415,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie0&quot;,&quot;produits&quot;:[{&quot;id&quot;:1849,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit00&quot;,&quot;idCategorie&quot;:415,&quot;prix&quot;:100.0,&quot;description&quot;:&quot;desc00&quot;},{&quot;id&quot;:1850,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit01&quot;,&quot;idCategorie&quot;:415,&quot;prix&quot;:101.0,&quot;description&quot;:&quot;desc01&quot;},{&quot;id&quot;:1851,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit02&quot;,&quot;idCategorie&quot;:415,&quot;prix&quot;:102.0,&quot;description&quot;:&quot;desc02&quot;},{&quot;id&quot;:1852,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit03&quot;,&quot;idCategorie&quot;:415,&quot;prix&quot;:103.0,&quot;description&quot;:&quot;desc03&quot;},{&quot;id&quot;:1853,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit04&quot;,&quot;idCategorie&quot;:415,&quot;prix&quot;:104.0,&quot;description&quot;:&quot;desc04&quot;}]},{&quot;id&quot;:416,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;,&quot;produits&quot;:[{&quot;id&quot;:1856,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit12&quot;,&quot;idCategorie&quot;:416,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;desc12&quot;},{&quot;id&quot;:1857,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit13&quot;,&quot;idCategorie&quot;:416,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;desc13&quot;},{&quot;id&quot;:1858,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:416,&quot;prix&quot;:114.0,&quot;description&quot;:&quot;desc14&quot;},{&quot;id&quot;:1854,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit10&quot;,&quot;idCategorie&quot;:416,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;desc10&quot;},{&quot;id&quot;:1855,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit11&quot;,&quot;idCategorie&quot;:416,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;desc11&quot;}]}]}
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>status:0</strong> signifie qu'il n'y a pas eu d'erreurs côté serveur ;</li>
<li><strong>messages : null</strong> signifie qu'il n'y a pas de messages d'erreur ;</li>
<li><strong>body</strong> : est le corps de la réponse, ici la liste des catégories avec leurs produits. Il y a deux catégories avec chacune 5 produits ;</li>
</ul>
<p>Nous allons ajouter à la catégorie [categorie1], le produit [produit15]. Pour cela nous allons utiliser l'URL [/addCategories] qui a le code suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span>
<span class="normal"><a href="#__codelineno-39-20">20</a></span>
<span class="normal"><a href="#__codelineno-39-21">21</a></span>
<span class="normal"><a href="#__codelineno-39-22">22</a></span>
<span class="normal"><a href="#__codelineno-39-23">23</a></span>
<span class="normal"><a href="#__codelineno-39-24">24</a></span>
<span class="normal"><a href="#__codelineno-39-25">25</a></span>
<span class="normal"><a href="#__codelineno-39-26">26</a></span>
<span class="normal"><a href="#__codelineno-39-27">27</a></span>
<span class="normal"><a href="#__codelineno-39-28">28</a></span>
<span class="normal"><a href="#__codelineno-39-29">29</a></span>
<span class="normal"><a href="#__codelineno-39-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="err">@</span><span class="nx">RequestMapping</span><span class="p">(</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/addCategories&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RequestMethod</span><span class="p">.</span><span class="nx">POST</span><span class="p">,</span><span class="w"> </span><span class="nx">consumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json; charset=UTF-8&quot;</span><span class="p">)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="w">    </span><span class="err">@</span><span class="nx">ResponseBody</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="nx">addCategories</span><span class="p">(</span><span class="nx">HttpServletRequest</span><span class="w"> </span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="kr">throws</span><span class="w"> </span><span class="nx">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">        </span><span class="nx">Response</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Categorie</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">;</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">        </span><span class="nx">ObjectMapper</span><span class="w"> </span><span class="nx">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">getBean</span><span class="p">(</span><span class="nx">ObjectMapper</span><span class="p">.</span><span class="kd">class</span><span class="p">);</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="w">        </span><span class="c1">// on persiste les catégories</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="w">            </span><span class="c1">// on récupère la valeur postée</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">            </span><span class="nb">String</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CharStreams</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">getReader</span><span class="p">());</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="w">            </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">setFilters</span><span class="p">(</span><span class="nx">jsonFilterCategorieWithProduits</span><span class="p">);</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="w">            </span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">readValue</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TypeReference</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Categorie</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="w">            </span><span class="p">});</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="w">            </span><span class="c1">// on rétablit le lien entre produits et catégories</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">Categorie</span><span class="w"> </span><span class="nx">categorie</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="w">                </span><span class="nb">Set</span><span class="o">&lt;</span><span class="nx">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">categorie</span><span class="p">.</span><span class="nx">getProduits</span><span class="p">();</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">produits</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">Produit</span><span class="w"> </span><span class="nx">produit</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">categorie</span><span class="p">.</span><span class="nx">getProduits</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a><span class="w">                        </span><span class="nx">produit</span><span class="p">.</span><span class="nx">setCategorie</span><span class="p">(</span><span class="nx">categorie</span><span class="p">);</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-39-21" name="__codelineno-39-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-22" name="__codelineno-39-22"></a><span class="w">            </span><span class="c1">// on persiste les catégories</span>
<a id="__codelineno-39-23" name="__codelineno-39-23"></a><span class="w">            </span><span class="nx">application</span><span class="p">.</span><span class="nx">addCategories</span><span class="p">(</span><span class="nx">categories</span><span class="p">);</span>
<a id="__codelineno-39-24" name="__codelineno-39-24"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Response</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Categorie</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">categories</span><span class="p">);</span>
<a id="__codelineno-39-25" name="__codelineno-39-25"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">Exception</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-26" name="__codelineno-39-26"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Response</span><span class="o">&lt;</span><span class="nx">List</span><span class="o">&lt;</span><span class="nx">Categorie</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mf">1004</span><span class="p">,</span><span class="w"> </span><span class="nx">getErreursForException</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-39-27" name="__codelineno-39-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-28" name="__codelineno-39-28"></a><span class="w">        </span><span class="c1">// réponse jSON</span>
<a id="__codelineno-39-29" name="__codelineno-39-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">mapper</span><span class="p">.</span><span class="nx">writeValueAsString</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<a id="__codelineno-39-30" name="__codelineno-39-30"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : le client doit faire un POST et la valeur postée doit être une chaîne jSON ;</li>
<li>lignes 9-12 : la valeur postée doit être une liste de catégories avec leurs produits associés ;</li>
</ul>
<p>Nous allons créer une catégorie [categorie2] avec un produit [produit21]. La chaîne jSON à envoyer est alors la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>[{&quot;id&quot;:null,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie2&quot;,&quot;produits&quot;:[{&quot;id&quot;:null,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit21&quot;,&quot;idCategorie&quot;:null,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;desc21&quot;}]}]
</code></pre></div></td></tr></table></div>
<p>La requête au service web / jSON est faite de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003FD000002DAA37EA8B6.png" style="display:inline-block; margin:4px;width:13.508cm;height:9.657cm;" /></td></tr></table>

<ul>
<li>en [1], l'URL demandée ;</li>
<li>en [2], elle est demandée via une opération POST ;</li>
<li>en [3], la chaîne jSON postée ;</li>
<li>en [4], on indique au serveur qu'on va lui envoyer du jSON ;</li>
</ul>
<p>La réponse du serveur est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002A3000003BA6C0FC241.png" style="display:inline-block; margin:4px;width:8.931cm;height:12.621cm;" /></td></tr></table>

<ul>
<li>en [1], on voit que et la catégorie et son produit ont maintenant une clé primaire montrant par là qu'ils ont probablement été insérés dans la base. Nous allons le vérifier en utilisant l'URL [/getCategorieByNameWithProduits/categorie2] :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002B80000014A54EDFFD4.png" style="display:inline-block; margin:4px;width:9.208cm;height:4.366cm;" /></td></tr></table>

<p>Nous obtenons le résultat suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001E00000026AD1B3CEE6.png" style="display:inline-block; margin:4px;width:6.35cm;height:8.176cm;" /></td></tr></table>

<p>Nous avons bien obtenu la catégorie [categorie2] avec son unique produit [produit21]. On peut aussi demander uniquement le produit. Utilisons pour cela l'URL [/getProduitByIdWithoutCategorie/1859] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000029C000000F1CCAE9599.png" style="display:inline-block; margin:4px;width:8.837cm;height:3.189cm;" /></td></tr></table>

<p>Nous obtenons le résultat suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001C8000001B94DB1B898.png" style="display:inline-block; margin:4px;width:6.033cm;height:5.835cm;" /></td></tr></table>

<p>Toutes les opérations [GET] peuvent être faites dans un simple navigateur :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002C000000053CAB3BCDB.png" style="display:inline-block; margin:4px;width:13.04cm;height:1.54cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le lecteur est invité à tester les autres URL du service web / json.</p>
<h2 id="136-un-client-programme-pour-le-service-web-json">13.6. Un client programmé pour le service web / jSON</h2>
<p>Maintenant que la base [dbintrospringdata] est disponible sur le web, nous allons écrire une application qui l'exploite. On aura alors l'architecture client / serveur suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000047C00000308921A5F6D.png" style="display:inline-block; margin:4px;width:15.187cm;height:10.266cm;" /></td></tr></table>

<p>L'application cliente aura deux couches :</p>
<ul>
<li>une couche [DAO] [2] pour communiquer avec l'application web / jSON qui expose la base de données ;</li>
<li>une couche de tests JUnit [1] pour vérifier que le client et le serveur font bien leur travail ;</li>
</ul>
<h3 id="1361-le-projet-eclipse">13.6.1. Le projet Eclipse</h3>
<p>Le projet Eclipse du client est le suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E9000000F98862577D.png" style="display:inline-block; margin:4px;width:4.309cm;height:4.611cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>le dossier [src/main/java] implémente la couche [DAO] ;</li>
<li>le dossier [src/test/java] implémente les tests JUnit ;</li>
</ul>
<h3 id="1362-configuration-maven-du-projet">13.6.2. Configuration Maven du projet</h3>
<p>Le projet est un projet Maven configuré par le fichier [pom.xml] suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span>
<span class="normal"><a href="#__codelineno-41-21">21</a></span>
<span class="normal"><a href="#__codelineno-41-22">22</a></span>
<span class="normal"><a href="#__codelineno-41-23">23</a></span>
<span class="normal"><a href="#__codelineno-41-24">24</a></span>
<span class="normal"><a href="#__codelineno-41-25">25</a></span>
<span class="normal"><a href="#__codelineno-41-26">26</a></span>
<span class="normal"><a href="#__codelineno-41-27">27</a></span>
<span class="normal"><a href="#__codelineno-41-28">28</a></span>
<span class="normal"><a href="#__codelineno-41-29">29</a></span>
<span class="normal"><a href="#__codelineno-41-30">30</a></span>
<span class="normal"><a href="#__codelineno-41-31">31</a></span>
<span class="normal"><a href="#__codelineno-41-32">32</a></span>
<span class="normal"><a href="#__codelineno-41-33">33</a></span>
<span class="normal"><a href="#__codelineno-41-34">34</a></span>
<span class="normal"><a href="#__codelineno-41-35">35</a></span>
<span class="normal"><a href="#__codelineno-41-36">36</a></span>
<span class="normal"><a href="#__codelineno-41-37">37</a></span>
<span class="normal"><a href="#__codelineno-41-38">38</a></span>
<span class="normal"><a href="#__codelineno-41-39">39</a></span>
<span class="normal"><a href="#__codelineno-41-40">40</a></span>
<span class="normal"><a href="#__codelineno-41-41">41</a></span>
<span class="normal"><a href="#__codelineno-41-42">42</a></span>
<span class="normal"><a href="#__codelineno-41-43">43</a></span>
<span class="normal"><a href="#__codelineno-41-44">44</a></span>
<span class="normal"><a href="#__codelineno-41-45">45</a></span>
<span class="normal"><a href="#__codelineno-41-46">46</a></span>
<span class="normal"><a href="#__codelineno-41-47">47</a></span>
<span class="normal"><a href="#__codelineno-41-48">48</a></span>
<span class="normal"><a href="#__codelineno-41-49">49</a></span>
<span class="normal"><a href="#__codelineno-41-50">50</a></span>
<span class="normal"><a href="#__codelineno-41-51">51</a></span>
<span class="normal"><a href="#__codelineno-41-52">52</a></span>
<span class="normal"><a href="#__codelineno-41-53">53</a></span>
<span class="normal"><a href="#__codelineno-41-54">54</a></span>
<span class="normal"><a href="#__codelineno-41-55">55</a></span>
<span class="normal"><a href="#__codelineno-41-56">56</a></span>
<span class="normal"><a href="#__codelineno-41-57">57</a></span>
<span class="normal"><a href="#__codelineno-41-58">58</a></span>
<span class="normal"><a href="#__codelineno-41-59">59</a></span>
<span class="normal"><a href="#__codelineno-41-60">60</a></span>
<span class="normal"><a href="#__codelineno-41-61">61</a></span>
<span class="normal"><a href="#__codelineno-41-62">62</a></span>
<span class="normal"><a href="#__codelineno-41-63">63</a></span>
<span class="normal"><a href="#__codelineno-41-64">64</a></span>
<span class="normal"><a href="#__codelineno-41-65">65</a></span>
<span class="normal"><a href="#__codelineno-41-66">66</a></span>
<span class="normal"><a href="#__codelineno-41-67">67</a></span>
<span class="normal"><a href="#__codelineno-41-68">68</a></span>
<span class="normal"><a href="#__codelineno-41-69">69</a></span>
<span class="normal"><a href="#__codelineno-41-70">70</a></span>
<span class="normal"><a href="#__codelineno-41-71">71</a></span>
<span class="normal"><a href="#__codelineno-41-72">72</a></span>
<span class="normal"><a href="#__codelineno-41-73">73</a></span>
<span class="normal"><a href="#__codelineno-41-74">74</a></span>
<span class="normal"><a href="#__codelineno-41-75">75</a></span>
<span class="normal"><a href="#__codelineno-41-76">76</a></span>
<span class="normal"><a href="#__codelineno-41-77">77</a></span>
<span class="normal"><a href="#__codelineno-41-78">78</a></span>
<span class="normal"><a href="#__codelineno-41-79">79</a></span>
<span class="normal"><a href="#__codelineno-41-80">80</a></span>
<span class="normal"><a href="#__codelineno-41-81">81</a></span>
<span class="normal"><a href="#__codelineno-41-82">82</a></span>
<span class="normal"><a href="#__codelineno-41-83">83</a></span>
<span class="normal"><a href="#__codelineno-41-84">84</a></span>
<span class="normal"><a href="#__codelineno-41-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>istia.st.webjson<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>intro-client-webjson-01<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>Client<span class="w"> </span>console<span class="w"> </span>du<span class="w"> </span>serveur<span class="w"> </span>web<span class="w"> </span>/<span class="w"> </span>jSON<span class="nt">&lt;/description&gt;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">        </span><span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">        </span><span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.7.RELEASE<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="w">        </span><span class="cm">&lt;!-- Spring --&gt;</span>
<a id="__codelineno-41-22" name="__codelineno-41-22"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-23" name="__codelineno-41-23"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-24" name="__codelineno-41-24"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-25" name="__codelineno-41-25"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-26" name="__codelineno-41-26"></a><span class="w">        </span><span class="cm">&lt;!-- librairie jSON utilisée par Spring --&gt;</span>
<a id="__codelineno-41-27" name="__codelineno-41-27"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-28" name="__codelineno-41-28"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-29" name="__codelineno-41-29"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>jackson-core<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-30" name="__codelineno-41-30"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-31" name="__codelineno-41-31"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-32" name="__codelineno-41-32"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-33" name="__codelineno-41-33"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-34" name="__codelineno-41-34"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-35" name="__codelineno-41-35"></a><span class="w">        </span><span class="cm">&lt;!-- composant utilisé par Spring RestTemplate --&gt;</span>
<a id="__codelineno-41-36" name="__codelineno-41-36"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-37" name="__codelineno-41-37"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-38" name="__codelineno-41-38"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>httpclient<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-39" name="__codelineno-41-39"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-40" name="__codelineno-41-40"></a><span class="w">        </span><span class="cm">&lt;!-- Google Guava --&gt;</span>
<a id="__codelineno-41-41" name="__codelineno-41-41"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-42" name="__codelineno-41-42"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.google.guava<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-43" name="__codelineno-41-43"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>guava<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-44" name="__codelineno-41-44"></a><span class="w">            </span><span class="nt">&lt;version&gt;</span>16.0.1<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-41-45" name="__codelineno-41-45"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-41-46" name="__codelineno-41-46"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-47" name="__codelineno-41-47"></a><span class="w">        </span><span class="cm">&lt;!-- bibliothèque de logs --&gt;</span>
<a id="__codelineno-41-48" name="__codelineno-41-48"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-49" name="__codelineno-41-49"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-50" name="__codelineno-41-50"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-logging<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-51" name="__codelineno-41-51"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-52" name="__codelineno-41-52"></a><span class="w">        </span><span class="cm">&lt;!-- Spring Boot Test --&gt;</span>
<a id="__codelineno-41-53" name="__codelineno-41-53"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-54" name="__codelineno-41-54"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-55" name="__codelineno-41-55"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-56" name="__codelineno-41-56"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-41-57" name="__codelineno-41-57"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-58" name="__codelineno-41-58"></a><span class="w">        </span><span class="cm">&lt;!-- Spring Boot --&gt;</span>
<a id="__codelineno-41-59" name="__codelineno-41-59"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-41-60" name="__codelineno-41-60"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-61" name="__codelineno-41-61"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-62" name="__codelineno-41-62"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-41-63" name="__codelineno-41-63"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-41-64" name="__codelineno-41-64"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-41-65" name="__codelineno-41-65"></a><span class="w">    </span><span class="cm">&lt;!-- plugins --&gt;</span>
<a id="__codelineno-41-66" name="__codelineno-41-66"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-41-67" name="__codelineno-41-67"></a><span class="w">        </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-41-68" name="__codelineno-41-68"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-41-69" name="__codelineno-41-69"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>maven-assembly-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-70" name="__codelineno-41-70"></a><span class="w">                </span><span class="nt">&lt;configuration&gt;</span>
<a id="__codelineno-41-71" name="__codelineno-41-71"></a><span class="w">                    </span><span class="nt">&lt;descriptorRefs&gt;</span>
<a id="__codelineno-41-72" name="__codelineno-41-72"></a><span class="w">                        </span><span class="nt">&lt;descriptorRef&gt;</span>jar-with-dependencies<span class="nt">&lt;/descriptorRef&gt;</span>
<a id="__codelineno-41-73" name="__codelineno-41-73"></a><span class="w">                    </span><span class="nt">&lt;/descriptorRefs&gt;</span>
<a id="__codelineno-41-74" name="__codelineno-41-74"></a><span class="w">                </span><span class="nt">&lt;/configuration&gt;</span>
<a id="__codelineno-41-75" name="__codelineno-41-75"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-41-76" name="__codelineno-41-76"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-41-77" name="__codelineno-41-77"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-41-78" name="__codelineno-41-78"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-41-79" name="__codelineno-41-79"></a><span class="w">                </span><span class="nt">&lt;version&gt;</span>2.18.1<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-41-80" name="__codelineno-41-80"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-41-81" name="__codelineno-41-81"></a><span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-41-82" name="__codelineno-41-82"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
<a id="__codelineno-41-83" name="__codelineno-41-83"></a>
<a id="__codelineno-41-84" name="__codelineno-41-84"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>intro-client-webjson-01<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-41-85" name="__codelineno-41-85"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 14-18 : le projet Maven parent [spring-boot-starter-parent] qui nous permet de définir un certain nombre de dépendances sans leur versions, celle-ci étant définie dans le projet parent ;</li>
<li>lignes 22-25 : bien que nous n'écrivions pas une application web, nous avons besoin de la dépendance [spring-web] qui amène avec elle la classe [RestTemplate] qui permet de s'interfacer aisément avec une application web / jSON ;</li>
<li>lignes 27-34 : une bibliothèque jSON ;</li>
<li>lignes 36-39 : une dépendance qui va nous permettre de fixer un timeout aux requêtes HTTP du client. Un timeout est un temps maximal d'attente de la réponse du serveur. Au-delà de ce temps, le client signale une erreur de timeout en jetant une exception ;</li>
<li>lignes 41-46 : la bibliothèque Google Guava utilisée dans le test JUnit. Pour cette raison, nous avons mis sa portée à [test] (ligne 45). Cela signifie que cette dépendance n'est incluse que lors de l'exécution de codes de la branche [src/test/java] ;</li>
<li>lignes 48-51 : la bibliothèque de logs ;</li>
<li>lignes 52-63 : la dépendance pour les tests JUnit. Elle amène notamment la bibliothèque JUnit 4 nécessaire pour les tests. Ces dépendances ont l'attribut [&lt;scope&gt;test&lt;/scope&gt;] indiquant qu'elles ne sont nécessaires que pour la phase de tests. Elles ne sont pas incluses dans l'archive finale du projet ;</li>
</ul>
<h3 id="1363-implementation-de-la-couche-dao">13.6.3. Implémentation de la couche [DAO]</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003730000015CDB4D7784.png" style="display:inline-block; margin:4px;width:11.682cm;height:4.604cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000DE00000122F972297C.png" style="display:inline-block; margin:4px;width:4.11cm;height:5.369cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>le package [spring.client.config] contient la configation Spring de la couche [DAO] ;</li>
<li>le package [spring.client.dao] contient l'implémentation de la couche [DAO] ;</li>
<li>le package [spring.client.entities] contient les objets échangés avec le service web / jSON ;</li>
</ul>
<h4 id="13631-configuration">13.6.3.1. Configuration</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F70000009647928AFE.png" style="display:inline-block; margin:4px;width:4.57cm;height:2.78cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [DaoConfig] fait la configuration Spring de la couche [DAO]. Son code est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span>
<span class="normal"><a href="#__codelineno-42-32">32</a></span>
<span class="normal"><a href="#__codelineno-42-33">33</a></span>
<span class="normal"><a href="#__codelineno-42-34">34</a></span>
<span class="normal"><a href="#__codelineno-42-35">35</a></span>
<span class="normal"><a href="#__codelineno-42-36">36</a></span>
<span class="normal"><a href="#__codelineno-42-37">37</a></span>
<span class="normal"><a href="#__codelineno-42-38">38</a></span>
<span class="normal"><a href="#__codelineno-42-39">39</a></span>
<span class="normal"><a href="#__codelineno-42-40">40</a></span>
<span class="normal"><a href="#__codelineno-42-41">41</a></span>
<span class="normal"><a href="#__codelineno-42-42">42</a></span>
<span class="normal"><a href="#__codelineno-42-43">43</a></span>
<span class="normal"><a href="#__codelineno-42-44">44</a></span>
<span class="normal"><a href="#__codelineno-42-45">45</a></span>
<span class="normal"><a href="#__codelineno-42-46">46</a></span>
<span class="normal"><a href="#__codelineno-42-47">47</a></span>
<span class="normal"><a href="#__codelineno-42-48">48</a></span>
<span class="normal"><a href="#__codelineno-42-49">49</a></span>
<span class="normal"><a href="#__codelineno-42-50">50</a></span>
<span class="normal"><a href="#__codelineno-42-51">51</a></span>
<span class="normal"><a href="#__codelineno-42-52">52</a></span>
<span class="normal"><a href="#__codelineno-42-53">53</a></span>
<span class="normal"><a href="#__codelineno-42-54">54</a></span>
<span class="normal"><a href="#__codelineno-42-55">55</a></span>
<span class="normal"><a href="#__codelineno-42-56">56</a></span>
<span class="normal"><a href="#__codelineno-42-57">57</a></span>
<span class="normal"><a href="#__codelineno-42-58">58</a></span>
<span class="normal"><a href="#__codelineno-42-59">59</a></span>
<span class="normal"><a href="#__codelineno-42-60">60</a></span>
<span class="normal"><a href="#__codelineno-42-61">61</a></span>
<span class="normal"><a href="#__codelineno-42-62">62</a></span>
<span class="normal"><a href="#__codelineno-42-63">63</a></span>
<span class="normal"><a href="#__codelineno-42-64">64</a></span>
<span class="normal"><a href="#__codelineno-42-65">65</a></span>
<span class="normal"><a href="#__codelineno-42-66">66</a></span>
<span class="normal"><a href="#__codelineno-42-67">67</a></span>
<span class="normal"><a href="#__codelineno-42-68">68</a></span>
<span class="normal"><a href="#__codelineno-42-69">69</a></span>
<span class="normal"><a href="#__codelineno-42-70">70</a></span>
<span class="normal"><a href="#__codelineno-42-71">71</a></span>
<span class="normal"><a href="#__codelineno-42-72">72</a></span>
<span class="normal"><a href="#__codelineno-42-73">73</a></span>
<span class="normal"><a href="#__codelineno-42-74">74</a></span>
<span class="normal"><a href="#__codelineno-42-75">75</a></span>
<span class="normal"><a href="#__codelineno-42-76">76</a></span>
<span class="normal"><a href="#__codelineno-42-77">77</a></span>
<span class="normal"><a href="#__codelineno-42-78">78</a></span>
<span class="normal"><a href="#__codelineno-42-79">79</a></span>
<span class="normal"><a href="#__codelineno-42-80">80</a></span>
<span class="normal"><a href="#__codelineno-42-81">81</a></span>
<span class="normal"><a href="#__codelineno-42-82">82</a></span>
<span class="normal"><a href="#__codelineno-42-83">83</a></span>
<span class="normal"><a href="#__codelineno-42-84">84</a></span>
<span class="normal"><a href="#__codelineno-42-85">85</a></span>
<span class="normal"><a href="#__codelineno-42-86">86</a></span>
<span class="normal"><a href="#__codelineno-42-87">87</a></span>
<span class="normal"><a href="#__codelineno-42-88">88</a></span>
<span class="normal"><a href="#__codelineno-42-89">89</a></span>
<span class="normal"><a href="#__codelineno-42-90">90</a></span>
<span class="normal"><a href="#__codelineno-42-91">91</a></span>
<span class="normal"><a href="#__codelineno-42-92">92</a></span>
<span class="normal"><a href="#__codelineno-42-93">93</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.config</span><span class="p">;</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.client.HttpComponentsClientHttpRequestFactory</span><span class="p">;</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.client.RestTemplate</span><span class="p">;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter</span><span class="p">;</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider</span><span class="p">;</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="nd">@ComponentScan</span><span class="p">({</span><span class="w"> </span><span class="s">&quot;spring.client.dao&quot;</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DaoConfig</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="w">    </span><span class="c1">// constantes</span>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TIMEOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">URL_WEBJSON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080&quot;</span><span class="p">;</span>
<a id="__codelineno-42-19" name="__codelineno-42-19"></a>
<a id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="w">    </span><span class="nd">@Bean</span>
<a id="__codelineno-42-21" name="__codelineno-42-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a><span class="w">        </span><span class="c1">// création du composant RestTemplate</span>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="w">        </span><span class="n">HttpComponentsClientHttpRequestFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpComponentsClientHttpRequestFactory</span><span class="p">();</span>
<a id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="w">        </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">restTemplate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<a id="__codelineno-42-25" name="__codelineno-42-25"></a><span class="w">        </span><span class="c1">// timeout des échanges</span>
<a id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="w">        </span><span class="n">factory</span><span class="p">.</span><span class="na">setConnectTimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">);</span>
<a id="__codelineno-42-27" name="__codelineno-42-27"></a><span class="w">        </span><span class="n">factory</span><span class="p">.</span><span class="na">setReadTimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">);</span>
<a id="__codelineno-42-28" name="__codelineno-42-28"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-42-29" name="__codelineno-42-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">;</span>
<a id="__codelineno-42-30" name="__codelineno-42-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a>
<a id="__codelineno-42-32" name="__codelineno-42-32"></a><span class="w">    </span><span class="nd">@Bean</span>
<a id="__codelineno-42-33" name="__codelineno-42-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">timeout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-34" name="__codelineno-42-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">TIMEOUT</span><span class="p">;</span>
<a id="__codelineno-42-35" name="__codelineno-42-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-36" name="__codelineno-42-36"></a>
<a id="__codelineno-42-37" name="__codelineno-42-37"></a><span class="w">    </span><span class="nd">@Bean</span>
<a id="__codelineno-42-38" name="__codelineno-42-38"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">urlWebJson</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-39" name="__codelineno-42-39"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">URL_WEBJSON</span><span class="p">;</span>
<a id="__codelineno-42-40" name="__codelineno-42-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-41" name="__codelineno-42-41"></a>
<a id="__codelineno-42-42" name="__codelineno-42-42"></a><span class="w">    </span><span class="c1">// filtres jSON</span>
<a id="__codelineno-42-43" name="__codelineno-42-43"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-42-44" name="__codelineno-42-44"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-45" name="__codelineno-42-45"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-42-46" name="__codelineno-42-46"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-47" name="__codelineno-42-47"></a>
<a id="__codelineno-42-48" name="__codelineno-42-48"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-42-49" name="__codelineno-42-49"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperCategorieWithProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-50" name="__codelineno-42-50"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-42-51" name="__codelineno-42-51"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-42-52" name="__codelineno-42-52"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-42-53" name="__codelineno-42-53"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span>
<a id="__codelineno-42-54" name="__codelineno-42-54"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">())</span>
<a id="__codelineno-42-55" name="__codelineno-42-55"></a><span class="w">                        </span><span class="p">.</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;categorie&quot;</span><span class="p">)));</span>
<a id="__codelineno-42-56" name="__codelineno-42-56"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-42-57" name="__codelineno-42-57"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-42-58" name="__codelineno-42-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-59" name="__codelineno-42-59"></a>
<a id="__codelineno-42-60" name="__codelineno-42-60"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-42-61" name="__codelineno-42-61"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperProduitWithCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-62" name="__codelineno-42-62"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-42-63" name="__codelineno-42-63"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-42-64" name="__codelineno-42-64"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-42-65" name="__codelineno-42-65"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span>
<a id="__codelineno-42-66" name="__codelineno-42-66"></a><span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">())</span>
<a id="__codelineno-42-67" name="__codelineno-42-67"></a><span class="w">                        </span><span class="p">.</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;produits&quot;</span><span class="p">)));</span>
<a id="__codelineno-42-68" name="__codelineno-42-68"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-42-69" name="__codelineno-42-69"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-42-70" name="__codelineno-42-70"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-71" name="__codelineno-42-71"></a>
<a id="__codelineno-42-72" name="__codelineno-42-72"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-42-73" name="__codelineno-42-73"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperCategorieWithoutProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-74" name="__codelineno-42-74"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-42-75" name="__codelineno-42-75"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-42-76" name="__codelineno-42-76"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-42-77" name="__codelineno-42-77"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span>
<a id="__codelineno-42-78" name="__codelineno-42-78"></a><span class="w">                </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;produits&quot;</span><span class="p">)));</span>
<a id="__codelineno-42-79" name="__codelineno-42-79"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-42-80" name="__codelineno-42-80"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-42-81" name="__codelineno-42-81"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-82" name="__codelineno-42-82"></a>
<a id="__codelineno-42-83" name="__codelineno-42-83"></a><span class="w">    </span><span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-42-84" name="__codelineno-42-84"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="nf">jsonMapperProduitWithoutCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-85" name="__codelineno-42-85"></a><span class="w">        </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-42-86" name="__codelineno-42-86"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-42-87" name="__codelineno-42-87"></a><span class="w">        </span><span class="c1">// filtres</span>
<a id="__codelineno-42-88" name="__codelineno-42-88"></a><span class="w">        </span><span class="n">mapper</span><span class="p">.</span><span class="na">setFilters</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFilterProvider</span><span class="p">().</span><span class="na">addFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">,</span>
<a id="__codelineno-42-89" name="__codelineno-42-89"></a><span class="w">                </span><span class="n">SimpleBeanPropertyFilter</span><span class="p">.</span><span class="na">serializeAllExcept</span><span class="p">(</span><span class="s">&quot;categorie&quot;</span><span class="p">)));</span>
<a id="__codelineno-42-90" name="__codelineno-42-90"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-42-91" name="__codelineno-42-91"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-42-92" name="__codelineno-42-92"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-93" name="__codelineno-42-93"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : la classe est une classe de configuration Spring - des composants Spring sont à chercher dans le package [spring.client.dao] ;</li>
<li>ligne 17 : on se fixe un timeout d'une seconde (1000 ms) ;</li>
<li>lignes 32-35 : le bean qui rend cette valeur ;</li>
<li>ligne 18 : l'URL du service web / jSON ;</li>
<li>lignes 37-40 : le bean qui rend cette valeur ;</li>
<li>lignes 20-30 : la configuration de la classe [RestTemplate] qui assure les échanges avec le service web / jSON. Lorsqu'on n'a pas à la configurer, on peut en disposer dans le code par un simple [new RestTemplate()]. Ici, nous voulons fixer le timeout des échanges avec le service web / jSON. Le bean [timeout] de la ligne 36 est passé en paramètre de la méthode [restTemplate] de la ligne 24 ;</li>
<li>ligne 23 : le composant [HttpComponentsClientHttpRequestFactory] est le composant qui nous permet de fixer le timeout des échanges (lignes 29-30) ;</li>
<li>ligne 24 : la classe [RestTemplate] est construite avec ce composant. Comme elle s'appuie sur celui-ci pour communiquer avec le service web / jSON, les échanges seront bien soumis au timeout ;</li>
<li>le client et le serveur vont s'échanger des lignes de texte. Un convertisseur s'occupe de sérialiser un objet en texte et inversement de désérialiser un texte en objet. Il peut y avoir plusieurs convertisseurs associés à la classe [RestTemplate] et celui choisi à un moment donné dépend des entêtes HTTP envoyés par le serveur. Ici, nous n'aurons aucun convertisseur. Aussi, le composant [RestTemplate] ne cherchera pas à convertir d'une façon ou d'une autre les deux éléments suivants :</li>
<li>le texte posté ;</li>
<li>le texte reçu en réponse ;</li>
</ul>
<p>Ces textes seront des chaînes jSON qui seront donc laissées en l'état par le composant [RestTemplate]. C'est nous développeur, qui ferons les séralisations / désérialisations jSON nécessaires. Ceci parce que les filtres à appliquer à la valeur postée et à la réponse reçue peuvent être différents et l'expérience montre qu'il est plus facile de les gérer soi-même que d'essayer de configurer le composant [RestTemplate] afin qu'il utilise le bon convertisseur jSON ;</p>
<ul>
<li>lignes 42-92 : définissent des filtres jSON. Ce sont les mêmes que ceux du serveur présentés et expliqués au paragraphe 13.5.3.1, page 229 ;</li>
<li>lignes 43-46 : un mappeur jSON sans filtres ;</li>
<li>lignes 64-68 : un mappeur jSON pour avoir une catégorie sans ses produits ;</li>
<li>lignes 48-58 : un mappeur jSON pour avoir une catégorie avec ses produits ;</li>
<li>lignes 83-92 : un mappeur jSON pour avoir un produit sans sa catégorie ;</li>
<li>lignes 60-70 : un mappeur jSON pour avoir un produit avec sa catégorie ;</li>
</ul>
<p>Tous ces beans vont être disponibles aux codes de la couche [DAO] ainsi qu'au test Junit.</p>
<h4 id="13632-les-entites">13.6.3.2. Les entités</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000EA000000B3AD48A719.png" style="display:inline-block; margin:4px;width:4.33cm;height:3.311cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Les entités manipulées par la couche [DAO] sont celles qu'elle échange avec le service web / jSON. Ce sont les articles et les produits. Côté serveur, ces entités avaient des annotations de persistence JPA. Ici, ces annotations ont été enlevées. Nous redonnons le code des entités pour rappel :</p>
<p>[<strong>AbstractEntity</strong>]</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span>
<span class="normal"><a href="#__codelineno-43-24">24</a></span>
<span class="normal"><a href="#__codelineno-43-25">25</a></span>
<span class="normal"><a href="#__codelineno-43-26">26</a></span>
<span class="normal"><a href="#__codelineno-43-27">27</a></span>
<span class="normal"><a href="#__codelineno-43-28">28</a></span>
<span class="normal"><a href="#__codelineno-43-29">29</a></span>
<span class="normal"><a href="#__codelineno-43-30">30</a></span>
<span class="normal"><a href="#__codelineno-43-31">31</a></span>
<span class="normal"><a href="#__codelineno-43-32">32</a></span>
<span class="normal"><a href="#__codelineno-43-33">33</a></span>
<span class="normal"><a href="#__codelineno-43-34">34</a></span>
<span class="normal"><a href="#__codelineno-43-35">35</a></span>
<span class="normal"><a href="#__codelineno-43-36">36</a></span>
<span class="normal"><a href="#__codelineno-43-37">37</a></span>
<span class="normal"><a href="#__codelineno-43-38">38</a></span>
<span class="normal"><a href="#__codelineno-43-39">39</a></span>
<span class="normal"><a href="#__codelineno-43-40">40</a></span>
<span class="normal"><a href="#__codelineno-43-41">41</a></span>
<span class="normal"><a href="#__codelineno-43-42">42</a></span>
<span class="normal"><a href="#__codelineno-43-43">43</a></span>
<span class="normal"><a href="#__codelineno-43-44">44</a></span>
<span class="normal"><a href="#__codelineno-43-45">45</a></span>
<span class="normal"><a href="#__codelineno-43-46">46</a></span>
<span class="normal"><a href="#__codelineno-43-47">47</a></span>
<span class="normal"><a href="#__codelineno-43-48">48</a></span>
<span class="normal"><a href="#__codelineno-43-49">49</a></span>
<span class="normal"><a href="#__codelineno-43-50">50</a></span>
<span class="normal"><a href="#__codelineno-43-51">51</a></span>
<span class="normal"><a href="#__codelineno-43-52">52</a></span>
<span class="normal"><a href="#__codelineno-43-53">53</a></span>
<span class="normal"><a href="#__codelineno-43-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.entities</span><span class="p">;</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractEntity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="w">    </span><span class="c1">// propriétés</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">AbstractEntity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">AbstractEntity</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">version</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="w">    </span><span class="c1">// redéfinition [equals] et [hashcode]</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">id</span><span class="p">.</span><span class="na">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-43-25" name="__codelineno-43-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a>
<a id="__codelineno-43-27" name="__codelineno-43-27"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-43-28" name="__codelineno-43-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-29" name="__codelineno-43-29"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AbstractEntity</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-30" name="__codelineno-43-30"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-43-31" name="__codelineno-43-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-43-32" name="__codelineno-43-32"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">class1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">();</span>
<a id="__codelineno-43-33" name="__codelineno-43-33"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">class2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">();</span>
<a id="__codelineno-43-34" name="__codelineno-43-34"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">class2</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">class1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-35" name="__codelineno-43-35"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-43-36" name="__codelineno-43-36"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-43-37" name="__codelineno-43-37"></a><span class="w">        </span><span class="n">AbstractEntity</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AbstractEntity</span><span class="p">)</span><span class="w"> </span><span class="n">entity</span><span class="p">;</span>
<a id="__codelineno-43-38" name="__codelineno-43-38"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">longValue</span><span class="p">();</span>
<a id="__codelineno-43-39" name="__codelineno-43-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-40" name="__codelineno-43-40"></a>
<a id="__codelineno-43-41" name="__codelineno-43-41"></a><span class="w">    </span><span class="c1">// signature jSON</span>
<a id="__codelineno-43-42" name="__codelineno-43-42"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-43" name="__codelineno-43-43"></a><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-43-44" name="__codelineno-43-44"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-45" name="__codelineno-43-45"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">mapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-43-46" name="__codelineno-43-46"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-47" name="__codelineno-43-47"></a><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-43-48" name="__codelineno-43-48"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-43-49" name="__codelineno-43-49"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-43-50" name="__codelineno-43-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-51" name="__codelineno-43-51"></a>
<a id="__codelineno-43-52" name="__codelineno-43-52"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-43-53" name="__codelineno-43-53"></a><span class="p">...</span>
<a id="__codelineno-43-54" name="__codelineno-43-54"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>[<strong>Categorie</strong>]</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span>
<span class="normal"><a href="#__codelineno-44-21">21</a></span>
<span class="normal"><a href="#__codelineno-44-22">22</a></span>
<span class="normal"><a href="#__codelineno-44-23">23</a></span>
<span class="normal"><a href="#__codelineno-44-24">24</a></span>
<span class="normal"><a href="#__codelineno-44-25">25</a></span>
<span class="normal"><a href="#__codelineno-44-26">26</a></span>
<span class="normal"><a href="#__codelineno-44-27">27</a></span>
<span class="normal"><a href="#__codelineno-44-28">28</a></span>
<span class="normal"><a href="#__codelineno-44-29">29</a></span>
<span class="normal"><a href="#__codelineno-44-30">30</a></span>
<span class="normal"><a href="#__codelineno-44-31">31</a></span>
<span class="normal"><a href="#__codelineno-44-32">32</a></span>
<span class="normal"><a href="#__codelineno-44-33">33</a></span>
<span class="normal"><a href="#__codelineno-44-34">34</a></span>
<span class="normal"><a href="#__codelineno-44-35">35</a></span>
<span class="normal"><a href="#__codelineno-44-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.entities</span><span class="p">;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashSet</span><span class="p">;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonFilter</span><span class="p">;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="nd">@JsonFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Categorie</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractEntity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="w">    </span><span class="c1">// propriétés</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="w">    </span><span class="c1">// les produits associés</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Categorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-19" name="__codelineno-44-19"></a>
<a id="__codelineno-44-20" name="__codelineno-44-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-21" name="__codelineno-44-21"></a>
<a id="__codelineno-44-22" name="__codelineno-44-22"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Categorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-23" name="__codelineno-44-23"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-44-24" name="__codelineno-44-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-25" name="__codelineno-44-25"></a>
<a id="__codelineno-44-26" name="__codelineno-44-26"></a><span class="w">    </span><span class="c1">// méthodes</span>
<a id="__codelineno-44-27" name="__codelineno-44-27"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProduit</span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-28" name="__codelineno-44-28"></a><span class="w">        </span><span class="c1">// on ajoute le produit</span>
<a id="__codelineno-44-29" name="__codelineno-44-29"></a><span class="w">        </span><span class="n">produits</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
<a id="__codelineno-44-30" name="__codelineno-44-30"></a><span class="w">        </span><span class="c1">// on fixe sa catégorie</span>
<a id="__codelineno-44-31" name="__codelineno-44-31"></a><span class="w">        </span><span class="n">produit</span><span class="p">.</span><span class="na">setCategorie</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-44-32" name="__codelineno-44-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-33" name="__codelineno-44-33"></a>
<a id="__codelineno-44-34" name="__codelineno-44-34"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-44-35" name="__codelineno-44-35"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-44-36" name="__codelineno-44-36"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>[<strong>Produit</strong>]</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span>
<span class="normal"><a href="#__codelineno-45-23">23</a></span>
<span class="normal"><a href="#__codelineno-45-24">24</a></span>
<span class="normal"><a href="#__codelineno-45-25">25</a></span>
<span class="normal"><a href="#__codelineno-45-26">26</a></span>
<span class="normal"><a href="#__codelineno-45-27">27</a></span>
<span class="normal"><a href="#__codelineno-45-28">28</a></span>
<span class="normal"><a href="#__codelineno-45-29">29</a></span>
<span class="normal"><a href="#__codelineno-45-30">30</a></span>
<span class="normal"><a href="#__codelineno-45-31">31</a></span>
<span class="normal"><a href="#__codelineno-45-32">32</a></span>
<span class="normal"><a href="#__codelineno-45-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.webjson.client.entities</span><span class="p">;</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonFilter</span><span class="p">;</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="nd">@JsonFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterProduit&quot;</span><span class="p">)</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Produit</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractEntity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="w">    </span><span class="c1">// le nom</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="w">  </span><span class="c1">// le n° de la catégorie</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">;</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="w">  </span><span class="c1">// le prix</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">prix</span><span class="p">;</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="w">  </span><span class="c1">// la description</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="w">    </span><span class="c1">// la catégorie</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="p">;</span>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Produit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a>
<a id="__codelineno-45-23" name="__codelineno-45-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-45-24" name="__codelineno-45-24"></a>
<a id="__codelineno-45-25" name="__codelineno-45-25"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Produit</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">prix</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-26" name="__codelineno-45-26"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-45-27" name="__codelineno-45-27"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">prix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prix</span><span class="p">;</span>
<a id="__codelineno-45-28" name="__codelineno-45-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<a id="__codelineno-45-29" name="__codelineno-45-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-45-30" name="__codelineno-45-30"></a>
<a id="__codelineno-45-31" name="__codelineno-45-31"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-45-32" name="__codelineno-45-32"></a><span class="p">...</span>
<a id="__codelineno-45-33" name="__codelineno-45-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="13633-la-classe-daoexception">13.6.3.3. La classe [DaoException]</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D1000000C90F5AC4AE.png" style="display:inline-block; margin:4px;width:3.87cm;height:3.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Lorsque la couche [DAO] rencontrera une erreur, elle lancera une exception de type [DaoException]. Cette classe est celle utilisée côté serveur et décrite au paragraphe 11.3.7, page 192.</p>
<h4 id="13634-linterface-de-la-couche-dao">13.6.3.4. L'interface de la couche [DAO]</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D1000000C9D2A8FD21.png" style="display:inline-block; margin:4px;width:3.87cm;height:3.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La couche [DAO] présente l'interface [IDao] décrite au paragraphe 11.3.7, page 192.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span>
<span class="normal"><a href="#__codelineno-46-18">18</a></span>
<span class="normal"><a href="#__codelineno-46-19">19</a></span>
<span class="normal"><a href="#__codelineno-46-20">20</a></span>
<span class="normal"><a href="#__codelineno-46-21">21</a></span>
<span class="normal"><a href="#__codelineno-46-22">22</a></span>
<span class="normal"><a href="#__codelineno-46-23">23</a></span>
<span class="normal"><a href="#__codelineno-46-24">24</a></span>
<span class="normal"><a href="#__codelineno-46-25">25</a></span>
<span class="normal"><a href="#__codelineno-46-26">26</a></span>
<span class="normal"><a href="#__codelineno-46-27">27</a></span>
<span class="normal"><a href="#__codelineno-46-28">28</a></span>
<span class="normal"><a href="#__codelineno-46-29">29</a></span>
<span class="normal"><a href="#__codelineno-46-30">30</a></span>
<span class="normal"><a href="#__codelineno-46-31">31</a></span>
<span class="normal"><a href="#__codelineno-46-32">32</a></span>
<span class="normal"><a href="#__codelineno-46-33">33</a></span>
<span class="normal"><a href="#__codelineno-46-34">34</a></span>
<span class="normal"><a href="#__codelineno-46-35">35</a></span>
<span class="normal"><a href="#__codelineno-46-36">36</a></span>
<span class="normal"><a href="#__codelineno-46-37">37</a></span>
<span class="normal"><a href="#__codelineno-46-38">38</a></span>
<span class="normal"><a href="#__codelineno-46-39">39</a></span>
<span class="normal"><a href="#__codelineno-46-40">40</a></span>
<span class="normal"><a href="#__codelineno-46-41">41</a></span>
<span class="normal"><a href="#__codelineno-46-42">42</a></span>
<span class="normal"><a href="#__codelineno-46-43">43</a></span>
<span class="normal"><a href="#__codelineno-46-44">44</a></span>
<span class="normal"><a href="#__codelineno-46-45">45</a></span>
<span class="normal"><a href="#__codelineno-46-46">46</a></span>
<span class="normal"><a href="#__codelineno-46-47">47</a></span>
<span class="normal"><a href="#__codelineno-46-48">48</a></span>
<span class="normal"><a href="#__codelineno-46-49">49</a></span>
<span class="normal"><a href="#__codelineno-46-50">50</a></span>
<span class="normal"><a href="#__codelineno-46-51">51</a></span>
<span class="normal"><a href="#__codelineno-46-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.dao</span><span class="p">;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">IDao</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="w">    </span><span class="c1">// insertion d&#39;une liste de produits</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="w">    </span><span class="c1">// suppression de tous les produits</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllProduits</span><span class="p">();</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="w">    </span><span class="c1">// mise à jour d&#39;une liste de produits</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a><span class="w">    </span><span class="c1">// obtention de tous les produits</span>
<a id="__codelineno-46-20" name="__codelineno-46-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllProduits</span><span class="p">();</span>
<a id="__codelineno-46-21" name="__codelineno-46-21"></a>
<a id="__codelineno-46-22" name="__codelineno-46-22"></a><span class="w">    </span><span class="c1">// insertion d&#39;une liste de categories</span>
<a id="__codelineno-46-23" name="__codelineno-46-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-46-24" name="__codelineno-46-24"></a>
<a id="__codelineno-46-25" name="__codelineno-46-25"></a><span class="w">    </span><span class="c1">// suppression de tous les categories</span>
<a id="__codelineno-46-26" name="__codelineno-46-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-46-27" name="__codelineno-46-27"></a>
<a id="__codelineno-46-28" name="__codelineno-46-28"></a><span class="w">    </span><span class="c1">// mise à jour d&#39;une liste de categories</span>
<a id="__codelineno-46-29" name="__codelineno-46-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-46-30" name="__codelineno-46-30"></a>
<a id="__codelineno-46-31" name="__codelineno-46-31"></a><span class="w">    </span><span class="c1">// obtention de tous les categories</span>
<a id="__codelineno-46-32" name="__codelineno-46-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllCategories</span><span class="p">();</span>
<a id="__codelineno-46-33" name="__codelineno-46-33"></a>
<a id="__codelineno-46-34" name="__codelineno-46-34"></a><span class="w">    </span><span class="c1">// un produit particulier</span>
<a id="__codelineno-46-35" name="__codelineno-46-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-46-36" name="__codelineno-46-36"></a>
<a id="__codelineno-46-37" name="__codelineno-46-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-46-38" name="__codelineno-46-38"></a>
<a id="__codelineno-46-39" name="__codelineno-46-39"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-46-40" name="__codelineno-46-40"></a>
<a id="__codelineno-46-41" name="__codelineno-46-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithoutCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-46-42" name="__codelineno-46-42"></a>
<a id="__codelineno-46-43" name="__codelineno-46-43"></a><span class="w">    </span><span class="c1">// une catégorie particulière</span>
<a id="__codelineno-46-44" name="__codelineno-46-44"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-46-45" name="__codelineno-46-45"></a>
<a id="__codelineno-46-46" name="__codelineno-46-46"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-46-47" name="__codelineno-46-47"></a>
<a id="__codelineno-46-48" name="__codelineno-46-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-46-49" name="__codelineno-46-49"></a>
<a id="__codelineno-46-50" name="__codelineno-46-50"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-46-51" name="__codelineno-46-51"></a>
<a id="__codelineno-46-52" name="__codelineno-46-52"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="13635-la-reponse-du-service-web-json">13.6.3.5. La réponse du service web / jSON</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D1000000C9C8BF23B9.png" style="display:inline-block; margin:4px;width:3.87cm;height:3.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Nous avons vu que toutes les URL du service web / jSON rendaient un type [Response] défini au paragraphe 13.5.5.3, page 236. Nous reprenons ici cette classe :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span>
<span class="normal"><a href="#__codelineno-47-23">23</a></span>
<span class="normal"><a href="#__codelineno-47-24">24</a></span>
<span class="normal"><a href="#__codelineno-47-25">25</a></span>
<span class="normal"><a href="#__codelineno-47-26">26</a></span>
<span class="normal"><a href="#__codelineno-47-27">27</a></span>
<span class="normal"><a href="#__codelineno-47-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.dao</span><span class="p">;</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="w">    </span><span class="c1">// ----------------- propriétés</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="w">    </span><span class="c1">// statut de l&#39;opération</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="w">    </span><span class="c1">// les éventuels messages d&#39;erreur</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">;</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="w">    </span><span class="c1">// le corps de la réponse</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">body</span><span class="p">;</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Response</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a>
<a id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-19" name="__codelineno-47-19"></a>
<a id="__codelineno-47-20" name="__codelineno-47-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Response</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-21" name="__codelineno-47-21"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<a id="__codelineno-47-22" name="__codelineno-47-22"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messages</span><span class="p">;</span>
<a id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="p">;</span>
<a id="__codelineno-47-24" name="__codelineno-47-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-25" name="__codelineno-47-25"></a>
<a id="__codelineno-47-26" name="__codelineno-47-26"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-47-27" name="__codelineno-47-27"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-47-28" name="__codelineno-47-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="13636-implementation-des-echanges-avec-le-service-web-json">13.6.3.6. Implémentation des échanges avec le service web / jSON</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D1000000C943E23BD0.png" style="display:inline-block; margin:4px;width:3.87cm;height:3.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [AbstractDao] implémente les échanges avec le service web / jSON :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span>
<span class="normal"><a href="#__codelineno-48-19">19</a></span>
<span class="normal"><a href="#__codelineno-48-20">20</a></span>
<span class="normal"><a href="#__codelineno-48-21">21</a></span>
<span class="normal"><a href="#__codelineno-48-22">22</a></span>
<span class="normal"><a href="#__codelineno-48-23">23</a></span>
<span class="normal"><a href="#__codelineno-48-24">24</a></span>
<span class="normal"><a href="#__codelineno-48-25">25</a></span>
<span class="normal"><a href="#__codelineno-48-26">26</a></span>
<span class="normal"><a href="#__codelineno-48-27">27</a></span>
<span class="normal"><a href="#__codelineno-48-28">28</a></span>
<span class="normal"><a href="#__codelineno-48-29">29</a></span>
<span class="normal"><a href="#__codelineno-48-30">30</a></span>
<span class="normal"><a href="#__codelineno-48-31">31</a></span>
<span class="normal"><a href="#__codelineno-48-32">32</a></span>
<span class="normal"><a href="#__codelineno-48-33">33</a></span>
<span class="normal"><a href="#__codelineno-48-34">34</a></span>
<span class="normal"><a href="#__codelineno-48-35">35</a></span>
<span class="normal"><a href="#__codelineno-48-36">36</a></span>
<span class="normal"><a href="#__codelineno-48-37">37</a></span>
<span class="normal"><a href="#__codelineno-48-38">38</a></span>
<span class="normal"><a href="#__codelineno-48-39">39</a></span>
<span class="normal"><a href="#__codelineno-48-40">40</a></span>
<span class="normal"><a href="#__codelineno-48-41">41</a></span>
<span class="normal"><a href="#__codelineno-48-42">42</a></span>
<span class="normal"><a href="#__codelineno-48-43">43</a></span>
<span class="normal"><a href="#__codelineno-48-44">44</a></span>
<span class="normal"><a href="#__codelineno-48-45">45</a></span>
<span class="normal"><a href="#__codelineno-48-46">46</a></span>
<span class="normal"><a href="#__codelineno-48-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.dao</span><span class="p">;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URI</span><span class="p">;</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URISyntaxException</span><span class="p">;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.core.ParameterizedTypeReference</span><span class="p">;</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.MediaType</span><span class="p">;</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.RequestEntity</span><span class="p">;</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.client.RestTemplate</span><span class="p">;</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AbstractDao</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="w">    </span><span class="c1">// data</span>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">;</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">urlServiceWebJson</span><span class="p">;</span>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a><span class="w">    </span><span class="c1">// requête générique</span>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getResponse</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">jsonPost</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a><span class="w">        </span><span class="c1">// url : URL à contacter</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a><span class="w">        </span><span class="c1">// jsonPost : la valeur jSON à poster</span>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-26" name="__codelineno-48-26"></a><span class="w">            </span><span class="c1">// exécution requête</span>
<a id="__codelineno-48-27" name="__codelineno-48-27"></a><span class="w">            </span><span class="n">RequestEntity</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">request</span><span class="p">;</span>
<a id="__codelineno-48-28" name="__codelineno-48-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jsonPost</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-29" name="__codelineno-48-29"></a><span class="w">                </span><span class="c1">// requête POST</span>
<a id="__codelineno-48-30" name="__codelineno-48-30"></a><span class="w">                </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestEntity</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">URI</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">urlServiceWebJson</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)))</span>
<a id="__codelineno-48-31" name="__codelineno-48-31"></a><span class="w">                        </span><span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">).</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">).</span><span class="na">body</span><span class="p">(</span><span class="n">jsonPost</span><span class="p">);</span>
<a id="__codelineno-48-32" name="__codelineno-48-32"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-33" name="__codelineno-48-33"></a><span class="w">                </span><span class="c1">// requête GET</span>
<a id="__codelineno-48-34" name="__codelineno-48-34"></a><span class="w">                </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestEntity</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">URI</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">urlServiceWebJson</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)))</span>
<a id="__codelineno-48-35" name="__codelineno-48-35"></a><span class="w">                        </span><span class="p">.</span><span class="na">accept</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-48-36" name="__codelineno-48-36"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-48-37" name="__codelineno-48-37"></a><span class="w">            </span><span class="c1">// on exécute la requête</span>
<a id="__codelineno-48-38" name="__codelineno-48-38"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-39" name="__codelineno-48-39"></a><span class="w">            </span><span class="p">}).</span><span class="na">getBody</span><span class="p">();</span>
<a id="__codelineno-48-40" name="__codelineno-48-40"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">URISyntaxException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-41" name="__codelineno-48-41"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">);</span>
<a id="__codelineno-48-42" name="__codelineno-48-42"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-43" name="__codelineno-48-43"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">);</span>
<a id="__codelineno-48-44" name="__codelineno-48-44"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-48-45" name="__codelineno-48-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-46" name="__codelineno-48-46"></a>
<a id="__codelineno-48-47" name="__codelineno-48-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 15-16 : injection du composant [RestTemplate] qui assure la communication avec le serveur ;</li>
<li>lignes 17-18 : injection de l'URL du service web / jSON ;</li>
</ul>
<p>L'implémentation des méthodes de communication avec le serveur est factorisée dans la méthode [getResponse] :</p>
<ul>
<li>ligne 21 : la méthode reçoit 2 paramètres :</li>
<li>[url] : l'URL demandée ;</li>
<li>[jsonPost] : la chaîne jSON à poster, null sinon. Si [jsonPost==null], la requête de l'URL est faite avec un GET, sinon avec un POST ; </li>
<li>ligne 38 : l'instruction qui fait la requête au serveur et reçoit sa réponse. Le composant [RestTemplate] offre un nombre important de méthodes d'échange avec le serveur. Nous avons choisi ici la méthode [exchange], mais il en existe d'autres ;</li>
<li>lignes 27-36 : il nous faut construire la requête de type [RequestEntity]. Elle est différente selon que l'on utilise un GET ou un POST pour faire la requête ;</li>
<li>lignes 30-31 : la requête pour un GET. La classe [RequestEntity] offre des méthodes statiques pour créer les requêtes GET, POST, HEAD,... La méthode [RequestEntity.get] permet de créer une requête GET en chaînant les différentes méthodes qui construisent celle-ci :</li>
<li>la méthode [RequestEntity.get] admet pour paramètre l'URL cible sous la forme d'une instance URI,</li>
<li>la méthode [accept] permet de définir les éléments de l'entête HTTP [Accept]. Ici, nous indiquons que nous acceptons le type [application/json] que va envoyer le serveur ;</li>
<li>la méthode [build] utilise ces différentes informations pour construire le type [RequestEntity] de la requête ;</li>
<li>lignes 34-35 : la requête pour un POST. La méthode [RequestEntity.post] permet de créer une requête POST en chaînant les différentes méthodes qui construisent celle-ci :</li>
<li>la méthode [RequestEntity.post] admet pour paramètre l'URL cible sous la forme d'une instance URI,</li>
<li>la méthode [header] définit un entête HTTP. Ici on envoie au serveur l'entête [Content-Type: application/json] pour lui indiquer que la valeur postée va lui arriver sous la forme d'une chaîne jSON ;</li>
<li>la méthode [accept] permet d'indiquer que nous acceptons le type [application/json] que va envoyer le serveur ;</li>
<li>la méthode [body] fixe la valeur postée. Celle-ci est le 4ième paramètre de la méthode générique [getResponse] (ligne 1) ;</li>
<li>ligne 38 : la méthode [RestTemplate].exchange rend un type [ResponseEntity&lt;String&gt;] qui encapsule la totalité de la réponse du serveur : entêtes HTTP et corps du document. La méthode [ResponseEntity].getBody() permet d'avoir ce corps qui représente la réponse du serveur, ici une chaîne de caractères ;</li>
</ul>
<h4 id="13637-implementation-de-linterface-idao">13.6.3.7. Implémentation de l'interface [IDao]</h4>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D1000000C91E039E7B.png" style="display:inline-block; margin:4px;width:3.87cm;height:3.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [Dao] implémente l'interface [IDao] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span>
<span class="normal"><a href="#__codelineno-49-11">11</a></span>
<span class="normal"><a href="#__codelineno-49-12">12</a></span>
<span class="normal"><a href="#__codelineno-49-13">13</a></span>
<span class="normal"><a href="#__codelineno-49-14">14</a></span>
<span class="normal"><a href="#__codelineno-49-15">15</a></span>
<span class="normal"><a href="#__codelineno-49-16">16</a></span>
<span class="normal"><a href="#__codelineno-49-17">17</a></span>
<span class="normal"><a href="#__codelineno-49-18">18</a></span>
<span class="normal"><a href="#__codelineno-49-19">19</a></span>
<span class="normal"><a href="#__codelineno-49-20">20</a></span>
<span class="normal"><a href="#__codelineno-49-21">21</a></span>
<span class="normal"><a href="#__codelineno-49-22">22</a></span>
<span class="normal"><a href="#__codelineno-49-23">23</a></span>
<span class="normal"><a href="#__codelineno-49-24">24</a></span>
<span class="normal"><a href="#__codelineno-49-25">25</a></span>
<span class="normal"><a href="#__codelineno-49-26">26</a></span>
<span class="normal"><a href="#__codelineno-49-27">27</a></span>
<span class="normal"><a href="#__codelineno-49-28">28</a></span>
<span class="normal"><a href="#__codelineno-49-29">29</a></span>
<span class="normal"><a href="#__codelineno-49-30">30</a></span>
<span class="normal"><a href="#__codelineno-49-31">31</a></span>
<span class="normal"><a href="#__codelineno-49-32">32</a></span>
<span class="normal"><a href="#__codelineno-49-33">33</a></span>
<span class="normal"><a href="#__codelineno-49-34">34</a></span>
<span class="normal"><a href="#__codelineno-49-35">35</a></span>
<span class="normal"><a href="#__codelineno-49-36">36</a></span>
<span class="normal"><a href="#__codelineno-49-37">37</a></span>
<span class="normal"><a href="#__codelineno-49-38">38</a></span>
<span class="normal"><a href="#__codelineno-49-39">39</a></span>
<span class="normal"><a href="#__codelineno-49-40">40</a></span>
<span class="normal"><a href="#__codelineno-49-41">41</a></span>
<span class="normal"><a href="#__codelineno-49-42">42</a></span>
<span class="normal"><a href="#__codelineno-49-43">43</a></span>
<span class="normal"><a href="#__codelineno-49-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.dao</span><span class="p">;</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="p">;</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.ApplicationContext</span><span class="p">;</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.type.TypeReference</span><span class="p">;</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a><span class="nd">@Component</span>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Dao</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractDao</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IDao</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-49-21" name="__codelineno-49-21"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<a id="__codelineno-49-22" name="__codelineno-49-22"></a>
<a id="__codelineno-49-23" name="__codelineno-49-23"></a><span class="w">    </span><span class="c1">// filtres jSON</span>
<a id="__codelineno-49-24" name="__codelineno-49-24"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-49-25" name="__codelineno-49-25"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-49-26" name="__codelineno-49-26"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">;</span>
<a id="__codelineno-49-27" name="__codelineno-49-27"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-49-28" name="__codelineno-49-28"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-49-29" name="__codelineno-49-29"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">;</span>
<a id="__codelineno-49-30" name="__codelineno-49-30"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-49-31" name="__codelineno-49-31"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-49-32" name="__codelineno-49-32"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithCategorie</span><span class="p">;</span>
<a id="__codelineno-49-33" name="__codelineno-49-33"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-49-34" name="__codelineno-49-34"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-49-35" name="__codelineno-49-35"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">;</span>
<a id="__codelineno-49-36" name="__codelineno-49-36"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-49-37" name="__codelineno-49-37"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-49-38" name="__codelineno-49-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">;</span>
<a id="__codelineno-49-39" name="__codelineno-49-39"></a>
<a id="__codelineno-49-40" name="__codelineno-49-40"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-49-41" name="__codelineno-49-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-42" name="__codelineno-49-42"></a><span class="w">        </span><span class="c1">// ----------- ajouter des produits (sans leur catégorie)</span>
<a id="__codelineno-49-43" name="__codelineno-49-43"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-49-44" name="__codelineno-49-44"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 17 : la classe [Dao] est un composant Spring dans lequel on peut donc injecter d'autres composants Spring ;</li>
<li>ligne 18 : la classe [Dao] étend la classe [AbstractDao] que nous venons de voir et implémente l'interface [IDao] ;</li>
<li>lignes 20-21 : on injecte le contexte Spring afin d'avoir accès à ses beans ;</li>
<li>lignes 24-38 : injection des mappeurs jSON définis dans la classe [AppConfig] présentée au paragraphe 13.6.2, page 247 ;</li>
</ul>
<p>Les implémentations des différentes méthodes de l'interface [IDao] suivent toutes le même schéma. Nous allons présenter deux méthodes, l'une s'appuyant sur une opération [POST], l'autre sur une opération [GET].</p>
<p>Un exemple de [GET] : [getCategorieByNameWithProduits]</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span>
<span class="normal"><a href="#__codelineno-50-19">19</a></span>
<span class="normal"><a href="#__codelineno-50-20">20</a></span>
<span class="normal"><a href="#__codelineno-50-21">21</a></span>
<span class="normal"><a href="#__codelineno-50-22">22</a></span>
<span class="normal"><a href="#__codelineno-50-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a>@Override
<a id="__codelineno-50-2" name="__codelineno-50-2"></a>    public Categorie getCategorieByNameWithProduits(String nom) {
<a id="__codelineno-50-3" name="__codelineno-50-3"></a>        // ----------- obtenir une catégorie désignée par son nom, avec ses produits
<a id="__codelineno-50-4" name="__codelineno-50-4"></a>        try {
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>            // requête
<a id="__codelineno-50-6" name="__codelineno-50-6"></a>            Response&lt;Categorie&gt; response = jsonMapperCategorieWithProduits.readValue(
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>                    getResponse(String.format(&quot;/getCategorieByNameWithProduits/%s&quot;, nom), null),
<a id="__codelineno-50-8" name="__codelineno-50-8"></a>                    new TypeReference&lt;Response&lt;Categorie&gt;&gt;() {
<a id="__codelineno-50-9" name="__codelineno-50-9"></a>                    });
<a id="__codelineno-50-10" name="__codelineno-50-10"></a>            // erreur ?
<a id="__codelineno-50-11" name="__codelineno-50-11"></a>            if (response.getStatus() != 0) {
<a id="__codelineno-50-12" name="__codelineno-50-12"></a>                // on lance 1 exception
<a id="__codelineno-50-13" name="__codelineno-50-13"></a>                throw new DaoException(response.getStatus(), response.getMessages());
<a id="__codelineno-50-14" name="__codelineno-50-14"></a>            } else {
<a id="__codelineno-50-15" name="__codelineno-50-15"></a>                // on rend le coeur de la réponse du serveur
<a id="__codelineno-50-16" name="__codelineno-50-16"></a>                return response.getBody();
<a id="__codelineno-50-17" name="__codelineno-50-17"></a>            }
<a id="__codelineno-50-18" name="__codelineno-50-18"></a>        } catch (DaoException e1) {
<a id="__codelineno-50-19" name="__codelineno-50-19"></a>            throw e1;
<a id="__codelineno-50-20" name="__codelineno-50-20"></a>        } catch (RuntimeException | IOException e2) {
<a id="__codelineno-50-21" name="__codelineno-50-21"></a>            throw new DaoException(113, e2);
<a id="__codelineno-50-22" name="__codelineno-50-22"></a>        }
<a id="__codelineno-50-23" name="__codelineno-50-23"></a>    }
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 7 : on appelle la méthode [getResponse] de la classe parent. C'est cette méthode qui assure les échanges avec le service web / jSON. Ses paramètres sont les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a>getResponse(String.format(&quot;/getCategorieByNameWithProduits/%s&quot;, nom), null)
</code></pre></div></td></tr></table></div>
<ul>
<li>l'URL du service interrogée [/getCategorieByNameWithProduits/nom] ;</li>
<li>la valeur postée. Ici il n'y en a pas ;</li>
</ul>
<p>La méthode [getResponse] rend un type String qui est la réponse jSON envoyée par le serveur. On désérialise cette réponse jSON de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span>
<span class="normal"><a href="#__codelineno-52-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a>jsonMapperCategorieWithProduits.readValue(
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>                    jsonResponse,
<a id="__codelineno-52-3" name="__codelineno-52-3"></a>                    new TypeReference&lt;Response&lt;Categorie&gt;&gt;() {
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>});
</code></pre></div></td></tr></table></div>
<p>parce que la chaîne jSON est la sérialisation d'un type [Response&lt;Categorie&gt;] ;</p>
<ul>
<li>lignes 11-17 : on teste le statut de la réponse. Si le statut est différent de 0, alors c'est qu'il y a eu une erreur côté serveur. On lance alors une exception (ligne 13), en reprenant les informations contenues dans la réponse (statut et liste de messages d'erreur) ;</li>
<li>ligne 16 : s'il n'y a pas eu d'erreur côté serveur, on rend le corps du type [Response&lt;Categorie&gt;], ç-à-d la catégorie demandée ;</li>
<li>lignes 18-19 : on gère l'exception lancée ligne 16 ;</li>
<li>lignes 20-22 : traitent toutes les autres exceptions ;</li>
</ul>
<p>Un exemple de [POST] : [addCategories]</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span>
<span class="normal"><a href="#__codelineno-53-21">21</a></span>
<span class="normal"><a href="#__codelineno-53-22">22</a></span>
<span class="normal"><a href="#__codelineno-53-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a>@Override
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>    public List&lt;Categorie&gt; addCategories(List&lt;Categorie&gt; categories) {
<a id="__codelineno-53-3" name="__codelineno-53-3"></a>        // ----------- ajouter des catégories (avec leurs produits)
<a id="__codelineno-53-4" name="__codelineno-53-4"></a>        try {
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>            // requête
<a id="__codelineno-53-6" name="__codelineno-53-6"></a>            Response&lt;List&lt;Categorie&gt;&gt; response = jsonMapperCategorieWithProduits.readValue(
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>                    getResponse(&quot;/addCategories&quot;, jsonMapperCategorieWithProduits.writeValueAsString(categories)),
<a id="__codelineno-53-8" name="__codelineno-53-8"></a>                    new TypeReference&lt;Response&lt;List&lt;Categorie&gt;&gt;&gt;() {
<a id="__codelineno-53-9" name="__codelineno-53-9"></a>                    });
<a id="__codelineno-53-10" name="__codelineno-53-10"></a>            // erreur ?
<a id="__codelineno-53-11" name="__codelineno-53-11"></a>            if (response.getStatus() != 0) {
<a id="__codelineno-53-12" name="__codelineno-53-12"></a>                // on lance 1 exception
<a id="__codelineno-53-13" name="__codelineno-53-13"></a>                throw new DaoException(response.getStatus(), response.getMessages());
<a id="__codelineno-53-14" name="__codelineno-53-14"></a>            } else {
<a id="__codelineno-53-15" name="__codelineno-53-15"></a>                // on rend le coeur de la réponse du serveur
<a id="__codelineno-53-16" name="__codelineno-53-16"></a>                return response.getBody();
<a id="__codelineno-53-17" name="__codelineno-53-17"></a>            }
<a id="__codelineno-53-18" name="__codelineno-53-18"></a>        } catch (DaoException e1) {
<a id="__codelineno-53-19" name="__codelineno-53-19"></a>            throw e1;
<a id="__codelineno-53-20" name="__codelineno-53-20"></a>        } catch (RuntimeException | IOException e2) {
<a id="__codelineno-53-21" name="__codelineno-53-21"></a>            throw new DaoException(104, e2);
<a id="__codelineno-53-22" name="__codelineno-53-22"></a>        }
<a id="__codelineno-53-23" name="__codelineno-53-23"></a>    }
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : la méthode [addCategories] sert à persister en base de données les catégories passées en paramètre. Elle rend ces mêmes catégories enrichies de leurs clés primaires. Si les catégories sont passées avec des produits, ceux-ci sont également persistés ;</li>
<li>ligne 7 : on appelle la méthode [getResponse] du parent pour faire les échanges avec le service web / jSON ;</li>
<li>le 1er paramètre est l'URL [/addCategories] ;</li>
<li>le second paramètre est la valeur postée, ici la liste des catégories à persister ;</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a>getResponse(&quot;/addCategories&quot;, jsonMapperCategorieWithProduits.writeValueAsString(categories))
</code></pre></div></td></tr></table></div>
<p>La chaîne jSON obtenue est ensuite désérialisée pour obtenir le type [Response&lt;List&lt;Categorie&gt;] attendu :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>Response&lt;List&lt;Categorie&gt;&gt; response = jsonMapperCategorieWithProduits.readValue(
<a id="__codelineno-55-2" name="__codelineno-55-2"></a>                    jsonResponse,
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>                    new TypeReference&lt;Response&lt;List&lt;Categorie&gt;&gt;&gt;() {
<a id="__codelineno-55-4" name="__codelineno-55-4"></a>                    });
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 11-17 : gestion de la réponse du serveur (erreur ou pas) ;</li>
<li>lignes 20-22 : gestion des exceptions ;</li>
</ul>
<p>Toutes les autres méthodes suivent le canevas des deux méthodes présentées.</p>
<h3 id="1364-le-test-junit">13.6.4. Le test JUnit</h3>
<p>Revenons à l'architecture client / serveur en cours de construction :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004730000030E094525DC.png" style="display:inline-block; margin:4px;width:15.069cm;height:10.345cm;" /></td></tr></table>

<p>Nous avons construit une couche [DAO] [2] avec la même interface que la couche [DAO] [4]. Pour tester la couche [DAO] [2], on peut donc utiliser le test JUnit qui a servi à tester la couche [DAO] [4]. Pour rappel, celui-ci est le suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D70000009A56112D8B.png" style="display:inline-block; margin:4px;width:3.979cm;height:2.85cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">  1</a></span>
<span class="normal"><a href="#__codelineno-56-2">  2</a></span>
<span class="normal"><a href="#__codelineno-56-3">  3</a></span>
<span class="normal"><a href="#__codelineno-56-4">  4</a></span>
<span class="normal"><a href="#__codelineno-56-5">  5</a></span>
<span class="normal"><a href="#__codelineno-56-6">  6</a></span>
<span class="normal"><a href="#__codelineno-56-7">  7</a></span>
<span class="normal"><a href="#__codelineno-56-8">  8</a></span>
<span class="normal"><a href="#__codelineno-56-9">  9</a></span>
<span class="normal"><a href="#__codelineno-56-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-56-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-56-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-56-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-56-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-56-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-56-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-56-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-56-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-56-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-56-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-56-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-56-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-56-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-56-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-56-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-56-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-56-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-56-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-56-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-56-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-56-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-56-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-56-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-56-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-56-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-56-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-56-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-56-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-56-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-56-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-56-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-56-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-56-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-56-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-56-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-56-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-56-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-56-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-56-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-56-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-56-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-56-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-56-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-56-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-56-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-56-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-56-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-56-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-56-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-56-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-56-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-56-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-56-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-56-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-56-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-56-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-56-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-56-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-56-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-56-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-56-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-56-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-56-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-56-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-56-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-56-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-56-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-56-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-56-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-56-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-56-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-56-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-56-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-56-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-56-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-56-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-56-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-56-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-56-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-56-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-56-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-56-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-56-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-56-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-56-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-56-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-56-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-56-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-56-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-56-100">100</a></span>
<span class="normal"><a href="#__codelineno-56-101">101</a></span>
<span class="normal"><a href="#__codelineno-56-102">102</a></span>
<span class="normal"><a href="#__codelineno-56-103">103</a></span>
<span class="normal"><a href="#__codelineno-56-104">104</a></span>
<span class="normal"><a href="#__codelineno-56-105">105</a></span>
<span class="normal"><a href="#__codelineno-56-106">106</a></span>
<span class="normal"><a href="#__codelineno-56-107">107</a></span>
<span class="normal"><a href="#__codelineno-56-108">108</a></span>
<span class="normal"><a href="#__codelineno-56-109">109</a></span>
<span class="normal"><a href="#__codelineno-56-110">110</a></span>
<span class="normal"><a href="#__codelineno-56-111">111</a></span>
<span class="normal"><a href="#__codelineno-56-112">112</a></span>
<span class="normal"><a href="#__codelineno-56-113">113</a></span>
<span class="normal"><a href="#__codelineno-56-114">114</a></span>
<span class="normal"><a href="#__codelineno-56-115">115</a></span>
<span class="normal"><a href="#__codelineno-56-116">116</a></span>
<span class="normal"><a href="#__codelineno-56-117">117</a></span>
<span class="normal"><a href="#__codelineno-56-118">118</a></span>
<span class="normal"><a href="#__codelineno-56-119">119</a></span>
<span class="normal"><a href="#__codelineno-56-120">120</a></span>
<span class="normal"><a href="#__codelineno-56-121">121</a></span>
<span class="normal"><a href="#__codelineno-56-122">122</a></span>
<span class="normal"><a href="#__codelineno-56-123">123</a></span>
<span class="normal"><a href="#__codelineno-56-124">124</a></span>
<span class="normal"><a href="#__codelineno-56-125">125</a></span>
<span class="normal"><a href="#__codelineno-56-126">126</a></span>
<span class="normal"><a href="#__codelineno-56-127">127</a></span>
<span class="normal"><a href="#__codelineno-56-128">128</a></span>
<span class="normal"><a href="#__codelineno-56-129">129</a></span>
<span class="normal"><a href="#__codelineno-56-130">130</a></span>
<span class="normal"><a href="#__codelineno-56-131">131</a></span>
<span class="normal"><a href="#__codelineno-56-132">132</a></span>
<span class="normal"><a href="#__codelineno-56-133">133</a></span>
<span class="normal"><a href="#__codelineno-56-134">134</a></span>
<span class="normal"><a href="#__codelineno-56-135">135</a></span>
<span class="normal"><a href="#__codelineno-56-136">136</a></span>
<span class="normal"><a href="#__codelineno-56-137">137</a></span>
<span class="normal"><a href="#__codelineno-56-138">138</a></span>
<span class="normal"><a href="#__codelineno-56-139">139</a></span>
<span class="normal"><a href="#__codelineno-56-140">140</a></span>
<span class="normal"><a href="#__codelineno-56-141">141</a></span>
<span class="normal"><a href="#__codelineno-56-142">142</a></span>
<span class="normal"><a href="#__codelineno-56-143">143</a></span>
<span class="normal"><a href="#__codelineno-56-144">144</a></span>
<span class="normal"><a href="#__codelineno-56-145">145</a></span>
<span class="normal"><a href="#__codelineno-56-146">146</a></span>
<span class="normal"><a href="#__codelineno-56-147">147</a></span>
<span class="normal"><a href="#__codelineno-56-148">148</a></span>
<span class="normal"><a href="#__codelineno-56-149">149</a></span>
<span class="normal"><a href="#__codelineno-56-150">150</a></span>
<span class="normal"><a href="#__codelineno-56-151">151</a></span>
<span class="normal"><a href="#__codelineno-56-152">152</a></span>
<span class="normal"><a href="#__codelineno-56-153">153</a></span>
<span class="normal"><a href="#__codelineno-56-154">154</a></span>
<span class="normal"><a href="#__codelineno-56-155">155</a></span>
<span class="normal"><a href="#__codelineno-56-156">156</a></span>
<span class="normal"><a href="#__codelineno-56-157">157</a></span>
<span class="normal"><a href="#__codelineno-56-158">158</a></span>
<span class="normal"><a href="#__codelineno-56-159">159</a></span>
<span class="normal"><a href="#__codelineno-56-160">160</a></span>
<span class="normal"><a href="#__codelineno-56-161">161</a></span>
<span class="normal"><a href="#__codelineno-56-162">162</a></span>
<span class="normal"><a href="#__codelineno-56-163">163</a></span>
<span class="normal"><a href="#__codelineno-56-164">164</a></span>
<span class="normal"><a href="#__codelineno-56-165">165</a></span>
<span class="normal"><a href="#__codelineno-56-166">166</a></span>
<span class="normal"><a href="#__codelineno-56-167">167</a></span>
<span class="normal"><a href="#__codelineno-56-168">168</a></span>
<span class="normal"><a href="#__codelineno-56-169">169</a></span>
<span class="normal"><a href="#__codelineno-56-170">170</a></span>
<span class="normal"><a href="#__codelineno-56-171">171</a></span>
<span class="normal"><a href="#__codelineno-56-172">172</a></span>
<span class="normal"><a href="#__codelineno-56-173">173</a></span>
<span class="normal"><a href="#__codelineno-56-174">174</a></span>
<span class="normal"><a href="#__codelineno-56-175">175</a></span>
<span class="normal"><a href="#__codelineno-56-176">176</a></span>
<span class="normal"><a href="#__codelineno-56-177">177</a></span>
<span class="normal"><a href="#__codelineno-56-178">178</a></span>
<span class="normal"><a href="#__codelineno-56-179">179</a></span>
<span class="normal"><a href="#__codelineno-56-180">180</a></span>
<span class="normal"><a href="#__codelineno-56-181">181</a></span>
<span class="normal"><a href="#__codelineno-56-182">182</a></span>
<span class="normal"><a href="#__codelineno-56-183">183</a></span>
<span class="normal"><a href="#__codelineno-56-184">184</a></span>
<span class="normal"><a href="#__codelineno-56-185">185</a></span>
<span class="normal"><a href="#__codelineno-56-186">186</a></span>
<span class="normal"><a href="#__codelineno-56-187">187</a></span>
<span class="normal"><a href="#__codelineno-56-188">188</a></span>
<span class="normal"><a href="#__codelineno-56-189">189</a></span>
<span class="normal"><a href="#__codelineno-56-190">190</a></span>
<span class="normal"><a href="#__codelineno-56-191">191</a></span>
<span class="normal"><a href="#__codelineno-56-192">192</a></span>
<span class="normal"><a href="#__codelineno-56-193">193</a></span>
<span class="normal"><a href="#__codelineno-56-194">194</a></span>
<span class="normal"><a href="#__codelineno-56-195">195</a></span>
<span class="normal"><a href="#__codelineno-56-196">196</a></span>
<span class="normal"><a href="#__codelineno-56-197">197</a></span>
<span class="normal"><a href="#__codelineno-56-198">198</a></span>
<span class="normal"><a href="#__codelineno-56-199">199</a></span>
<span class="normal"><a href="#__codelineno-56-200">200</a></span>
<span class="normal"><a href="#__codelineno-56-201">201</a></span>
<span class="normal"><a href="#__codelineno-56-202">202</a></span>
<span class="normal"><a href="#__codelineno-56-203">203</a></span>
<span class="normal"><a href="#__codelineno-56-204">204</a></span>
<span class="normal"><a href="#__codelineno-56-205">205</a></span>
<span class="normal"><a href="#__codelineno-56-206">206</a></span>
<span class="normal"><a href="#__codelineno-56-207">207</a></span>
<span class="normal"><a href="#__codelineno-56-208">208</a></span>
<span class="normal"><a href="#__codelineno-56-209">209</a></span>
<span class="normal"><a href="#__codelineno-56-210">210</a></span>
<span class="normal"><a href="#__codelineno-56-211">211</a></span>
<span class="normal"><a href="#__codelineno-56-212">212</a></span>
<span class="normal"><a href="#__codelineno-56-213">213</a></span>
<span class="normal"><a href="#__codelineno-56-214">214</a></span>
<span class="normal"><a href="#__codelineno-56-215">215</a></span>
<span class="normal"><a href="#__codelineno-56-216">216</a></span>
<span class="normal"><a href="#__codelineno-56-217">217</a></span>
<span class="normal"><a href="#__codelineno-56-218">218</a></span>
<span class="normal"><a href="#__codelineno-56-219">219</a></span>
<span class="normal"><a href="#__codelineno-56-220">220</a></span>
<span class="normal"><a href="#__codelineno-56-221">221</a></span>
<span class="normal"><a href="#__codelineno-56-222">222</a></span>
<span class="normal"><a href="#__codelineno-56-223">223</a></span>
<span class="normal"><a href="#__codelineno-56-224">224</a></span>
<span class="normal"><a href="#__codelineno-56-225">225</a></span>
<span class="normal"><a href="#__codelineno-56-226">226</a></span>
<span class="normal"><a href="#__codelineno-56-227">227</a></span>
<span class="normal"><a href="#__codelineno-56-228">228</a></span>
<span class="normal"><a href="#__codelineno-56-229">229</a></span>
<span class="normal"><a href="#__codelineno-56-230">230</a></span>
<span class="normal"><a href="#__codelineno-56-231">231</a></span>
<span class="normal"><a href="#__codelineno-56-232">232</a></span>
<span class="normal"><a href="#__codelineno-56-233">233</a></span>
<span class="normal"><a href="#__codelineno-56-234">234</a></span>
<span class="normal"><a href="#__codelineno-56-235">235</a></span>
<span class="normal"><a href="#__codelineno-56-236">236</a></span>
<span class="normal"><a href="#__codelineno-56-237">237</a></span>
<span class="normal"><a href="#__codelineno-56-238">238</a></span>
<span class="normal"><a href="#__codelineno-56-239">239</a></span>
<span class="normal"><a href="#__codelineno-56-240">240</a></span>
<span class="normal"><a href="#__codelineno-56-241">241</a></span>
<span class="normal"><a href="#__codelineno-56-242">242</a></span>
<span class="normal"><a href="#__codelineno-56-243">243</a></span>
<span class="normal"><a href="#__codelineno-56-244">244</a></span>
<span class="normal"><a href="#__codelineno-56-245">245</a></span>
<span class="normal"><a href="#__codelineno-56-246">246</a></span>
<span class="normal"><a href="#__codelineno-56-247">247</a></span>
<span class="normal"><a href="#__codelineno-56-248">248</a></span>
<span class="normal"><a href="#__codelineno-56-249">249</a></span>
<span class="normal"><a href="#__codelineno-56-250">250</a></span>
<span class="normal"><a href="#__codelineno-56-251">251</a></span>
<span class="normal"><a href="#__codelineno-56-252">252</a></span>
<span class="normal"><a href="#__codelineno-56-253">253</a></span>
<span class="normal"><a href="#__codelineno-56-254">254</a></span>
<span class="normal"><a href="#__codelineno-56-255">255</a></span>
<span class="normal"><a href="#__codelineno-56-256">256</a></span>
<span class="normal"><a href="#__codelineno-56-257">257</a></span>
<span class="normal"><a href="#__codelineno-56-258">258</a></span>
<span class="normal"><a href="#__codelineno-56-259">259</a></span>
<span class="normal"><a href="#__codelineno-56-260">260</a></span>
<span class="normal"><a href="#__codelineno-56-261">261</a></span>
<span class="normal"><a href="#__codelineno-56-262">262</a></span>
<span class="normal"><a href="#__codelineno-56-263">263</a></span>
<span class="normal"><a href="#__codelineno-56-264">264</a></span>
<span class="normal"><a href="#__codelineno-56-265">265</a></span>
<span class="normal"><a href="#__codelineno-56-266">266</a></span>
<span class="normal"><a href="#__codelineno-56-267">267</a></span>
<span class="normal"><a href="#__codelineno-56-268">268</a></span>
<span class="normal"><a href="#__codelineno-56-269">269</a></span>
<span class="normal"><a href="#__codelineno-56-270">270</a></span>
<span class="normal"><a href="#__codelineno-56-271">271</a></span>
<span class="normal"><a href="#__codelineno-56-272">272</a></span>
<span class="normal"><a href="#__codelineno-56-273">273</a></span>
<span class="normal"><a href="#__codelineno-56-274">274</a></span>
<span class="normal"><a href="#__codelineno-56-275">275</a></span>
<span class="normal"><a href="#__codelineno-56-276">276</a></span>
<span class="normal"><a href="#__codelineno-56-277">277</a></span>
<span class="normal"><a href="#__codelineno-56-278">278</a></span>
<span class="normal"><a href="#__codelineno-56-279">279</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.client.junit</span><span class="p">;</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Assert</span><span class="p">;</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Before</span><span class="p">;</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.BeansException</span><span class="p">;</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="p">;</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.SpringApplicationConfiguration</span><span class="p">;</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.collect.Lists</span><span class="p">;</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.config.DaoConfig</span><span class="p">;</span>
<a id="__codelineno-56-22" name="__codelineno-56-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.dao.DaoException</span><span class="p">;</span>
<a id="__codelineno-56-23" name="__codelineno-56-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.dao.IDao</span><span class="p">;</span>
<a id="__codelineno-56-24" name="__codelineno-56-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-56-25" name="__codelineno-56-25"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.client.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-56-26" name="__codelineno-56-26"></a>
<a id="__codelineno-56-27" name="__codelineno-56-27"></a><span class="nd">@SpringApplicationConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DaoConfig</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-56-28" name="__codelineno-56-28"></a><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-56-29" name="__codelineno-56-29"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test01</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-30" name="__codelineno-56-30"></a>
<a id="__codelineno-56-31" name="__codelineno-56-31"></a><span class="w">    </span><span class="c1">// couche [DAO]</span>
<a id="__codelineno-56-32" name="__codelineno-56-32"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-56-33" name="__codelineno-56-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">IDao</span><span class="w"> </span><span class="n">dao</span><span class="p">;</span>
<a id="__codelineno-56-34" name="__codelineno-56-34"></a>
<a id="__codelineno-56-35" name="__codelineno-56-35"></a><span class="w">    </span><span class="c1">// filtres jSON</span>
<a id="__codelineno-56-36" name="__codelineno-56-36"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-56-37" name="__codelineno-56-37"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-56-38" name="__codelineno-56-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">;</span>
<a id="__codelineno-56-39" name="__codelineno-56-39"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-56-40" name="__codelineno-56-40"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-56-41" name="__codelineno-56-41"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">;</span>
<a id="__codelineno-56-42" name="__codelineno-56-42"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-56-43" name="__codelineno-56-43"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-56-44" name="__codelineno-56-44"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithCategorie</span><span class="p">;</span>
<a id="__codelineno-56-45" name="__codelineno-56-45"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-56-46" name="__codelineno-56-46"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-56-47" name="__codelineno-56-47"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">;</span>
<a id="__codelineno-56-48" name="__codelineno-56-48"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-56-49" name="__codelineno-56-49"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-56-50" name="__codelineno-56-50"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">;</span>
<a id="__codelineno-56-51" name="__codelineno-56-51"></a>
<a id="__codelineno-56-52" name="__codelineno-56-52"></a><span class="w">    </span><span class="nd">@Before</span>
<a id="__codelineno-56-53" name="__codelineno-56-53"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cleanAndFill</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-54" name="__codelineno-56-54"></a><span class="w">        </span><span class="c1">// on nettoie la base avant chaque test</span>
<a id="__codelineno-56-55" name="__codelineno-56-55"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Vidage de la base de données&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-56" name="__codelineno-56-56"></a><span class="w">        </span><span class="c1">// on vide la table [CATEGORIES] - par cascade la table [PRODUITS] va être vidée</span>
<a id="__codelineno-56-57" name="__codelineno-56-57"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-56-58" name="__codelineno-56-58"></a><span class="w">        </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-56-59" name="__codelineno-56-59"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Remplissage de la base&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-60" name="__codelineno-56-60"></a><span class="w">        </span><span class="c1">// on remplit les tables</span>
<a id="__codelineno-56-61" name="__codelineno-56-61"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-56-62" name="__codelineno-56-62"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-63" name="__codelineno-56-63"></a><span class="w">            </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Categorie</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;categorie%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">));</span>
<a id="__codelineno-56-64" name="__codelineno-56-64"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-65" name="__codelineno-56-65"></a><span class="w">                </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;produit%d%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">),</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-56-66" name="__codelineno-56-66"></a><span class="w">                        </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;desc%d%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)));</span>
<a id="__codelineno-56-67" name="__codelineno-56-67"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-56-68" name="__codelineno-56-68"></a><span class="w">            </span><span class="n">categories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">categorie</span><span class="p">);</span>
<a id="__codelineno-56-69" name="__codelineno-56-69"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-70" name="__codelineno-56-70"></a><span class="w">        </span><span class="c1">// ajout de la catégorie - par cascade les produits vont eux aussi être insérés</span>
<a id="__codelineno-56-71" name="__codelineno-56-71"></a><span class="w">        </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">addCategories</span><span class="p">(</span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-56-72" name="__codelineno-56-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-73" name="__codelineno-56-73"></a>
<a id="__codelineno-56-74" name="__codelineno-56-74"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-75" name="__codelineno-56-75"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showDataBase</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">BeansException</span><span class="p">,</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-76" name="__codelineno-56-76"></a><span class="w">        </span><span class="c1">// liste des catégories</span>
<a id="__codelineno-56-77" name="__codelineno-56-77"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des catégories&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-56-78" name="__codelineno-56-78"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">();</span>
<a id="__codelineno-56-79" name="__codelineno-56-79"></a><span class="w">        </span><span class="n">affiche</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">);</span>
<a id="__codelineno-56-80" name="__codelineno-56-80"></a><span class="w">        </span><span class="c1">// liste des produits</span>
<a id="__codelineno-56-81" name="__codelineno-56-81"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des produits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-56-82" name="__codelineno-56-82"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">();</span>
<a id="__codelineno-56-83" name="__codelineno-56-83"></a><span class="w">        </span><span class="n">affiche</span><span class="p">(</span><span class="n">produits</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">);</span>
<a id="__codelineno-56-84" name="__codelineno-56-84"></a><span class="w">        </span><span class="c1">// quelques vérifications</span>
<a id="__codelineno-56-85" name="__codelineno-56-85"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-56-86" name="__codelineno-56-86"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">produits</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-56-87" name="__codelineno-56-87"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findCategorieByName</span><span class="p">(</span><span class="s">&quot;categorie0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-56-88" name="__codelineno-56-88"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie</span><span class="p">);</span>
<a id="__codelineno-56-89" name="__codelineno-56-89"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findProduitByName</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-56-90" name="__codelineno-56-90"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
<a id="__codelineno-56-91" name="__codelineno-56-91"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getIdCategorie</span><span class="p">();</span>
<a id="__codelineno-56-92" name="__codelineno-56-92"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">categorie</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-56-93" name="__codelineno-56-93"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-94" name="__codelineno-56-94"></a>
<a id="__codelineno-56-95" name="__codelineno-56-95"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-96" name="__codelineno-56-96"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCategorieByNameWithProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-97" name="__codelineno-56-97"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getCategorieByNameWithProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-98" name="__codelineno-56-98"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-99" name="__codelineno-56-99"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie1</span><span class="p">);</span>
<a id="__codelineno-56-100" name="__codelineno-56-100"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">categorie1</span><span class="p">.</span><span class="na">getProduits</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-56-101" name="__codelineno-56-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-102" name="__codelineno-56-102"></a>
<a id="__codelineno-56-103" name="__codelineno-56-103"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-104" name="__codelineno-56-104"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCategorieByNameWithoutProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-105" name="__codelineno-56-105"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getCategorieByNameWithoutProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-106" name="__codelineno-56-106"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-107" name="__codelineno-56-107"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie1</span><span class="p">);</span>
<a id="__codelineno-56-108" name="__codelineno-56-108"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">categorie1</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-56-109" name="__codelineno-56-109"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-110" name="__codelineno-56-110"></a>
<a id="__codelineno-56-111" name="__codelineno-56-111"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-112" name="__codelineno-56-112"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCategorieByIdWithProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-113" name="__codelineno-56-113"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getCategorieByIdWithProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-114" name="__codelineno-56-114"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-115" name="__codelineno-56-115"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">categorie1</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-116" name="__codelineno-56-116"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie2</span><span class="p">);</span>
<a id="__codelineno-56-117" name="__codelineno-56-117"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">categorie1</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">categorie2</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-118" name="__codelineno-56-118"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">categorie1</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">categorie2</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-56-119" name="__codelineno-56-119"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-120" name="__codelineno-56-120"></a>
<a id="__codelineno-56-121" name="__codelineno-56-121"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-122" name="__codelineno-56-122"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCategorieByIdWithoutProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-123" name="__codelineno-56-123"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getCategorieByIdWithoutProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-124" name="__codelineno-56-124"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-125" name="__codelineno-56-125"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="n">categorie1</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-126" name="__codelineno-56-126"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie2</span><span class="p">);</span>
<a id="__codelineno-56-127" name="__codelineno-56-127"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">categorie1</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">categorie2</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-56-128" name="__codelineno-56-128"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-129" name="__codelineno-56-129"></a>
<a id="__codelineno-56-130" name="__codelineno-56-130"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-131" name="__codelineno-56-131"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getProduitByNameWithCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-132" name="__codelineno-56-132"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getProduitByNameWithCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-133" name="__codelineno-56-133"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">);</span>
<a id="__codelineno-56-134" name="__codelineno-56-134"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
<a id="__codelineno-56-135" name="__codelineno-56-135"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getCategorie</span><span class="p">());</span>
<a id="__codelineno-56-136" name="__codelineno-56-136"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-137" name="__codelineno-56-137"></a>
<a id="__codelineno-56-138" name="__codelineno-56-138"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-139" name="__codelineno-56-139"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getProduitByNameWithoutCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-140" name="__codelineno-56-140"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getProduitByNameWithoutCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-141" name="__codelineno-56-141"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithoutCategorie</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">);</span>
<a id="__codelineno-56-142" name="__codelineno-56-142"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
<a id="__codelineno-56-143" name="__codelineno-56-143"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-56-144" name="__codelineno-56-144"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-145" name="__codelineno-56-145"></a>
<a id="__codelineno-56-146" name="__codelineno-56-146"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-147" name="__codelineno-56-147"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getProduitByIdWithCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-148" name="__codelineno-56-148"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getProduitByNameWithCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-149" name="__codelineno-56-149"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">);</span>
<a id="__codelineno-56-150" name="__codelineno-56-150"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-151" name="__codelineno-56-151"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit2</span><span class="p">);</span>
<a id="__codelineno-56-152" name="__codelineno-56-152"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-56-153" name="__codelineno-56-153"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-154" name="__codelineno-56-154"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getCategorie</span><span class="p">().</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">produit2</span><span class="p">.</span><span class="na">getCategorie</span><span class="p">().</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-155" name="__codelineno-56-155"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-156" name="__codelineno-56-156"></a>
<a id="__codelineno-56-157" name="__codelineno-56-157"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-158" name="__codelineno-56-158"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getProduitByIdWithoutCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-159" name="__codelineno-56-159"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getProduitByIdWithoutCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-160" name="__codelineno-56-160"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">);</span>
<a id="__codelineno-56-161" name="__codelineno-56-161"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-162" name="__codelineno-56-162"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit2</span><span class="p">);</span>
<a id="__codelineno-56-163" name="__codelineno-56-163"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-56-164" name="__codelineno-56-164"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-56-165" name="__codelineno-56-165"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-166" name="__codelineno-56-166"></a>
<a id="__codelineno-56-167" name="__codelineno-56-167"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-168" name="__codelineno-56-168"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doInsertsInTransaction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-169" name="__codelineno-56-169"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Ajout d&#39;une catégorie [cat1] avec deux produits de même nom&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-170" name="__codelineno-56-170"></a><span class="w">        </span><span class="c1">// on fait l&#39;insertion</span>
<a id="__codelineno-56-171" name="__codelineno-56-171"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Categorie</span><span class="p">(</span><span class="s">&quot;cat1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-172" name="__codelineno-56-172"></a><span class="w">        </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">));</span>
<a id="__codelineno-56-173" name="__codelineno-56-173"></a><span class="w">        </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">));</span>
<a id="__codelineno-56-174" name="__codelineno-56-174"></a><span class="w">        </span><span class="c1">// ajout de la catégorie - par cascade les produits vont eux aussi être insérés</span>
<a id="__codelineno-56-175" name="__codelineno-56-175"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-176" name="__codelineno-56-176"></a><span class="w">            </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">addCategories</span><span class="p">(</span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">categorie</span><span class="p">)).</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-56-177" name="__codelineno-56-177"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DaoException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-178" name="__codelineno-56-178"></a><span class="w">            </span><span class="n">show</span><span class="p">(</span><span class="s">&quot;Les erreurs suivantes se sont produites :&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getErreurs</span><span class="p">());</span>
<a id="__codelineno-56-179" name="__codelineno-56-179"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-180" name="__codelineno-56-180"></a><span class="w">        </span><span class="c1">// vérifications</span>
<a id="__codelineno-56-181" name="__codelineno-56-181"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">();</span>
<a id="__codelineno-56-182" name="__codelineno-56-182"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-56-183" name="__codelineno-56-183"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">();</span>
<a id="__codelineno-56-184" name="__codelineno-56-184"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">produits</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-56-185" name="__codelineno-56-185"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-186" name="__codelineno-56-186"></a>
<a id="__codelineno-56-187" name="__codelineno-56-187"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-188" name="__codelineno-56-188"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDataBase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-189" name="__codelineno-56-189"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Mise à jour du prix des produits de [categorie1]&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-190" name="__codelineno-56-190"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-191" name="__codelineno-56-191"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1Saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-56-192" name="__codelineno-56-192"></a><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categorie1</span><span class="p">.</span><span class="na">getProduits</span><span class="p">();</span>
<a id="__codelineno-56-193" name="__codelineno-56-193"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-194" name="__codelineno-56-194"></a><span class="w">            </span><span class="n">produit</span><span class="p">.</span><span class="na">setPrix</span><span class="p">(</span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getPrix</span><span class="p">());</span>
<a id="__codelineno-56-195" name="__codelineno-56-195"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-196" name="__codelineno-56-196"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-56-197" name="__codelineno-56-197"></a><span class="w">        </span><span class="n">produits2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">updateProduits</span><span class="p">(</span><span class="n">produits2</span><span class="p">);</span>
<a id="__codelineno-56-198" name="__codelineno-56-198"></a><span class="w">        </span><span class="c1">// vérifications</span>
<a id="__codelineno-56-199" name="__codelineno-56-199"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produitsSaved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">categorie1Saved</span><span class="p">.</span><span class="na">getProduits</span><span class="p">());</span>
<a id="__codelineno-56-200" name="__codelineno-56-200"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">produits2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-201" name="__codelineno-56-201"></a><span class="w">            </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findProduitByName</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">produitsSaved</span><span class="p">);</span>
<a id="__codelineno-56-202" name="__codelineno-56-202"></a><span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getPrix</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getPrix</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.1</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">);</span>
<a id="__codelineno-56-203" name="__codelineno-56-203"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-204" name="__codelineno-56-204"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-205" name="__codelineno-56-205"></a>
<a id="__codelineno-56-206" name="__codelineno-56-206"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-56-207" name="__codelineno-56-207"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">BeansException</span><span class="p">,</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-208" name="__codelineno-56-208"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Ajout de deux produits de catégorie [categorie0]&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-56-209" name="__codelineno-56-209"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="s">&quot;categorie0&quot;</span><span class="p">);</span>
<a id="__codelineno-56-210" name="__codelineno-56-210"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categorie0</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
<a id="__codelineno-56-211" name="__codelineno-56-211"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-56-212" name="__codelineno-56-212"></a><span class="w">        </span><span class="n">p1</span><span class="p">.</span><span class="na">setIdCategorie</span><span class="p">(</span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-56-213" name="__codelineno-56-213"></a><span class="w">        </span><span class="n">p1</span><span class="p">.</span><span class="na">setCategorie</span><span class="p">(</span><span class="n">categorie0</span><span class="p">);</span>
<a id="__codelineno-56-214" name="__codelineno-56-214"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-56-215" name="__codelineno-56-215"></a><span class="w">        </span><span class="n">p2</span><span class="p">.</span><span class="na">setIdCategorie</span><span class="p">(</span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-56-216" name="__codelineno-56-216"></a><span class="w">        </span><span class="n">p2</span><span class="p">.</span><span class="na">setCategorie</span><span class="p">(</span><span class="n">categorie0</span><span class="p">);</span>
<a id="__codelineno-56-217" name="__codelineno-56-217"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-56-218" name="__codelineno-56-218"></a><span class="w">        </span><span class="n">produits</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>
<a id="__codelineno-56-219" name="__codelineno-56-219"></a><span class="w">        </span><span class="n">produits</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
<a id="__codelineno-56-220" name="__codelineno-56-220"></a><span class="w">        </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">addProduits</span><span class="p">(</span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-56-221" name="__codelineno-56-221"></a><span class="w">        </span><span class="c1">// vérification</span>
<a id="__codelineno-56-222" name="__codelineno-56-222"></a><span class="w">        </span><span class="n">affiche</span><span class="p">(</span><span class="n">produits</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">);</span>
<a id="__codelineno-56-223" name="__codelineno-56-223"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-224" name="__codelineno-56-224"></a>
<a id="__codelineno-56-225" name="__codelineno-56-225"></a><span class="w">    </span><span class="c1">// -------------- méthodes privées</span>
<a id="__codelineno-56-226" name="__codelineno-56-226"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">findProduitByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-227" name="__codelineno-56-227"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-228" name="__codelineno-56-228"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">nom</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-229" name="__codelineno-56-229"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">produit</span><span class="p">;</span>
<a id="__codelineno-56-230" name="__codelineno-56-230"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-56-231" name="__codelineno-56-231"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-232" name="__codelineno-56-232"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-56-233" name="__codelineno-56-233"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-234" name="__codelineno-56-234"></a>
<a id="__codelineno-56-235" name="__codelineno-56-235"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">findCategorieByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-236" name="__codelineno-56-236"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-237" name="__codelineno-56-237"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">categorie</span><span class="p">.</span><span class="na">getNom</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">nom</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-238" name="__codelineno-56-238"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">categorie</span><span class="p">;</span>
<a id="__codelineno-56-239" name="__codelineno-56-239"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-56-240" name="__codelineno-56-240"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-241" name="__codelineno-56-241"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-56-242" name="__codelineno-56-242"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-243" name="__codelineno-56-243"></a>
<a id="__codelineno-56-244" name="__codelineno-56-244"></a><span class="w">    </span><span class="c1">// affichage d&#39;un élément de type T</span>
<a id="__codelineno-56-245" name="__codelineno-56-245"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-246" name="__codelineno-56-246"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jsonMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">element</span><span class="p">));</span>
<a id="__codelineno-56-247" name="__codelineno-56-247"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-248" name="__codelineno-56-248"></a>
<a id="__codelineno-56-249" name="__codelineno-56-249"></a><span class="w">    </span><span class="c1">// affichage d&#39;une liste d&#39;éléments de type T</span>
<a id="__codelineno-56-250" name="__codelineno-56-250"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">elements</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-251" name="__codelineno-56-251"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">elements</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-252" name="__codelineno-56-252"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">);</span>
<a id="__codelineno-56-253" name="__codelineno-56-253"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-254" name="__codelineno-56-254"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-255" name="__codelineno-56-255"></a>
<a id="__codelineno-56-256" name="__codelineno-56-256"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-257" name="__codelineno-56-257"></a><span class="w">        </span><span class="c1">// affiche message</span>
<a id="__codelineno-56-258" name="__codelineno-56-258"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-56-259" name="__codelineno-56-259"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-260" name="__codelineno-56-260"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-56-261" name="__codelineno-56-261"></a><span class="w">            </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s --------------------------------&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-56-262" name="__codelineno-56-262"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-56-263" name="__codelineno-56-263"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-56-264" name="__codelineno-56-264"></a><span class="w">            </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;-- %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-56-265" name="__codelineno-56-265"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-56-266" name="__codelineno-56-266"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-267" name="__codelineno-56-267"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">toPrint</span><span class="p">);</span>
<a id="__codelineno-56-268" name="__codelineno-56-268"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-269" name="__codelineno-56-269"></a>
<a id="__codelineno-56-270" name="__codelineno-56-270"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-271" name="__codelineno-56-271"></a><span class="w">        </span><span class="c1">// titre</span>
<a id="__codelineno-56-272" name="__codelineno-56-272"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s : &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">));</span>
<a id="__codelineno-56-273" name="__codelineno-56-273"></a><span class="w">        </span><span class="c1">// messages</span>
<a id="__codelineno-56-274" name="__codelineno-56-274"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-275" name="__codelineno-56-275"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;- %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">));</span>
<a id="__codelineno-56-276" name="__codelineno-56-276"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-277" name="__codelineno-56-277"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-278" name="__codelineno-56-278"></a>
<a id="__codelineno-56-279" name="__codelineno-56-279"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Son exécution réussit et donne les résultats suivants sur la console :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span>
<span class="normal"><a href="#__codelineno-57-19">19</a></span>
<span class="normal"><a href="#__codelineno-57-20">20</a></span>
<span class="normal"><a href="#__codelineno-57-21">21</a></span>
<span class="normal"><a href="#__codelineno-57-22">22</a></span>
<span class="normal"><a href="#__codelineno-57-23">23</a></span>
<span class="normal"><a href="#__codelineno-57-24">24</a></span>
<span class="normal"><a href="#__codelineno-57-25">25</a></span>
<span class="normal"><a href="#__codelineno-57-26">26</a></span>
<span class="normal"><a href="#__codelineno-57-27">27</a></span>
<span class="normal"><a href="#__codelineno-57-28">28</a></span>
<span class="normal"><a href="#__codelineno-57-29">29</a></span>
<span class="normal"><a href="#__codelineno-57-30">30</a></span>
<span class="normal"><a href="#__codelineno-57-31">31</a></span>
<span class="normal"><a href="#__codelineno-57-32">32</a></span>
<span class="normal"><a href="#__codelineno-57-33">33</a></span>
<span class="normal"><a href="#__codelineno-57-34">34</a></span>
<span class="normal"><a href="#__codelineno-57-35">35</a></span>
<span class="normal"><a href="#__codelineno-57-36">36</a></span>
<span class="normal"><a href="#__codelineno-57-37">37</a></span>
<span class="normal"><a href="#__codelineno-57-38">38</a></span>
<span class="normal"><a href="#__codelineno-57-39">39</a></span>
<span class="normal"><a href="#__codelineno-57-40">40</a></span>
<span class="normal"><a href="#__codelineno-57-41">41</a></span>
<span class="normal"><a href="#__codelineno-57-42">42</a></span>
<span class="normal"><a href="#__codelineno-57-43">43</a></span>
<span class="normal"><a href="#__codelineno-57-44">44</a></span>
<span class="normal"><a href="#__codelineno-57-45">45</a></span>
<span class="normal"><a href="#__codelineno-57-46">46</a></span>
<span class="normal"><a href="#__codelineno-57-47">47</a></span>
<span class="normal"><a href="#__codelineno-57-48">48</a></span>
<span class="normal"><a href="#__codelineno-57-49">49</a></span>
<span class="normal"><a href="#__codelineno-57-50">50</a></span>
<span class="normal"><a href="#__codelineno-57-51">51</a></span>
<span class="normal"><a href="#__codelineno-57-52">52</a></span>
<span class="normal"><a href="#__codelineno-57-53">53</a></span>
<span class="normal"><a href="#__codelineno-57-54">54</a></span>
<span class="normal"><a href="#__codelineno-57-55">55</a></span>
<span class="normal"><a href="#__codelineno-57-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>Ajout de deux produits de catégorie [categorie0] --------------------------------
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>{&quot;id&quot;:6285,&quot;version&quot;:0,&quot;nom&quot;:&quot;x&quot;,&quot;idCategorie&quot;:1319,&quot;prix&quot;:1.0,&quot;description&quot;:&quot;&quot;}
<a id="__codelineno-57-5" name="__codelineno-57-5"></a>{&quot;id&quot;:6286,&quot;version&quot;:0,&quot;nom&quot;:&quot;y&quot;,&quot;idCategorie&quot;:1319,&quot;prix&quot;:1.0,&quot;description&quot;:&quot;&quot;}
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-8" name="__codelineno-57-8"></a>Mise à jour du prix des produits de [categorie1] --------------------------------
<a id="__codelineno-57-9" name="__codelineno-57-9"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-10" name="__codelineno-57-10"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-11" name="__codelineno-57-11"></a>getCategorieByIdWithoutProduits --------------------------------
<a id="__codelineno-57-12" name="__codelineno-57-12"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-13" name="__codelineno-57-13"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-14" name="__codelineno-57-14"></a>getProduitByNameWithoutCategorie --------------------------------
<a id="__codelineno-57-15" name="__codelineno-57-15"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-16" name="__codelineno-57-16"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-17" name="__codelineno-57-17"></a>getCategorieByNameWithProduits --------------------------------
<a id="__codelineno-57-18" name="__codelineno-57-18"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-19" name="__codelineno-57-19"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-20" name="__codelineno-57-20"></a>getCategorieByNameWithoutProduits --------------------------------
<a id="__codelineno-57-21" name="__codelineno-57-21"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-22" name="__codelineno-57-22"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-23" name="__codelineno-57-23"></a>getProduitByNameWithCategorie --------------------------------
<a id="__codelineno-57-24" name="__codelineno-57-24"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-25" name="__codelineno-57-25"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-26" name="__codelineno-57-26"></a>getProduitByNameWithCategorie --------------------------------
<a id="__codelineno-57-27" name="__codelineno-57-27"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-28" name="__codelineno-57-28"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-29" name="__codelineno-57-29"></a>getProduitByIdWithoutCategorie --------------------------------
<a id="__codelineno-57-30" name="__codelineno-57-30"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-31" name="__codelineno-57-31"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-32" name="__codelineno-57-32"></a>-- Liste des catégories
<a id="__codelineno-57-33" name="__codelineno-57-33"></a>{&quot;id&quot;:1337,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie0&quot;}
<a id="__codelineno-57-34" name="__codelineno-57-34"></a>{&quot;id&quot;:1338,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;}
<a id="__codelineno-57-35" name="__codelineno-57-35"></a>-- Liste des produits
<a id="__codelineno-57-36" name="__codelineno-57-36"></a>{&quot;id&quot;:6367,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit00&quot;,&quot;idCategorie&quot;:1337,&quot;prix&quot;:100.0,&quot;description&quot;:&quot;desc00&quot;}
<a id="__codelineno-57-37" name="__codelineno-57-37"></a>{&quot;id&quot;:6368,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit01&quot;,&quot;idCategorie&quot;:1337,&quot;prix&quot;:101.0,&quot;description&quot;:&quot;desc01&quot;}
<a id="__codelineno-57-38" name="__codelineno-57-38"></a>{&quot;id&quot;:6369,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit02&quot;,&quot;idCategorie&quot;:1337,&quot;prix&quot;:102.0,&quot;description&quot;:&quot;desc02&quot;}
<a id="__codelineno-57-39" name="__codelineno-57-39"></a>{&quot;id&quot;:6370,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit03&quot;,&quot;idCategorie&quot;:1337,&quot;prix&quot;:103.0,&quot;description&quot;:&quot;desc03&quot;}
<a id="__codelineno-57-40" name="__codelineno-57-40"></a>{&quot;id&quot;:6371,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit04&quot;,&quot;idCategorie&quot;:1337,&quot;prix&quot;:104.0,&quot;description&quot;:&quot;desc04&quot;}
<a id="__codelineno-57-41" name="__codelineno-57-41"></a>{&quot;id&quot;:6372,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit10&quot;,&quot;idCategorie&quot;:1338,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;desc10&quot;}
<a id="__codelineno-57-42" name="__codelineno-57-42"></a>{&quot;id&quot;:6373,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit11&quot;,&quot;idCategorie&quot;:1338,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;desc11&quot;}
<a id="__codelineno-57-43" name="__codelineno-57-43"></a>{&quot;id&quot;:6374,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit12&quot;,&quot;idCategorie&quot;:1338,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;desc12&quot;}
<a id="__codelineno-57-44" name="__codelineno-57-44"></a>{&quot;id&quot;:6375,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit13&quot;,&quot;idCategorie&quot;:1338,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;desc13&quot;}
<a id="__codelineno-57-45" name="__codelineno-57-45"></a>{&quot;id&quot;:6376,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:1338,&quot;prix&quot;:114.0,&quot;description&quot;:&quot;desc14&quot;}
<a id="__codelineno-57-46" name="__codelineno-57-46"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-47" name="__codelineno-57-47"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-48" name="__codelineno-57-48"></a>getCategorieByIdWithProduits --------------------------------
<a id="__codelineno-57-49" name="__codelineno-57-49"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-57-50" name="__codelineno-57-50"></a>Remplissage de la base --------------------------------
<a id="__codelineno-57-51" name="__codelineno-57-51"></a>Ajout d&#39;une catégorie [cat1] avec deux produits de même nom --------------------------------
<a id="__codelineno-57-52" name="__codelineno-57-52"></a>Les erreurs suivantes se sont produites : 
<a id="__codelineno-57-53" name="__codelineno-57-53"></a>- org.hibernate.exception.ConstraintViolationException: could not execute statement
<a id="__codelineno-57-54" name="__codelineno-57-54"></a>- could not execute statement
<a id="__codelineno-57-55" name="__codelineno-57-55"></a>- Duplicate entry &#39;x&#39; for key &#39;NOM&#39;
<a id="__codelineno-57-56" name="__codelineno-57-56"></a>11:24:37.650 [Thread-1] INFO  o.s.c.a.AnnotationConfigApplicationContext - Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@f8c1ddd: startup date [Fri Nov 20 11:24:34 CET 2015]; root of context hierarchy
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "navigation.expand", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>