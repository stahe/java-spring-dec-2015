
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/java-spring-dec-2015/programmation-asynchrone-avec-rxjava.html">
      
      
        <link rel="prev" href="td-elections-avec-des-requetes-inter-domaines.html">
      
      
        <link rel="next" href="conclusion.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>20. Programmation asynchrone avec RxJava - Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#20-programmation-asynchrone-avec-rxjava" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-header__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              20. Programmation asynchrone avec RxJava
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-nav__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-le-probleme.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. [TD] : Le problème
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-classes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. [TD] : Classes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-architectures-en-couches.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. [TD] : Architectures en couches
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-au-framework-spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. [Cours] : Introduction au framework Spring
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-a-lx27api-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. [Cours] : Introduction à l&#x27;API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-lx27api-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. [TD] : Implémentation de la couche [DAO] du TD avec l&#x27;API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. [TD] : La couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-un-programme-console.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. [TD] : Implémentation de la couche [ui] avec un programme console
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-une-interface-swing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. [TD] : Implémentation de la couche [ui] avec une interface Swing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. [Cours] : Gestion des bases de données relationnelles avec Spring Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. [TD] : Implémentation de la couche [DAO] du TD avec [Spring Data]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. [Cours] : Exposer une base de données sur le web avec Spring MVC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-exposition-sur-le-web-de-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. [TD] : Exposition sur le web de la couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-creation-dx27un-client-pour-le-service-web.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. [TD] : création d&#x27;un client pour le service web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-securiser-lx27acces-a-un-service-web-avec-spring-security.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. [Cours] : Sécuriser l&#x27;accès à un service web avec Spring Security
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-securisation-du-serveur-web--json-des-elections.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. [TD] : sécurisation du serveur web / jSON des élections
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-acces-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. [Cours] : Gestion des accès inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-elections-avec-des-requetes-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. [TD] Elections avec des requêtes inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    20. Programmation asynchrone avec RxJava
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="programmation-asynchrone-avec-rxjava.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Programmation asynchrone avec RxJava
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#201-etape-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1. étape 1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="20.1. étape 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2011-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.1. Création
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2012-configuration-maven" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.2. Configuration Maven
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2013-implementation-asynchrone-de-la-couche-metier" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.3. Implémentation asynchrone de la couche [métier]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2014-les-tests-junit-de-la-couche-metier" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.4. Les tests JUnit de la couche [métier]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="20.1.4. Les tests JUnit de la couche [métier]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#20141-test01" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.4.1. Test01
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20142-test02" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.4.2. Test02
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20143-test03" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1.4.3. Test03
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#202-etape-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2. étape 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#203-etape-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3. étape 3
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="20.3. étape 3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2031-configuration-maven" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3.1. Configuration Maven
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2032-la-classe-electionsconnectform" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3.2. La classe [ElectionsConnectForm]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2033-la-classe-electionsmainform" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3.3. La classe [ElectionsMainForm]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="20.3.3. La classe [ElectionsMainForm]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#20331-initialisation-de-linterface-graphique" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3.3.1. Initialisation de l&#x27;interface graphique
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20332-calcul-des-sieges-obtenus-par-les-differentes-listes" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3.3.2. Calcul des sièges obtenus par les différentes listes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20333-enregistrement-des-resultats-de-lelection" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3.3.3. Enregistrement des résultats de l&#x27;élection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="annexes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="20-programmation-asynchrone-avec-rxjava">20. Programmation asynchrone avec RxJava</h1>
<p><strong>Document à lire</strong> : [<a href="http://tahe.developpez.com/tutoriels-cours/rxjava-rxswing-rxandroid/documents/rxjava.pdf"><u>Introduction à RxJava. Application aux environnements Swing et Android</u></a>.]</p>
<p>Dans ce chapitre, nous revenons sur le chapitre 17.6, page 343 où nous avions construit une application client / serveur avec l&#x27;architecture suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004C7000002EECD229798.png" style="display:inline-block; margin:4px;width:16.18cm;height:9.922cm;" /></td></tr></table>

<p>Certaines actions de l&#x27;utilisateur sur l&#x27;interface Swing en [1] déclenchent des actions jusque dans la base de données en [3] au-travers d&#x27;un réseau HTTP [2]. A cause de celui-ci, la réponse à l&#x27;action de l&#x27;utilisateur peut être plus ou moins longue à venir. Ce serait bien de pouvoir mettre un indicateur d&#x27;attente sur l&#x27;interface utilisateur avec une option d&#x27;annulation de l&#x27;opération lancée si celle-ci venait à être trop longue. Dans le chapitre 17.6, page 343, chaque action de l&#x27;utilisateur nécessitant d&#x27;échanger des informations avec le serveur est synchrone. Le gestionnaire d&#x27;événement exécuté par le code n&#x27;est terminé que lorsque la réponse est reçue. Pendant tout ce temps, l&#x27;interface graphique est gelée : elle ne répond pas aux nouvelles actions de l&#x27;utilisateur. Celles-ci sont simplement mises en file d&#x27;attente pour être traitées lorsque le gestionnaire d&#x27;événement qui s&#x27;exécute actuellement soit terminé. Ainsi, si on faisait apparaître un bouton d&#x27;annulation, l&#x27;utilisateur pourrait cliquer dessus mais il ne se passerait rien tant que l&#x27;opération en cours ne serait pas terminée. Le bouton d&#x27;annulation n&#x27;aurait alors aucun intérêt.</p>
<p>Pour que le clic sur le bouton d&#x27;annulation soit suivi d&#x27;effet, il faut que l&#x27;opération en cours soit terminée. Pour cela, elle doit lancer l&#x27;opération potentiellement longue de façon asynchrone : </p>
<ul>
<li>le gestionnaire d&#x27;événement lance l&#x27;opération longue mais n&#x27;attend pas son résultat et rend la main au thread de l&#x27;UI qui gère les événements de l&#x27;interface graphique. L&#x27;opération longue est lancée sur un thread différent de celui de l&#x27;UI ce qui ne bloque pas ce dernier ;</li>
<li>si l&#x27;utilisateur clique sur le bouton d&#x27;annulation avant la fin de l&#x27;opération longue, le thread de l&#x27;UI qui est inoccupé peut traiter cet événement. On peut alors abandonner l&#x27;opération longue en ignorant son résultat ;</li>
<li>si l&#x27;opération longue n&#x27;a pas été annulée, l&#x27;arrivée de la réponse va provoquer un événement dans le thread de l&#x27;UI. Celui-ci, s&#x27;il est inoccupé, va alors exécuter le code lié à cet événement qui va exploiter la réponse ;
L&#x27;interface utilisateur va fonctionner comme précédemment. Si les temps de réponse du serveur sont rapides, l&#x27;utilisateur ne verra pas la différence. S&#x27;ils sont perceptibles, l&#x27;utilisateur verra un bouton d&#x27;annulation apparaître et aura la possibilté d&#x27;interrompre l&#x27;opération en cours.</li>
</ul>
<p>La bibliothèque [<a href="http://reactivex.io/"><u>Rx</u></a>] permet de faire de la programmation asynchrone. Son grand intérêt réside dans le fait qu&#x27;elle a été portée dans de nombreux environnements (Java, .NET, JS, ...) et que sa maîtrise dans un environnement peut être transposée facilement dans un autre environnement. Nous allons nous appuyer ici sur le chapitre 2 du document [<a href="http://tahe.developpez.com/tutoriels-cours/rxjava-rxswing-rxandroid/documents/rxjava.pdf"><u>Introduction à RxJava. Application aux </u></a><a href="http://tahe.developpez.com/tutoriels-cours/rxjava-rxswing-rxandroid/documents/rxjava.pdf"><u>environnements Swing et Android</u></a>]. Le lecteur est invité à le lire. Dans la suite, nous reprenons du code issu des exemples de ce chapitre.</p>
<p>Nous allons faire évoluer l&#x27;architecture de l&#x27;application de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003BD000001460AF459F1.png" style="display:inline-block; margin:4px;width:12.661cm;height:4.313cm;" /></td></tr></table>

<ul>
<li>
<p>en [1], nous intercalons une couche [RxJava] entre la couche [swing] et la couche [métier]. Les méthodes de celle-ci vont désormais être appelées de façon asynchrone ;
Nous allons procéder en plusieurs étapes :</p>
</li>
<li>
<p><strong>étape 1</strong> : la couche [metier, DAO] présente pour l&#x27;instant une interface synchrone à la couche [ui]. Nous allons la transformer en une couche asynchrone [RxJava, metier, DAO] ;</p>
</li>
<li><strong>étape 2</strong> : nous porterons l&#x27;application console synchrone en une application toujours synchrone mais utilisant l&#x27;interface asynchrone [RxJava, metier, DAO] ;</li>
<li><strong>étape 3</strong> : nous porterons l&#x27;application swing synchrone en une application swing asynchrone ;</li>
</ul>
<h2 id="201-etape-1">20.1. étape 1</h2>
<p>Nous transformons la couche synchrone actuelle [metier, DAO] en une couche asynchrone [RxJava, metier, DAO].</p>
<h3 id="2011-creation">20.1.1. Création</h3>
<p>Nous partons du projet Maven du chapitre 17.4, page 333 que nous ouvrons avec <strong>Netbeans</strong> :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F0000000C583EDA9B3.png" style="display:inline-block; margin:4px;width:4.45cm;height:3.649cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001310000010375A45E24.png" style="display:inline-block; margin:4px;width:5.65cm;height:4.8cm;" /></td></tr></table>

<p>Nous dupliquons ce projet [1] (copy / paste) dans un nouveau projet [elections-rxjava-metier-dao-security-webjson] [2].</p>
<h3 id="2012-configuration-maven">20.1.2. Configuration Maven</h3>
<p>Nous faisons évoluer le fichier [pom.xml] du nouveau projet pour ajouter la dépendance sur la bibliothèque [RxJava] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="o">&lt;</span><span class="n">project</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">         </span><span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">modelVersion</span><span class="o">&gt;</span><span class="mf">4.0.0</span><span class="o">&lt;/</span><span class="n">modelVersion</span><span class="o">&gt;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">istia</span><span class="p">.</span><span class="na">st</span><span class="p">.</span><span class="na">elections</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">elections</span><span class="o">-</span><span class="n">metier</span><span class="o">-</span><span class="n">dao</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">rxjava</span><span class="o">-</span><span class="n">webjson</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">0.0.1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span><span class="n">Client</span><span class="w"> </span><span class="n">jUnit</span><span class="w"> </span><span class="n">du</span><span class="w"> </span><span class="n">serveur</span><span class="w"> </span><span class="n">web</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">jSON</span><span class="o">&lt;/</span><span class="n">description</span><span class="o">&gt;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">elections</span><span class="o">-</span><span class="n">metier</span><span class="o">-</span><span class="n">dao</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">rxjava</span><span class="o">-</span><span class="n">webjson</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">properties</span><span class="o">&gt;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">project</span><span class="p">.</span><span class="na">build</span><span class="p">.</span><span class="na">sourceEncoding</span><span class="o">&gt;</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="o">&lt;/</span><span class="n">project</span><span class="p">.</span><span class="na">build</span><span class="p">.</span><span class="na">sourceEncoding</span><span class="o">&gt;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">java</span><span class="p">.</span><span class="na">version</span><span class="o">&gt;</span><span class="mf">1.8</span><span class="o">&lt;/</span><span class="n">java</span><span class="p">.</span><span class="na">version</span><span class="o">&gt;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">  </span><span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">parent</span><span class="o">&gt;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">parent</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.2.7</span><span class="p">.</span><span class="na">RELEASE</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">  </span><span class="o">&lt;/</span><span class="n">parent</span><span class="o">&gt;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">dependencies</span><span class="o">&gt;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">web</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">librairie</span><span class="w"> </span><span class="n">jSON</span><span class="w"> </span><span class="n">utilisée</span><span class="w"> </span><span class="n">par</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">com</span><span class="p">.</span><span class="na">fasterxml</span><span class="p">.</span><span class="na">jackson</span><span class="p">.</span><span class="na">core</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">jackson</span><span class="o">-</span><span class="n">core</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">com</span><span class="p">.</span><span class="na">fasterxml</span><span class="p">.</span><span class="na">jackson</span><span class="p">.</span><span class="na">core</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">jackson</span><span class="o">-</span><span class="n">databind</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">composant</span><span class="w"> </span><span class="n">utilisé</span><span class="w"> </span><span class="n">par</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">httpcomponents</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">httpclient</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">Google</span><span class="w"> </span><span class="n">Guava</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">com</span><span class="p">.</span><span class="na">google</span><span class="p">.</span><span class="na">guava</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">guava</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">16.0.1</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">bibliothèque</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">logging</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">Spring</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//mvnrepository.com/artifact/io.reactivex/rxjava --&gt;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">io</span><span class="p">.</span><span class="na">reactivex</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">rxjava</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.2.0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">  </span><span class="o">&lt;/</span><span class="n">dependencies</span><span class="o">&gt;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">build</span><span class="o">&gt;</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">plugins</span><span class="o">&gt;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">plugin</span><span class="o">&gt;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="p">.</span><span class="na">apache</span><span class="p">.</span><span class="na">maven</span><span class="p">.</span><span class="na">plugins</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">maven</span><span class="o">-</span><span class="n">surefire</span><span class="o">-</span><span class="n">plugin</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">        </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">2.18.1</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">      </span><span class="o">&lt;/</span><span class="n">plugin</span><span class="o">&gt;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">plugins</span><span class="o">&gt;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="w">  </span><span class="o">&lt;/</span><span class="n">build</span><span class="o">&gt;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="o">&lt;/</span><span class="n">project</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 65-70 : nous avons ajouté la dépendance sur la bibliothèque RxJava ;</li>
</ul>
<h3 id="2013-implementation-asynchrone-de-la-couche-metier">20.1.3. Implémentation asynchrone de la couche [métier]</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003CD00000135B33CC21A.png" style="display:inline-block; margin:4px;width:12.873cm;height:4.089cm;" /></td></tr></table>

<p>Pour implémenter la couche [RxJava, métier], nous ajoutons une interface asynchrone [IRxElectionsMetier] [1] et son implémentation [RxElectionsMetier] [2] au projet :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001240000011A86638049.png" style="display:inline-block; margin:4px;width:5.41cm;height:5.219cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>L&#x27;interface [IRxElectionsMetier] est l&#x27;interface asynchrone de la couche [RxJava, métier]. Son code est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.metier</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.ListeElectorale</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.User</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.Observable</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">IRxElectionsMetier</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">  </span><span class="c1">// authentification</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">  </span><span class="c1">// obtenir les listes en compétition</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">  </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">getListesElectorales</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">  </span><span class="c1">// le nombre de sièges à pourvoir</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">  </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getNbSiegesAPourvoir</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">  </span><span class="c1">// le seuil électoral</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">  </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getSeuilElectoral</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">  </span><span class="c1">// l&#39;enregistrement des résultats</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">  </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">recordResultats</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">);</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">  </span><span class="c1">// le calcul des sièges</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">  </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">calculerSieges</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">);</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>L&#x27;interface [IRxElectionsMetier] reprend les méthodes de l&#x27;interface [IElectionsMetier] mais là où une méthode M de l&#x27;interface [IElectionsMetier] rendait un résultat de type <strong>T</strong>, la méthode M de l&#x27;interface [IRxElectionsMetier] rend un résultat de type <strong>Observable</strong>&lt;<strong>T</strong>&gt;. Le type [Observable] est fourni par la bibliothèque RxJava. Un type Observable&lt;T&gt; fournit la méthode [subscribe] qui va obtenir le type T de façon asynchrone. Sont associés à cette méthode trois événements :</p>
<ul>
<li><strong>onSuccess</strong>(T result) qui avertit qu&#x27;un résultat de type T est disponible. L&#x27;opération asynchrone peut fournir plusieurs résultats ;</li>
<li><strong>onError</strong>(Throwable th) qui avertit que l&#x27;opération asynchrone a rencontré une erreur ;</li>
<li><strong>onCompleted</strong>() qui avertit que l&#x27;opération asynchrone est terminée ;
Tant que la méthode [Observable.subscribe] n&#x27;est pas appelée, l&#x27;opération asynchrone liée à l&#x27;observable n&#x27;est pas lancée. Le code qui appelle une méthode M de l&#x27;interface [IRxElectionsMetier] n&#x27;obtient pas le résultat T attendu, mais un type Observable&lt;T&gt; qui lui permettra ultérieurement d&#x27;obtenir le résultat T en appelant la méthode [Observable.subscribe].</li>
</ul>
<p>L&#x27;implémentation [RxElectionsMetier] de l&#x27;interface [IRxElectionsMetier] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span>
<span class="normal"><a href="#__codelineno-2-47">47</a></span>
<span class="normal"><a href="#__codelineno-2-48">48</a></span>
<span class="normal"><a href="#__codelineno-2-49">49</a></span>
<span class="normal"><a href="#__codelineno-2-50">50</a></span>
<span class="normal"><a href="#__codelineno-2-51">51</a></span>
<span class="normal"><a href="#__codelineno-2-52">52</a></span>
<span class="normal"><a href="#__codelineno-2-53">53</a></span>
<span class="normal"><a href="#__codelineno-2-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.metier</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.ListeElectorale</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.User</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.Observable</span><span class="p">;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="nd">@Component</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RxElectionsMetier</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IRxElectionsMetier</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">IElectionsMetier</span><span class="w"> </span><span class="n">metier</span><span class="p">;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">getListesElectorales</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">        </span><span class="c1">// appel méthode synchrone puis réponse au souscripteur</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">metier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">user</span><span class="p">));</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getNbSiegesAPourvoir</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getSeuilElectoral</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">recordResultats</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">calculerSieges</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 12-13 : injection Spring de la couche métier <strong>synchrone</strong> ;</li>
<li>lignes 20-34 : nous allons commenter la méthode [getListesElectorales] qui au lieu de rendre un type [ListeElectorale[]] rend un type [Observable&lt;ListeElectorale[]&gt;] ;</li>
<li>lignes 22-32 : la méthode statique [Observable.create] permet de créer un Observable à partir d&#x27;un type [<strong>Subscriber</strong>]. Le type [Subscriber] représente un abonné aux flux de résultats produits par le processus observé (l&#x27;Observable). Il fournit trois méthodes :</li>
<li>[Subscriber.<strong>onNext</strong>] (ligne 25) pour recevoir un résultat du processus observé ;</li>
<li>[Subscriber.<strong>onError</strong>] (ligne 30) pour recevoir une exception du processus observé. Après une exception, le type [Observable] n&#x27;émet plus de résultats ;</li>
<li>[Subscriber.<strong>onCompleted</strong>] (ligne 27) pour recevoir le signal de fin d&#x27;émission du processus observé. Ici, le processus observé n&#x27;émet qu&#x27;un élément. On remarquera ici que ce signal n&#x27;est pas émis s&#x27;il se produit une exception. C&#x27;est le comportement par défaut des Observables : l&#x27;émission d&#x27;une exception signale également la fin des émissions. Les souscripteurs le savent ;</li>
<li>lignes 22-34 : la méthode [Observable.create] admet pour paramètre un type [Observable.OnSubscribe]. Ce type est une <strong>interface fonctionnelle</strong>. Cette notion a été introduite avec Java 8 et désigne une interface ayant une unique méthode. Ici, la méthode unique de l&#x27;interface [Observable.OnSubscribe] est la suivante :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">T</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="n">Subscriber</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subscriber</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Pour implémenter une interface fonctionnelle de méthode unique <strong>m(param1, param2, ..., paramn)</strong>, on peut utiliser la syntaxe simplifiée suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">(</span><span class="n">param1</span><span class="p">,</span><span class="w"> </span><span class="n">param2</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">paramn</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="n">méthode</span><span class="w"> </span><span class="n">m</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>C&#x27;est ce qui est fait aux lignes 22-34 :</p>
<ul>
<li>[subscriber] est le paramètre de la méthode [Observable.OnSubscribe.<strong>call</strong>] ;</li>
<li>lignes 23-32 : le code qu&#x27;on veut donner à la méthode [call] ;</li>
<li>ligne 25 : on demande les listes électorales de façon synchrone à la couche [métier] injectée en ligne 13. Il va donc y avoir attente du résultat. Lorsque celui-ci va être reçu, il est passé à la méthode [onNext] du souscripteur ;</li>
<li>ligne 28 : en cas d&#x27;erreur, l&#x27;exception est passée à la méthode [onError] du souscripteur ;</li>
<li>ligne 31 : on n&#x27;attend qu&#x27;un résultat. Lorsque celui-ci a été obtenu (les listes électorales ou une exception), on indique au souscripteur que le processus observé a terminé d&#x27;émettre des résultats ;
On se rappellera bien que la méthode [RxElectionsMetier] rend un type Observable&lt;ListeElectorale[]&gt; et non le type ListeElectorale[] lui-même. Il faudra que le code appelant appelle la méthode Observable&lt;ListeElectorale[]&gt;.<strong>subscribe</strong> pour que le code des lignes 23-33 soit exécuté et rende les listes électorales au moyen de la ligne 25.</li>
</ul>
<p>Le code des autres méthodes est analogue :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">  1</a></span>
<span class="normal"><a href="#__codelineno-5-2">  2</a></span>
<span class="normal"><a href="#__codelineno-5-3">  3</a></span>
<span class="normal"><a href="#__codelineno-5-4">  4</a></span>
<span class="normal"><a href="#__codelineno-5-5">  5</a></span>
<span class="normal"><a href="#__codelineno-5-6">  6</a></span>
<span class="normal"><a href="#__codelineno-5-7">  7</a></span>
<span class="normal"><a href="#__codelineno-5-8">  8</a></span>
<span class="normal"><a href="#__codelineno-5-9">  9</a></span>
<span class="normal"><a href="#__codelineno-5-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-5-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-5-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-5-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-5-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-5-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-5-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-5-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-5-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-5-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-5-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-5-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-5-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-5-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-5-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-5-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-5-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-5-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-5-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-5-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-5-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-5-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-5-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-5-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-5-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-5-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-5-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-5-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-5-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-5-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-5-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-5-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-5-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-5-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-5-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-5-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-5-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-5-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-5-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-5-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-5-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-5-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-5-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-5-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-5-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-5-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-5-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-5-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-5-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-5-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-5-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-5-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-5-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-5-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-5-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-5-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-5-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-5-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-5-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-5-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-5-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-5-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-5-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-5-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-5-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-5-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-5-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-5-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-5-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-5-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-5-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-5-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-5-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-5-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-5-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-5-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-5-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-5-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-5-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-5-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-5-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-5-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-5-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-5-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-5-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-5-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-5-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-5-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-5-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-5-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-5-100">100</a></span>
<span class="normal"><a href="#__codelineno-5-101">101</a></span>
<span class="normal"><a href="#__codelineno-5-102">102</a></span>
<span class="normal"><a href="#__codelineno-5-103">103</a></span>
<span class="normal"><a href="#__codelineno-5-104">104</a></span>
<span class="normal"><a href="#__codelineno-5-105">105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.metier</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.ListeElectorale</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.User</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.Observable</span><span class="p">;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="nd">@Component</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RxElectionsMetier</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IRxElectionsMetier</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">IElectionsMetier</span><span class="w"> </span><span class="n">metier</span><span class="p">;</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">        </span><span class="c1">// appel méthode synchrone</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">        </span><span class="n">metier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">getListesElectorales</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="w">        </span><span class="c1">// appel méthode synchrone puis réponse au souscripteur</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">metier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">user</span><span class="p">));</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getNbSiegesAPourvoir</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="w">        </span><span class="c1">// appel méthode synchrone puis réponse au souscripteur</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">metier</span><span class="p">.</span><span class="na">getNbSiegesAPourvoir</span><span class="p">(</span><span class="n">user</span><span class="p">));</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getSeuilElectoral</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-64" name="__codelineno-5-64"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-65" name="__codelineno-5-65"></a><span class="w">        </span><span class="c1">// appel méthode synchrone puis réponse au souscripteur</span>
<a id="__codelineno-5-66" name="__codelineno-5-66"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">metier</span><span class="p">.</span><span class="na">getSeuilElectoral</span><span class="p">(</span><span class="n">user</span><span class="p">));</span>
<a id="__codelineno-5-67" name="__codelineno-5-67"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-5-68" name="__codelineno-5-68"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-5-69" name="__codelineno-5-69"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-70" name="__codelineno-5-70"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-5-71" name="__codelineno-5-71"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-5-72" name="__codelineno-5-72"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-73" name="__codelineno-5-73"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-74" name="__codelineno-5-74"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-75" name="__codelineno-5-75"></a>
<a id="__codelineno-5-76" name="__codelineno-5-76"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-5-77" name="__codelineno-5-77"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">recordResultats</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-78" name="__codelineno-5-78"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-79" name="__codelineno-5-79"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-80" name="__codelineno-5-80"></a><span class="w">        </span><span class="c1">// appel méthode synchrone</span>
<a id="__codelineno-5-81" name="__codelineno-5-81"></a><span class="w">        </span><span class="n">metier</span><span class="p">.</span><span class="na">recordResultats</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">);</span>
<a id="__codelineno-5-82" name="__codelineno-5-82"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-5-83" name="__codelineno-5-83"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-5-84" name="__codelineno-5-84"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-85" name="__codelineno-5-85"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-5-86" name="__codelineno-5-86"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-5-87" name="__codelineno-5-87"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-88" name="__codelineno-5-88"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-89" name="__codelineno-5-89"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-90" name="__codelineno-5-90"></a>
<a id="__codelineno-5-91" name="__codelineno-5-91"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-5-92" name="__codelineno-5-92"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">calculerSieges</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-93" name="__codelineno-5-93"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Observable</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">subscriber</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-94" name="__codelineno-5-94"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-95" name="__codelineno-5-95"></a><span class="w">        </span><span class="c1">// appel méthode synchrone puis réponse au souscripteur</span>
<a id="__codelineno-5-96" name="__codelineno-5-96"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">metier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">));</span>
<a id="__codelineno-5-97" name="__codelineno-5-97"></a><span class="w">        </span><span class="c1">// on signale la fin de l&#39;observable</span>
<a id="__codelineno-5-98" name="__codelineno-5-98"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<a id="__codelineno-5-99" name="__codelineno-5-99"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-100" name="__codelineno-5-100"></a><span class="w">        </span><span class="c1">// on fait suivre l&#39;exception</span>
<a id="__codelineno-5-101" name="__codelineno-5-101"></a><span class="w">        </span><span class="n">subscriber</span><span class="p">.</span><span class="na">onError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-5-102" name="__codelineno-5-102"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-5-103" name="__codelineno-5-103"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-5-104" name="__codelineno-5-104"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-105" name="__codelineno-5-105"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 20 et 81 : la méthode [onNext] du souscripteur n&#x27;est pas appelée parce que celui-ci n&#x27;attend pas de résultats ;</li>
</ul>
<h3 id="2014-les-tests-junit-de-la-couche-metier">20.1.4. Les tests JUnit de la couche [métier]</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000012000000113B05A3BCF.png" style="display:inline-block; margin:4px;width:5.33cm;height:5.091cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h4 id="20141-test01">20.1.4.1. Test01</h4>
<p>Nous reprenons le test unitaire [Test01] étudié au paragraphe 17.4.4, page 337. Il a été prévu pour faire des appels synchrones à l&#x27;interface [IElectionsMetier]. Nous le modifions pour qu&#x27;il fasse des appels synchrones à la nouvelle interface [IRxElectionsMetier]. Il est en effet possible de faire des appels synchrones à une interface asynchrone RxJava. Le code devient le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">  1</a></span>
<span class="normal"><a href="#__codelineno-6-2">  2</a></span>
<span class="normal"><a href="#__codelineno-6-3">  3</a></span>
<span class="normal"><a href="#__codelineno-6-4">  4</a></span>
<span class="normal"><a href="#__codelineno-6-5">  5</a></span>
<span class="normal"><a href="#__codelineno-6-6">  6</a></span>
<span class="normal"><a href="#__codelineno-6-7">  7</a></span>
<span class="normal"><a href="#__codelineno-6-8">  8</a></span>
<span class="normal"><a href="#__codelineno-6-9">  9</a></span>
<span class="normal"><a href="#__codelineno-6-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-6-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-6-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-6-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-6-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-6-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-6-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-6-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-6-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-6-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-6-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-6-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-6-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-6-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-6-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-6-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-6-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-6-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-6-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-6-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-6-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-6-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-6-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-6-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-6-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-6-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-6-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-6-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-6-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-6-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-6-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-6-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-6-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-6-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-6-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-6-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-6-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-6-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-6-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-6-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-6-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-6-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-6-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-6-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-6-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-6-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-6-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-6-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-6-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-6-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-6-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-6-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-6-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-6-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-6-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-6-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-6-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-6-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-6-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-6-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-6-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-6-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-6-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-6-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-6-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-6-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-6-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-6-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-6-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-6-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-6-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-6-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-6-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-6-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-6-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-6-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-6-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-6-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-6-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-6-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-6-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-6-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-6-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-6-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-6-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-6-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-6-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-6-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-6-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-6-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-6-100">100</a></span>
<span class="normal"><a href="#__codelineno-6-101">101</a></span>
<span class="normal"><a href="#__codelineno-6-102">102</a></span>
<span class="normal"><a href="#__codelineno-6-103">103</a></span>
<span class="normal"><a href="#__codelineno-6-104">104</a></span>
<span class="normal"><a href="#__codelineno-6-105">105</a></span>
<span class="normal"><a href="#__codelineno-6-106">106</a></span>
<span class="normal"><a href="#__codelineno-6-107">107</a></span>
<span class="normal"><a href="#__codelineno-6-108">108</a></span>
<span class="normal"><a href="#__codelineno-6-109">109</a></span>
<span class="normal"><a href="#__codelineno-6-110">110</a></span>
<span class="normal"><a href="#__codelineno-6-111">111</a></span>
<span class="normal"><a href="#__codelineno-6-112">112</a></span>
<span class="normal"><a href="#__codelineno-6-113">113</a></span>
<span class="normal"><a href="#__codelineno-6-114">114</a></span>
<span class="normal"><a href="#__codelineno-6-115">115</a></span>
<span class="normal"><a href="#__codelineno-6-116">116</a></span>
<span class="normal"><a href="#__codelineno-6-117">117</a></span>
<span class="normal"><a href="#__codelineno-6-118">118</a></span>
<span class="normal"><a href="#__codelineno-6-119">119</a></span>
<span class="normal"><a href="#__codelineno-6-120">120</a></span>
<span class="normal"><a href="#__codelineno-6-121">121</a></span>
<span class="normal"><a href="#__codelineno-6-122">122</a></span>
<span class="normal"><a href="#__codelineno-6-123">123</a></span>
<span class="normal"><a href="#__codelineno-6-124">124</a></span>
<span class="normal"><a href="#__codelineno-6-125">125</a></span>
<span class="normal"><a href="#__codelineno-6-126">126</a></span>
<span class="normal"><a href="#__codelineno-6-127">127</a></span>
<span class="normal"><a href="#__codelineno-6-128">128</a></span>
<span class="normal"><a href="#__codelineno-6-129">129</a></span>
<span class="normal"><a href="#__codelineno-6-130">130</a></span>
<span class="normal"><a href="#__codelineno-6-131">131</a></span>
<span class="normal"><a href="#__codelineno-6-132">132</a></span>
<span class="normal"><a href="#__codelineno-6-133">133</a></span>
<span class="normal"><a href="#__codelineno-6-134">134</a></span>
<span class="normal"><a href="#__codelineno-6-135">135</a></span>
<span class="normal"><a href="#__codelineno-6-136">136</a></span>
<span class="normal"><a href="#__codelineno-6-137">137</a></span>
<span class="normal"><a href="#__codelineno-6-138">138</a></span>
<span class="normal"><a href="#__codelineno-6-139">139</a></span>
<span class="normal"><a href="#__codelineno-6-140">140</a></span>
<span class="normal"><a href="#__codelineno-6-141">141</a></span>
<span class="normal"><a href="#__codelineno-6-142">142</a></span>
<span class="normal"><a href="#__codelineno-6-143">143</a></span>
<span class="normal"><a href="#__codelineno-6-144">144</a></span>
<span class="normal"><a href="#__codelineno-6-145">145</a></span>
<span class="normal"><a href="#__codelineno-6-146">146</a></span>
<span class="normal"><a href="#__codelineno-6-147">147</a></span>
<span class="normal"><a href="#__codelineno-6-148">148</a></span>
<span class="normal"><a href="#__codelineno-6-149">149</a></span>
<span class="normal"><a href="#__codelineno-6-150">150</a></span>
<span class="normal"><a href="#__codelineno-6-151">151</a></span>
<span class="normal"><a href="#__codelineno-6-152">152</a></span>
<span class="normal"><a href="#__codelineno-6-153">153</a></span>
<span class="normal"><a href="#__codelineno-6-154">154</a></span>
<span class="normal"><a href="#__codelineno-6-155">155</a></span>
<span class="normal"><a href="#__codelineno-6-156">156</a></span>
<span class="normal"><a href="#__codelineno-6-157">157</a></span>
<span class="normal"><a href="#__codelineno-6-158">158</a></span>
<span class="normal"><a href="#__codelineno-6-159">159</a></span>
<span class="normal"><a href="#__codelineno-6-160">160</a></span>
<span class="normal"><a href="#__codelineno-6-161">161</a></span>
<span class="normal"><a href="#__codelineno-6-162">162</a></span>
<span class="normal"><a href="#__codelineno-6-163">163</a></span>
<span class="normal"><a href="#__codelineno-6-164">164</a></span>
<span class="normal"><a href="#__codelineno-6-165">165</a></span>
<span class="normal"><a href="#__codelineno-6-166">166</a></span>
<span class="normal"><a href="#__codelineno-6-167">167</a></span>
<span class="normal"><a href="#__codelineno-6-168">168</a></span>
<span class="normal"><a href="#__codelineno-6-169">169</a></span>
<span class="normal"><a href="#__codelineno-6-170">170</a></span>
<span class="normal"><a href="#__codelineno-6-171">171</a></span>
<span class="normal"><a href="#__codelineno-6-172">172</a></span>
<span class="normal"><a href="#__codelineno-6-173">173</a></span>
<span class="normal"><a href="#__codelineno-6-174">174</a></span>
<span class="normal"><a href="#__codelineno-6-175">175</a></span>
<span class="normal"><a href="#__codelineno-6-176">176</a></span>
<span class="normal"><a href="#__codelineno-6-177">177</a></span>
<span class="normal"><a href="#__codelineno-6-178">178</a></span>
<span class="normal"><a href="#__codelineno-6-179">179</a></span>
<span class="normal"><a href="#__codelineno-6-180">180</a></span>
<span class="normal"><a href="#__codelineno-6-181">181</a></span>
<span class="normal"><a href="#__codelineno-6-182">182</a></span>
<span class="normal"><a href="#__codelineno-6-183">183</a></span>
<span class="normal"><a href="#__codelineno-6-184">184</a></span>
<span class="normal"><a href="#__codelineno-6-185">185</a></span>
<span class="normal"><a href="#__codelineno-6-186">186</a></span>
<span class="normal"><a href="#__codelineno-6-187">187</a></span>
<span class="normal"><a href="#__codelineno-6-188">188</a></span>
<span class="normal"><a href="#__codelineno-6-189">189</a></span>
<span class="normal"><a href="#__codelineno-6-190">190</a></span>
<span class="normal"><a href="#__codelineno-6-191">191</a></span>
<span class="normal"><a href="#__codelineno-6-192">192</a></span>
<span class="normal"><a href="#__codelineno-6-193">193</a></span>
<span class="normal"><a href="#__codelineno-6-194">194</a></span>
<span class="normal"><a href="#__codelineno-6-195">195</a></span>
<span class="normal"><a href="#__codelineno-6-196">196</a></span>
<span class="normal"><a href="#__codelineno-6-197">197</a></span>
<span class="normal"><a href="#__codelineno-6-198">198</a></span>
<span class="normal"><a href="#__codelineno-6-199">199</a></span>
<span class="normal"><a href="#__codelineno-6-200">200</a></span>
<span class="normal"><a href="#__codelineno-6-201">201</a></span>
<span class="normal"><a href="#__codelineno-6-202">202</a></span>
<span class="normal"><a href="#__codelineno-6-203">203</a></span>
<span class="normal"><a href="#__codelineno-6-204">204</a></span>
<span class="normal"><a href="#__codelineno-6-205">205</a></span>
<span class="normal"><a href="#__codelineno-6-206">206</a></span>
<span class="normal"><a href="#__codelineno-6-207">207</a></span>
<span class="normal"><a href="#__codelineno-6-208">208</a></span>
<span class="normal"><a href="#__codelineno-6-209">209</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.metier.junit</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Assert</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.BeforeClass</span><span class="p">;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.SpringApplicationConfiguration</span><span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.config.MetierConfig</span><span class="p">;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.ElectionsException</span><span class="p">;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.ListeElectorale</span><span class="p">;</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.User</span><span class="p">;</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.metier.IRxElectionsMetier</span><span class="p">;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.observables.BlockingObservable</span><span class="p">;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="nd">@SpringApplicationConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MetierConfig</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test01</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">  </span><span class="c1">// couche [electionsMetier]</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">IRxElectionsMetier</span><span class="w"> </span><span class="n">electionsMetier</span><span class="p">;</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">  </span><span class="c1">// mappeur jSON</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">  </span><span class="c1">// utilisateurs</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">admin</span><span class="p">;</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">unknown</span><span class="p">;</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">  </span><span class="nd">@BeforeClass</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initTest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="w">    </span><span class="n">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="p">);</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">);</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="w">    </span><span class="n">unknown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">);</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="w">  </span><span class="nd">@Test</span><span class="p">()</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkUserUser</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="w">    </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="w">      </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">)).</span><span class="na">firstOrDefault</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="w">      </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">se</span><span class="p">);</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;403 Forbidden&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="p">.</span><span class="na">getErreurs</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="w">  </span><span class="nd">@Test</span><span class="p">()</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkUserUnknown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="w">    </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="w">      </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">unknown</span><span class="p">)).</span><span class="na">firstOrDefault</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a><span class="w">      </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">se</span><span class="p">);</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;401 Unauthorized&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="p">.</span><span class="na">getErreurs</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a>
<a id="__codelineno-6-68" name="__codelineno-6-68"></a><span class="w">  </span><span class="nd">@Test</span><span class="p">()</span>
<a id="__codelineno-6-69" name="__codelineno-6-69"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkUserAdmin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="w">    </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-6-71" name="__codelineno-6-71"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-72" name="__codelineno-6-72"></a><span class="w">      </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">admin</span><span class="p">)).</span><span class="na">firstOrDefault</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-73" name="__codelineno-6-73"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-74" name="__codelineno-6-74"></a><span class="w">      </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<a id="__codelineno-6-75" name="__codelineno-6-75"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-76" name="__codelineno-6-76"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNull</span><span class="p">(</span><span class="n">se</span><span class="p">);</span>
<a id="__codelineno-6-77" name="__codelineno-6-77"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-78" name="__codelineno-6-78"></a>
<a id="__codelineno-6-79" name="__codelineno-6-79"></a><span class="w">  </span><span class="cm">/**</span>
<a id="__codelineno-6-80" name="__codelineno-6-80"></a><span class="cm">   * vérification 1 : méthode de calcul des sièges on fixe en dur les listes</span>
<a id="__codelineno-6-81" name="__codelineno-6-81"></a><span class="cm">   */</span>
<a id="__codelineno-6-82" name="__codelineno-6-82"></a><span class="w">  </span><span class="nd">@Test</span>
<a id="__codelineno-6-83" name="__codelineno-6-83"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculSieges1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-84" name="__codelineno-6-84"></a><span class="w">    </span><span class="c1">// on crée le tableau des 7 listes candidates</span>
<a id="__codelineno-6-85" name="__codelineno-6-85"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[</span><span class="mi">7</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-6-86" name="__codelineno-6-86"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">32000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-87" name="__codelineno-6-87"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-88" name="__codelineno-6-88"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-89" name="__codelineno-6-89"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-90" name="__codelineno-6-90"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-91" name="__codelineno-6-91"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;F&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-92" name="__codelineno-6-92"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;G&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-93" name="__codelineno-6-93"></a><span class="w">    </span><span class="c1">// on calcule les sièges de chacune des listes</span>
<a id="__codelineno-6-94" name="__codelineno-6-94"></a><span class="w">    </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-95" name="__codelineno-6-95"></a><span class="w">    </span><span class="c1">// on vérifie les résultats</span>
<a id="__codelineno-6-96" name="__codelineno-6-96"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-97" name="__codelineno-6-97"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-98" name="__codelineno-6-98"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-99" name="__codelineno-6-99"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-100" name="__codelineno-6-100"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-101" name="__codelineno-6-101"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-102" name="__codelineno-6-102"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-103" name="__codelineno-6-103"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-104" name="__codelineno-6-104"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-105" name="__codelineno-6-105"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-106" name="__codelineno-6-106"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-107" name="__codelineno-6-107"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-108" name="__codelineno-6-108"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-109" name="__codelineno-6-109"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-110" name="__codelineno-6-110"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-111" name="__codelineno-6-111"></a>
<a id="__codelineno-6-112" name="__codelineno-6-112"></a><span class="w">  </span><span class="cm">/**</span>
<a id="__codelineno-6-113" name="__codelineno-6-113"></a><span class="cm">   * vérification 2 : méthode de calcul des sièges on demande les listes à la couche [metier] puis on fixe en dur les</span>
<a id="__codelineno-6-114" name="__codelineno-6-114"></a><span class="cm">   * voix</span>
<a id="__codelineno-6-115" name="__codelineno-6-115"></a><span class="cm">   */</span>
<a id="__codelineno-6-116" name="__codelineno-6-116"></a><span class="w">  </span><span class="nd">@Test</span>
<a id="__codelineno-6-117" name="__codelineno-6-117"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculSieges2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-118" name="__codelineno-6-118"></a><span class="w">    </span><span class="c1">// on crée le tableau des 7 listes candidates</span>
<a id="__codelineno-6-119" name="__codelineno-6-119"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">admin</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-120" name="__codelineno-6-120"></a><span class="w">    </span><span class="c1">// on fixe en dur les voix</span>
<a id="__codelineno-6-121" name="__codelineno-6-121"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">32000</span><span class="p">);</span>
<a id="__codelineno-6-122" name="__codelineno-6-122"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">25000</span><span class="p">);</span>
<a id="__codelineno-6-123" name="__codelineno-6-123"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">16000</span><span class="p">);</span>
<a id="__codelineno-6-124" name="__codelineno-6-124"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">12000</span><span class="p">);</span>
<a id="__codelineno-6-125" name="__codelineno-6-125"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
<a id="__codelineno-6-126" name="__codelineno-6-126"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">4500</span><span class="p">);</span>
<a id="__codelineno-6-127" name="__codelineno-6-127"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">2500</span><span class="p">);</span>
<a id="__codelineno-6-128" name="__codelineno-6-128"></a><span class="w">    </span><span class="c1">// on calcule les sièges obtenus par chacune des listes</span>
<a id="__codelineno-6-129" name="__codelineno-6-129"></a><span class="w">    </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-130" name="__codelineno-6-130"></a><span class="w">    </span><span class="c1">// on vérifie les résultats</span>
<a id="__codelineno-6-131" name="__codelineno-6-131"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-132" name="__codelineno-6-132"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-133" name="__codelineno-6-133"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-134" name="__codelineno-6-134"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-135" name="__codelineno-6-135"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-136" name="__codelineno-6-136"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-137" name="__codelineno-6-137"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-138" name="__codelineno-6-138"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-139" name="__codelineno-6-139"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-140" name="__codelineno-6-140"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-141" name="__codelineno-6-141"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-142" name="__codelineno-6-142"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-143" name="__codelineno-6-143"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-144" name="__codelineno-6-144"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-145" name="__codelineno-6-145"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-146" name="__codelineno-6-146"></a>
<a id="__codelineno-6-147" name="__codelineno-6-147"></a><span class="w">  </span><span class="cm">/**</span>
<a id="__codelineno-6-148" name="__codelineno-6-148"></a><span class="cm">   * vérification 3 méthode de calcul des sièges on provoque une exception</span>
<a id="__codelineno-6-149" name="__codelineno-6-149"></a><span class="cm">   */</span>
<a id="__codelineno-6-150" name="__codelineno-6-150"></a><span class="w">  </span><span class="nd">@Test</span><span class="p">(</span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ElectionsException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-6-151" name="__codelineno-6-151"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculSieges3</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-152" name="__codelineno-6-152"></a><span class="w">    </span><span class="c1">// on crée un tableau de 24 listes candidates avec chacune 1 voix</span>
<a id="__codelineno-6-153" name="__codelineno-6-153"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[</span><span class="mi">25</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-6-154" name="__codelineno-6-154"></a><span class="w">    </span><span class="c1">// les 25 listes auront le même nombre de voix (4%)</span>
<a id="__codelineno-6-155" name="__codelineno-6-155"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">listes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-156" name="__codelineno-6-156"></a><span class="w">      </span><span class="n">listes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;Liste&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-6-157" name="__codelineno-6-157"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-158" name="__codelineno-6-158"></a><span class="w">    </span><span class="c1">// calcul des sièges - normalement on doit avoir une ElectionsException</span>
<a id="__codelineno-6-159" name="__codelineno-6-159"></a><span class="w">    </span><span class="c1">// avec un seuil èlectoral de 5%</span>
<a id="__codelineno-6-160" name="__codelineno-6-160"></a><span class="w">    </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-161" name="__codelineno-6-161"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-162" name="__codelineno-6-162"></a>
<a id="__codelineno-6-163" name="__codelineno-6-163"></a><span class="w">  </span><span class="cm">/**</span>
<a id="__codelineno-6-164" name="__codelineno-6-164"></a><span class="cm">   * enregistrement des résultats de l&#39;élection</span>
<a id="__codelineno-6-165" name="__codelineno-6-165"></a><span class="cm">   *</span>
<a id="__codelineno-6-166" name="__codelineno-6-166"></a><span class="cm">   * @throws JsonProcessingException</span>
<a id="__codelineno-6-167" name="__codelineno-6-167"></a><span class="cm">   */</span>
<a id="__codelineno-6-168" name="__codelineno-6-168"></a><span class="w">  </span><span class="nd">@Test</span>
<a id="__codelineno-6-169" name="__codelineno-6-169"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ecritureResultatsElections</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-170" name="__codelineno-6-170"></a><span class="w">    </span><span class="c1">// on crée le tableau des 7 listes candidates</span>
<a id="__codelineno-6-171" name="__codelineno-6-171"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">admin</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-172" name="__codelineno-6-172"></a><span class="w">    </span><span class="c1">// on fixe en dur les voix</span>
<a id="__codelineno-6-173" name="__codelineno-6-173"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">32000</span><span class="p">);</span>
<a id="__codelineno-6-174" name="__codelineno-6-174"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">25000</span><span class="p">);</span>
<a id="__codelineno-6-175" name="__codelineno-6-175"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">16000</span><span class="p">);</span>
<a id="__codelineno-6-176" name="__codelineno-6-176"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">12000</span><span class="p">);</span>
<a id="__codelineno-6-177" name="__codelineno-6-177"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
<a id="__codelineno-6-178" name="__codelineno-6-178"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">4500</span><span class="p">);</span>
<a id="__codelineno-6-179" name="__codelineno-6-179"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">setVoix</span><span class="p">(</span><span class="mi">2500</span><span class="p">);</span>
<a id="__codelineno-6-180" name="__codelineno-6-180"></a><span class="w">    </span><span class="c1">// on calcule les sièges obtenus par chacune des listes</span>
<a id="__codelineno-6-181" name="__codelineno-6-181"></a><span class="w">    </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-182" name="__codelineno-6-182"></a><span class="w">    </span><span class="c1">// on affiche les résultats</span>
<a id="__codelineno-6-183" name="__codelineno-6-183"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">listes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-184" name="__codelineno-6-184"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
<a id="__codelineno-6-185" name="__codelineno-6-185"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-186" name="__codelineno-6-186"></a><span class="w">    </span><span class="c1">// on enregistre les résultats dans la base de données</span>
<a id="__codelineno-6-187" name="__codelineno-6-187"></a><span class="w">    </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">recordResultats</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)).</span><span class="na">firstOrDefault</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<a id="__codelineno-6-188" name="__codelineno-6-188"></a><span class="w">    </span><span class="c1">// on vérifie les résultats</span>
<a id="__codelineno-6-189" name="__codelineno-6-189"></a><span class="w">    </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">admin</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-6-190" name="__codelineno-6-190"></a><span class="w">    </span><span class="c1">// on affiche les résultats</span>
<a id="__codelineno-6-191" name="__codelineno-6-191"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">listes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-192" name="__codelineno-6-192"></a><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">mapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
<a id="__codelineno-6-193" name="__codelineno-6-193"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-194" name="__codelineno-6-194"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-195" name="__codelineno-6-195"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-196" name="__codelineno-6-196"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-197" name="__codelineno-6-197"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-198" name="__codelineno-6-198"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-199" name="__codelineno-6-199"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-200" name="__codelineno-6-200"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-201" name="__codelineno-6-201"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-202" name="__codelineno-6-202"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-203" name="__codelineno-6-203"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-204" name="__codelineno-6-204"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-205" name="__codelineno-6-205"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-206" name="__codelineno-6-206"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-6-207" name="__codelineno-6-207"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-6-208" name="__codelineno-6-208"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-209" name="__codelineno-6-209"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Etudions les modifications :</p>
<ul>
<li>ligne 48 : la méthode statique [BlockingObservable.from(Observable).first] :</li>
<li>s&#x27;abonne à l&#x27;observable paramètre de [from] ;</li>
<li>lance l&#x27;exécution du code associé à l&#x27;observable ;</li>
<li>attend de recevoir le 1er résultat. C&#x27;est donc une opération synchrone ;
Nous utilisons ici la méthode [firstOrDefault(null)] parce que l&#x27;observable [metier.authenticate] ne rend pas de résultat lorsqu&#x27;il est exécuté. Le résultat de la méthode [firstOrDefault(null)] sera donc null, valeur inexploitée ici ;</li>
</ul>
<p>Nous reprenons ce schéma dans le reste du code à chaque fois que nous voulons faire appel à la couche [métier].</p>
<p>Le test unitaire [Test01] doit passer :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001D2000000F6CBC27211.png" style="display:inline-block; margin:4px;width:8.513cm;height:4.493cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p><strong>Travail à faire</strong> : vérifier que le test [Test01] passe.</p>
<h4 id="20142-test02">20.1.4.2. Test02</h4>
<p>Nous transformons le test [Test01] afin de tester désormais l&#x27;interface asynchrone [IRxElectionsMetier] en faisant des appels asynchrones à ses méthodes.</p>
<p>Etudions un premier test :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="w">  </span><span class="c1">// sémaphore de synchronisation de threads</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="w"> </span><span class="n">latch</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span><span class="c1">// -----------------------------------</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">checkUserUserException</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">  </span><span class="nd">@Test</span><span class="p">()</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkUserUser</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="c1">// sémaphore à 1</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="n">latch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="p">((</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="c1">// opération asynchrone</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">())</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">((</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">            </span><span class="p">},</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">                      </span><span class="n">checkUserUserException</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="p">)</span><span class="w"> </span><span class="n">th</span><span class="p">;</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">                      </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">                      </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">    </span><span class="c1">// attente sémaphore</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">    </span><span class="n">latch</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">    </span><span class="c1">// vérification résultats</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">checkUserUserException</span><span class="p">);</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;403 Forbidden&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">checkUserUserException</span><span class="p">.</span><span class="na">getErreurs</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : un sémaphore est un outil utilisé pour synchroniser des threads entre eux. Des threads sont des flux d&#x27;exécution s&#x27;exécutant en parallèle. Pour exécuter une tâche T1, le thread [Thread1] peut avoir besoin qu&#x27;une tâche T2 exécutée par un thread [Thread2] soit terminée. Il attend alors que le thread [Thread2] lui envoie un signal indiquant que la tâche T2 est terminée. Il y a diverses façons de gérer cette synchronisation entre deux threads. La méthode utilisée ici est la suivante ;</li>
<li>ligne 10 : le thread [Thread1] crée un sémaphore avec la valeur 1 ;</li>
<li>ligne 12 : le thread [Thread1] crée et lance un thread [Thread2]. Ceci est obtenu par la syntaxe :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">())</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>La méthode [Observable.subscribeOn] fixe le thread sur lequel s&#x27;exécutera le processus observé. Le paramètre de [subscribeOn] est un pool de threads. La bibliothèque RxJava en fournit plusieurs adaptés à différentes situations. Le pool [Schedulers.io()] est celui qui est conseillé pour les opérations réseau ;</p>
<ul>
<li>lignes 12-13 : l&#x27;opération 
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">subscribe</span><span class="p">(...)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>exécute l&#x27;opération synchrone encapsulée dans l&#x27;observable [authenticate(user)]. Mais parce que cette opération synchrone est lancée sur un autre thread que le thread [Thread1], ce dernier n&#x27;attend pas la réponse de la méthode [subscribe] et passe à l&#x27;instruction suivante ;</p>
<ul>
<li>ligne 23 : le thread [Thread1] s&#x27;arrête et attend que le sémaphore passe à 0 (il est à 1 pour l&#x27;instant) ;</li>
<li>lignes 13-21 : la méthode [subscribe] admet comme paramètres trois fonctions lambda :</li>
<li>la première [<strong>(result)-&gt;{...}</strong>] est appelée à chaque fois que l&#x27;observable [authenticate(user)] émet un résultat [result]. Ici nous avons un observable [authenticate(user)] qui fait quelque chose mais n&#x27;émet aucun résultat. Le lambda [<strong>(result)-&gt;{}</strong>] ne sera donc jamais appelé. C&#x27;est pourquoi son code est ici vide [<strong>{}</strong>] ;</li>
<li>la seconde [<strong>(th)-&gt;{...}</strong>] reçoit comme paramètre un type [Throwable]. Elle est appelée lorsque l&#x27;exécution de l&#x27;observable rencontre une exception. Ici, nous traitons le paramètre [Throwable th] de la façon suivante :</li>
<li>ligne 16 : nous le mémorisons dans un champ de la classe de test de type [ElectionsException] car l&#x27;observable exécuté n&#x27;émet que ce type d&#x27;exception ;</li>
<li>ligne 17 : nous passons le sémaphore à 0 pour indiquer que le thread [Thread2] a terminé son travail ;</li>
<li>la troisième [<strong>()-&gt;{...}</strong>] est appelée lorsque l&#x27;observable n&#x27;a plus d&#x27;éléments à émettre. Nous traitons cet événement de la façon suivante :</li>
<li>
<p>ligne 20 : nous passons le sémaphore à 0 pour indiquer que le thread [Thread2] a terminé son travail ;
Il faut noter que le troisième lambda n&#x27;est pas appelé si une exception se produit. C&#x27;est pourquoi, on a été obligé de mettre le sémaphore à 0 également ligne 17 ;</p>
</li>
<li>
<p>ligne 25 : lorsqu&#x27;on arrive à cette ligne, l&#x27;observable a terminé son travail. On peut alors faire les mêmes vérifications que dans le test [Test01] ;
Examinons un autre test :</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span>
<span class="normal"><a href="#__codelineno-10-39">39</a></span>
<span class="normal"><a href="#__codelineno-10-40">40</a></span>
<span class="normal"><a href="#__codelineno-10-41">41</a></span>
<span class="normal"><a href="#__codelineno-10-42">42</a></span>
<span class="normal"><a href="#__codelineno-10-43">43</a></span>
<span class="normal"><a href="#__codelineno-10-44">44</a></span>
<span class="normal"><a href="#__codelineno-10-45">45</a></span>
<span class="normal"><a href="#__codelineno-10-46">46</a></span>
<span class="normal"><a href="#__codelineno-10-47">47</a></span>
<span class="normal"><a href="#__codelineno-10-48">48</a></span>
<span class="normal"><a href="#__codelineno-10-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1">// -----------------------------------</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">calculSieges1Exception</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="nd">@Test</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculSieges1</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="c1">// on crée le tableau des 7 listes candidates</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[</span><span class="mi">7</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">32000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;F&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;G&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="c1">// sémaphore à 1</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">    </span><span class="n">latch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="p">((</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">    </span><span class="c1">// opération asynchrone    </span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">    </span><span class="c1">// on calcule les sièges de chacune des listes</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="w">    </span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">())</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">((</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w">              </span><span class="n">listesCalculSieges1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">            </span><span class="p">},</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">                      </span><span class="n">calculSieges1Exception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="p">)</span><span class="w"> </span><span class="n">th</span><span class="p">;</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">                      </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="w">                      </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="w">    </span><span class="c1">// attente sémaphore</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="w">    </span><span class="n">latch</span><span class="p">.</span><span class="na">await</span><span class="p">();</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="w">    </span><span class="c1">// on vérifie les résultats</span>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNull</span><span class="p">(</span><span class="n">calculSieges1Exception</span><span class="p">);</span>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-44" name="__codelineno-10-44"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-10-48" name="__codelineno-10-48"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-10-49" name="__codelineno-10-49"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 20-30 : exécution asynchrone de l&#x27;observable [electionsMetier.calculerSieges(admin, listes)] ;</li>
<li>lignes 21-23 : l&#x27;exécution de l&#x27;observable rend un type [ListeElectorale[]] qu&#x27;on mémorise dans un champ de la classe de test, ligne 3 ;</li>
<li>lignes 34-48 : ces vérifications sont celles du test [Test01] auxquelles on a ajouté la vérification de la ligne 34 qui s&#x27;assure qu&#x27;il n&#x27;y a pas eu d&#x27;exception ;
L&#x27;ensemble du test [Test02] est disponible dans le support de cours.</li>
</ul>
<p><strong>Travail à faire</strong> : passer le test [Test02] et vérifier qu&#x27;il passe.</p>
<h4 id="20143-test03">20.1.4.3. Test03</h4>
<p>Le test [Test03] fait la même chose que le test [Test01] : il teste l&#x27;interface [IRxElectionsMetier] par des appels synchrones à cette interface. C&#x27;est une copie du test [Test02] à deux détails près :</p>
<ul>
<li>les observables ne sont plus exécutés dans un thread différent de celui qui exécute les tests. Lorsque le thread [Thread1] exécute la méthode [subscribe] d&#x27;un observable, celle-ci démarre une opération HTTP vers le serveur également sur le thread [Thread1]. Toute la méthode [subscribe] devient alors synchrone ;</li>
<li>puisqu&#x27;il n&#x27;y a plus qu&#x27;un thread, la synchronisation de threads devient inutile et le sémaphore disparaît ;
Voici deux exemples de tests :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="w">  </span><span class="c1">// -----------------------------------</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">checkUserUserException</span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span><span class="nd">@Test</span><span class="p">()</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkUserUser</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="c1">// opération synchrone</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">    </span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">((</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">            </span><span class="p">},</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">                      </span><span class="n">checkUserUserException</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="p">)</span><span class="w"> </span><span class="n">th</span><span class="p">;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">    </span><span class="c1">// vérification résultats</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">checkUserUserException</span><span class="p">);</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;403 Forbidden&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">checkUserUserException</span><span class="p">.</span><span class="na">getErreurs</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 7 : par défaut, la méthode [electionsMetier.authenticate(user).subscribe] s&#x27;exécute dans le thread du code appelant. On a donc une opération synchrone ;
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="w">  </span><span class="c1">// -----------------------------------</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ElectionsException</span><span class="w"> </span><span class="n">calculSieges1Exception</span><span class="p">;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span><span class="nd">@Test</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">calculSieges1</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="c1">// on crée le tableau des 7 listes candidates</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[</span><span class="mi">7</span><span class="o">]</span><span class="p">;</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">32000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;F&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4500</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">    </span><span class="n">listes</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="p">(</span><span class="s">&quot;G&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">    </span><span class="c1">// opération synchrone    </span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">    </span><span class="c1">// on calcule les sièges de chacune des listes</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">    </span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">((</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">              </span><span class="n">listesCalculSieges1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">            </span><span class="p">},</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="w">                      </span><span class="n">calculSieges1Exception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ElectionsException</span><span class="p">)</span><span class="w"> </span><span class="n">th</span><span class="p">;</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="w">    </span><span class="c1">// on vérifie les résultats</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNull</span><span class="p">(</span><span class="n">calculSieges1Exception</span><span class="p">);</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">getSieges</span><span class="p">());</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">    </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">listesCalculSieges1</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">.</span><span class="na">isElimine</span><span class="p">());</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p><strong>Travail à faire</strong> : passer le test [Test03] et vérifier qu&#x27;il passe.</p>
<h2 id="202-etape-2">20.2. étape 2</h2>
<p>Nous portons maintenant l&#x27;application console synchrone du chapitre 17.5, page 339, en une application toujours synchrone mais utilisant l&#x27;interface asynchrone [RxJava, metier, DAO] ;</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003F2000001322CEEF8B8.png" style="display:inline-block; margin:4px;width:13.361cm;height:4.048cm;" /></td></tr></table>

<p>Nous partons du projet [elections-console-metier-dao-security-webjson] [1] du chapitre 17.5, page 339 que nous dupliquons dans un nouveau projet [elections-console-<strong>rxjava- </strong>metier-dao-security-webjson] [2] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001420000010BCAA9096A.png" style="display:inline-block; margin:4px;width:5.96cm;height:4.941cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000016B00000135D181CE2C.png" style="display:inline-block; margin:4px;width:6.72cm;height:5.72cm;" /></td></tr></table>

<ul>
<li>en [3-4], dans le nouveau projet on supprime la dépendance sur l&#x27;ancienne couche [métier] synchrone ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000147000000E6F3A24D18.png" style="display:inline-block; margin:4px;width:6.05cm;height:4.26cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002490000011E3D72526F.png" style="display:inline-block; margin:4px;width:10.83cm;height:5.3cm;" /></td></tr></table>

<ul>
<li>en [5-9], on ajoute une dépendance sur la nouvelle couche [métier] asynchrone ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000021100000244E2DEC2B7.png" style="display:inline-block; margin:4px;width:8.641cm;height:9.474cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000012D00000117BD12F800.png" style="display:inline-block; margin:4px;width:5.57cm;height:5.159cm;" /></td></tr></table>

<ul>
<li>en [10-14], on renomme la classe [ElectionsConsole] en [ElectionsConsole01] ;
De même, on renomme la classe [BootElectionsConsole] en [BootElectionsConsole01] :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000100000000B8D59AAE49.png" style="display:inline-block; margin:4px;width:4.74cm;height:3.41cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le code actuel de la classe [BootElectionsConsole01] est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.boot</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.console.IElectionsUI</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BootElectionsConsole01</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBootElections</span><span class="p">{</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">BootElectionsConsole01</span><span class="p">().</span><span class="na">run</span><span class="p">();</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">IElectionsUI</span><span class="w"> </span><span class="nf">getUI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;electionsConsole&quot;</span><span class="p">,</span><span class="n">IElectionsUI</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : parce qu&#x27;on a changé le nom de la classe [ElectionsConsole] en [ElectionsConsole01], il faut désormais écrire :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;electionsConsole01&quot;</span><span class="p">,</span><span class="n">IElectionsUI</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Revenons au code de la classe [ElectionsConsole01] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nd">@Component</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ElectionsConsole01</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IElectionsUI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">IElectionsMetier</span><span class="w"> </span><span class="n">electionsMetier</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">admin</span><span class="p">;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">        </span><span class="c1">// les listes en compétition</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">        </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="p">;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">        </span><span class="c1">// saisie des données</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Scanner</span><span class="w"> </span><span class="n">clavier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">         </span><span class="c1">// on demande les listes en compétition à la couche [metier]</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">         </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">admin</span><span class="p">);</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">        </span><span class="c1">// on fait le calcul des sièges</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">        </span><span class="n">listes</span><span class="o">=</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="n">listes</span><span class="p">);</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">        </span><span class="c1">// on enregistre les résultats</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">        </span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">recordResultats</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="n">listes</span><span class="p">);</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Si on suit l&#x27;exemple du test [Test01] du paragraphe 20.1.4.1, page 391, les lignes 5, 17, 20 et 22 vont évoluer de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nd">@Component</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ElectionsConsole01</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IElectionsUI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">IRxElectionsMetier</span><span class="w"> </span><span class="n">electionsMetier</span><span class="p">;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">admin</span><span class="p">;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="c1">// les listes en compétition</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">    </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="p">;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">    </span><span class="c1">// saisie des données</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Scanner</span><span class="w"> </span><span class="n">clavier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Scanner</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">      </span><span class="c1">// on demande les listes en compétition à la couche [metier]</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">      </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">admin</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">      </span><span class="p">...</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">    </span><span class="c1">// on fait le calcul des sièges</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">    </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">)).</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">    </span><span class="c1">// on enregistre les résultats</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="w">    </span><span class="n">BlockingObservable</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">electionsMetier</span><span class="p">.</span><span class="na">recordResultats</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="p">));</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="w">  </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Travail à faire</strong> : configurez le projet pour exécuter la classe [BootElectionsConsole01] avec les trois paramètres [SS, Heures travaillées, Jours travaillés] et vérifiez que l&#x27;exécution du projet ainsi configuré donne les résultats attendus.</p>
<p><strong>Travail à faire</strong> : configurez le projet pour exécuter le couple [BootElectionsConsole02, ElectionsConsole02] où la classe [ElectionsConsole02] aura été écrite en suivant le modèle du test [Test02] du paragraphe 20.1.4.2, page 394.</p>
<p><strong>Travail à faire</strong> : configurez le projet pour exécuter le couple [BootElectionsConsole03, ElectionsConsole03] où la classe [ElectionsConsole03] aura été écrite en suivant le modèle du test [Test03] du paragraphe 20.1.4.3, page 395.</p>
<h2 id="203-etape-3">20.3. étape 3</h2>
<p>Nous passons maintenant au portage de l&#x27;application swing dans un environnement asynchrone.</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003CA00000133793411BE.png" style="display:inline-block; margin:4px;width:12.832cm;height:4.062cm;" /></td></tr></table>

<p>Nous commençons par dupliquer le projet [elections-swing-metier-dao-security-webjson] [1] du chapitre 17.6, page 343, dans un nouveau projet [elections-swing-rxjava-metier-dao-security-webjson] [2] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000146000000ACC12B8135.png" style="display:inline-block; margin:4px;width:6.04cm;height:3.191cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000191000001222CDE9ABE.png" style="display:inline-block; margin:4px;width:7.421cm;height:5.369cm;" /></td></tr></table>

<ul>
<li>en [3, 4], nous supprimons la dépendance sur la couche [console] synchrone ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000106000000BDF7A58C21.png" style="display:inline-block; margin:4px;width:4.851cm;height:3.5cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002410000014F8DEACC02.png" style="display:inline-block; margin:4px;width:10.68cm;height:6.2cm;" /></td></tr></table>

<ul>
<li>
<p>en [5-9], nous ajoutons une dépendance sur la couche console asynchrone ;
La couche [swing] va faire de vrais appels asynchrones à la couche [métier]. Lors de l&#x27;appel à une méthode de celle-ci, il y aura deux threads :</p>
</li>
<li>
<p>le thread de l&#x27;UI, celui qui gère les événements ;</p>
</li>
<li>un thread d&#x27;E/S qui exécutera l&#x27;appel HTTP au serveur ;
Pendant toute la durée de l&#x27;appel asynchrone, nous devrions afficher une image d&#x27;attente ainsi qu&#x27;un bouton d&#x27;annulation. Nous ne le ferons pas ici et cela vous sera proposé comme amélioration de l&#x27;application. Les modifications ont lieu dans les deux classes qui font des appels à la couche [métier] :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000012C000000C88953966C.png" style="display:inline-block; margin:4px;width:5.549cm;height:3.701cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h3 id="2031-configuration-maven">20.3.1. Configuration Maven</h3>
<p>Nous allons utiliser ici la bibliothèque [RxSwing] qui ajoute à la bibliothèque [RxJava] des fonctionnalités disponibles seulement dans un environnement Swing. Pour cela, nous modifions le fichier [pom.xml] de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span>
<span class="normal"><a href="#__codelineno-17-31">31</a></span>
<span class="normal"><a href="#__codelineno-17-32">32</a></span>
<span class="normal"><a href="#__codelineno-17-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="o">&lt;</span><span class="n">project</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">         </span><span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">modelVersion</span><span class="o">&gt;</span><span class="mf">4.0.0</span><span class="o">&lt;/</span><span class="n">modelVersion</span><span class="o">&gt;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">istia</span><span class="p">.</span><span class="na">st</span><span class="p">.</span><span class="na">elections</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">elections</span><span class="o">-</span><span class="n">swing</span><span class="o">-</span><span class="n">rxjava</span><span class="o">-</span><span class="n">metier</span><span class="o">-</span><span class="n">dao</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">webjson</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">0.0.1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">elections</span><span class="o">-</span><span class="n">swing</span><span class="o">-</span><span class="n">rxjava</span><span class="o">-</span><span class="n">metier</span><span class="o">-</span><span class="n">dao</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">webjson</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span><span class="n">couche</span><span class="w"> </span><span class="n">swing</span><span class="w"> </span><span class="n">asynchrone</span><span class="w"> </span><span class="n">du</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">web</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">jSON</span><span class="o">&lt;/</span><span class="n">description</span><span class="o">&gt;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">properties</span><span class="o">&gt;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">project</span><span class="p">.</span><span class="na">build</span><span class="p">.</span><span class="na">sourceEncoding</span><span class="o">&gt;</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="o">&lt;/</span><span class="n">project</span><span class="p">.</span><span class="na">build</span><span class="p">.</span><span class="na">sourceEncoding</span><span class="o">&gt;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">java</span><span class="p">.</span><span class="na">version</span><span class="o">&gt;</span><span class="mf">1.8</span><span class="o">&lt;/</span><span class="n">java</span><span class="p">.</span><span class="na">version</span><span class="o">&gt;</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">maven</span><span class="p">.</span><span class="na">compiler</span><span class="p">.</span><span class="na">source</span><span class="o">&gt;</span><span class="mf">1.8</span><span class="o">&lt;/</span><span class="n">maven</span><span class="p">.</span><span class="na">compiler</span><span class="p">.</span><span class="na">source</span><span class="o">&gt;</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">maven</span><span class="p">.</span><span class="na">compiler</span><span class="p">.</span><span class="na">target</span><span class="o">&gt;</span><span class="mf">1.8</span><span class="o">&lt;/</span><span class="n">maven</span><span class="p">.</span><span class="na">compiler</span><span class="p">.</span><span class="na">target</span><span class="o">&gt;</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">  </span><span class="o">&lt;/</span><span class="n">properties</span><span class="o">&gt;</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">  </span><span class="o">&lt;</span><span class="n">dependencies</span><span class="o">&gt;</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">RxSwing</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="c1">//mvnrepository.com/artifact/io.reactivex/rxswing --&gt;</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">io</span><span class="p">.</span><span class="na">reactivex</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">rxswing</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">0.27.0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="w">    </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">couches</span><span class="w"> </span><span class="n">basses</span><span class="w"> </span><span class="o">--&gt;</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">istia</span><span class="p">.</span><span class="na">st</span><span class="p">.</span><span class="na">elections</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">elections</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">rxjava</span><span class="o">-</span><span class="n">metier</span><span class="o">-</span><span class="n">dao</span><span class="o">-</span><span class="n">security</span><span class="o">-</span><span class="n">webjson</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a><span class="w">      </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">0.0.1</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a><span class="w">    </span><span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a><span class="w">  </span><span class="o">&lt;/</span><span class="n">dependencies</span><span class="o">&gt;</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a><span class="o">&lt;/</span><span class="n">project</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<h3 id="2032-la-classe-electionsconnectform">20.3.2. La classe [ElectionsConnectForm]</h3>
<p>Dans un fonctionnement asynchrone, la classe [ElectionsConnectForm] devient la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span>
<span class="normal"><a href="#__codelineno-18-48">48</a></span>
<span class="normal"><a href="#__codelineno-18-49">49</a></span>
<span class="normal"><a href="#__codelineno-18-50">50</a></span>
<span class="normal"><a href="#__codelineno-18-51">51</a></span>
<span class="normal"><a href="#__codelineno-18-52">52</a></span>
<span class="normal"><a href="#__codelineno-18-53">53</a></span>
<span class="normal"><a href="#__codelineno-18-54">54</a></span>
<span class="normal"><a href="#__codelineno-18-55">55</a></span>
<span class="normal"><a href="#__codelineno-18-56">56</a></span>
<span class="normal"><a href="#__codelineno-18-57">57</a></span>
<span class="normal"><a href="#__codelineno-18-58">58</a></span>
<span class="normal"><a href="#__codelineno-18-59">59</a></span>
<span class="normal"><a href="#__codelineno-18-60">60</a></span>
<span class="normal"><a href="#__codelineno-18-61">61</a></span>
<span class="normal"><a href="#__codelineno-18-62">62</a></span>
<span class="normal"><a href="#__codelineno-18-63">63</a></span>
<span class="normal"><a href="#__codelineno-18-64">64</a></span>
<span class="normal"><a href="#__codelineno-18-65">65</a></span>
<span class="normal"><a href="#__codelineno-18-66">66</a></span>
<span class="normal"><a href="#__codelineno-18-67">67</a></span>
<span class="normal"><a href="#__codelineno-18-68">68</a></span>
<span class="normal"><a href="#__codelineno-18-69">69</a></span>
<span class="normal"><a href="#__codelineno-18-70">70</a></span>
<span class="normal"><a href="#__codelineno-18-71">71</a></span>
<span class="normal"><a href="#__codelineno-18-72">72</a></span>
<span class="normal"><a href="#__codelineno-18-73">73</a></span>
<span class="normal"><a href="#__codelineno-18-74">74</a></span>
<span class="normal"><a href="#__codelineno-18-75">75</a></span>
<span class="normal"><a href="#__codelineno-18-76">76</a></span>
<span class="normal"><a href="#__codelineno-18-77">77</a></span>
<span class="normal"><a href="#__codelineno-18-78">78</a></span>
<span class="normal"><a href="#__codelineno-18-79">79</a></span>
<span class="normal"><a href="#__codelineno-18-80">80</a></span>
<span class="normal"><a href="#__codelineno-18-81">81</a></span>
<span class="normal"><a href="#__codelineno-18-82">82</a></span>
<span class="normal"><a href="#__codelineno-18-83">83</a></span>
<span class="normal"><a href="#__codelineno-18-84">84</a></span>
<span class="normal"><a href="#__codelineno-18-85">85</a></span>
<span class="normal"><a href="#__codelineno-18-86">86</a></span>
<span class="normal"><a href="#__codelineno-18-87">87</a></span>
<span class="normal"><a href="#__codelineno-18-88">88</a></span>
<span class="normal"><a href="#__codelineno-18-89">89</a></span>
<span class="normal"><a href="#__codelineno-18-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.swing</span><span class="p">;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.console.IElectionsUI</span><span class="p">;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.User</span><span class="p">;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Dimension</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Toolkit</span><span class="p">;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.SwingUtilities</span><span class="p">;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.metier.IRxElectionsMetier</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.schedulers.Schedulers</span><span class="p">;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.schedulers.SwingScheduler</span><span class="p">;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="nd">@Component</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ElectionsConnectForm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractElectionsConnectForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IElectionsUI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">  </span><span class="c1">// référence sur la couche [métier] asynchrone</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">IRxElectionsMetier</span><span class="w"> </span><span class="n">metier</span><span class="p">;</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="w">  </span><span class="c1">// utilisateur connecté</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="w">  </span><span class="c1">// formulaire principal</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ElectionsMainForm</span><span class="w"> </span><span class="n">electionsMainForm</span><span class="p">;</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a><span class="w">  </span><span class="c1">// session UI</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">UiSession</span><span class="w"> </span><span class="n">uiSession</span><span class="p">;</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doConnect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isPageValid</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a><span class="w">      </span><span class="c1">// authentification de l&#39;utilisateur</span>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a><span class="w">      </span><span class="n">metier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">()).</span><span class="na">subscribe</span><span class="p">(</span>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a><span class="w">        </span><span class="c1">// il n&#39;y a pas de réponse</span>
<a id="__codelineno-18-42" name="__codelineno-18-42"></a><span class="w">        </span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-43" name="__codelineno-18-43"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-18-44" name="__codelineno-18-44"></a><span class="w">        </span><span class="c1">// gestion de l&#39;exception</span>
<a id="__codelineno-18-45" name="__codelineno-18-45"></a><span class="w">        </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-46" name="__codelineno-18-46"></a><span class="w">          </span><span class="c1">// on note l&#39;erreur</span>
<a id="__codelineno-18-47" name="__codelineno-18-47"></a><span class="w">          </span><span class="n">String</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getInfoForException</span><span class="p">(</span><span class="s">&quot;Les erreurs suivantes se sont produites :&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">th</span><span class="p">);</span>
<a id="__codelineno-18-48" name="__codelineno-18-48"></a><span class="w">          </span><span class="c1">// on affiche l&#39;info</span>
<a id="__codelineno-18-49" name="__codelineno-18-49"></a><span class="w">          </span><span class="n">jTextPaneErreurs</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">info</span><span class="p">);</span>
<a id="__codelineno-18-50" name="__codelineno-18-50"></a><span class="w">          </span><span class="n">jTextPaneErreurs</span><span class="p">.</span><span class="na">setCaretPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-18-51" name="__codelineno-18-51"></a>
<a id="__codelineno-18-52" name="__codelineno-18-52"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-18-53" name="__codelineno-18-53"></a><span class="w">        </span><span class="c1">// l&#39;authentification est terminée</span>
<a id="__codelineno-18-54" name="__codelineno-18-54"></a><span class="w">        </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-55" name="__codelineno-18-55"></a><span class="w">          </span><span class="c1">// on mémorise l&#39;utilisateur dans la session</span>
<a id="__codelineno-18-56" name="__codelineno-18-56"></a><span class="w">          </span><span class="n">uiSession</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<a id="__codelineno-18-57" name="__codelineno-18-57"></a><span class="w">          </span><span class="c1">// la vue de connexion est cachée</span>
<a id="__codelineno-18-58" name="__codelineno-18-58"></a><span class="w">          </span><span class="n">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-18-59" name="__codelineno-18-59"></a><span class="w">          </span><span class="c1">// la vue principale est affichée</span>
<a id="__codelineno-18-60" name="__codelineno-18-60"></a><span class="w">          </span><span class="n">electionsMainForm</span><span class="p">.</span><span class="na">run</span><span class="p">();</span>
<a id="__codelineno-18-61" name="__codelineno-18-61"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-18-62" name="__codelineno-18-62"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-63" name="__codelineno-18-63"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-64" name="__codelineno-18-64"></a>
<a id="__codelineno-18-65" name="__codelineno-18-65"></a><span class="w">  </span><span class="c1">// initialisations</span>
<a id="__codelineno-18-66" name="__codelineno-18-66"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-18-67" name="__codelineno-18-67"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-68" name="__codelineno-18-68"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-18-69" name="__codelineno-18-69"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-70" name="__codelineno-18-70"></a>
<a id="__codelineno-18-71" name="__codelineno-18-71"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-18-72" name="__codelineno-18-72"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-73" name="__codelineno-18-73"></a><span class="w">    </span><span class="c1">// on affiche l&#39;interface graphique</span>
<a id="__codelineno-18-74" name="__codelineno-18-74"></a><span class="w">    </span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-75" name="__codelineno-18-75"></a><span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-76" name="__codelineno-18-76"></a><span class="w">        </span><span class="n">init</span><span class="p">();</span>
<a id="__codelineno-18-77" name="__codelineno-18-77"></a><span class="w">        </span><span class="n">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-18-78" name="__codelineno-18-78"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-18-79" name="__codelineno-18-79"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-18-80" name="__codelineno-18-80"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-81" name="__codelineno-18-81"></a>
<a id="__codelineno-18-82" name="__codelineno-18-82"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isPageValid</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-83" name="__codelineno-18-83"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-18-84" name="__codelineno-18-84"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-85" name="__codelineno-18-85"></a>
<a id="__codelineno-18-86" name="__codelineno-18-86"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getInfoForException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-87" name="__codelineno-18-87"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-18-88" name="__codelineno-18-88"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-89" name="__codelineno-18-89"></a>
<a id="__codelineno-18-90" name="__codelineno-18-90"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 36-63 : la méthode [doConnect] est exécutée lorsque l&#x27;utilisateur appuie sur l&#x27;option de menu [Connexion] :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000016A000000EBC99E3A9A.png" style="display:inline-block; margin:4px;width:6.699cm;height:4.35cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Tout est dans la ligne 40 :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="w">      </span><span class="n">metier</span><span class="p">.</span><span class="na">authenticate</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">()).</span><span class="na">subscribe</span><span class="p">(...)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>le processus observé est [metier.authenticate(user)] ;</li>
<li>il sera exécuté sur un thread d&#x27;E/S pris dans le pool [Schedulers.io()] ;</li>
<li>
<p>il sera observé dans le thread de l&#x27;UI, celui qui gère les événements de l&#x27;interface Swing [observeOn(SwingScheduler.getInstance())]. Ce thread est obtenu par la méthode [SwingScheduler.getInstance()] où [SwingScheduler] est une classe fournie par la bibliothèque [RxSwing]. Ceci est obligatoire. A l&#x27;obtention du résultat de l&#x27;opration asynchrone, celui-ci est souvent utilisé pour modifier des éléments de l&#x27;interface Swing. Or celle-ci ne peut être modifiée que dans le thread de l&#x27;UI, sinon on a une exception. Il faut donc que les lignes 41-61 s&#x27;exécutent dans le thread de l&#x27;UI. C&#x27;est assuré ici par la méthode [observeOn(SwingScheduler.getInstance())] ;
Commentons le reste du code :</p>
</li>
<li>
<p>lignes 42-43 : ces lignes sont là pour respecter la syntaxe de la méthode [subscribe]. Elles ne seront jamais exécutées car le processus [metier.authenticate(user)] ne rend aucun résultat ;</p>
</li>
<li>lignes 35-52 : à réception d&#x27;une exception, celle-ci est affichée ;</li>
<li>lignes 54-61 : exécutées lorsque le processus [metier.authenticate(user)] signale la fin de ses émissions ;</li>
</ul>
<h3 id="2033-la-classe-electionsmainform">20.3.3. La classe [ElectionsMainForm]</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000012C000000C88953966C.png" style="display:inline-block; margin:4px;width:5.549cm;height:3.701cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h4 id="20331-initialisation-de-linterface-graphique">20.3.3.1. Initialisation de l&#x27;interface graphique</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span>
<span class="normal"><a href="#__codelineno-20-42">42</a></span>
<span class="normal"><a href="#__codelineno-20-43">43</a></span>
<span class="normal"><a href="#__codelineno-20-44">44</a></span>
<span class="normal"><a href="#__codelineno-20-45">45</a></span>
<span class="normal"><a href="#__codelineno-20-46">46</a></span>
<span class="normal"><a href="#__codelineno-20-47">47</a></span>
<span class="normal"><a href="#__codelineno-20-48">48</a></span>
<span class="normal"><a href="#__codelineno-20-49">49</a></span>
<span class="normal"><a href="#__codelineno-20-50">50</a></span>
<span class="normal"><a href="#__codelineno-20-51">51</a></span>
<span class="normal"><a href="#__codelineno-20-52">52</a></span>
<span class="normal"><a href="#__codelineno-20-53">53</a></span>
<span class="normal"><a href="#__codelineno-20-54">54</a></span>
<span class="normal"><a href="#__codelineno-20-55">55</a></span>
<span class="normal"><a href="#__codelineno-20-56">56</a></span>
<span class="normal"><a href="#__codelineno-20-57">57</a></span>
<span class="normal"><a href="#__codelineno-20-58">58</a></span>
<span class="normal"><a href="#__codelineno-20-59">59</a></span>
<span class="normal"><a href="#__codelineno-20-60">60</a></span>
<span class="normal"><a href="#__codelineno-20-61">61</a></span>
<span class="normal"><a href="#__codelineno-20-62">62</a></span>
<span class="normal"><a href="#__codelineno-20-63">63</a></span>
<span class="normal"><a href="#__codelineno-20-64">64</a></span>
<span class="normal"><a href="#__codelineno-20-65">65</a></span>
<span class="normal"><a href="#__codelineno-20-66">66</a></span>
<span class="normal"><a href="#__codelineno-20-67">67</a></span>
<span class="normal"><a href="#__codelineno-20-68">68</a></span>
<span class="normal"><a href="#__codelineno-20-69">69</a></span>
<span class="normal"><a href="#__codelineno-20-70">70</a></span>
<span class="normal"><a href="#__codelineno-20-71">71</a></span>
<span class="normal"><a href="#__codelineno-20-72">72</a></span>
<span class="normal"><a href="#__codelineno-20-73">73</a></span>
<span class="normal"><a href="#__codelineno-20-74">74</a></span>
<span class="normal"><a href="#__codelineno-20-75">75</a></span>
<span class="normal"><a href="#__codelineno-20-76">76</a></span>
<span class="normal"><a href="#__codelineno-20-77">77</a></span>
<span class="normal"><a href="#__codelineno-20-78">78</a></span>
<span class="normal"><a href="#__codelineno-20-79">79</a></span>
<span class="normal"><a href="#__codelineno-20-80">80</a></span>
<span class="normal"><a href="#__codelineno-20-81">81</a></span>
<span class="normal"><a href="#__codelineno-20-82">82</a></span>
<span class="normal"><a href="#__codelineno-20-83">83</a></span>
<span class="normal"><a href="#__codelineno-20-84">84</a></span>
<span class="normal"><a href="#__codelineno-20-85">85</a></span>
<span class="normal"><a href="#__codelineno-20-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">elections.security.client.swing</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.console.IElectionsUI</span><span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.ListeElectorale</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.entities.User</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">elections.security.client.metier.IRxElectionsMetier</span><span class="p">;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.schedulers.Schedulers</span><span class="p">;</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rx.schedulers.SwingScheduler</span><span class="p">;</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.*</span><span class="p">;</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.*</span><span class="p">;</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="nd">@Component</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ElectionsMainForm</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractElectionsMainForm</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IElectionsUI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">  </span><span class="c1">// référence sur la couche [métier] asynchrone</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">IRxElectionsMetier</span><span class="w"> </span><span class="n">metier</span><span class="p">;</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">  </span><span class="c1">// session UI</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="w">  </span><span class="nd">@Autowired</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">UiSession</span><span class="w"> </span><span class="n">uiSession</span><span class="p">;</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="w">  </span><span class="c1">// utilisateur connecté</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="w">  </span><span class="c1">// modèles des listes JList</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">DefaultListModel</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">modèleNomsVoix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">DefaultListModel</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">modèleRésultats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a><span class="w">  </span><span class="c1">// les listes en compétition</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">listes</span><span class="p">;</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a><span class="w">  </span><span class="c1">// listes saisies par l&#39;utilisateur</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ListeElectorale</span><span class="o">&gt;</span><span class="w"> </span><span class="n">listesSaisies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">tListesSaisies</span><span class="p">;</span>
<a id="__codelineno-20-43" name="__codelineno-20-43"></a>
<a id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="w">  </span><span class="c1">// initialisations</span>
<a id="__codelineno-20-45" name="__codelineno-20-45"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-20-46" name="__codelineno-20-46"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-47" name="__codelineno-20-47"></a><span class="w">    </span><span class="c1">// génération des composants par la classe parent</span>
<a id="__codelineno-20-48" name="__codelineno-20-48"></a><span class="w">    </span><span class="kd">super</span><span class="p">.</span><span class="na">init</span><span class="p">();</span>
<a id="__codelineno-20-49" name="__codelineno-20-49"></a><span class="w">    </span><span class="c1">// état formulaire</span>
<a id="__codelineno-20-50" name="__codelineno-20-50"></a><span class="w">    </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JLabel</span><span class="o">[]</span><span class="p">{</span><span class="n">jLabelAjouter</span><span class="p">,</span><span class="w"> </span><span class="n">jLabelCalculer</span><span class="p">,</span><span class="w"> </span><span class="n">jLabelEnregistrer</span><span class="p">,</span><span class="w"> </span><span class="n">jLabelSupprimer</span><span class="p">},</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-20-51" name="__codelineno-20-51"></a><span class="w">    </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span>
<a id="__codelineno-20-52" name="__codelineno-20-52"></a><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">JMenuItem</span><span class="o">[]</span><span class="p">{</span><span class="n">jMenuItemAjouter</span><span class="p">,</span><span class="w"> </span><span class="n">jMenuItemCalculer</span><span class="p">,</span><span class="w"> </span><span class="n">jMenuItemEnregistrer</span><span class="p">,</span><span class="w"> </span><span class="n">jMenuItemSupprimer</span><span class="p">},</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-20-53" name="__codelineno-20-53"></a><span class="w">    </span><span class="c1">// centrer la fenêtre</span>
<a id="__codelineno-20-54" name="__codelineno-20-54"></a><span class="w">    </span><span class="n">Dimension</span><span class="w"> </span><span class="n">screenSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">().</span><span class="na">getScreenSize</span><span class="p">();</span>
<a id="__codelineno-20-55" name="__codelineno-20-55"></a><span class="w">    </span><span class="n">Dimension</span><span class="w"> </span><span class="n">frameSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSize</span><span class="p">();</span>
<a id="__codelineno-20-56" name="__codelineno-20-56"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frameSize</span><span class="p">.</span><span class="na">height</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">screenSize</span><span class="p">.</span><span class="na">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-57" name="__codelineno-20-57"></a><span class="w">      </span><span class="n">frameSize</span><span class="p">.</span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">screenSize</span><span class="p">.</span><span class="na">height</span><span class="p">;</span>
<a id="__codelineno-20-58" name="__codelineno-20-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-59" name="__codelineno-20-59"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frameSize</span><span class="p">.</span><span class="na">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">screenSize</span><span class="p">.</span><span class="na">width</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-60" name="__codelineno-20-60"></a><span class="w">      </span><span class="n">frameSize</span><span class="p">.</span><span class="na">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">screenSize</span><span class="p">.</span><span class="na">width</span><span class="p">;</span>
<a id="__codelineno-20-61" name="__codelineno-20-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-62" name="__codelineno-20-62"></a><span class="w">    </span><span class="n">setLocation</span><span class="p">((</span><span class="n">screenSize</span><span class="p">.</span><span class="na">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frameSize</span><span class="p">.</span><span class="na">width</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">screenSize</span><span class="p">.</span><span class="na">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frameSize</span><span class="p">.</span><span class="na">height</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-20-63" name="__codelineno-20-63"></a><span class="w">    </span><span class="c1">// utilisateur connecté</span>
<a id="__codelineno-20-64" name="__codelineno-20-64"></a><span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uiSession</span><span class="p">.</span><span class="na">getUser</span><span class="p">();</span>
<a id="__codelineno-20-65" name="__codelineno-20-65"></a><span class="w">    </span><span class="c1">// initialisations locales</span>
<a id="__codelineno-20-66" name="__codelineno-20-66"></a><span class="w">    </span><span class="n">modèleNomsVoix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultListModel</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-20-67" name="__codelineno-20-67"></a><span class="w">    </span><span class="n">jListNomsVoix</span><span class="p">.</span><span class="na">setModel</span><span class="p">(</span><span class="n">modèleNomsVoix</span><span class="p">);</span>
<a id="__codelineno-20-68" name="__codelineno-20-68"></a><span class="w">    </span><span class="n">modèleRésultats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultListModel</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-20-69" name="__codelineno-20-69"></a><span class="w">    </span><span class="n">jListResultats</span><span class="p">.</span><span class="na">setModel</span><span class="p">(</span><span class="n">modèleRésultats</span><span class="p">);</span>
<a id="__codelineno-20-70" name="__codelineno-20-70"></a><span class="w">    </span><span class="c1">// on demande les listes à la couche [métier]</span>
<a id="__codelineno-20-71" name="__codelineno-20-71"></a><span class="w">    </span><span class="n">metier</span><span class="p">.</span><span class="na">getListesElectorales</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">())</span>
<a id="__codelineno-20-72" name="__codelineno-20-72"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span>
<a id="__codelineno-20-73" name="__codelineno-20-73"></a><span class="w">                    </span><span class="c1">// réponse</span>
<a id="__codelineno-20-74" name="__codelineno-20-74"></a><span class="w">                    </span><span class="n">listesElectorales</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-75" name="__codelineno-20-75"></a><span class="w">                      </span><span class="c1">// on mémorise les listes</span>
<a id="__codelineno-20-76" name="__codelineno-20-76"></a><span class="w">                      </span><span class="n">listes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listesElectorales</span><span class="p">;</span>
<a id="__codelineno-20-77" name="__codelineno-20-77"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-20-78" name="__codelineno-20-78"></a><span class="w">                    </span><span class="c1">// exception</span>
<a id="__codelineno-20-79" name="__codelineno-20-79"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">showException</span><span class="p">(</span><span class="n">th</span><span class="p">),</span>
<a id="__codelineno-20-80" name="__codelineno-20-80"></a><span class="w">                    </span><span class="c1">// fin observable</span>
<a id="__codelineno-20-81" name="__codelineno-20-81"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-82" name="__codelineno-20-82"></a><span class="w">                      </span><span class="c1">// étape suivante</span>
<a id="__codelineno-20-83" name="__codelineno-20-83"></a><span class="w">                      </span><span class="n">doInitStep2</span><span class="p">();</span>
<a id="__codelineno-20-84" name="__codelineno-20-84"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-20-85" name="__codelineno-20-85"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-20-86" name="__codelineno-20-86"></a><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 46 : la méthode [init] est exécutée lorsque la fenêtre associée va s&#x27;afficher. Elle a pour but d&#x27;initialiser les composants [1-3] ci-dessous :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000211000001CC6930C088.png" style="display:inline-block; margin:4px;width:8.641cm;height:7.512cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>lignes 71-85 : on demande de façon asynchrone les listes candidates (composant [1]) ;</li>
<li>ligne 71 : le processus observé est [metier.getListesElectorales(user)]. Il est exécuté sur un thread d&#x27;E/S [subscribeOn(Schedulers.io())] et observé sur le thread de l&#x27;UI [observeOn(SwingScheduler.getInstance()] ;</li>
<li>lignes 74-77 : le résultat renvoyé par le processus observé est mémorisé dans le champ [listes] de la ligne 38 ;</li>
<li>
<p>ligne 79 : l&#x27;éventuelle exception est traitée par la méthode suivante :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showException</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="c1">// on affiche l&#39;exception</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="n">jTextPaneMessages</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">getInfoForException</span><span class="p">(</span><span class="s">&quot;Les erreurs suivantes se sont produites : &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">th</span><span class="p">));</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="n">jTextPaneMessages</span><span class="p">.</span><span class="na">setCaretPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>lignes 81-84 : à la fin du processus observé, on exécute les lignes 81-84. Ces lignes ne sont pas exécutées s&#x27;il y a eu exception. La méthode [doInitStep2] assure l&#x27;étape 2 de l&#x27;initialisation de la façon suivante :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doInitStep2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="c1">// on associe les noms des listes au combo jComboBoxNomsListes</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">listes</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">      </span><span class="n">jComboBoxNomsListes</span><span class="p">.</span><span class="na">addItem</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s - %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">listes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">getNom</span><span class="p">()));</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="c1">// nombre de sièges à pourvoir</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">    </span><span class="n">metier</span><span class="p">.</span><span class="na">getNbSiegesAPourvoir</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">())</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">                    </span><span class="c1">// réponse</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">                    </span><span class="n">nbSiegesAPourvoir</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">                      </span><span class="c1">// on initialise le label lié à cette information</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">                      </span><span class="n">jLabelSAP</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">jLabelSAP</span><span class="p">.</span><span class="na">getText</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbSiegesAPourvoir</span><span class="p">);</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">                    </span><span class="c1">// exception</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">showException</span><span class="p">(</span><span class="n">th</span><span class="p">),</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">                    </span><span class="c1">// fin observable</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">                      </span><span class="c1">// étape suivante</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">                      </span><span class="n">doInitStep3</span><span class="p">();</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>lignes 3-5 : on utilise le résultat de l&#x27;étape précédente pour remplir la liste déroulante avec les noms des listes candidates ;</p>
</li>
<li>lignes 7-20 : on demande le nombre de sièges à pourvoir de façon asynchrone ;</li>
<li>ligne 7 : le processus observé est [metier.getNbSiegesAPourvoir(user)]. Il est exécuté sur un thread d&#x27;E/S [subscribeOn(Schedulers.io())] et observé sur le thread de l&#x27;UI [observeOn(SwingScheduler.getInstance()] ;</li>
<li>lignes 10-13 : le résultat renvoyé par le processus est utilisé pour mettre à jour l&#x27;interface graphique ;</li>
<li>ligne 15 : on affiche l&#x27;éventuelle exception ;</li>
<li>lignes 17-20 : à réception du signal de fin de l&#x27;observable, on passe à l&#x27;étape 3 du processus d&#x27;initialisation ;
L&#x27;étape 3 de l&#x27;initialisation est assurée par le code suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doInitStep3</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="c1">// seuil électoral</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="n">metier</span><span class="p">.</span><span class="na">getSeuilElectoral</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">())</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">                    </span><span class="c1">// réponse</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">                    </span><span class="n">seuilElectoral</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">                      </span><span class="c1">// on initialise le label lié à cette information</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">                      </span><span class="n">jLabelSE</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">jLabelSE</span><span class="p">.</span><span class="na">getText</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">seuilElectoral</span><span class="p">);</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">                    </span><span class="c1">// exception</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">showException</span><span class="p">(</span><span class="n">th</span><span class="p">),</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">                    </span><span class="c1">// fin observable</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">                    </span><span class="p">});</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 3-4 : on demande le seuil électoral de façon asynchrone ;</li>
<li>ligne 3 : le processus observé est [metier.getSeuilElectoral(user)]. Il est exécuté sur un thread d&#x27;E/S [subscribeOn(Schedulers.io())] et observé sur le thread de l&#x27;UI [observeOn(SwingScheduler.getInstance()] ;</li>
<li>lignes 6-9 : le résultat renvoyé par le processus est utilisé pour mettre à jour l&#x27;interface graphique ;</li>
<li>ligne 11 : on affiche l&#x27;éventuelle exception ;</li>
<li>lignes 13-14 : à réception du signal de fin de l&#x27;observable, rien n&#x27;est fait : le processus d&#x27;initialisation de l&#x27;interface graphique est terminé ;</li>
</ul>
<h4 id="20332-calcul-des-sieges-obtenus-par-les-differentes-listes">20.3.3.2. Calcul des sièges obtenus par les différentes listes</h4>
<p>La méthode [doCalculer] a pour fonction de calculer le nombre de sièges obtenus par les différentes listes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doCalculer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">    </span><span class="n">tListesSaisies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listesSaisies</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ListeElectorale</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="c1">// calcul des sièges</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="n">metier</span><span class="p">.</span><span class="na">calculerSieges</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">tListesSaisies</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">())</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">                    </span><span class="c1">// traitement résultat</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">                    </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">consumeResultSieges</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">                    </span><span class="c1">// traitement exception</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">                    </span><span class="n">th</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">showException</span><span class="p">(</span><span class="n">th</span><span class="p">),</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">                    </span><span class="c1">// fin observable</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w">            </span><span class="p">);</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 6-15 : on calcule de façon asynchrone les sièges obtenus par les différentes listes ;</li>
<li>ligne 6 : le processus observé est [metier.calculerSieges(user, tListesSaisies)]. Il est exécuté sur un thread d&#x27;E/S [subscribeOn(Schedulers.io())] et observé sur le thread de l&#x27;UI [observeOn(SwingScheduler.getInstance()] ;</li>
<li>ligne 9 : le résultat renvoyé par le processus est utilisé par la méthode [consumeResultSieges] ;</li>
<li>ligne 11 : on affiche l&#x27;éventuelle exception ;</li>
<li>lignes 13-14 : à réception du signal de fin de l&#x27;observable, rien n&#x27;est fait ;
Ligne 9, la méthode [consumeResultSieges] exploite le résultat renvoyé par le processus observé, les listes candidates avec leurs champs [sieges, elimine] mis à jour :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">consumeResultSieges</span><span class="p">(</span><span class="n">ListeElectorale</span><span class="o">[]</span><span class="w"> </span><span class="n">tListesSaisies</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">    </span><span class="c1">// on mémorise le résultat</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">tListesSaisies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tListesSaisies</span><span class="p">;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="c1">// affichage des résultats</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="n">modèleRésultats</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tListesSaisies</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">      </span><span class="n">modèleRésultats</span><span class="p">.</span><span class="na">addElement</span><span class="p">(</span><span class="n">tListesSaisies</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">    </span><span class="c1">// maj état formulaire</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">    </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JLabel</span><span class="o">[]</span><span class="p">{</span><span class="n">jLabelEnregistrer</span><span class="p">},</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">    </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JLabel</span><span class="o">[]</span><span class="p">{</span><span class="n">jLabelCalculer</span><span class="p">},</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">    </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JMenuItem</span><span class="o">[]</span><span class="p">{</span><span class="n">jMenuItemEnregistrer</span><span class="p">},</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">    </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JMenuItem</span><span class="o">[]</span><span class="p">{</span><span class="n">jMenuItemCalculer</span><span class="p">},</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="w">    </span><span class="n">jTextPaneMessages</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;Calcul terminé&quot;</span><span class="p">);</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-14 : le résultat obtenu est utilisé pour mettre à jour l&#x27;interface graphique ;</li>
</ul>
<h4 id="20333-enregistrement-des-resultats-de-lelection">20.3.3.3. Enregistrement des résultats de l&#x27;élection</h4>
<p>L&#x27;enregistrement des résultats de l&#x27;élection est fait par la méthode [doEnregistrer] suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="w">  </span><span class="nd">@Override</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">  </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doEnregistrer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">    </span><span class="c1">// on demande l&#39;enregistrement à la couche [métier]</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="n">metier</span><span class="p">.</span><span class="na">recordResultats</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">tListesSaisies</span><span class="p">).</span><span class="na">subscribeOn</span><span class="p">(</span><span class="n">Schedulers</span><span class="p">.</span><span class="na">io</span><span class="p">()).</span><span class="na">observeOn</span><span class="p">(</span><span class="n">SwingScheduler</span><span class="p">.</span><span class="na">getInstance</span><span class="p">())</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">            </span><span class="p">.</span><span class="na">subscribe</span><span class="p">(</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">                    </span><span class="c1">// traitement du résultat - il n&#39;y en a pas ici</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">                    </span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">                    </span><span class="p">},</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">                    </span><span class="c1">// traitement de l&#39;exception</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">                    </span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">showException</span><span class="p">(</span><span class="n">th</span><span class="p">),</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">                    </span><span class="c1">// fin observable</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">                    </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">                      </span><span class="c1">// maj du formulaire</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">                      </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JLabel</span><span class="o">[]</span><span class="p">{</span><span class="n">jLabelEnregistrer</span><span class="p">},</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">                      </span><span class="n">Utilitaires</span><span class="p">.</span><span class="na">setEnabled</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JMenuItem</span><span class="o">[]</span><span class="p">{</span><span class="n">jMenuItemEnregistrer</span><span class="p">},</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">                      </span><span class="n">jTextPaneMessages</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;Enregistrement des résultats réalisé&quot;</span><span class="p">);</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">            </span><span class="p">);</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-17 : on enregistre les résultats de l&#x27;élection de façon asynchrone ;</li>
<li>ligne 4 : le processus observé est [metier.recordResultats(user, tListesSaisies)]. Il est exécuté sur un thread d&#x27;E/S [subscribeOn(Schedulers.io())] et observé sur le thread de l&#x27;UI [observeOn(SwingScheduler.getInstance()] ;</li>
<li>lignes 7-8 : ces lignes ne seront jamais exécutées car le processus observé ne rend pas de résultat ;</li>
<li>ligne 10 : on affiche l&#x27;éventuelle exception ;</li>
<li>lignes 14-16 : à réception du signal de fin de l&#x27;observable, on met à jour l&#x27;interface graphique ;
<strong>Travail à faire</strong> : vérifier que l&#x27;application Swing fonctionne. Puis faites évoluer l&#x27;interface graphique et le code pour que lors d&#x27;une opération asynchrone avec le serveur web / jSON, une image d&#x27;attente apparaisse ainsi qu&#x27;une option d&#x27;annulation de l&#x27;opération en cours.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>