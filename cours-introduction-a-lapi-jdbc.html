
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/java-spring-dec-2015/cours-introduction-a-lapi-jdbc.html">
      
      
        <link rel="prev" href="cours-introduction-au-framework-spring.html">
      
      
        <link rel="next" href="td-implementation-de-la-couche-dao-du-td-avec-lapi-jdbc.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>6. [Cours] : Introduction à l'API JDBC - Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#6-cours-introduction-a-lapi-jdbc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-header__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6. [Cours] : Introduction à l'API JDBC
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-nav__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-le-probleme.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. [TD] : Le problème
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-classes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. [TD] : Classes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-architectures-en-couches.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. [TD] : Architectures en couches
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-au-framework-spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. [Cours] : Introduction au framework Spring
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    6. [Cours] : Introduction à l'API JDBC
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="cours-introduction-a-lapi-jdbc.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    6. [Cours] : Introduction à l'API JDBC
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#61-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1. Support
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#62-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2. Architecture
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#63-les-etapes-dexploitation-dune-base-de-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3. Les étapes d'exploitation d'une base de données
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3. Les étapes d&#39;exploitation d&#39;une base de données">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#631-etape-1-chargement-en-memoire-du-pilote-jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3.1. étape 1 - chargement en mémoire du pilote JDBC
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#632-etape-2-ouverture-dune-connexion" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3.2. étape 2 - ouverture d'une connexion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#633-etape-3-emission-dordres-sql-select" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3.3. étape 3 - émission d'ordres SQL [SELECT]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#634-etape-3-emission-dordres-sql-insert-update-delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3.4. étape 3 - émission d'ordres SQL [INSERT, UPDATE, DELETE]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#635-etape-4-fermeture-de-la-connexion" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3.5. étape 4 - fermeture de la connexion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#64-un-projet-exemple" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4. Un projet exemple
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.4. Un projet exemple">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#641-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.1. Support
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#642-la-base-de-donnees-exploitee" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.2. La base de données exploitée
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#643-le-projet-eclipse" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.3. Le projet Eclipse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#644-la-classe-des-produits" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.4. La classe des produits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#645-la-classe-static" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.5. La classe [Static]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#646-le-squelette-de-la-classe-principale" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.6. Le squelette de la classe principale
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#647-suppression-du-contenu-de-la-table-des-produits" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.7. Suppression du contenu de la table des produits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#648-creation-du-contenu-de-la-table-des-produits" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.8. Création du contenu de la table des produits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#649-affichage-du-contenu-de-la-table-des-produits" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.9. Affichage du contenu de la table des produits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6410-mise-a-jour-du-contenu-de-la-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.10. Mise à jour du contenu de la table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6411-role-de-la-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.11. Rôle de la transaction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6412-resultats" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4.12. Résultats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#65-utilisation-dune-source-de-donnees-de-type-datasource" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5. Utilisation d'une source de données de type [DataSource]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.5. Utilisation d&#39;une source de données de type [DataSource]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#651-le-projet-eclipse" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5.1. Le projet Eclipse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#652-la-classe-principale" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5.2. La classe principale
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#66-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6. Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-lapi-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. [TD] : Implémentation de la couche [DAO] du TD avec l'API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. [TD] : La couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-un-programme-console.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. [TD] : Implémentation de la couche [ui] avec un programme console
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-une-interface-swing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. [TD] : Implémentation de la couche [ui] avec une interface Swing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. [Cours] : Gestion des bases de données relationnelles avec Spring Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. [TD] : Implémentation de la couche [DAO] du TD avec [Spring Data]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. [Cours] : Exposer une base de données sur le web avec Spring MVC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-exposition-sur-le-web-de-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. [TD] : Exposition sur le web de la couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-creation-dun-client-pour-le-service-web.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. [TD] : création d'un client pour le service web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-securiser-lacces-a-un-service-web-avec-spring-security.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. [Cours] : Sécuriser l'accès à un service web avec Spring Security
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-securisation-du-serveur-web--json-des-elections.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. [TD] : sécurisation du serveur web / jSON des élections
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-acces-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. [Cours] : Gestion des accès inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-elections-avec-des-requetes-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. [TD] Elections avec des requêtes inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="programmation-asynchrone-avec-rxjava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Programmation asynchrone avec RxJava
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="annexes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="6-cours-introduction-a-lapi-jdbc">6. [Cours] : Introduction à l'API JDBC</h1>
<p><strong>Mots clés</strong> : bases de données relationnelles, API JDBC, SQLException.</p>
<h2 id="61-support">6.1. Support</h2>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000BD00000096518BC439.png" style="display:inline-block; margin:4px;width:3.5cm;height:2.78cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E3000001337D6BE978.png" style="display:inline-block; margin:4px;width:4.2cm;height:5.68cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F60000015AF428CA9B.png" style="display:inline-block; margin:4px;width:4.56cm;height:6.41cm;" /></td></tr></table>

<p>Le dossier [support / chap-06] contient les projets Eclipse de ce chapitre.</p>
<h2 id="62-architecture">6.2. Architecture</h2>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000051B00000107553F3249.png" style="display:inline-block; margin:4px;width:17.291cm;height:3.48cm;" /></td></tr></table>

<p>La couche JDBC (Java DataBase Connectivity) est une interface d'accès universelle aux bases de données. Elle présente toujours la même interface à la couche [DAO]. Si on change de SGBD, il suffit de changer le pilote JDBC. La couche [DAO] ne change pas.</p>
<h2 id="63-les-etapes-dexploitation-dune-base-de-donnees">6.3. Les étapes d'exploitation d'une base de données</h2>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000051A000000FFD776E479.png" style="display:inline-block; margin:4px;width:17.277cm;height:3.374cm;" /></td></tr></table>

<p>Dans l'architecture ci-dessus, l'exploitation d'une base de données par le programme console comporte les étapes suivantes :</p>
<ol>
<li>chargement du pilote JDBC de la base de données ;</li>
<li>ouverture d'une connexion avec la base ;</li>
<li>émission d'un ordre SQL sur la base et traitement des résultats de l'ordre SQL ;</li>
<li>fermeture de la connexion ;</li>
</ol>
<p>L'étape 1 ne se fait qu'une fois. Les étapes 2-4 se font de façon répétée. On notera qu'on ne laisse pas une connexion ouverte. On la ferme dès qu'on en n'a plus besoin.</p>
<h3 id="631-etape-1-chargement-en-memoire-du-pilote-jdbc">6.3.1. étape 1 - chargement en mémoire du pilote JDBC</h3>
<p><u>Le code</u></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>        // chargement du pilote JDBC
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>        try {
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>            Class.forName(nom de la classe du pilote JDBC);
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        } catch (ClassNotFoundException e1) {
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>            // traiter l&#39;exception
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>}
</code></pre></div></td></tr></table></div>
<p>L'opération de la ligne 3 a pour but de charger en mémoire le pilote JDBC de la base de données. Cette opération n'a besoin d'être faite qu'une fois. La répéter ne cause cependant pas d'erreur. La classe du pilote JDBC est cherchée dans le Classpath du projet. Il faut donc que dans le projet Eclipse, le [jar] contenant la classe du pilote JDBC ait été inclus dans le Classpath du projet.</p>
<h3 id="632-etape-2-ouverture-dune-connexion">6.3.2. étape 2 - ouverture d'une connexion</h3>
<p>Une fois le pilote JDBC en place, on lui demande d'ouvrir une connexion avec la BD :</p>
<p><u>Le code</u></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.jdbc</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Connection</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.PreparedStatement</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.ResultSet</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.SQLException</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">IntroJdbc01</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="p">...</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">        </span><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">        </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">            </span><span class="c1">// ouverture connexion</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">            </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">passwd</span><span class="p">);</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="p">...</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">            </span><span class="c1">// on traite l&#39;exception</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="w">         </span><span class="c1">// fermer la connexion</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connexion</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">                </span><span class="n">connexion</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">                </span><span class="c1">// traiter l&#39;exception</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="w">                </span><span class="p">...</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="w">         </span><span class="p">}</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 3-7 : les classes d'implémentation de l'interface JDBC sont toutes dans le package [java.sql]. Par ailleurs, en cas d'erreur elles lancent toutes une exception de type [SQLException] (ligne 19, 27). Cette exception dérive de la classe [Exception] et est une exception dite contrôlée : on est obligé de mettre un try / catch pour la gérer ou de façon alternative de ne pas la gérer et d'indiquer que la méthode laisse sortir l'exception en complétant la signature de la méthode par [throws SQLException] ;</li>
<li>ligne 17, [DriverManager.getConnection] est une méthode statique qui attend trois paramètres :</li>
<li>[url] : l'URL de la base de données. C'est une chaîne de caractères dépendante de la BD utilisée. Pour MySQL, elle est de la forme [jdbc:mysql://localhost:3306/nom_de_la_bd];</li>
<li>[user] : le propriétaire de la connexion ;</li>
<li>[passwd] : son mot de passe ;</li>
<li>lignes 24-30 : la connexion doit être fermée dans la clause [finally] afin qu'elle soit fermée qu'il y ait exception ou non.</li>
</ul>
<h3 id="633-etape-3-emission-dordres-sql-select">6.3.3. étape 3 - émission d'ordres SQL [SELECT]</h3>
<p>Une fois obtenue une connexion, on peut émettre des ordres SQL. La façon de gérer des ordres de lecture [SELECT] diffère de celle utilisée pour les opérations de mise à jour [UPDATE, INSERT, DELETE]. Nous commençons par les ordres SQL [SELECT] :</p>
<p><u><strong>Le code</strong></u></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">        </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">            </span><span class="c1">// ouverture connexion</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">            </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">passwd</span><span class="p">);</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">            </span><span class="c1">// début transaction</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">            </span><span class="c1">// en mode lecture seule</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">setReadOnly</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">            </span><span class="c1">// on lit la table [PRODUITS]</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">            </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connexion</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;SELECT ID, NOM, CATEGORIE, PRIX, DESCRIPTION FROM PRODUITS&quot;</span><span class="p">);</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">            </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Liste des produits : &quot;</span><span class="p">);</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">5</span><span class="p">)));</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">            </span><span class="c1">// commit transaction</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">            </span><span class="c1">// on traite l&#39;exception</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">             </span><span class="n">doCatchException</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span><span class="n">e1</span><span class="p">);</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">            </span><span class="c1">// on traite le finally</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">            </span><span class="n">doFinally</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">connexion</span><span class="p">);</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFinally</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="p">....</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 8, 10 : ouverture d'une transaction (ligne 8) en mode lecture seule (ligne 10). Une transaction est une séquence d'ordes SQL qui soit tous réussissent soit tous échouent. Ainsi dans une transaction comportant N ordres SQL, si l'ordre I+1 échoue, alors les I précédents seront annulés. Pour une opération de lecture, une transaction n'est pas nécessaire. Néanmoins créer une transaction en lecture seule peut permettre à certains SGBD de faire certaines optimisations ;</li>
<li>ligne 12 : utilisation d'un [PreparedStatement]. Un [PreparedStatement] a normalement des paramètres notés par le caractère ?. Ici il n'en a pas. Un [PreparedStatement] est un ordre préparé par le SGBD. Cette préparation a un coût et elle n'est faite qu'une fois. Ensuite cet ordre préparé est exécuté par le SGBD avec différents paramètres effectifs qui vont venir remplacer les paramètres formels ?. A noter qu'il est préférable de nommer les colonnes désirées plutôt que d'utiliser la notation * pour obtenir toutes les colonnes. En précisant le nom des colonnes on peut ensuite obtenir leurs valeurs à partir de leur position dans la requête SELECT ;</li>
<li>ligne 13 : exécution du [PreparedStatement]. On récupère un objet de type [ResultSet] ;</li>
</ul>
<p>Un objet de type [ResultSet] représente une table, c’est à dire un ensemble de lignes et de colonnes. A un moment donné, on n’a accès qu’à une ligne de la table appelée ligne courante. Lors de la création initiale du [ResultSet], il n'y a pas de ligne courante. Il faut faire une opération [ResultSet.next()] pour l'obtenir. La signature de la méthode next est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>    boolean next()
</code></pre></div></td></tr></table></div>
<p>Cette méthode tente de passer à la ligne suivante du [ResultSet] et rend true si elle réussit, false sinon. En cas de réussite, la ligne suivante devient la nouvelle ligne courante. La ligne précédente est perdue et on ne pourra revenir en arrière pour la récupérer.</p>
<p>La table du [ResultSet] a des colonnes nommées labelCol1, labelCol2,... précisées dans la requête [SELECT] exécutée. Avec la requête :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">myId</span><span class="p">,</span><span class="w"> </span><span class="n">NOM</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">myNom</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIE</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">myCategorie</span><span class="p">,</span><span class="w"> </span><span class="n">PRIX</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">myPrix</span><span class="p">,</span><span class="w"> </span><span class="n">DESCRIPTION</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">myDescription</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">PRODUITS</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>la colonne [ID] ira dans une colonne du [ResultSet] nommée [myId] ;</li>
<li>la colonne [NOM] ira dans une colonne du [ResultSet] nommée [myNom] ;</li>
<li>...</li>
</ul>
<p>Ci-dessus, les identifiants [myCol] sont appelés des <strong>labels de colonne</strong>. En l'absence de ces labels, les noms des colonnes du [ResultSet] sont dépendants du SGBD. Lorsque le [SELECT] opère sur une unique table, les labels des colonnes seront par défaut les noms des colonnes demandées par le SELECT. Le problème surgit lorsque le [SELECT] opère sur plusieurs tables et que dans celles-ci on trouve des noms de colonnes identiques comme dans l'exemple suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">PRODUITS</span><span class="p">.</span><span class="n">NOM</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIES</span><span class="p">.</span><span class="n">NOM</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">PRODUITS</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIES</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">PRODUITS</span><span class="p">.</span><span class="n">CATEGORIE_ID</span><span class="o">=</span><span class="n">CATEGORIES</span><span class="p">.</span><span class="n">ID</span>
</code></pre></div></td></tr></table></div>
<p>en imaginant que la table [PRODUITS] ait une clé étrangère vers la table [CATEGORIES] symbolisée par la relation [Produits].CATEGORIE_ID --&gt; [CATEGORIES].ID, et que les tables [PRODUITS] et [CATEGORIES] aient toutes les deux un champ [NOM]. Dans ce cas, les noms donnés dans le [ResultSet] aux colonnes [<strong>PRODUITS.NOM</strong>] et [<strong>CATEGORIES.NOM</strong>] sont dépendants du SGBD. Pour la portabilité entre SGBD, il faut donc utiliser des labels de colonnes ici et on écrira :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">PRODUITS</span><span class="p">.</span><span class="n">NOM</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">p_NOM</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIES</span><span class="p">.</span><span class="n">NOM</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">c_NOM</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">PRODUITS</span><span class="p">,</span><span class="w"> </span><span class="n">CATEGORIES</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">PRODUITS</span><span class="p">.</span><span class="n">CATEGORIE_ID</span><span class="o">=</span><span class="n">CATEGORIES</span><span class="p">.</span><span class="n">ID</span>
</code></pre></div></td></tr></table></div>
<p>Pour exploiter les différents champs de la ligne courante du [ResultSet], on dispose des méthodes suivantes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>Type getType(&quot;labelColi&quot;) 
</code></pre></div></td></tr></table></div>
<p>pour obtenir la colonne nommée «labelColi» de la ligne courante et donc la colonne du [SELECT] ayant ce label. Type désigne le type du champ coli. On peut utiliser les méthodes [getType] suivantes : getInt, getLong, getString, getDouble, getFloat, getDate, ... Au lieu d'utiliser le nom de la colonne, on peut utiliser sa position dans la requête [SELECT] exécutée :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>Type getType(i) 
</code></pre></div></td></tr></table></div>
<p>où i est l’indice de la colonne désirée (i&gt;=1).</p>
<ul>
<li>lignes 15-17 : récupération des valeurs lues dans la BD ;</li>
<li>ligne 19 : la transaction est validée (on dit également committée). Cela la termine et libère les ressources que le SGBD avait mobilisées pour elle ;</li>
<li>ligne 25 : les ressources sont libérées dans le [finally]. Celui-ci appelle la méthode [doFinally] suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>private void doFinally(ResultSet rs, PreparedStatement ps, Connection connexion) {
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>        // fermeture ResultSet
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        if (rs != null) {
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>            try {
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>                rs.close();
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>            } catch (SQLException e1) {
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>            }
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>        }
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>        // fermeture [PreparedStatement]
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>        if (ps != null) {
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>            try {
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>                ps.close();
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>            } catch (SQLException e2) {
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>            }
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>        }
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>        if (connexion != null) {
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>            try {
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>                // fermer la connexion
<a id="__codelineno-9-21" name="__codelineno-9-21"></a>                connexion.close();
<a id="__codelineno-9-22" name="__codelineno-9-22"></a>            } catch (SQLException e3) {
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>                // traiter l&#39;exception
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>            }
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>        }
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>    }
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 3-9 : fermeture du [ResultSet] ;</li>
<li>lignes 11-17 : fermeture du [PreparedStatement] ;</li>
<li>lignes 18-27 : fermeture de la connexion ;</li>
</ul>
<p>Les fermetures des lignes 3-17 semblent redondantes dans la mesure on ferme la connexion lignes 18-25. En fait, dans certains cas elles ne le sont pas et il est conseillé de les laisser [<a href="http://stackoverflow.com/questions/4507440/must-jdbc-resultsets-and-statements-be-closed-separately-although-the-connection"><u>http://stackoverflow.com/questions/4507440/must-jdbc-resultsets-and-statements-be-closed-separately-although-the-connection</u></a>].</p>
<ul>
<li>ligne 22 : l'exception est traitée par la méthode [doCatchException] suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>    private static void doCatchException(Connection connexion, Throwable th) {
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>        // annulation transaction
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>        try {
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>            if (connexion != null) {
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>                connexion.rollback();
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>            }
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>        } catch (SQLException e2) {
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>            // traiter l&#39;exception
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>        }
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>}
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-6 : la transaction est annulée. Cela la termine et le SGBD va pouvoir relâcher les ressources mobilisées pour elle ;</li>
</ul>
<h3 id="634-etape-3-emission-dordres-sql-insert-update-delete">6.3.4. étape 3 - émission d'ordres SQL [INSERT, UPDATE, DELETE]</h3>
<p>Les ordres SQL [INSERT, UPDATE, DELETE] sont des opérations de mise à jour : elles modifient la base de données mais ne ramènent aucune ligne. La seule information rendue est le nombre de lignes affectées par l'opération de mise à jour.</p>
<p><u><strong>Le code</strong></u></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="err">{</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">ouverture</span><span class="w"> </span><span class="n">connexion</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">            </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="n">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="k">user</span><span class="p">,</span><span class="w"> </span><span class="n">passwd</span><span class="p">);</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">début</span><span class="w"> </span><span class="k">transaction</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="n">setAutoCommit</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="k">mode</span><span class="w"> </span><span class="n">lecture</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="err">é</span><span class="n">criture</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">met</span><span class="w"> </span><span class="err">à</span><span class="w"> </span><span class="n">jour</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="k">table</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">            </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connexion</span><span class="p">.</span><span class="n">prepareStatement</span><span class="p">(</span><span class="ss">&quot;UPDATE PRODUITS SET PRIX=PRIX*1.1 WHERE CATEGORIE=?&quot;</span><span class="p">);</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">catégorie</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="n">setInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">exécution</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">            </span><span class="nb">int</span><span class="w"> </span><span class="n">nbLignes</span><span class="o">=</span><span class="n">ps</span><span class="p">.</span><span class="n">executeUpdate</span><span class="p">();</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">commit</span><span class="w"> </span><span class="k">transaction</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="k">commit</span><span class="p">();</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="k">SQLException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">traite</span><span class="w"> </span><span class="n">l</span><span class="err">&#39;</span><span class="k">exception</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="w">            </span><span class="n">doCatchException</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">);</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="n">finally</span><span class="w"> </span><span class="err">{</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">traite</span><span class="w"> </span><span class="n">le</span><span class="w"> </span><span class="n">finally</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="w">            </span><span class="n">doFinally</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">connexion</span><span class="p">);</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="w">        </span><span class="err">}</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="w">    </span><span class="err">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : la connexion est utilisée en lecture et écriture ;</li>
<li>ligne 11 : un [PreparedStatement] avec 1 paramètre (symbolisé par ?). On peut avoir plusieurs paramètres. Ils sont numérotés à partir de 1 ;</li>
<li>ligne 13 : on affecte sa valeur à l'unique paramètre. Le 1er paramètre de [setType] est la position du paramètre dans le [PreparedStatement] (1, 2, ...) et le second la valeur qui lui est attribuée. On peut utiliser les méthodes [setInt, setLong, setFloat, setDouble, setString, setDate, ...] ;</li>
<li>ligne 15 : on utilise la méthode [executeUpdate] et non [executeQuery] réservée aux ordres SELECT. La méthode rend le nombre de lignes affectées par l'opération. Peut être 0.</li>
<li>ligne 17 : la transaction est validée ;</li>
</ul>
<h3 id="635-etape-4-fermeture-de-la-connexion">6.3.5. étape 4 - fermeture de la connexion</h3>
<p>Une connexion doit être fermée le plus vite possible dans un contexte multi-utilisateurs car un SGBD accepte un nombre limité de connexions ouvertes. Dans les exemples précédents, elle était fermée dans la clause [finally] des opérations SQL afin qu'elle soit fermée qu'il y ait eu exception ou pas.</p>
<h2 id="64-un-projet-exemple">6.4. Un projet exemple</h2>
<h3 id="641-support">6.4.1. Support</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000546000002946CF3B768.png" style="display:inline-block; margin:4px;width:17.859cm;height:8.731cm;" /></td></tr></table>

<p>Le dossier [support / chap5] contient les projets Eclipse de ce chapitre [1, 2]. Le dossier [database] contient le script SQL permettant de créer la base MySQL exemple de ce chapitre [1, 3].</p>
<h3 id="642-la-base-de-donnees-exploitee">6.4.2. La base de données exploitée</h3>
<p>Les exemples qui suivent exploitent la base de données MySQL suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000268000000DD9250EEBF.png" style="display:inline-block; margin:4px;width:11.411cm;height:4.09cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>[ID] : clé primaire en mode AUTO_INCREMENT (si on ne donne pas de clé primaire, le SGBD la génère) ;</li>
<li>[NOM] : nom d'un produit - unique ;</li>
<li>[CATEGORIE] : n° de sa catégorie ;</li>
<li>[PRIX] : son prix ;</li>
<li>[DESCRIPTION] : une description du produit ;</li>
</ul>
<p>On la créera avec l'outil [WampServer] de la façon suivante [1-9] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005CF000001D89A2EDB81.png" style="display:inline-block; margin:4px;width:17.999cm;height:5.711cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000567000003F7018B2BEB.png" style="display:inline-block; margin:4px;width:17.999cm;height:13.208cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003AB0000014F988BC3D8.png" style="display:inline-block; margin:4px;width:12.423cm;height:4.433cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003840000039CD1B2AF97.png" style="display:inline-block; margin:4px;width:11.906cm;height:12.224cm;" /></td></tr></table>

<h3 id="643-le-projet-eclipse">6.4.3. Le projet Eclipse</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D80000010680364CDD.png" style="display:inline-block; margin:4px;width:4.001cm;height:4.851cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le projet est un projet Maven défini par le fichier [pom.xml] suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    &lt;groupId&gt;istia.st.jdbc&lt;/groupId&gt;
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    &lt;artifactId&gt;intro-jdbc-01&lt;/artifactId&gt;
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>    &lt;dependencies&gt;
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>        &lt;dependency&gt;
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>            &lt;groupId&gt;mysql&lt;/groupId&gt;
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>            &lt;version&gt;5.1.34&lt;/version&gt;
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>        &lt;/dependency&gt;
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>        &lt;dependency&gt;
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>            &lt;version&gt;2.5.1&lt;/version&gt;
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>        &lt;/dependency&gt;
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>    &lt;/dependencies&gt;
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>&lt;/project&gt;
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 8-12 : le pilote JDBC du SGBD MySQL5 ;</li>
<li>lignes 13-17 : une bibliothèque capable de gérer du jSON (Javascript Object Notation) (cf paragraphe 22.6, page 421). Nous allons l'utiliser pour afficher sous forme jSON les produits de la base de données ;</li>
</ul>
<h3 id="644-la-classe-des-produits">6.4.4. La classe des produits</h3>
<p>La classe [Produit] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">package</span> <span class="n">istia</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">jdbc</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">Produit</span> <span class="p">{</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span class="o">//</span> <span class="n">champs</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="n">private</span> <span class="nb">int</span> <span class="nb">id</span><span class="p">;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="n">private</span> <span class="n">String</span> <span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span class="n">private</span> <span class="nb">int</span> <span class="n">categorie</span><span class="p">;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>    <span class="n">private</span> <span class="n">double</span> <span class="n">prix</span><span class="p">;</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>    <span class="n">private</span> <span class="n">String</span> <span class="n">description</span><span class="p">;</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>    <span class="o">//</span> <span class="n">constructeurs</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="n">public</span> <span class="n">Produit</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>    <span class="p">}</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>    <span class="n">public</span> <span class="n">Produit</span><span class="p">(</span><span class="nb">int</span> <span class="nb">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">nom</span><span class="p">,</span> <span class="nb">int</span> <span class="n">categorie</span><span class="p">,</span> <span class="n">double</span> <span class="n">prix</span><span class="p">,</span> <span class="n">String</span> <span class="n">description</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>        <span class="n">this</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>        <span class="n">this</span><span class="o">.</span><span class="n">nom</span> <span class="o">=</span> <span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>        <span class="n">this</span><span class="o">.</span><span class="n">categorie</span> <span class="o">=</span> <span class="n">categorie</span><span class="p">;</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>        <span class="n">this</span><span class="o">.</span><span class="n">prix</span> <span class="o">=</span> <span class="n">prix</span><span class="p">;</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>        <span class="n">this</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">;</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>    <span class="p">}</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>    <span class="o">//</span> <span class="n">getters</span> <span class="n">et</span> <span class="n">setters</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>    <span class="o">...</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>    <span class="o">//</span> <span class="n">to</span> <span class="n">String</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>    <span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a>        <span class="k">try</span> <span class="p">{</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a>            <span class="k">return</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">()</span><span class="o">.</span><span class="n">writeValueAsString</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a>        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">JsonProcessingException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a>            <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a>            <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a>        <span class="p">}</span>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a>    <span class="p">}</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 34 : on utilise la bibliothèque jSON pour afficher la chaîne jSON du produit. Cela donne un affichage analogue au suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>Liste des produits : 
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>{&quot;id&quot;:1,&quot;nom&quot;:&quot;NOM1&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:100.0,&quot;description&quot;:&quot;DESC1&quot;}
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>{&quot;id&quot;:2,&quot;nom&quot;:&quot;NOM2&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:101.0,&quot;description&quot;:&quot;DESC2&quot;}
</code></pre></div></td></tr></table></div>
<p>L'intérêt de la méthode [toString] ci-dessus est que si on ajoute / retranche des champs à la classe, sa méthode [toString] est toujours valide. Par ailleurs, si les champs sont eux-mêmes des objets (listes, tableaux, dictionnaires, objets utilisateur), les bibliothèques jSON savent les transformer à leur tour en chaîne jSON ;</p>
<h3 id="645-la-classe-static">6.4.5. La classe [Static]</h3>
<p>La classe [Static] regroupe dans des méthodes du code utilisé fréquemment dans la classe principale :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">istia.st.jdbc</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Static</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getErreursFromThrowable</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">        </span><span class="c1">// on récupère la liste des msg d&#39;erreur de l&#39;exception</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">th</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">            </span><span class="c1">// message d&#39;erreur du throwable</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">            </span><span class="n">erreurs</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">th</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">            </span><span class="c1">// on passe à la cause du throwable</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">            </span><span class="n">th</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">th</span><span class="p">.</span><span class="na">getCause</span><span class="p">();</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">        </span><span class="c1">// résultat</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">erreurs</span><span class="p">;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">){</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">        </span><span class="c1">// titre</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s : &quot;</span><span class="p">,</span><span class="n">title</span><span class="p">));</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">        </span><span class="c1">// messages</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">messages</span><span class="p">){</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;- %s&quot;</span><span class="p">,</span><span class="n">message</span><span class="p">));</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 8-19 : permet d'avoir la liste des erreurs encapsulées dans un objet de type [Throwable] qui est la classe mère de la classe [Exception] ;</li>
<li>lignes 21-28 : affiche à l'écran une liste de messages ;</li>
</ul>
<p>Ce code pourrait être dans la classe principale parce qu'ici c'est la seule à l'utiliser. On se place ici dans un cas plus large ou d'autres classes auraient besoin de ce code.</p>
<h3 id="646-le-squelette-de-la-classe-principale">6.4.6. Le squelette de la classe principale</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">  1</a></span>
<span class="normal"><a href="#__codelineno-16-2">  2</a></span>
<span class="normal"><a href="#__codelineno-16-3">  3</a></span>
<span class="normal"><a href="#__codelineno-16-4">  4</a></span>
<span class="normal"><a href="#__codelineno-16-5">  5</a></span>
<span class="normal"><a href="#__codelineno-16-6">  6</a></span>
<span class="normal"><a href="#__codelineno-16-7">  7</a></span>
<span class="normal"><a href="#__codelineno-16-8">  8</a></span>
<span class="normal"><a href="#__codelineno-16-9">  9</a></span>
<span class="normal"><a href="#__codelineno-16-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-16-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-16-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-16-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-16-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-16-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-16-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-16-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-16-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-16-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-16-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-16-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-16-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-16-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-16-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-16-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-16-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-16-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-16-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-16-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-16-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-16-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-16-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-16-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-16-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-16-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-16-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-16-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-16-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-16-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-16-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-16-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-16-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-16-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-16-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-16-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-16-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-16-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-16-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-16-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-16-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-16-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-16-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-16-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-16-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-16-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-16-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-16-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-16-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-16-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-16-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-16-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-16-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-16-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-16-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-16-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-16-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-16-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-16-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-16-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-16-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-16-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-16-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-16-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-16-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-16-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-16-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-16-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-16-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-16-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-16-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-16-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-16-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-16-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-16-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-16-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-16-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-16-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-16-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-16-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-16-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-16-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-16-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-16-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-16-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-16-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-16-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-16-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-16-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-16-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-16-100">100</a></span>
<span class="normal"><a href="#__codelineno-16-101">101</a></span>
<span class="normal"><a href="#__codelineno-16-102">102</a></span>
<span class="normal"><a href="#__codelineno-16-103">103</a></span>
<span class="normal"><a href="#__codelineno-16-104">104</a></span>
<span class="normal"><a href="#__codelineno-16-105">105</a></span>
<span class="normal"><a href="#__codelineno-16-106">106</a></span>
<span class="normal"><a href="#__codelineno-16-107">107</a></span>
<span class="normal"><a href="#__codelineno-16-108">108</a></span>
<span class="normal"><a href="#__codelineno-16-109">109</a></span>
<span class="normal"><a href="#__codelineno-16-110">110</a></span>
<span class="normal"><a href="#__codelineno-16-111">111</a></span>
<span class="normal"><a href="#__codelineno-16-112">112</a></span>
<span class="normal"><a href="#__codelineno-16-113">113</a></span>
<span class="normal"><a href="#__codelineno-16-114">114</a></span>
<span class="normal"><a href="#__codelineno-16-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">istia.st.jdbc</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Connection</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.DriverManager</span><span class="p">;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.PreparedStatement</span><span class="p">;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.ResultSet</span><span class="p">;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.SQLException</span><span class="p">;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">IntroJdbc01</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="c1">// constantes</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:mysql://localhost:3306/dbIntroJdbc&quot;</span><span class="p">;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;root&quot;</span><span class="p">;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">passwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO PRODUITS(ID, NOM, CATEGORIE, PRIX, DESCRIPTION) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DELETE FROM PRODUITS&quot;</span><span class="p">;</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT ID, NOM, CATEGORIE, PRIX, DESCRIPTION FROM PRODUITS&quot;</span><span class="p">;</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UPDATE PRODUITS SET PRIX=PRIX*1.1 WHERE CATEGORIE=?&quot;</span><span class="p">;</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">insert2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO PRODUITS(ID, NOM, CATEGORIE, PRIX, DESCRIPTION) VALUES (100,&#39;X&#39;,1,1,&#39;x&#39;)&quot;</span><span class="p">;</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="w">        </span><span class="c1">// chargement du pilote JDBC de MySQL</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="w">            </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">);</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="w">            </span><span class="n">doCatchException</span><span class="p">(</span><span class="s">&quot;Pilote JDBC introuvable&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">);</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="w">        </span><span class="c1">// on vide la table [PRODUITS]</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="w">        </span><span class="n">delete</span><span class="p">();</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="w">        </span><span class="c1">// on la remplit</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="w">        </span><span class="n">insert</span><span class="p">();</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="w">        </span><span class="c1">// on la lit</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="w">        </span><span class="n">select</span><span class="p">();</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="w">        </span><span class="c1">// mise à jour</span>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a><span class="w">        </span><span class="n">update</span><span class="p">();</span>
<a id="__codelineno-16-37" name="__codelineno-16-37"></a><span class="w">        </span><span class="c1">// affichage</span>
<a id="__codelineno-16-38" name="__codelineno-16-38"></a><span class="w">        </span><span class="n">select</span><span class="p">();</span>
<a id="__codelineno-16-39" name="__codelineno-16-39"></a><span class="w">        </span><span class="c1">// insertion de deux éléments identiques</span>
<a id="__codelineno-16-40" name="__codelineno-16-40"></a><span class="w">        </span><span class="c1">// l&#39;insertion doit échouer et aucun des deux éléments n&#39;est inséré à cause de la transaction</span>
<a id="__codelineno-16-41" name="__codelineno-16-41"></a><span class="w">        </span><span class="n">insert2</span><span class="p">();</span>
<a id="__codelineno-16-42" name="__codelineno-16-42"></a><span class="w">        </span><span class="c1">// on vérifie</span>
<a id="__codelineno-16-43" name="__codelineno-16-43"></a><span class="w">        </span><span class="n">select</span><span class="p">();</span>
<a id="__codelineno-16-44" name="__codelineno-16-44"></a><span class="w">        </span><span class="c1">// fini</span>
<a id="__codelineno-16-45" name="__codelineno-16-45"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Travail terminé&quot;</span><span class="p">);</span>
<a id="__codelineno-16-46" name="__codelineno-16-46"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-47" name="__codelineno-16-47"></a>
<a id="__codelineno-16-48" name="__codelineno-16-48"></a><span class="w">    </span><span class="c1">// liste des produits</span>
<a id="__codelineno-16-49" name="__codelineno-16-49"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">select</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-50" name="__codelineno-16-50"></a><span class="p">...</span>
<a id="__codelineno-16-51" name="__codelineno-16-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-52" name="__codelineno-16-52"></a>
<a id="__codelineno-16-53" name="__codelineno-16-53"></a><span class="w">    </span><span class="c1">// suppression produits</span>
<a id="__codelineno-16-54" name="__codelineno-16-54"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-55" name="__codelineno-16-55"></a><span class="p">...</span>
<a id="__codelineno-16-56" name="__codelineno-16-56"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-57" name="__codelineno-16-57"></a>
<a id="__codelineno-16-58" name="__codelineno-16-58"></a><span class="w">    </span><span class="c1">// ajout produits</span>
<a id="__codelineno-16-59" name="__codelineno-16-59"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-60" name="__codelineno-16-60"></a><span class="p">...</span>
<a id="__codelineno-16-61" name="__codelineno-16-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-62" name="__codelineno-16-62"></a>
<a id="__codelineno-16-63" name="__codelineno-16-63"></a><span class="w">    </span><span class="c1">// ajout 2 produits</span>
<a id="__codelineno-16-64" name="__codelineno-16-64"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insert2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-65" name="__codelineno-16-65"></a><span class="p">...</span>
<a id="__codelineno-16-66" name="__codelineno-16-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-67" name="__codelineno-16-67"></a>
<a id="__codelineno-16-68" name="__codelineno-16-68"></a><span class="w">    </span><span class="c1">// mise à jour de certains produits</span>
<a id="__codelineno-16-69" name="__codelineno-16-69"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-70" name="__codelineno-16-70"></a><span class="p">..</span>
<a id="__codelineno-16-71" name="__codelineno-16-71"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-72" name="__codelineno-16-72"></a>
<a id="__codelineno-16-73" name="__codelineno-16-73"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFinally</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="p">,</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-74" name="__codelineno-16-74"></a><span class="w">        </span><span class="c1">// fermeture ResultSet</span>
<a id="__codelineno-16-75" name="__codelineno-16-75"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-76" name="__codelineno-16-76"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-77" name="__codelineno-16-77"></a><span class="w">                </span><span class="n">rs</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-16-78" name="__codelineno-16-78"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-79" name="__codelineno-16-79"></a>
<a id="__codelineno-16-80" name="__codelineno-16-80"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-16-81" name="__codelineno-16-81"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-82" name="__codelineno-16-82"></a><span class="w">        </span><span class="c1">// fermeture [PreparedStatement]</span>
<a id="__codelineno-16-83" name="__codelineno-16-83"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ps</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-84" name="__codelineno-16-84"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-85" name="__codelineno-16-85"></a><span class="w">                </span><span class="n">ps</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-16-86" name="__codelineno-16-86"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-87" name="__codelineno-16-87"></a>
<a id="__codelineno-16-88" name="__codelineno-16-88"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-16-89" name="__codelineno-16-89"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-90" name="__codelineno-16-90"></a><span class="w">        </span><span class="c1">// fermer la connexion</span>
<a id="__codelineno-16-91" name="__codelineno-16-91"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connexion</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-92" name="__codelineno-16-92"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-93" name="__codelineno-16-93"></a><span class="w">                </span><span class="n">connexion</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-16-94" name="__codelineno-16-94"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-95" name="__codelineno-16-95"></a><span class="w">                </span><span class="c1">// on affiche les msg d&#39;erreur</span>
<a id="__codelineno-16-96" name="__codelineno-16-96"></a><span class="w">                </span><span class="n">Static</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="s">&quot;Les erreurs suivantes se sont produites lors de la fermeture de la connexion&quot;</span><span class="p">,</span>
<a id="__codelineno-16-97" name="__codelineno-16-97"></a><span class="w">                        </span><span class="n">Static</span><span class="p">.</span><span class="na">getErreursFromThrowable</span><span class="p">(</span><span class="n">e3</span><span class="p">));</span>
<a id="__codelineno-16-98" name="__codelineno-16-98"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-16-99" name="__codelineno-16-99"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-100" name="__codelineno-16-100"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-101" name="__codelineno-16-101"></a>
<a id="__codelineno-16-102" name="__codelineno-16-102"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doCatchException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-103" name="__codelineno-16-103"></a><span class="w">        </span><span class="c1">// on affiche les msg d&#39;erreur</span>
<a id="__codelineno-16-104" name="__codelineno-16-104"></a><span class="w">        </span><span class="n">Static</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">Static</span><span class="p">.</span><span class="na">getErreursFromThrowable</span><span class="p">(</span><span class="n">th</span><span class="p">));</span>
<a id="__codelineno-16-105" name="__codelineno-16-105"></a><span class="w">        </span><span class="c1">// annulation transaction</span>
<a id="__codelineno-16-106" name="__codelineno-16-106"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-107" name="__codelineno-16-107"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connexion</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-108" name="__codelineno-16-108"></a><span class="w">                </span><span class="n">connexion</span><span class="p">.</span><span class="na">rollback</span><span class="p">();</span>
<a id="__codelineno-16-109" name="__codelineno-16-109"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-16-110" name="__codelineno-16-110"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-111" name="__codelineno-16-111"></a><span class="w">            </span><span class="c1">// on affiche les msg d&#39;erreur</span>
<a id="__codelineno-16-112" name="__codelineno-16-112"></a><span class="w">            </span><span class="n">Static</span><span class="p">.</span><span class="na">show</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">Static</span><span class="p">.</span><span class="na">getErreursFromThrowable</span><span class="p">(</span><span class="n">e2</span><span class="p">));</span>
<a id="__codelineno-16-113" name="__codelineno-16-113"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-114" name="__codelineno-16-114"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-115" name="__codelineno-16-115"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="647-suppression-du-contenu-de-la-table-des-produits">6.4.7. Suppression du contenu de la table des produits</h3>
<p>La méthode [delete] supprime le contenu de la table :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1">// suppression produits</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="kr">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="ow">delete</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">        </span><span class="nx">Connection</span><span class="w"> </span><span class="nx">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">        </span><span class="nx">PreparedStatement</span><span class="w"> </span><span class="nx">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">            </span><span class="c1">// ouverture connexion</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">            </span><span class="nx">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DriverManager</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">passwd</span><span class="p">);</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">            </span><span class="c1">// début transaction</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">            </span><span class="nx">connexion</span><span class="p">.</span><span class="nx">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">            </span><span class="c1">// on vide la table [PRODUITS]</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">            </span><span class="nx">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">connexion</span><span class="p">.</span><span class="nx">prepareStatement</span><span class="p">(</span><span class="ow">delete</span><span class="p">);</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">            </span><span class="nx">ps</span><span class="p">.</span><span class="nx">executeUpdate</span><span class="p">();</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">            </span><span class="c1">// commit transaction</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">            </span><span class="nx">connexion</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">            </span><span class="c1">// retour au mode par défaut</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">            </span><span class="nx">connexion</span><span class="p">.</span><span class="nx">setAutoCommit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">SQLException</span><span class="w"> </span><span class="nx">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">            </span><span class="c1">// on traite l&#39;exception</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">            </span><span class="nx">doCatchException</span><span class="p">(</span><span class="s2">&quot;Les erreurs suivantes se sont produites à la suppression du contenu de la table&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">connexion</span><span class="p">,</span><span class="w"> </span><span class="nx">e1</span><span class="p">);</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">            </span><span class="c1">// on traite le finally</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">            </span><span class="nx">doFinally</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="nx">connexion</span><span class="p">);</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Cet exemple utilise des transactions. Une transaction permet de regrouper des ordres SQL qui doivent être tous réussis ou tous annulés. Il y a quatre opérations à connaître :</p>
<ul>
<li>début d'une transaction : [<strong>connexion</strong><strong>.setAutoCommit(</strong><strong>false</strong><strong>)</strong>] ;</li>
<li>fin d'une transaction avec succès : [<strong>connexion</strong><strong>.commit()</strong>]. Dans ce cas, toutes les opérations faites sur la BD lors de la transaction sont validées ;</li>
<li>fin d'une transaction avec échec  : [<strong>connexion</strong><strong>.rollback()</strong>]. Dans ce cas, toutes les opérations faites sur la BD lors de la transaction sont annulées ;</li>
<li>retour au mode [auto-commit] qui est le mode par défaut de l'API JDBC : [<strong>connexion</strong><strong>.setAutoCommit(</strong><strong>true</strong><strong>)</strong>]. Dans ce mode, chaque ordre SQL fait l'objet d'une transaction. Ainsi si on fait deux insertions dont la deuxième échoue :</li>
<li>en mode [AutoCommit=true], la première insertion reste (elle a été validée par le 1er AutoCommit) ;</li>
<li>en mode [AutoCommit=false], la première insertion est annulée ;</li>
</ul>
<p>Dans nos exemples, à chaque fois que se produit une exception, nous annulons la transaction dans la méthode [doCatchException] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a>    private static void doCatchException(String title, Connection connexion, Throwable th) {
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>        // on affiche les msg d&#39;erreur
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>        Static.show(title, Static.getErreursFromThrowable(th));
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>        // annulation transaction
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>        try {
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>            if (connexion != null) {
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>                connexion.rollback();
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>            }
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>        } catch (SQLException e2) {
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>            // on affiche les msg d&#39;erreur
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>            Static.show(&quot;Erreur lors de l&#39;annulation de la transaction&quot;, Static.getErreursFromThrowable(e2));
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>        }
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>}
</code></pre></div></td></tr></table></div>
<h3 id="648-creation-du-contenu-de-la-table-des-produits">6.4.8. Création du contenu de la table des produits</h3>
<p>La méthode [insert] crée le contenu de la table :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a>// ajout produits
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>    public static void insert() {
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>        Connection connexion = null;
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>        PreparedStatement ps = null;
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>        try {
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>            // ouverture connexion
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>            connexion = DriverManager.getConnection(url, user, passwd);
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>            // début transaction
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>            connexion.setAutoCommit(false);
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>            // on remplit la table
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>            ps = connexion.prepareStatement(insert);
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>            for (int i = 0; i &lt; 10; i++) {
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>                // préparation
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>                int n = i + 1;
<a id="__codelineno-19-15" name="__codelineno-19-15"></a>                ps.setInt(1, n);
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>                ps.setString(2, String.format(&quot;NOM%s&quot;, n));
<a id="__codelineno-19-17" name="__codelineno-19-17"></a>                ps.setInt(3, n / 5 + 1);
<a id="__codelineno-19-18" name="__codelineno-19-18"></a>                ps.setDouble(4, 100 * (1 + (double) i / 100));
<a id="__codelineno-19-19" name="__codelineno-19-19"></a>                ps.setString(5, String.format(&quot;DESC%s&quot;, n));
<a id="__codelineno-19-20" name="__codelineno-19-20"></a>                // exécution
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>                ps.executeUpdate();
<a id="__codelineno-19-22" name="__codelineno-19-22"></a>            }
<a id="__codelineno-19-23" name="__codelineno-19-23"></a>            // commit transaction
<a id="__codelineno-19-24" name="__codelineno-19-24"></a>            connexion.commit();
<a id="__codelineno-19-25" name="__codelineno-19-25"></a>            // retour au mode par défaut
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>            connexion.setAutoCommit(true);
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>        } catch (SQLException e1) {
<a id="__codelineno-19-28" name="__codelineno-19-28"></a>            // on traite l&#39;exception
<a id="__codelineno-19-29" name="__codelineno-19-29"></a>            doCatchException(&quot;Les erreurs suivantes se sont produites à la création du contenu de la table&quot;, connexion, e1);
<a id="__codelineno-19-30" name="__codelineno-19-30"></a>        } finally {
<a id="__codelineno-19-31" name="__codelineno-19-31"></a>            // on traite le finally
<a id="__codelineno-19-32" name="__codelineno-19-32"></a>            doFinally(null, null, connexion);
<a id="__codelineno-19-33" name="__codelineno-19-33"></a>        }
<a id="__codelineno-19-34" name="__codelineno-19-34"></a>    }
</code></pre></div></td></tr></table></div>
<h3 id="649-affichage-du-contenu-de-la-table-des-produits">6.4.9. Affichage du contenu de la table des produits</h3>
<p>La méthode [select] affiche le contenu de la table :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="w">    </span><span class="c1">// liste des produits</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">select</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">        </span><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">        </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">            </span><span class="c1">// ouverture connexion</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">            </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">passwd</span><span class="p">);</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">            </span><span class="c1">// début transaction</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">            </span><span class="c1">// on lit la table [PRODUITS]</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">            </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connexion</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">select</span><span class="p">);</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">            </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Liste des produits : &quot;</span><span class="p">);</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">5</span><span class="p">)));</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="w">            </span><span class="c1">// commit transaction</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">            </span><span class="c1">// retour au mode par défaut</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">            </span><span class="c1">// on traite l&#39;exception</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="w">            </span><span class="n">doCatchException</span><span class="p">(</span><span class="s">&quot;Les erreurs suivantes se sont produites à la lecture de la table&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">connexion</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">);</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">            </span><span class="c1">// on traite le finally</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="w">            </span><span class="n">doFinally</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">connexion</span><span class="p">);</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="6410-mise-a-jour-du-contenu-de-la-table">6.4.10. Mise à jour du contenu de la table</h3>
<p>La méthode [update] met à jour certains produits :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>// mise à jour de certains produits
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>    public static void update() {
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>        Connection connexion = null;
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>        PreparedStatement ps = null;
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>        try {
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>            // ouverture connexion
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>            connexion = DriverManager.getConnection(url, user, passwd);
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>            // début transaction
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>            connexion.setAutoCommit(false);
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>            // on met à jour la table
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>            ps = connexion.prepareStatement(update);
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>            // catégorie 1
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>            ps.setInt(1, 1);
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>            // exécution
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>            ps.executeUpdate();
<a id="__codelineno-21-16" name="__codelineno-21-16"></a>            // commit transaction
<a id="__codelineno-21-17" name="__codelineno-21-17"></a>            connexion.commit();
<a id="__codelineno-21-18" name="__codelineno-21-18"></a>            // retour au mode par défaut
<a id="__codelineno-21-19" name="__codelineno-21-19"></a>            connexion.setAutoCommit(true);
<a id="__codelineno-21-20" name="__codelineno-21-20"></a>        } catch (SQLException e1) {
<a id="__codelineno-21-21" name="__codelineno-21-21"></a>            // on traite l&#39;exception
<a id="__codelineno-21-22" name="__codelineno-21-22"></a>            doCatchException(&quot;Les erreurs suivantes se sont produites à la mise à jour du contenu de la table&quot;, connexion, e1);
<a id="__codelineno-21-23" name="__codelineno-21-23"></a>        } finally {
<a id="__codelineno-21-24" name="__codelineno-21-24"></a>            // on traite le finally
<a id="__codelineno-21-25" name="__codelineno-21-25"></a>            doFinally(null, null, connexion);
<a id="__codelineno-21-26" name="__codelineno-21-26"></a>        }
<a id="__codelineno-21-27" name="__codelineno-21-27"></a>    }
</code></pre></div></td></tr></table></div>
<h3 id="6411-role-de-la-transaction">6.4.11. Rôle de la transaction</h3>
<p>La méthode [insert2] insère deux produits de même clé primaire dans la table, ce qui n'est pas possible. Comme on est dans une transaction, le première insertion va être annulée.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>// ajout de  2 produits de mêmes clés primaires
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>    public static void insert2() {
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>        Connection connexion = null;
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>        PreparedStatement ps = null;
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>        try {
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>            // ouverture connexion
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>            connexion = DriverManager.getConnection(url, user, passwd);
<a id="__codelineno-22-8" name="__codelineno-22-8"></a>            // début transaction
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>            connexion.setAutoCommit(false);
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>            // on ajoute 1 ligne
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>            ps = connexion.prepareStatement(insert2);
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>            // exécution
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>            ps.executeUpdate();
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>            // on ajoute la même ligne une 2ème fois donc avec la même clé primaire
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>            // l&#39;insertion doit échouer et aucun des deux éléments ne doit être inséré à cause de la transaction
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>            ps.executeUpdate();
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>            // commit transaction
<a id="__codelineno-22-18" name="__codelineno-22-18"></a>            connexion.commit();
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>            // retour au mode par défaut
<a id="__codelineno-22-20" name="__codelineno-22-20"></a>            connexion.setAutoCommit(true);
<a id="__codelineno-22-21" name="__codelineno-22-21"></a>        } catch (SQLException e1) {
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>            // on traite l&#39;exception
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>            doCatchException(&quot;Les erreurs suivantes se sont produites lors de l&#39;ajout&quot;, connexion, e1);
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>        } finally {
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>            // on traite le finally
<a id="__codelineno-22-26" name="__codelineno-22-26"></a>            doFinally(null, null, connexion);
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>        }
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>    }
</code></pre></div></td></tr></table></div>
<h3 id="6412-resultats">6.4.12. Résultats</h3>
<p>Les résultats de l'exécution de la méthode [main] donne les résultats suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>Liste des produits : 
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>{&quot;id&quot;:1,&quot;nom&quot;:&quot;NOM1&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:100.0,&quot;description&quot;:&quot;DESC1&quot;}
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>{&quot;id&quot;:2,&quot;nom&quot;:&quot;NOM2&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:101.0,&quot;description&quot;:&quot;DESC2&quot;}
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>{&quot;id&quot;:3,&quot;nom&quot;:&quot;NOM3&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:102.0,&quot;description&quot;:&quot;DESC3&quot;}
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>{&quot;id&quot;:4,&quot;nom&quot;:&quot;NOM4&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:103.0,&quot;description&quot;:&quot;DESC4&quot;}
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>{&quot;id&quot;:5,&quot;nom&quot;:&quot;NOM5&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:104.0,&quot;description&quot;:&quot;DESC5&quot;}
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>{&quot;id&quot;:6,&quot;nom&quot;:&quot;NOM6&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:105.0,&quot;description&quot;:&quot;DESC6&quot;}
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>{&quot;id&quot;:7,&quot;nom&quot;:&quot;NOM7&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:106.0,&quot;description&quot;:&quot;DESC7&quot;}
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>{&quot;id&quot;:8,&quot;nom&quot;:&quot;NOM8&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:107.0,&quot;description&quot;:&quot;DESC8&quot;}
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>{&quot;id&quot;:9,&quot;nom&quot;:&quot;NOM9&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:108.0,&quot;description&quot;:&quot;DESC9&quot;}
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>{&quot;id&quot;:10,&quot;nom&quot;:&quot;NOM10&quot;,&quot;categorie&quot;:3,&quot;prix&quot;:109.0,&quot;description&quot;:&quot;DESC10&quot;}
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>Liste des produits : 
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>{&quot;id&quot;:1,&quot;nom&quot;:&quot;NOM1&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;DESC1&quot;}
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>{&quot;id&quot;:2,&quot;nom&quot;:&quot;NOM2&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;DESC2&quot;}
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>{&quot;id&quot;:3,&quot;nom&quot;:&quot;NOM3&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;DESC3&quot;}
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>{&quot;id&quot;:4,&quot;nom&quot;:&quot;NOM4&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;DESC4&quot;}
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>{&quot;id&quot;:5,&quot;nom&quot;:&quot;NOM5&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:104.0,&quot;description&quot;:&quot;DESC5&quot;}
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>{&quot;id&quot;:6,&quot;nom&quot;:&quot;NOM6&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:105.0,&quot;description&quot;:&quot;DESC6&quot;}
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>{&quot;id&quot;:7,&quot;nom&quot;:&quot;NOM7&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:106.0,&quot;description&quot;:&quot;DESC7&quot;}
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>{&quot;id&quot;:8,&quot;nom&quot;:&quot;NOM8&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:107.0,&quot;description&quot;:&quot;DESC8&quot;}
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>{&quot;id&quot;:9,&quot;nom&quot;:&quot;NOM9&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:108.0,&quot;description&quot;:&quot;DESC9&quot;}
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>{&quot;id&quot;:10,&quot;nom&quot;:&quot;NOM10&quot;,&quot;categorie&quot;:3,&quot;prix&quot;:109.0,&quot;description&quot;:&quot;DESC10&quot;}
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>Les erreurs suivantes se sont produites lors de l&#39;ajout : 
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>- Duplicate entry &#39;100&#39; for key &#39;PRIMARY&#39;
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>Liste des produits : 
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>{&quot;id&quot;:1,&quot;nom&quot;:&quot;NOM1&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;DESC1&quot;}
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>{&quot;id&quot;:2,&quot;nom&quot;:&quot;NOM2&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;DESC2&quot;}
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>{&quot;id&quot;:3,&quot;nom&quot;:&quot;NOM3&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;DESC3&quot;}
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>{&quot;id&quot;:4,&quot;nom&quot;:&quot;NOM4&quot;,&quot;categorie&quot;:1,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;DESC4&quot;}
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>{&quot;id&quot;:5,&quot;nom&quot;:&quot;NOM5&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:104.0,&quot;description&quot;:&quot;DESC5&quot;}
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>{&quot;id&quot;:6,&quot;nom&quot;:&quot;NOM6&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:105.0,&quot;description&quot;:&quot;DESC6&quot;}
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>{&quot;id&quot;:7,&quot;nom&quot;:&quot;NOM7&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:106.0,&quot;description&quot;:&quot;DESC7&quot;}
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>{&quot;id&quot;:8,&quot;nom&quot;:&quot;NOM8&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:107.0,&quot;description&quot;:&quot;DESC8&quot;}
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>{&quot;id&quot;:9,&quot;nom&quot;:&quot;NOM9&quot;,&quot;categorie&quot;:2,&quot;prix&quot;:108.0,&quot;description&quot;:&quot;DESC9&quot;}
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>{&quot;id&quot;:10,&quot;nom&quot;:&quot;NOM10&quot;,&quot;categorie&quot;:3,&quot;prix&quot;:109.0,&quot;description&quot;:&quot;DESC10&quot;}
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>Travail terminé
</code></pre></div></td></tr></table></div>
<h2 id="65-utilisation-dune-source-de-donnees-de-type-datasource">6.5. Utilisation d'une source de données de type [DataSource]</h2>
<p>Nous allons reprendre l'application précédente en utilisant une source de données de type [javax.sql.DataSource] :</p>
<p><img src="images/100000000000036C0000025CA9CF067E.png" style="width:17.729cm;height:12.224cm;" alt="Image" /></p>
<p>Nous allons utiliser une source de données implémentée par la classe [org.apache.tomcat.jdbc.pool.DataSource]. Cette classe utilise un pool de connexions ç-à-d un ensemble de connexions ouvertes :</p>
<ul>
<li>lorsque le pool est instancié, un certain nombre de connexions est ouvert avec la base de données. Ce nombre est configurable ;</li>
<li>lorsque le code Java ouvre une connexion, celle-ci est fournie par le pool ;</li>
<li>lorsque le code Java ferme une connexion, celle-ci est rendue au pool ;</li>
</ul>
<p>Au final, les connexions ne sont ouvertes qu'une fois, ce qui améliore la performance d'accès à la base de données. La source de données sera définie dans une classe de configuration Spring</p>
<h3 id="651-le-projet-eclipse">6.5.1. Le projet Eclipse</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D30000010D4DBC1498.png" style="display:inline-block; margin:4px;width:3.911cm;height:4.979cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le projet est un projet Maven défini par le fichier [pom.xml] suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>    &lt;groupId&gt;istia.st.jdbc&lt;/groupId&gt;
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>    &lt;artifactId&gt;intro-jdbc-02&lt;/artifactId&gt;
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>    &lt;dependencies&gt;
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>        &lt;!-- MySQL --&gt;
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>        &lt;dependency&gt;
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>            &lt;groupId&gt;mysql&lt;/groupId&gt;
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>            &lt;version&gt;5.1.34&lt;/version&gt;
<a id="__codelineno-24-13" name="__codelineno-24-13"></a>        &lt;/dependency&gt;
<a id="__codelineno-24-14" name="__codelineno-24-14"></a>        &lt;!-- bibliothèque jSON --&gt;
<a id="__codelineno-24-15" name="__codelineno-24-15"></a>        &lt;dependency&gt;
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>            &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
<a id="__codelineno-24-18" name="__codelineno-24-18"></a>            &lt;version&gt;2.5.1&lt;/version&gt;
<a id="__codelineno-24-19" name="__codelineno-24-19"></a>        &lt;/dependency&gt;
<a id="__codelineno-24-20" name="__codelineno-24-20"></a>        &lt;!-- Spring --&gt;
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>        &lt;dependency&gt;
<a id="__codelineno-24-22" name="__codelineno-24-22"></a>            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<a id="__codelineno-24-23" name="__codelineno-24-23"></a>            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
<a id="__codelineno-24-24" name="__codelineno-24-24"></a>            &lt;version&gt;4.1.3.RELEASE&lt;/version&gt;
<a id="__codelineno-24-25" name="__codelineno-24-25"></a>        &lt;/dependency&gt;
<a id="__codelineno-24-26" name="__codelineno-24-26"></a>        &lt;!-- Tomcat Jdbc --&gt;
<a id="__codelineno-24-27" name="__codelineno-24-27"></a>        &lt;dependency&gt;
<a id="__codelineno-24-28" name="__codelineno-24-28"></a>            &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
<a id="__codelineno-24-29" name="__codelineno-24-29"></a>            &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;
<a id="__codelineno-24-30" name="__codelineno-24-30"></a>            &lt;version&gt;8.0.20&lt;/version&gt;
<a id="__codelineno-24-31" name="__codelineno-24-31"></a>        &lt;/dependency&gt;
<a id="__codelineno-24-32" name="__codelineno-24-32"></a>    &lt;/dependencies&gt;
<a id="__codelineno-24-33" name="__codelineno-24-33"></a>&lt;/project&gt;
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 21-25 : dépendance sur Spring ;</li>
<li>lignes 27-31 : dépendance sur la bibliothèque qui fournit la source de données ;</li>
</ul>
<p>La classe de configuration de Spring [AppConfig] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span>
<span class="normal"><a href="#__codelineno-25-29">29</a></span>
<span class="normal"><a href="#__codelineno-25-30">30</a></span>
<span class="normal"><a href="#__codelineno-25-31">31</a></span>
<span class="normal"><a href="#__codelineno-25-32">32</a></span>
<span class="normal"><a href="#__codelineno-25-33">33</a></span>
<span class="normal"><a href="#__codelineno-25-34">34</a></span>
<span class="normal"><a href="#__codelineno-25-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">package</span><span class="w"> </span><span class="n">istia</span><span class="p">.</span><span class="n">st</span><span class="p">.</span><span class="n">jdbc</span><span class="p">;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">import</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">tomcat</span><span class="p">.</span><span class="n">jdbc</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="n">DataSource</span><span class="p">;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="n">import</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Bean</span><span class="p">;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">import</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="n">springframework</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">Configuration</span><span class="p">;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="o">@</span><span class="n">Configuration</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">AppConfig</span><span class="w"> </span><span class="err">{</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">constantes</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;jdbc:mysql://localhost:3306/dbIntroJdbc&quot;</span><span class="p">;</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;root&quot;</span><span class="p">;</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PASSWD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;INSERT INTO PRODUITS(ID, NOM, CATEGORIE, PRIX, DESCRIPTION) VALUES (?, ?, ?, ?, ?)&quot;</span><span class="p">;</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;DELETE FROM PRODUITS&quot;</span><span class="p">;</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;SELECT ID, NOM, CATEGORIE, PRIX, DESCRIPTION FROM PRODUITS&quot;</span><span class="p">;</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;UPDATE PRODUITS SET PRIX=PRIX*1.1 WHERE CATEGORIE=?&quot;</span><span class="p">;</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">INSERT2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;INSERT INTO PRODUITS(ID, NOM, CATEGORIE, PRIX, DESCRIPTION) VALUES (100,&#39;X&#39;,1,1,&#39;x&#39;)&quot;</span><span class="p">;</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="w">    </span><span class="k">final</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DRIVER_CLASSNAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">;</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="w">    </span><span class="o">@</span><span class="n">Bean</span>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">données</span><span class="w"> </span><span class="n">TomcatJdbc</span>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="w">        </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataSource</span><span class="p">();</span>
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">accès</span><span class="w"> </span><span class="n">JDBC</span>
<a id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="w">        </span><span class="n">dataSource</span><span class="p">.</span><span class="n">setDriverClassName</span><span class="p">(</span><span class="n">DRIVER_CLASSNAME</span><span class="p">);</span>
<a id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="w">        </span><span class="n">dataSource</span><span class="p">.</span><span class="n">setUsername</span><span class="p">(</span><span class="k">USER</span><span class="p">);</span>
<a id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="w">        </span><span class="n">dataSource</span><span class="p">.</span><span class="n">setPassword</span><span class="p">(</span><span class="n">PASSWD</span><span class="p">);</span>
<a id="__codelineno-25-29" name="__codelineno-25-29"></a><span class="w">        </span><span class="n">dataSource</span><span class="p">.</span><span class="n">setUrl</span><span class="p">(</span><span class="n">URL</span><span class="p">);</span>
<a id="__codelineno-25-30" name="__codelineno-25-30"></a><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">une</span><span class="w"> </span><span class="n">connexion</span><span class="w"> </span><span class="n">ouverte</span><span class="w"> </span><span class="n">initialement</span>
<a id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="w">        </span><span class="n">dataSource</span><span class="p">.</span><span class="n">setInitialSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-25-32" name="__codelineno-25-32"></a><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">résultat</span>
<a id="__codelineno-25-33" name="__codelineno-25-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<a id="__codelineno-25-34" name="__codelineno-25-34"></a><span class="w">    </span><span class="err">}</span>
<a id="__codelineno-25-35" name="__codelineno-25-35"></a><span class="err">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 11-19 : les constantes précédemment définies dans [IntroJdbc01] ont migré dans [AppConfig] ;</li>
<li>lignes 31-34 : le bean Spring définissant la source de données ;</li>
<li>ligne 24 : création de la source de données encore non configurée ;</li>
<li>lignes 26-29 : les informations qui permettent à la source de données de se connecter à la base de données ;</li>
<li>ligne 31 ; crée un pool de 1 connexion. On n'en a pas besoin de plus ici. Il n'y a jamais plusieurs connexions simultanées ;</li>
</ul>
<h3 id="652-la-classe-principale">6.5.2. La classe principale</h3>
<p>La classe principale [IntroJdbc02] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span>
<span class="normal"><a href="#__codelineno-26-33">33</a></span>
<span class="normal"><a href="#__codelineno-26-34">34</a></span>
<span class="normal"><a href="#__codelineno-26-35">35</a></span>
<span class="normal"><a href="#__codelineno-26-36">36</a></span>
<span class="normal"><a href="#__codelineno-26-37">37</a></span>
<span class="normal"><a href="#__codelineno-26-38">38</a></span>
<span class="normal"><a href="#__codelineno-26-39">39</a></span>
<span class="normal"><a href="#__codelineno-26-40">40</a></span>
<span class="normal"><a href="#__codelineno-26-41">41</a></span>
<span class="normal"><a href="#__codelineno-26-42">42</a></span>
<span class="normal"><a href="#__codelineno-26-43">43</a></span>
<span class="normal"><a href="#__codelineno-26-44">44</a></span>
<span class="normal"><a href="#__codelineno-26-45">45</a></span>
<span class="normal"><a href="#__codelineno-26-46">46</a></span>
<span class="normal"><a href="#__codelineno-26-47">47</a></span>
<span class="normal"><a href="#__codelineno-26-48">48</a></span>
<span class="normal"><a href="#__codelineno-26-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">istia.st.jdbc</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Connection</span><span class="p">;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.PreparedStatement</span><span class="p">;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.ResultSet</span><span class="p">;</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.SQLException</span><span class="p">;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.sql.DataSource</span><span class="p">;</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">IntroJdbc02</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">    </span><span class="c1">// source de données</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">        </span><span class="c1">// récupération du contexte Spring</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">        </span><span class="n">AnnotationConfigApplicationContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="w">        </span><span class="c1">// récupération de la source de données</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="w">        </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">DataSource</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="w">        </span><span class="c1">// on vide la table [PRODUITS]</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="w">        </span><span class="n">delete</span><span class="p">();</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="p">...</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="w">        </span><span class="c1">// fini</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Travail terminé&quot;</span><span class="p">);</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a><span class="w">    </span><span class="c1">// liste des produits</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">select</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-31" name="__codelineno-26-31"></a><span class="w">        </span><span class="n">Connection</span><span class="w"> </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-26-32" name="__codelineno-26-32"></a><span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-26-33" name="__codelineno-26-33"></a><span class="w">        </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-26-34" name="__codelineno-26-34"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-35" name="__codelineno-26-35"></a><span class="w">            </span><span class="c1">// ouverture connexion</span>
<a id="__codelineno-26-36" name="__codelineno-26-36"></a><span class="w">            </span><span class="n">connexion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getConnection</span><span class="p">();</span>
<a id="__codelineno-26-37" name="__codelineno-26-37"></a><span class="w">            </span><span class="c1">// début transaction</span>
<a id="__codelineno-26-38" name="__codelineno-26-38"></a><span class="w">            </span><span class="n">connexion</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-26-39" name="__codelineno-26-39"></a><span class="p">...</span>
<a id="__codelineno-26-40" name="__codelineno-26-40"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-41" name="__codelineno-26-41"></a><span class="w">            </span><span class="c1">// on traite l&#39;exception</span>
<a id="__codelineno-26-42" name="__codelineno-26-42"></a><span class="w">            </span><span class="n">doCatchException</span><span class="p">(</span><span class="s">&quot;Les erreurs suivantes se sont produites à la lecture de la table&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">connexion</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">);</span>
<a id="__codelineno-26-43" name="__codelineno-26-43"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-44" name="__codelineno-26-44"></a><span class="w">            </span><span class="c1">// on traite le finally</span>
<a id="__codelineno-26-45" name="__codelineno-26-45"></a><span class="w">            </span><span class="n">doFinally</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">connexion</span><span class="p">);</span>
<a id="__codelineno-26-46" name="__codelineno-26-46"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-26-47" name="__codelineno-26-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-26-48" name="__codelineno-26-48"></a><span class="p">...</span>
<a id="__codelineno-26-49" name="__codelineno-26-49"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 14 : la source de données. On notera qu'elle est de type [javax.sql.DataSource] qui est une interface ;</li>
<li>ligne 18 : instanciation des objets Spring ;</li>
<li>ligne 20 : obtention d'une référence sur la source de données. On notera qu'à aucun moment on ne cite la classe réellement utilisée. Ainsi ici, rien ne laisse supposer qu'on utilise une implémentation [TomcatJdbc] ;</li>
<li>ligne 36 : obtention d'une connexion ouverte ;</li>
<li>le reste du code est identique à celui de la classe [IntroJdbc01] ;</li>
</ul>
<h2 id="66-conclusion">6.6. Conclusion</h2>
<p>On trouvera davantage d'informations sur la gestion des bases de données dans le document [<a href="http://tahe.developpez.com/tutoriels-cours/spring/spring-data-jpa/serge-tahe-spring-data-jpa-jdbc-mvc-rest-security-cors/"><u>Exploiter une base relationnelle avec l'écosystème Spring</u></a>].</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "navigation.expand", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>