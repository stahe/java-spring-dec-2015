
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/java-spring-dec-2015/cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data.html">
      
      
        <link rel="prev" href="td-implementation-de-la-couche-ui-avec-une-interface-swing.html">
      
      
        <link rel="next" href="td-implementation-de-la-couche-dao-du-td-avec-spring-data.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>11. [Cours] : Gestion des bases de données relationnelles avec Spring Data - Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#11-cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-header__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              11. [Cours] : Gestion des bases de données relationnelles avec Spring Data
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Java et à l&#39;écosystème Spring au travers d&#39;une étude de cas" class="md-nav__button md-logo" aria-label="Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Java et à l'écosystème Spring au travers d'une étude de cas
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/java-spring-dec-2015" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-le-probleme.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. [TD] : Le problème
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-classes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. [TD] : Classes
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-architectures-en-couches.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. [TD] : Architectures en couches
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-au-framework-spring.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. [Cours] : Introduction au framework Spring
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-introduction-a-lapi-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. [Cours] : Introduction à l'API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-lapi-jdbc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. [TD] : Implémentation de la couche [DAO] du TD avec l'API JDBC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. [TD] : La couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-un-programme-console.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. [TD] : Implémentation de la couche [ui] avec un programme console
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-ui-avec-une-interface-swing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. [TD] : Implémentation de la couche [ui] avec une interface Swing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    11. [Cours] : Gestion des bases de données relationnelles avec Spring Data
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    11. [Cours] : Gestion des bases de données relationnelles avec Spring Data
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#111-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1. Support
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#112-exemple-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2. Exemple 1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2. Exemple 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121-la-configuration-maven-du-projet" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.1. La configuration Maven du projet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1122-la-couche-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.2. La couche [JPA]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1123-la-couche-spring-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.3. La couche [Spring Data]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1124-la-couche-console" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.4. La couche [console]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1125-configuration-manuelle-du-projet-spring-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.5. Configuration manuelle du projet Spring Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1126-creation-dune-archive-executable" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.2.6. Création d'une archive exécutable
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#113-exemple-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3. Exemple 2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3. Exemple 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1131-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1132-creation-du-projet-maven" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.2. Création du projet Maven
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1133-le-projet-eclipse" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.3. Le projet Eclipse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1134-configuration-maven" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.4. Configuration Maven
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1135-les-entites-de-la-couche-jpa" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.5. Les entités de la couche [JPA]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3.5. Les entités de la couche [JPA]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11351-la-classe-abstractentity" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.5.1. La classe [AbstractEntity]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11352-lentite-jpa-produit" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.5.2. L'entité JPA [Produit]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11353-lentite-jpa-categorie" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.5.3. L'entité JPA [Categorie]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1136-la-couche-spring-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.6. La couche [Spring Data]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1137-la-couche-dao" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.7. La couche [DAO]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1138-configuration-du-projet-spring" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.8. Configuration du projet Spring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1139-la-couche-console" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.9. La couche [console]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11310-le-test-unitaire-junit" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.10. Le test unitaire JUnit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11311-gestion-des-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.11. Gestion des logs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11312-generation-de-larchive-maven-du-projet" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.3.12. Génération de l'archive Maven du projet
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-implementation-de-la-couche-dao-du-td-avec-spring-data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. [TD] : Implémentation de la couche [DAO] du TD avec [Spring Data]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-exposer-une-base-de-donnees-sur-le-web-avec-spring-mvc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. [Cours] : Exposer une base de données sur le web avec Spring MVC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-exposition-sur-le-web-de-la-couche-metier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. [TD] : Exposition sur le web de la couche [metier]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-creation-dun-client-pour-le-service-web.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. [TD] : création d'un client pour le service web
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-securiser-lacces-a-un-service-web-avec-spring-security.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. [Cours] : Sécuriser l'accès à un service web avec Spring Security
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-securisation-du-serveur-web--json-des-elections.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. [TD] : sécurisation du serveur web / jSON des élections
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="cours-gestion-des-acces-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. [Cours] : Gestion des accès inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="td-elections-avec-des-requetes-inter-domaines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. [TD] Elections avec des requêtes inter-domaines
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="programmation-asynchrone-avec-rxjava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Programmation asynchrone avec RxJava
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="annexes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Annexes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="11-cours-gestion-des-bases-de-donnees-relationnelles-avec-spring-data">11. [Cours] : Gestion des bases de données relationnelles avec Spring Data</h1>
<p><strong>Mots clés</strong> : architecture multicouche, Spring, injection de dépendances, API JPA (Java Persistence API), Spring Data.</p>
<p>Nous allons implémenter la couche [DAO] du TD avec [Spring Data], une branche de l'écosystème Spring. [Spring Data] s'appuie sur une couche JPA (Java Persistence API) qui permet à la couche [DAO] de manipuler des objets plutôt que des ordres SQL. Au final, la couche [DAO] ignore qu'elle dialogue avec une base de données. Elle ne connaît que l'interface de la couche [Spring Data].</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004960000011254B543CA.png" style="display:inline-block; margin:4px;width:15.531cm;height:3.625cm;" /></td></tr></table>

<p>Nous allons d'abord découvrir [Spring Data] sur deux exemples.</p>
<h2 id="111-support">11.1. Support</h2>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000037F0000011E3930C6BE.png" style="display:inline-block; margin:4px;width:11.841cm;height:3.784cm;" /></td></tr></table>

<ul>
<li>en [1], le dossier [support / chap-11] contient trois projets Eclipse ;</li>
<li>en [2], le script SQL permettant de créer la base de données exemple de ce chapitre ;</li>
</ul>
<h2 id="112-exemple-1">11.2. Exemple 1</h2>
<p>Sur le site de Spring existent de nombreux tutoriels pour démarrer avec Spring [<a href="http://spring.io/guides"><u>http://spring.io/guides</u></a>]. Nous allons utiliser l'un d'eux pour introduire Spring Data. Nous utilisons pour cela Spring Tool Suite (STS).</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000003D20000015DA19B7E0B.png" style="display:inline-block; margin:4px;width:12.938cm;height:4.618cm;" /></td></tr></table>

<ul>
<li>en [1], nous importons l'un des tutoriels de [spring.io/guides] ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005340000032B0ABEBB8F.png" style="display:inline-block; margin:4px;width:17.621cm;height:10.73cm;" /></td></tr></table>

<ul>
<li>en [2], on choisit le tutoriel [Accessing Data Jpa] qui montre comment accéder à une base de données avec Spring Data ;</li>
<li>en [3], on choisit un projet configuré par Maven ;</li>
<li>en [4], le tutoriel peut être délivré sous deux formes : [initial] qui est une version vide qu'on remplit en suivant le tutoriel ou [complete] qui est la version finale du tutoriel. Nous choisissons cette dernière ;</li>
<li>en [5], on peut choisir de visualiser le tutoriel dans un navigateur ;</li>
<li>en [6], le projet final.</li>
</ul>
<h3 id="1121-la-configuration-maven-du-projet">11.2.1. La configuration Maven du projet</h3>
<p>Les dépendances Maven du projet sont configurées dans le fichier [pom.xml] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    &lt;artifactId&gt;gs-accessing-data-jpa&lt;/artifactId&gt;
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    &lt;version&gt;0.1.0&lt;/version&gt;
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    &lt;parent&gt;
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        &lt;version&gt;1.1.10.RELEASE&lt;/version&gt;
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    &lt;/parent&gt;
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    &lt;dependencies&gt;
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        &lt;dependency&gt;
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        &lt;/dependency&gt;
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>        &lt;dependency&gt;
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>            &lt;artifactId&gt;h2&lt;/artifactId&gt;
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>        &lt;/dependency&gt;
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    &lt;/dependencies&gt;
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    &lt;properties&gt;
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        &lt;!-- use UTF-8 for everything --&gt;
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        &lt;start-class&gt;hello.Application&lt;/start-class&gt;
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>&lt;/properties&gt;
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 5-9 : définissent un projet Maven parent. C'est lui qui définit l'essentiel des dépendances du projet. Elles peuvent être suffisantes, auquel cas on n'en rajoute pas, ou pas, auquel cas on rajoute les dépendances manquantes ;</li>
<li>lignes 12-15 : définissent une dépendance sur [spring-boot-starter-data-jpa]. Cet artifact contient les classes de Spring Data ;</li>
<li>lignes 16-19 : définissent une dépendance sur le SGBD H2 qui permet de créer et gérer des bases de données en mémoire.</li>
</ul>
<p>Regardons les classes amenées par ces dépendances :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000014F00000173C684B02E.png" style="display:inline-block; margin:4px;width:5.609cm;height:6.071cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F70000010C4CA71FE9.png" style="display:inline-block; margin:4px;width:4.57cm;height:4.96cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000114000000BD1D144A05.png" style="display:inline-block; margin:4px;width:5.11cm;height:3.5cm;" /></td></tr></table>

<p>Elles sont très nombreuses :</p>
<ul>
<li>certaines appartiennent à l'écosystème Spring (celles commençant par spring) ;</li>
<li>d'autres appartiennent à l'écosystème Hibernate (hibernate, jboss) dont on utilise ici l'implémentation JPA ;</li>
<li>d'autres sont des bibliothèques de tests (junit, hamcrest) ;</li>
<li>d'autres des bibliothèques de logs (log4j, logback, slf4j) ;</li>
</ul>
<p>Nous allons les garder toutes. Pour une application en production, il faudrait ne garder que celles qui sont nécessaires.</p>
<p>Ligne 26 du fichier [pom.xml] on trouve la ligne :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>&lt;start-class&gt;hello.Application&lt;/start-class&gt;
</code></pre></div></td></tr></table></div>
<p>Cette ligne est liée aux lignes suivantes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>&lt;build&gt;
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>        &lt;plugins&gt;
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>            &lt;plugin&gt; 
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>            &lt;/plugin&gt;
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>            &lt;plugin&gt;
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>            &lt;/plugin&gt;
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>        &lt;/plugins&gt;
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>    &lt;/build&gt;
</code></pre></div></td></tr></table></div>
<p>Lignes 6-9, le plugin [spring-boot-maven-plugin] permet de générer le jar exécutable de l'application. La ligne 26 du fichier [pom.xml] désigne alors la classe exécutable de ce jar.</p>
<h3 id="1122-la-couche-jpa">11.2.2. La couche [JPA]</h3>
<p>L'accès à la base de données se fait au travers d'une couche [JPA], Java Persistence API :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004A20000011020A14249.png" style="display:inline-block; margin:4px;width:15.69cm;height:3.598cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000EB00000077D50ECFCE.png" style="display:inline-block; margin:4px;width:4.35cm;height:2.2cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>L'application est basique et gère des clients [Customer]. La classe [Customer] fait partie de la couche [JPA] et est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">package</span> <span class="n">hello</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Id</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="nd">@Entity</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">Customer</span> <span class="p">{</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="nd">@Id</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="n">AUTO</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="n">private</span> <span class="n">long</span> <span class="nb">id</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>    <span class="n">private</span> <span class="n">String</span> <span class="n">firstName</span><span class="p">;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>    <span class="n">private</span> <span class="n">String</span> <span class="n">lastName</span><span class="p">;</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="n">protected</span> <span class="n">Customer</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>    <span class="p">}</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a>    <span class="n">public</span> <span class="n">Customer</span><span class="p">(</span><span class="n">String</span> <span class="n">firstName</span><span class="p">,</span> <span class="n">String</span> <span class="n">lastName</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a>        <span class="n">this</span><span class="o">.</span><span class="n">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="p">;</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a>        <span class="n">this</span><span class="o">.</span><span class="n">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="p">;</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a>    <span class="p">}</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a>    <span class="nd">@Override</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a>    <span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a>        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Customer[id=</span><span class="si">%d</span><span class="s2">, firstName=&#39;</span><span class="si">%s</span><span class="s2">&#39;, lastName=&#39;</span><span class="si">%s</span><span class="s2">&#39;]&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">firstName</span><span class="p">,</span> <span class="n">lastName</span><span class="p">);</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a>    <span class="p">}</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Un client a un identifiant [id], un prénom [firstName] et un nom [lastName]. Chaque instance [Customer] représente une ligne d'une table de la base de données.</p>
<ul>
<li>ligne 8 : annotation JPA qui fait que la persistence des instances [Customer] (Create, Read, Update, Delete) va être gérée par une implémentation JPA. D'après les dépendances Maven, on voit que c'est l'implémentation JPA / Hibernate qui est utilisée ;</li>
<li>lignes 11-12 : annotations JPA qui associent le champ [id] à la clé primaire de la table des [Customer]. La ligne 12, indique que l'implémentation JPA utilisera la méthode de génération de clé primaire propre au SGBD utilisé, ici H2 ;</li>
</ul>
<p>Il n'y a pas d'autres annotations JPA. Des valeurs par défaut seront alors utilisées :</p>
<ul>
<li>la table des [Customer] portera le nom de la classe, ç-à-d [Customer] ;</li>
<li>les colonnes de cette table porteront le nom des champs de la classe : [id, firstName, lastName] sachant que la casse n'est pas prise en compte dans le nom d'une colonne de table ;</li>
</ul>
<p>On notera qu'à aucun moment, l'implémentation JPA utilisée n'est nommée.</p>
<h3 id="1123-la-couche-spring-data">11.2.3. La couche [Spring Data]</h3>
<p>La classe [CustomerRepository] implémente la couche d'accès à la table [Customer]. Son code est le suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004A1000001188C053E0A.png" style="display:inline-block; margin:4px;width:15.677cm;height:3.704cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000EB00000077BA57F747.png" style="display:inline-block; margin:4px;width:4.35cm;height:2.2cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CustomerRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByLastName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">);</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>C'est donc une interface et non une classe (ligne 7). Elle étend l'interface [CrudRepository], une interface de Spring Data (ligne 5). Cette interface est paramétrée par deux types : le premier est le type des éléments gérés, ici le type [Customer], le second le type de la clé primaire des éléments gérés, ici un type [Long]. L'interface [CrudRepository] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">org.springframework.data.repository</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="nd">@NoRepositoryBean</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Serializable</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Repository</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">S</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">S</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entities</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">    </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">);</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="nf">count</span><span class="p">();</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">entity</span><span class="p">);</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entities</span><span class="p">);</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAll</span><span class="p">();</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Cette interface définit les opérations CRUD (Create – Read – Update – Delete) qu'on peut faire sur un type JPA T :</p>
<ul>
<li>ligne 8 : la méthode <strong>save</strong> permet de <strong>persister</strong> une entité T en base. Elle rend l'entité persistée avec la clé primaire que lui a donnée le SGBD. Elle permet également de <strong>mettre à jour</strong> une entité T identifiée par sa clé primaire id. Le choix de l'une ou l'autre action se fait selon la valeur de la clé primaire id : si celle-ci vaut <strong>null</strong> c'est l'opération de persistence qui a lieu, sinon c'est l'opération de mise à jour ;</li>
<li>ligne 10 : idem mais pour une liste d'entités ;</li>
<li>ligne 12 : la méthode <strong>findOne</strong> permet de retrouver une entité T identifiée par sa clé primaire id ;</li>
<li>ligne 22 : la méthode <strong>delete</strong> permet de supprimer une entité T identifiée par sa clé primaire id ;</li>
<li>lignes 24-28 : des variantes de la méthode [delete] ;</li>
<li>ligne 16 : la méthode [findAll] permet de retrouver toutes les entités persistées T ;</li>
<li>ligne 18 : idem mais limitées aux entités dont on a passé la liste des identifiants ;</li>
</ul>
<p>Revenons à l'interface [CustomerRepository] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">CustomerRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByLastName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">);</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>la ligne 9 permet de retrouver un [Customer] par son nom [lastName] ;</li>
</ul>
<p>Et c'est tout pour la couche [DAO]. Il n'y a pas de classe d'implémentation de l'interface précédente. Celle-ci est générée à l'exécution par [Spring Data]. Les méthodes de l'interface [CrudRepository] sont automatiquement implémentées. Pour les méthodes rajoutées dans l'interface [CustomerRepository], ça dépend. Revenons à la définition de [Customer] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>private long id;
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>private String firstName;
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>private String lastName;
</code></pre></div></td></tr></table></div>
<p>La méthode de la ligne 9 est implémentée automatiquement par [Spring Data] parce qu'elle référence le champ [lastName] (ligne 3) de [Customer]. Lorsqu'il rencontre une méthode [findBySomething] dans l'interface à implémenter, Spring Data l'implémente par la requête JPQL (Java Persistence Query Language) suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>select t from T t where t.something=:value
</code></pre></div></td></tr></table></div>
<p>Il faut donc que le type T ait un champ nommé [something]. Ainsi la méthode</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>List&lt;Customer&gt; findByLastName(String lastName);
</code></pre></div></td></tr></table></div>
<p>va être implémentée par un code ressemblant au suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>return [em].createQuery(&quot;select c from Customer c where  c.lastName=:value&quot;).setParameter(&quot;value&quot;,lastName).getResultList()
</code></pre></div></td></tr></table></div>
<p>où [em] désigne le contexte de persistance JPA. Cela n'est possible que si la classe [Customer] a un champ nommé [lastName], ce qui est le cas.</p>
<p>En conclusion, dans les cas simples, Spring Data nous permet d'implémenter la couche [DAO] avec une simple interface.</p>
<h3 id="1124-la-couche-console">11.2.4. La couche [console]</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000004980000010700ABFB59.png" style="display:inline-block; margin:4px;width:15.558cm;height:3.48cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000EB00000077E52D8FD9.png" style="display:inline-block; margin:4px;width:4.35cm;height:2.2cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [Application] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">hello</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.CommandLineRunner</span><span class="p">;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="nd">@SpringBootApplication</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Application</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">CommandLineRunner</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">    </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="n">repository</span><span class="p">;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">String</span><span class="p">...</span><span class="w"> </span><span class="n">strings</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="w">        </span><span class="c1">// save a couple of customers</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bauer&quot;</span><span class="p">));</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Chloe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;O&#39;Brian&quot;</span><span class="p">));</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Kim&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bauer&quot;</span><span class="p">));</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;David&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Palmer&quot;</span><span class="p">));</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Michelle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dessler&quot;</span><span class="p">));</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="w">        </span><span class="c1">// fetch all customers</span>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Customers found with findAll():&quot;</span><span class="p">);</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;-------------------------------&quot;</span><span class="p">);</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findAll</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="w">        </span><span class="c1">// fetch an individual customer by ID</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a><span class="w">        </span><span class="n">Customer</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Customer found with findOne(1L):&quot;</span><span class="p">);</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;--------------------------------&quot;</span><span class="p">);</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">customer</span><span class="p">);</span>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a><span class="w">        </span><span class="c1">// fetch customers by last name</span>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Customer found with findByLastName(&#39;Bauer&#39;):&quot;</span><span class="p">);</span>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;--------------------------------------------&quot;</span><span class="p">);</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">bauer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">repository</span><span class="p">.</span><span class="na">findByLastName</span><span class="p">(</span><span class="s">&quot;Bauer&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-46" name="__codelineno-11-46"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">bauer</span><span class="p">);</span>
<a id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-49" name="__codelineno-11-49"></a>
<a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : la classe implémente l'interface [CommandLineRunner] qui est une interface [Spring Boot] (ligne 4). Cette interfae n'a qu'une méthode, celle de la ligne 19 ;</li>
<li>ligne 8 : @<strong>SpringBootApplication</strong> est une annotation regroupant plusieurs annotations [Spring Boot] :</li>
<li>@<strong>Configuration</strong> : indique que la classe est une classe de configuration ;</li>
<li>@<strong>EnableAutoConfiguration</strong> : demande à [Spring Boot] de créer lui-même un certain nombre de beans en fonction de diverses propriétés, en particulier le contenu du Classpath du projet. Parce que les bibliothèques Hibernate sont dans le Classpath, le bean [entityManagerFactory] sera implémenté avec Hibernate. Parce que la bibliothèque du SGBD H2 est dans le Classpath, le bean [dataSource] sera implémenté avec H2. Dans le bean [dataSource], on doit définir également l'utilisateur et son mot de passe. Ici Spring Boot utilisera l'administrateur par défaut de H2, <strong>sa</strong> sans mot de passe. Parce que la bibliothèque [spring-tx] est dans le Classpath, c'est le gestionnaire de transactions de Spring qui sera utilisé ;</li>
<li>@<strong>EnableWebMvc</strong> : si dans le Classpath se trouve la bibliothèque [spring-mvc]. Dans ce cas, une auto-configuration est faite pour l'application web ;</li>
<li>@<strong>ComponentScan</strong> : qui dit à Spring où chercher les autres beans, configurations et services. Ici ils sont cherchés par défaut dans le package contenant la classe taguée, ç-à-d le package [hello]. Ainsi les classes [Customer] et [CustomerRepository] vont-elles être trouvées. Parce que la première a l'annotation [@Entity] elle sera cataloguée comme entité à gérer par Hibernate. Parce que la seconde étend l'interface [CrudRepository] elle sera enregistrée comme bean Spring ;</li>
<li>lignes 11-12 : le bean [CustomerRepository] est injecté dans le code de la classe principale ;</li>
<li>ligne 15 : la méthode statique [run] de la classe [SpringApplication] du projet Spring Boot est exécutée. Son paramètre est la classe qui a une annotation [Configuration] ou [EnableAutoConfiguration]. Tout ce qui a été expliqué précédemment va alors se dérouler. Le résultat est un contexte d'application Spring, ç-à-d un ensemble de beans gérés par Spring ;</li>
</ul>
<p>Les opérations qui suivent ne font qu'utiliser les méthodes du bean implémentant l'interface [CustomerRepository]. Les résultats console sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="p">.</span><span class="w">   </span><span class="nx">____</span><span class="w">          </span><span class="nx">_</span><span class="w">            </span><span class="nx">__</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">_</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w"> </span><span class="o">/</span><span class="err">\\</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">___</span><span class="s1">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="s1">( ( )\___ | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;_| | &#39;</span><span class="nx">_</span><span class="w"> </span><span class="err">\</span><span class="o">/</span><span class="w"> </span><span class="nx">_</span><span class="sb">` | \ \ \ \</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="sb"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="sb">  &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="sb"> =========|_|==============|___/=/_/_/_/</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="sb"> :: Spring Boot ::        (v1.2.2.RELEASE)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="sb">2015-03-10 15:35:43.661  INFO 5784 --- [           main] hello.Application                        : Starting Application on Gportpers3 with PID 5784 (started by ST in C:\Users\Serge Tahé\Documents\workspace-sts-3.6.3.RELEASE\gs-accessing-data-jpa-complete)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="sb">2015-03-10 15:35:43.708  INFO 5784 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@5d11346a: startup date [Tue Mar 10 15:35:43 CET 2015]; root of context hierarchy</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="sb">2015-03-10 15:35:45.230  INFO 5784 --- [           main] j.LocalContainerEntityManagerFactoryBean : Building JPA container EntityManagerFactory for persistence unit &#39;default&#39;</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="sb">2015-03-10 15:35:45.254  INFO 5784 --- [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="sb">    name: default</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="sb">    ...]</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="sb">2015-03-10 15:35:45.331  INFO 5784 --- [           main] org.hibernate.Version                    : HHH000412: Hibernate Core {4.3.8.Final}</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="sb">2015-03-10 15:35:45.332  INFO 5784 --- [           main] org.hibernate.cfg.Environment            : HHH000206: hibernate.properties not found</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="sb">2015-03-10 15:35:45.334  INFO 5784 --- [           main] org.hibernate.cfg.Environment            : HHH000021: Bytecode provider name : javassist</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="sb">2015-03-10 15:35:45.651  INFO 5784 --- [           main] o.hibernate.annotations.common.Version   : HCANN000001: Hibernate Commons Annotations {4.0.5.Final}</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="sb">2015-03-10 15:35:45.754  INFO 5784 --- [           main] org.hibernate.dialect.Dialect            : HHH000400: Using dialect: org.hibernate.dialect.H2Dialect</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="sb">2015-03-10 15:35:45.877  INFO 5784 --- [           main] o.h.h.i.ast.ASTQueryTranslatorFactory    : HHH000397: Using ASTQueryTranslatorFactory</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="sb">2015-03-10 15:35:46.154  INFO 5784 --- [           main] org.hibernate.tool.hbm2ddl.SchemaExport  : HHH000227: Running hbm2ddl schema export</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="sb">2015-03-10 15:35:46.169  INFO 5784 --- [           main] org.hibernate.tool.hbm2ddl.SchemaExport  : HHH000230: Schema export complete</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="sb">2015-03-10 15:35:46.779  INFO 5784 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="sb">Customers found with findAll():</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="sb">-------------------------------</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="sb">Customer[id=1, firstName=&#39;Jack&#39;, lastName=&#39;Bauer&#39;]</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="sb">Customer[id=2, firstName=&#39;Chloe&#39;, lastName=&#39;O&#39;Brian&#39;]</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="sb">Customer[id=3, firstName=&#39;Kim&#39;, lastName=&#39;Bauer&#39;]</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="sb">Customer[id=4, firstName=&#39;David&#39;, lastName=&#39;Palmer&#39;]</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="sb">Customer[id=5, firstName=&#39;Michelle&#39;, lastName=&#39;Dessler&#39;]</span>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="sb">Customer found with findOne(1L):</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="sb">--------------------------------</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="sb">Customer[id=1, firstName=&#39;Jack&#39;, lastName=&#39;Bauer&#39;]</span>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="sb">Customer found with findByLastName(&#39;Bauer&#39;):</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="sb">--------------------------------------------</span>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="sb">Customer[id=1, firstName=&#39;Jack&#39;, lastName=&#39;Bauer&#39;]</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="sb">Customer[id=3, firstName=&#39;Kim&#39;, lastName=&#39;Bauer&#39;]</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="sb">2015-03-10 15:35:47.040  INFO 5784 --- [           main] hello.Application                        : Started Application in 3.623 seconds (JVM running for 4.324)</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="sb">2015-03-10 15:35:47.042  INFO 5784 --- [       Thread-1] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@5d11346a: startup date [Tue Mar 10 15:35:43 CET 2015]; root of context hierarchy</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="sb">2015-03-10 15:35:47.044  INFO 5784 --- [       Thread-1] o.s.j.e.a.AnnotationMBeanExporter        : Unregistering JMX-exposed beans on shutdown</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="sb">2015-03-10 15:35:47.046  INFO 5784 --- [       Thread-1] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit &#39;default&#39;</span>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="sb">2015-03-10 15:35:47.047  INFO 5784 --- [       Thread-1] org.hibernate.tool.hbm2ddl.SchemaExport  : HHH000227: Running hbm2ddl schema export</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="sb">2015-03-10 15:35:47.051  INFO 5784 --- [       Thread-1] org.hibernate.tool.hbm2ddl.SchemaExport  : HHH000230: Schema export complete</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-8 : le logo du projet Spring Boot ;</li>
<li>ligne 9 : la classe [hello.Application] est exécutée ;</li>
<li>ligne 10 : [AnnotationConfigApplicationContext] est une classe implémentant l'interface [ApplicationContext] de Spring. C'est un conteneur de beans ;</li>
<li>ligne 11 : le bean [entityManagerFactory] est implémenté avec la classe [LocalContainerEntityManagerFactory], une classe de Spring ;</li>
<li>ligne 12 : on voit apparaître [Hibernate]. C'est cette implémentation JPA qui a été choisie ;</li>
<li>ligne 19 : un dialecte Hibernate est la variante SQL à utiliser avec le SGBD. Ici le dialecte [H2Dialect] montre qu'Hibernate va travailler avec le SGBD H2 ;</li>
<li>lignes 21-22 : la base de données est créée. La table [CUSTOMER] est créée. Cela signifie qu'Hibernate a été configuré pour générer les tables à partir des définitions JPA, ici la définition JPA de la classe [Customer] ;</li>
<li>lignes 26-30 : résultat de la méthode [findAll] de l'interface ;</li>
<li>ligne 34 : résultat de la méthode [findOne] de l'interface ;</li>
<li>lignes 38-39 : résultats de la méthode [findByLastName] ;</li>
<li>lignes 41 et suivantes : logs de la fermeture du contexte Spring.</li>
</ul>
<h3 id="1125-configuration-manuelle-du-projet-spring-data">11.2.5. Configuration manuelle du projet Spring Data</h3>
<p>Nous dupliquons le projet précédent dans le projet [gs-accessing-data-jpa-02] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F80000015BACE9B961.png" style="display:inline-block; margin:4px;width:4.59cm;height:6.421cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Dans ce nouveau projet, nous n'allons pas nous reposer sur la configuration automatique faite par Spring Boot. Nous allons la faire manuellement. Cela peut être utile si les configurations par défaut ne nous conviennent pas.</p>
<p>Tout d'abord, nous allons expliciter les dépendances nécessaires dans le fichier [pom.xml] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span>
<span class="normal"><a href="#__codelineno-13-41">41</a></span>
<span class="normal"><a href="#__codelineno-13-42">42</a></span>
<span class="normal"><a href="#__codelineno-13-43">43</a></span>
<span class="normal"><a href="#__codelineno-13-44">44</a></span>
<span class="normal"><a href="#__codelineno-13-45">45</a></span>
<span class="normal"><a href="#__codelineno-13-46">46</a></span>
<span class="normal"><a href="#__codelineno-13-47">47</a></span>
<span class="normal"><a href="#__codelineno-13-48">48</a></span>
<span class="normal"><a href="#__codelineno-13-49">49</a></span>
<span class="normal"><a href="#__codelineno-13-50">50</a></span>
<span class="normal"><a href="#__codelineno-13-51">51</a></span>
<span class="normal"><a href="#__codelineno-13-52">52</a></span>
<span class="normal"><a href="#__codelineno-13-53">53</a></span>
<span class="normal"><a href="#__codelineno-13-54">54</a></span>
<span class="normal"><a href="#__codelineno-13-55">55</a></span>
<span class="normal"><a href="#__codelineno-13-56">56</a></span>
<span class="normal"><a href="#__codelineno-13-57">57</a></span>
<span class="normal"><a href="#__codelineno-13-58">58</a></span>
<span class="normal"><a href="#__codelineno-13-59">59</a></span>
<span class="normal"><a href="#__codelineno-13-60">60</a></span>
<span class="normal"><a href="#__codelineno-13-61">61</a></span>
<span class="normal"><a href="#__codelineno-13-62">62</a></span>
<span class="normal"><a href="#__codelineno-13-63">63</a></span>
<span class="normal"><a href="#__codelineno-13-64">64</a></span>
<span class="normal"><a href="#__codelineno-13-65">65</a></span>
<span class="normal"><a href="#__codelineno-13-66">66</a></span>
<span class="normal"><a href="#__codelineno-13-67">67</a></span>
<span class="normal"><a href="#__codelineno-13-68">68</a></span>
<span class="normal"><a href="#__codelineno-13-69">69</a></span>
<span class="normal"><a href="#__codelineno-13-70">70</a></span>
<span class="normal"><a href="#__codelineno-13-71">71</a></span>
<span class="normal"><a href="#__codelineno-13-72">72</a></span>
<span class="normal"><a href="#__codelineno-13-73">73</a></span>
<span class="normal"><a href="#__codelineno-13-74">74</a></span>
<span class="normal"><a href="#__codelineno-13-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>gs-accessing-data-jpa-02<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.1.0<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.7.RELEASE<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">        </span><span class="cm">&lt;!-- Spring Data --&gt;</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.data<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="w">        </span><span class="cm">&lt;!-- Hibernate --&gt;</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="w">        </span><span class="cm">&lt;!-- H2 Database --&gt;</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a><span class="w">        </span><span class="cm">&lt;!-- Tomcat JDBC --&gt;</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.apache.tomcat<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>tomcat-jdbc<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a><span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a><span class="w">        </span><span class="cm">&lt;!-- use UTF-8 for everything --&gt;</span>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a><span class="w">        </span><span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a><span class="w">        </span><span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
<a id="__codelineno-13-43" name="__codelineno-13-43"></a><span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
<a id="__codelineno-13-44" name="__codelineno-13-44"></a>
<a id="__codelineno-13-45" name="__codelineno-13-45"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-13-46" name="__codelineno-13-46"></a><span class="w">        </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-13-47" name="__codelineno-13-47"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-13-48" name="__codelineno-13-48"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-13-49" name="__codelineno-13-49"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-13-50" name="__codelineno-13-50"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-13-51" name="__codelineno-13-51"></a><span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-13-52" name="__codelineno-13-52"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
<a id="__codelineno-13-53" name="__codelineno-13-53"></a>
<a id="__codelineno-13-54" name="__codelineno-13-54"></a><span class="w">    </span><span class="nt">&lt;repositories&gt;</span>
<a id="__codelineno-13-55" name="__codelineno-13-55"></a><span class="w">        </span><span class="nt">&lt;repository&gt;</span>
<a id="__codelineno-13-56" name="__codelineno-13-56"></a><span class="w">            </span><span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
<a id="__codelineno-13-57" name="__codelineno-13-57"></a><span class="w">            </span><span class="nt">&lt;name&gt;</span>Spring<span class="w"> </span>Releases<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-13-58" name="__codelineno-13-58"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-release<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-13-59" name="__codelineno-13-59"></a><span class="w">        </span><span class="nt">&lt;/repository&gt;</span>
<a id="__codelineno-13-60" name="__codelineno-13-60"></a><span class="w">        </span><span class="nt">&lt;repository&gt;</span>
<a id="__codelineno-13-61" name="__codelineno-13-61"></a><span class="w">            </span><span class="nt">&lt;id&gt;</span>org.jboss.repository.releases<span class="nt">&lt;/id&gt;</span>
<a id="__codelineno-13-62" name="__codelineno-13-62"></a><span class="w">            </span><span class="nt">&lt;name&gt;</span>JBoss<span class="w"> </span>Maven<span class="w"> </span>Release<span class="w"> </span>Repository<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-13-63" name="__codelineno-13-63"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://repository.jboss.org/nexus/content/repositories/releases<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-13-64" name="__codelineno-13-64"></a><span class="w">        </span><span class="nt">&lt;/repository&gt;</span>
<a id="__codelineno-13-65" name="__codelineno-13-65"></a><span class="w">    </span><span class="nt">&lt;/repositories&gt;</span>
<a id="__codelineno-13-66" name="__codelineno-13-66"></a>
<a id="__codelineno-13-67" name="__codelineno-13-67"></a><span class="w">    </span><span class="nt">&lt;pluginRepositories&gt;</span>
<a id="__codelineno-13-68" name="__codelineno-13-68"></a><span class="w">        </span><span class="nt">&lt;pluginRepository&gt;</span>
<a id="__codelineno-13-69" name="__codelineno-13-69"></a><span class="w">            </span><span class="nt">&lt;id&gt;</span>spring-releases<span class="nt">&lt;/id&gt;</span>
<a id="__codelineno-13-70" name="__codelineno-13-70"></a><span class="w">            </span><span class="nt">&lt;name&gt;</span>Spring<span class="w"> </span>Releases<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-13-71" name="__codelineno-13-71"></a><span class="w">            </span><span class="nt">&lt;url&gt;</span>https://repo.spring.io/libs-release<span class="nt">&lt;/url&gt;</span>
<a id="__codelineno-13-72" name="__codelineno-13-72"></a><span class="w">        </span><span class="nt">&lt;/pluginRepository&gt;</span>
<a id="__codelineno-13-73" name="__codelineno-13-73"></a><span class="w">    </span><span class="nt">&lt;/pluginRepositories&gt;</span>
<a id="__codelineno-13-74" name="__codelineno-13-74"></a>
<a id="__codelineno-13-75" name="__codelineno-13-75"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 10-14 : le projet Maven parent dont nous allons utiliser les bibliothèques qu'il définit ;</li>
<li>lignes 18-21 : Spring Data utilisé pour accéder à la base de données ;</li>
<li>lignes 23-26 : l'implémentation Hibernate de la spécification JPA ;</li>
<li>lignes 28-31 : le SGBD H2 ;</li>
<li>lignes 33-36 : les bases de données sont souvent utilisées avec des pools de connexions ouvertes qui évitent les ouvertures / fermetures de connexion à répétition. Ici, l'implémentation utilisée est celle de [tomcat-jdbc] ;</li>
</ul>
<p>Dans le nouveau projet, l'entité [Customer] et l'interface [CustomerRepository] ne changent pas. On va changer la classe [Application] qui va être scindée en deux classes : </p>
<ul>
<li>[Config] qui sera la classe de configuration :</li>
<li>[Main] qui sera la classe exécutable ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000E80000009FB5A3B942.png" style="display:inline-block; margin:4px;width:4.3cm;height:2.94cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe exécutable [Application] est désormais la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">console</span><span class="p">;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">repositories.CustomerRepository</span><span class="p">;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config.AppConfig</span><span class="p">;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">entities.Customer</span><span class="p">;</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Application</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">        </span><span class="c1">// instanciation contexte Spring</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">        </span><span class="n">AnnotationConfigApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">        </span><span class="n">CustomerRepository</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">CustomerRepository</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">        </span><span class="c1">// save a couple of customers</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bauer&quot;</span><span class="p">));</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Chloe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;O&#39;Brian&quot;</span><span class="p">));</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Kim&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bauer&quot;</span><span class="p">));</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;David&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Palmer&quot;</span><span class="p">));</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">        </span><span class="n">repository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="p">(</span><span class="s">&quot;Michelle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dessler&quot;</span><span class="p">));</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="w">        </span><span class="c1">// fermeture contexte</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="w">        </span><span class="n">context</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : la classe [Application] n'a plus d'annotations de configuration ;</li>
<li>lignes 3-7 : on notera qu'il n'y a plus d'imports de packages [Spring Boot] ;</li>
<li>ligne 12 : on instancie les beans Spring. On obtient le contexte de Spring qui contient la référence des beans ainsi créés ;</li>
<li>ligne 13 : on demande une référence sur le bean de type [CustomerRepository] ;</li>
</ul>
<p>La classe [Config] qui configure le projet est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">package</span> <span class="n">config</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.EntityManagerFactory</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.tomcat.jdbc.pool.DataSource</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span><span class="p">;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="p">;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="p">;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="p">;</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="p">;</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="p">;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="p">;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="p">;</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="o">//</span><span class="nd">@EnableTransactionManagement</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="nd">@EnableJpaRepositories</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;repositories&quot;</span> <span class="p">})</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="nd">@Configuration</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="o">//</span> <span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackages</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;package1&quot;</span><span class="p">,</span><span class="s2">&quot;package2&quot;</span><span class="p">})</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">AppConfig</span> <span class="p">{</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>    <span class="o">//</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">données</span> <span class="n">H2</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a>    <span class="n">public</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a>        <span class="o">//</span> <span class="n">source</span> <span class="n">de</span> <span class="n">données</span> <span class="n">TomcatJdbc</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a>        <span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DataSource</span><span class="p">();</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a>        <span class="o">//</span> <span class="n">configuration</span> <span class="n">accès</span> <span class="n">JDBC</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setDriverClassName</span><span class="p">(</span><span class="s2">&quot;org.h2.Driver&quot;</span><span class="p">);</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setUrl</span><span class="p">(</span><span class="s2">&quot;jdbc:h2:./demo&quot;</span><span class="p">);</span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setUsername</span><span class="p">(</span><span class="s2">&quot;sa&quot;</span><span class="p">);</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setPassword</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a>        <span class="o">//</span> <span class="n">une</span> <span class="n">connexion</span> <span class="n">ouverte</span> <span class="n">initialement</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setInitialSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a>        <span class="o">//</span> <span class="n">résultat</span>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a>        <span class="k">return</span> <span class="n">dataSource</span><span class="p">;</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a>    <span class="p">}</span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a>    <span class="o">//</span> <span class="n">le</span> <span class="n">provider</span> <span class="n">JPA</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a>    <span class="n">public</span> <span class="n">JpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a>        <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="p">();</span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a>        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="n">setShowSql</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a>        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="n">setGenerateDdl</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a>        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="n">setDatabase</span><span class="p">(</span><span class="n">Database</span><span class="o">.</span><span class="n">H2</span><span class="p">);</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a>        <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="p">;</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a>    <span class="p">}</span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a>    <span class="o">//</span> <span class="n">EntityManagerFactory</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a>    <span class="n">public</span> <span class="n">EntityManagerFactory</span> <span class="n">entityManagerFactory</span><span class="p">(</span><span class="n">JpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span><span class="p">,</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a>        <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="p">();</span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">setJpaVendorAdapter</span><span class="p">(</span><span class="n">jpaVendorAdapter</span><span class="p">);</span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">setPackagesToScan</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">);</span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">afterPropertiesSet</span><span class="p">();</span>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a>        <span class="k">return</span> <span class="n">factory</span><span class="o">.</span><span class="n">getObject</span><span class="p">();</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a>    <span class="p">}</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a>    <span class="o">//</span> <span class="n">Transaction</span> <span class="n">manager</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a>    <span class="n">public</span> <span class="n">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="p">(</span><span class="n">EntityManagerFactory</span> <span class="n">entityManagerFactory</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a>        <span class="n">JpaTransactionManager</span> <span class="n">txManager</span> <span class="o">=</span> <span class="n">new</span> <span class="n">JpaTransactionManager</span><span class="p">();</span>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a>        <span class="n">txManager</span><span class="o">.</span><span class="n">setEntityManagerFactory</span><span class="p">(</span><span class="n">entityManagerFactory</span><span class="p">);</span>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a>        <span class="k">return</span> <span class="n">txManager</span><span class="p">;</span>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a>    <span class="p">}</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 17 : l'annotation [@EnableTransactionManagement] indique que les méthodes des interfaces [CrudRepository] doivent se dérouler à l'intérieur d'une transaction. Elle a été mise en commentaires car c'est le cas par défaut ;</li>
<li>ligne 18 :  l'annotation [@EnableJpaRepositories] permet de désigner les dossiers où se trouvent les interfaces Spring Data [CrudRepository]. Ces interfaces vont devenir des composants Spring et être disponibles dans son contexte ;</li>
<li>ligne 19 : l'annotation [@Configuration] fait de la classe [Config] une classe de configuration Spring ;</li>
<li>ligne 20 : l'annotation [@ComponentScan] permet de lister les dossiers où les composants Spring doivent être recherchés. Les composants Spring sont des classes taguées avec des annotations Spring telles que @<strong>Service</strong>, @<strong>Component</strong>, @<strong>Controller</strong>, ... Ici, il n'y en a pas d'autres que ceux qui sont définis au sein de la classe [AppConfig], aussi l'annotation a-t-elle été mise en commentaires ;</li>
<li>lignes 24-37 : définissent la source de données, la base de données H2. C'est l'annotation @Bean de la ligne 25 qui fait de l'objet créé par cette méthode un composant géré par Spring. Le nom de la méthode peut être ici quelconque. Cependant elle doit être appelée [<strong>dataSource</strong>] si l'EntityManagerFactory de la ligne 51 est absent et défini par autoconfiguration ;</li>
<li>ligne 30 : la base de données s'appellera [demo] et sera générée dans le dossier du projet ;</li>
<li>lignes 40-47 : définissent l'implémentation JPA utilisée, ici une implémentation Hibernate. Le nom de la méthode peut être ici quelconque ;</li>
<li>ligne 43 : pas de logs SQL ;</li>
<li>ligne 44 : la base de données sera créée si elle n'existe pas ;</li>
<li>lignes 50-58 : définissent l'EntityManagerFactory qui va gérer la persistance JPA. La méthode doit s'appeler obligatoirement [<strong>entityManagerFactory</strong>] ;</li>
<li>ligne 51 : la méthode reçoit deux paramètres ayant le type des deux beans définis précédemment. Ceux-ci seront alors construits puis injectés par Spring comme paramètres de la méthode ;</li>
<li>ligne 53 : fixe l'implémentation JPA utilisée ;</li>
<li>ligne 54 : fixe les dossiers où trouver les entités JPA ;</li>
<li>ligne 55 : fixe la source de données à gérer ;</li>
<li>lignes 61-66 : le gestionnaire de transactions. La méthode doit s'appeler obligatoirement [<strong>transactionManager</strong>]. Elle reçoit pour paramètre le bean des lignes 51-58 ;</li>
<li>ligne 64 : le gestionnaire de transactions est associé à l'EntityManagerFactory ;</li>
</ul>
<p>Les méthodes précédentes peuvent être définies dans un ordre quelconque.</p>
<p>L'exécution du projet donne les mêmes résultats. Un nouveau fichier apparaît dans le dossier du projet, celui de la base de données H2 :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F1000000D6F0EB16BE.png" style="display:inline-block; margin:4px;width:4.461cm;height:3.96cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h3 id="1126-creation-dune-archive-executable">11.2.6. Création d'une archive exécutable</h3>
<p>Pour créer une archive exécutable du projet, on peut procéder ainsi :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000005870000018D0FFF267A.png" style="display:inline-block; margin:4px;width:17.999cm;height:5.05cm;" /></td></tr></table>

<ul>
<li>en [1] : on crée une configuration d'exécution ;</li>
<li>en [2] : de type [Java Application]</li>
<li>en [3] : désigne le projet à exécuter (utiliser le bouton Browse) ;</li>
<li>en [4] : désigne la classe à exécuter ;</li>
<li>en [5] : le nom de la configuration d'exécution – peut être quelconque ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000595000002955D9CFE45.png" style="display:inline-block; margin:4px;width:17.999cm;height:8.326cm;" /></td></tr></table>

<ul>
<li>en [6] : on exporte le projet ;</li>
<li>en [7] : sous la forme d'une archive JAR exécutable ;</li>
<li>en [8] : indique le chemin et le nom du fichier exécutable à créer ;</li>
<li>en [9] : le nom de la configuration d'exécution créée en [5] ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000001A60000019938FC06CE.png" style="display:inline-block; margin:4px;width:5.583cm;height:5.412cm;" /></td></tr></table>

<ul>
<li>en [10], l'archive créée ;</li>
</ul>
<p>Ceci fait, on ouvre une console dans le dossier contenant l'archive exécutable :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a>.....\dist&gt;dir
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>12/06/2014  09:11        15 104 869 gs-accessing-data-jpa-02.jar
</code></pre></div></td></tr></table></div>
<p>L'archive est exécutée de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a>.....\dist&gt;java -jar gs-accessing-data-jpa-02.jar
</code></pre></div></td></tr></table></div>
<p>Les résultats obtenus dans la console sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span>
<span class="normal"><a href="#__codelineno-18-48">48</a></span>
<span class="normal"><a href="#__codelineno-18-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nx">SLF4J</span><span class="o">:</span><span class="w"> </span><span class="nx">Failed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="s2">&quot;org.slf4j.impl.StaticLoggerBinder&quot;</span><span class="p">.</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nx">SLF4J</span><span class="o">:</span><span class="w"> </span><span class="nx">Defaulting</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">no</span><span class="o">-</span><span class="nx">operation</span><span class="w"> </span><span class="p">(</span><span class="nx">NOP</span><span class="p">)</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="nx">implementation</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="nx">SLF4J</span><span class="o">:</span><span class="w"> </span><span class="nx">See</span><span class="w"> </span><span class="nx">http</span><span class="o">:</span><span class="c1">//www.slf4j.org/codes.html#StaticLoggerBinder for further details.</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">20</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">jpa</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">LogHelper</span><span class="w"> </span><span class="nx">logPersistenceUnitInformation</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000204</span><span class="o">:</span><span class="w"> </span><span class="nx">Processing</span><span class="w"> </span><span class="nx">PersistenceUnitInfo</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="k">default</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="p">...]</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">20</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">Version</span><span class="w"> </span><span class="nx">logVersion</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000412</span><span class="o">:</span><span class="w"> </span><span class="nx">Hibernate</span><span class="w"> </span><span class="nx">Core</span><span class="w"> </span><span class="p">{</span><span class="mf">4.3.8</span><span class="p">.</span><span class="nx">Final</span><span class="p">}</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">20</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">clinit</span><span class="o">&gt;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000206</span><span class="o">:</span><span class="w"> </span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">properties</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">found</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">20</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">cfg</span><span class="p">.</span><span class="nx">Environment</span><span class="w"> </span><span class="nx">buildBytecodeProvider</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000021</span><span class="o">:</span><span class="w"> </span><span class="nx">Bytecode</span><span class="w"> </span><span class="nx">provider</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">javassist</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">common</span><span class="p">.</span><span class="nx">reflection</span><span class="p">.</span><span class="nx">java</span><span class="p">.</span><span class="nx">JavaReflectionManager</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">clinit</span><span class="o">&gt;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HCANN000001</span><span class="o">:</span><span class="w"> </span><span class="nx">Hibernate</span><span class="w"> </span><span class="nx">Commons</span><span class="w"> </span><span class="nx">Annotations</span><span class="w"> </span><span class="p">{</span><span class="mf">4.0.5</span><span class="p">.</span><span class="nx">Final</span><span class="p">}</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">Dialect</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">init</span><span class="o">&gt;</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000400</span><span class="o">:</span><span class="w"> </span><span class="nx">Using</span><span class="w"> </span><span class="nx">dialect</span><span class="o">:</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">H2Dialect</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">hql</span><span class="p">.</span><span class="nx">internal</span><span class="p">.</span><span class="nx">ast</span><span class="p">.</span><span class="nx">ASTQueryTranslatorFactory</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">init</span><span class="o">&gt;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000397</span><span class="o">:</span><span class="w"> </span><span class="nx">Using</span><span class="w"> </span><span class="nx">ASTQueryTranslatorFactory</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">SchemaUpdate</span><span class="w"> </span><span class="nx">execute</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000228</span><span class="o">:</span><span class="w"> </span><span class="nx">Running</span><span class="w"> </span><span class="nx">hbm2ddl</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="nx">update</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">SchemaUpdate</span><span class="w"> </span><span class="nx">execute</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000102</span><span class="o">:</span><span class="w"> </span><span class="nx">Fetching</span><span class="w"> </span><span class="nx">database</span><span class="w"> </span><span class="nx">metadata</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">SchemaUpdate</span><span class="w"> </span><span class="nx">execute</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000396</span><span class="o">:</span><span class="w"> </span><span class="nx">Updating</span><span class="w"> </span><span class="nx">schema</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">DatabaseMetadata</span><span class="w"> </span><span class="nx">getTableMetadata</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000262</span><span class="o">:</span><span class="w"> </span><span class="nx">Table</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">found</span><span class="o">:</span><span class="w"> </span><span class="nx">Customer</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">DatabaseMetadata</span><span class="w"> </span><span class="nx">getTableMetadata</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000262</span><span class="o">:</span><span class="w"> </span><span class="nx">Table</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">found</span><span class="o">:</span><span class="w"> </span><span class="nx">Customer</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">DatabaseMetadata</span><span class="w"> </span><span class="nx">getTableMetadata</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000262</span><span class="o">:</span><span class="w"> </span><span class="nx">Table</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">found</span><span class="o">:</span><span class="w"> </span><span class="nx">Customer</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a><span class="nx">mars</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">2015</span><span class="w"> </span><span class="mf">5</span><span class="o">:</span><span class="mf">27</span><span class="o">:</span><span class="mf">22</span><span class="w"> </span><span class="nx">PM</span><span class="w"> </span><span class="nx">org</span><span class="p">.</span><span class="nx">hibernate</span><span class="p">.</span><span class="nx">tool</span><span class="p">.</span><span class="nx">hbm2ddl</span><span class="p">.</span><span class="nx">SchemaUpdate</span><span class="w"> </span><span class="nx">execute</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a><span class="nx">INFO</span><span class="o">:</span><span class="w"> </span><span class="nx">HHH000232</span><span class="o">:</span><span class="w"> </span><span class="nx">Schema</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">complete</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a><span class="nx">Customers</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">findAll</span><span class="p">()</span><span class="o">:</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a><span class="o">-------------------------------</span>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a><span class="nx">Customer</span><span class="p">[</span><span class="nx">id</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">firstName</span><span class="o">=</span><span class="s1">&#39;Jack&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">lastName</span><span class="o">=</span><span class="s1">&#39;Bauer&#39;</span><span class="p">]</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a><span class="nx">Customer</span><span class="p">[</span><span class="nx">id</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">firstName</span><span class="o">=</span><span class="s1">&#39;Chloe&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">lastName</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="nx">Brian</span><span class="s1">&#39;]</span>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a><span class="s1">Customer[id=3, firstName=&#39;</span><span class="nx">Kim</span><span class="s1">&#39;, lastName=&#39;</span><span class="nx">Bauer</span><span class="s1">&#39;]</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a><span class="s1">Customer[id=4, firstName=&#39;</span><span class="nx">David</span><span class="s1">&#39;, lastName=&#39;</span><span class="nx">Palmer</span><span class="s1">&#39;]</span>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a><span class="s1">Customer[id=5, firstName=&#39;</span><span class="nx">Michelle</span><span class="s1">&#39;, lastName=&#39;</span><span class="nx">Dessler</span><span class="s1">&#39;]</span>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a>
<a id="__codelineno-18-42" name="__codelineno-18-42"></a><span class="s1">Customer found with findOne(1L):</span>
<a id="__codelineno-18-43" name="__codelineno-18-43"></a><span class="s1">--------------------------------</span>
<a id="__codelineno-18-44" name="__codelineno-18-44"></a><span class="s1">Customer[id=1, firstName=&#39;</span><span class="nx">Jack</span><span class="s1">&#39;, lastName=&#39;</span><span class="nx">Bauer</span><span class="s1">&#39;]</span>
<a id="__codelineno-18-45" name="__codelineno-18-45"></a>
<a id="__codelineno-18-46" name="__codelineno-18-46"></a><span class="s1">Customer found with findByLastName(&#39;</span><span class="nx">Bauer</span><span class="s1">&#39;):</span>
<a id="__codelineno-18-47" name="__codelineno-18-47"></a><span class="s1">--------------------------------------------</span>
<a id="__codelineno-18-48" name="__codelineno-18-48"></a><span class="s1">Customer[id=1, firstName=&#39;</span><span class="nx">Jack</span><span class="s1">&#39;, lastName=&#39;</span><span class="nx">Bauer</span><span class="s1">&#39;]</span>
<a id="__codelineno-18-49" name="__codelineno-18-49"></a><span class="s1">Customer[id=3, firstName=&#39;</span><span class="nx">Kim</span><span class="s1">&#39;, lastName=&#39;</span><span class="nx">Bauer</span><span class="err">&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h2 id="113-exemple-2">11.3. Exemple 2</h2>
<h3 id="1131-introduction">11.3.1. Introduction</h3>
<p>Nous allons reprendre l'exemple de la table de produits que nous avons utilisée pour introduire l'API JDBC et créer l'architecture suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000049A0000011056D6AA7D.png" style="display:inline-block; margin:4px;width:15.584cm;height:3.598cm;" /></td></tr></table>

<p>La base de données [dbintrospringjpa] a deux tables [PRODUITS] et [CATEGORIES]. La table [CATEGORIES] est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000219000000692D8D8733.png" style="display:inline-block; margin:4px;width:9.94cm;height:1.94cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>[ID] : clé primaire en mode AUTO_INCREMENT ;</li>
<li>[VERSION] : n° de version de l'enregistrement ;</li>
<li>[NOM] : nom de la catégorie - unique ;</li>
</ul>
<p>La table [PRODUITS] est la suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000024F000000AC2E1845DE.png" style="display:inline-block; margin:4px;width:10.94cm;height:3.191cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>[ID] : clé primaire en mode AUTO_INCREMENT ;</li>
<li>[VERSION] : n° de version de l'enregistrement ;</li>
<li>[NOM] : nom d'un produit - unique ;</li>
<li>[ID_CATEGORIE] : n° de sa catégorie - clé étrangère sur le champ [CATEGORIES.ID] ;</li>
<li>[PRIX] : son prix ;</li>
<li>[DESCRIPTION] : une description du produit ;</li>
</ul>
<p><strong>Travail à faire</strong> : créez la base de données [dbintrospringdata] avec le script SQL [dbintrospringdata.sql] du support :</p>
<h3 id="1132-creation-du-projet-maven">11.3.2. Création du projet Maven</h3>
<p>Pour créer un squelette de projet Spring Data, on peut procéder de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000053B0000037FB182922E.png" style="display:inline-block; margin:4px;width:17.715cm;height:11.841cm;" /></td></tr></table>

<ul>
<li>en [1], on crée un nouveau projet ;</li>
<li>en [2] : de type [Spring Starter Project] ;</li>
<li>le projet généré sera un projet Maven. En [3], on indique le nom du groupe du projet ;</li>
<li>en [4] : on indique le nom de l'artifact (un jar ici) qui sera créé par construction du projet ;</li>
<li>en [5] : le nom Eclipse du projet – peut être quelconque (n'a pas à être identique à [4]) ;</li>
<li>en [7] : on indique qu'on va créer un projet ayant une couche [JPA] avec le SGBD MySQL. Les dépendances nécessaires à un tel projet vont alors être incluses dans le fichier [pom.xml] ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000035100000366DD79C834.png" style="display:inline-block; margin:4px;width:11.232cm;height:11.509cm;" /></td></tr></table>

<ul>
<li>en [8], donner le nom du dossier du projet ;</li>
<li>en [9], terminer l'assistant ;</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000002300000018C3796C846.png" style="display:inline-block; margin:4px;width:7.408cm;height:5.239cm;" /></td></tr></table>

<ul>
<li>en [10] : le projet créé ;</li>
</ul>
<p>Le fichier [pom.xml] intègre les dépendances nécessaires à un projet JPA :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span>
<span class="normal"><a href="#__codelineno-19-40">40</a></span>
<span class="normal"><a href="#__codelineno-19-41">41</a></span>
<span class="normal"><a href="#__codelineno-19-42">42</a></span>
<span class="normal"><a href="#__codelineno-19-43">43</a></span>
<span class="normal"><a href="#__codelineno-19-44">44</a></span>
<span class="normal"><a href="#__codelineno-19-45">45</a></span>
<span class="normal"><a href="#__codelineno-19-46">46</a></span>
<span class="normal"><a href="#__codelineno-19-47">47</a></span>
<span class="normal"><a href="#__codelineno-19-48">48</a></span>
<span class="normal"><a href="#__codelineno-19-49">49</a></span>
<span class="normal"><a href="#__codelineno-19-50">50</a></span>
<span class="normal"><a href="#__codelineno-19-51">51</a></span>
<span class="normal"><a href="#__codelineno-19-52">52</a></span>
<span class="normal"><a href="#__codelineno-19-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>istia.st.springdata<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>intro-spring-data-01<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">    </span><span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>intro-spring-data-01<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>démo<span class="w"> </span>spring<span class="w"> </span>data<span class="w"> </span>avec<span class="w"> </span>table<span class="w"> </span>de<span class="w"> </span>produits<span class="nt">&lt;/description&gt;</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.2.RELEASE<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">        </span><span class="nt">&lt;relativePath/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- lookup parent from repository --&gt;</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="w">        </span><span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="w">        </span><span class="nt">&lt;start-class&gt;</span>demo.IntroSpringData01Application<span class="nt">&lt;/start-class&gt;</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="w">        </span><span class="nt">&lt;java.version&gt;</span>1.7<span class="nt">&lt;/java.version&gt;</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-19-40" name="__codelineno-19-40"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-19-41" name="__codelineno-19-41"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-19-42" name="__codelineno-19-42"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-19-43" name="__codelineno-19-43"></a>
<a id="__codelineno-19-44" name="__codelineno-19-44"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-19-45" name="__codelineno-19-45"></a><span class="w">        </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-19-46" name="__codelineno-19-46"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-19-47" name="__codelineno-19-47"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-19-48" name="__codelineno-19-48"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-19-49" name="__codelineno-19-49"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-19-50" name="__codelineno-19-50"></a><span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-19-51" name="__codelineno-19-51"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
<a id="__codelineno-19-52" name="__codelineno-19-52"></a>
<a id="__codelineno-19-53" name="__codelineno-19-53"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 14-19 : le projet Maven parent - définit un grand nombre de bibliothèques avec leurs versions - on utilise ces bibliothèques comme dépendances Maven sans préciser leur version ;</li>
<li>lignes 28-31 : la dépendance nécessaire à JPA – va inclure [Spring Data] ;</li>
<li>lignes 32-36 : la dépendance sur le pilote JDBC de MySQL ;</li>
<li>lignes 37-41 : les dépendances nécessaires aux tests JUnit intégrés avec Spring ;</li>
</ul>
<p>La classe exécutable [Application] ne fait rien mais est préconfigurée :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">demo</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="nd">@SpringBootApplication</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">IntroSpringData01Application</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">IntroSpringData01Application</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>l'annotation [@SpringBootApplication] fait de la classe une classe d'auto-configuration du projet ;</li>
</ul>
<p>La classe de tests [ApplicationTests] ne fait rien mais est préconfigurée :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">package</span> <span class="n">demo</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.SpringApplicationConfiguration</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="nd">@SpringApplicationConfiguration</span><span class="p">(</span><span class="n">classes</span> <span class="o">=</span> <span class="n">IntroSpringData01Application</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">IntroSpringData01ApplicationTests</span> <span class="p">{</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>    <span class="nd">@Test</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>    <span class="n">public</span> <span class="n">void</span> <span class="n">contextLoads</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>    <span class="p">}</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : l'annotation [@SpringApplicationConfiguration] permet d'exploiter le fichier de configuration [Application]. La classe de test bénéficiera ainsi de tous les beans qui seront définis par ce fichier ;</li>
<li>ligne 8 : l'annotation [@RunWith] permet l'intégration de Spring avec JUnit : la classe va pouvoir être exécutée comme un test JUnit. [@RunWith] est une annotation JUnit (ligne 4) alors que la classe [SpringJUnit4ClassRunner] est une classe Spring (ligne 6) ;</li>
</ul>
<p>Maintenant que nous avons un squelette d'application JPA, nous pouvons le compléter pour écrire le projet de la couche de persistance associée à la base de données des produits.</p>
<h3 id="1133-le-projet-eclipse">11.3.3. Le projet Eclipse</h3>
<p>Nous faisons évoluer le projet précédent de la façon suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000F6000002024FC5FC8F.png" style="display:inline-block; margin:4px;width:4.56cm;height:9.52cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<ul>
<li>[AppConfig.java] : la classe de configuration du projet Spring ;</li>
<li>[Main.java] : la classe exécutable du projet ;</li>
<li>[IDao.java] : l'interface de la couche [DAO] ;</li>
<li>[Dao.java] : la classe d'implémentation de la couche [DAO] ;</li>
<li>[AbstractEntity.java] : la classe parent des classes [Produit] et [Categorie] ;</li>
<li>[Produit.java] : classe associée à une ligne de la table [PRODUITS] de la base de données ;</li>
<li>[Categorie.java] : classe associée à une ligne de la table [CATEGORIES] de la base de données ;</li>
<li>[ProduitsRepository] : l'interface Spring Data d'accès à la table [PRODUITS] ;</li>
<li>[CategoriesRepository] : l'interface Spring Data d'accès à la table [CATEGORIES] ;</li>
<li>[pom.xml] : le fichier de configuration du projet Maven ;</li>
</ul>
<p>Ce projet implémente l'architecture suivante :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000049B00000112C905184C.png" style="display:inline-block; margin:4px;width:15.598cm;height:3.625cm;" /></td></tr></table>

<p>La couche [DAO] ne voit que la couche implémentée par [Spring Data].</p>
<h3 id="1134-configuration-maven">11.3.4. Configuration Maven</h3>
<p>Le fichier [pom.xml] du projet Maven est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span>
<span class="normal"><a href="#__codelineno-22-41">41</a></span>
<span class="normal"><a href="#__codelineno-22-42">42</a></span>
<span class="normal"><a href="#__codelineno-22-43">43</a></span>
<span class="normal"><a href="#__codelineno-22-44">44</a></span>
<span class="normal"><a href="#__codelineno-22-45">45</a></span>
<span class="normal"><a href="#__codelineno-22-46">46</a></span>
<span class="normal"><a href="#__codelineno-22-47">47</a></span>
<span class="normal"><a href="#__codelineno-22-48">48</a></span>
<span class="normal"><a href="#__codelineno-22-49">49</a></span>
<span class="normal"><a href="#__codelineno-22-50">50</a></span>
<span class="normal"><a href="#__codelineno-22-51">51</a></span>
<span class="normal"><a href="#__codelineno-22-52">52</a></span>
<span class="normal"><a href="#__codelineno-22-53">53</a></span>
<span class="normal"><a href="#__codelineno-22-54">54</a></span>
<span class="normal"><a href="#__codelineno-22-55">55</a></span>
<span class="normal"><a href="#__codelineno-22-56">56</a></span>
<span class="normal"><a href="#__codelineno-22-57">57</a></span>
<span class="normal"><a href="#__codelineno-22-58">58</a></span>
<span class="normal"><a href="#__codelineno-22-59">59</a></span>
<span class="normal"><a href="#__codelineno-22-60">60</a></span>
<span class="normal"><a href="#__codelineno-22-61">61</a></span>
<span class="normal"><a href="#__codelineno-22-62">62</a></span>
<span class="normal"><a href="#__codelineno-22-63">63</a></span>
<span class="normal"><a href="#__codelineno-22-64">64</a></span>
<span class="normal"><a href="#__codelineno-22-65">65</a></span>
<span class="normal"><a href="#__codelineno-22-66">66</a></span>
<span class="normal"><a href="#__codelineno-22-67">67</a></span>
<span class="normal"><a href="#__codelineno-22-68">68</a></span>
<span class="normal"><a href="#__codelineno-22-69">69</a></span>
<span class="normal"><a href="#__codelineno-22-70">70</a></span>
<span class="normal"><a href="#__codelineno-22-71">71</a></span>
<span class="normal"><a href="#__codelineno-22-72">72</a></span>
<span class="normal"><a href="#__codelineno-22-73">73</a></span>
<span class="normal"><a href="#__codelineno-22-74">74</a></span>
<span class="normal"><a href="#__codelineno-22-75">75</a></span>
<span class="normal"><a href="#__codelineno-22-76">76</a></span>
<span class="normal"><a href="#__codelineno-22-77">77</a></span>
<span class="normal"><a href="#__codelineno-22-78">78</a></span>
<span class="normal"><a href="#__codelineno-22-79">79</a></span>
<span class="normal"><a href="#__codelineno-22-80">80</a></span>
<span class="normal"><a href="#__codelineno-22-81">81</a></span>
<span class="normal"><a href="#__codelineno-22-82">82</a></span>
<span class="normal"><a href="#__codelineno-22-83">83</a></span>
<span class="normal"><a href="#__codelineno-22-84">84</a></span>
<span class="normal"><a href="#__codelineno-22-85">85</a></span>
<span class="normal"><a href="#__codelineno-22-86">86</a></span>
<span class="normal"><a href="#__codelineno-22-87">87</a></span>
<span class="normal"><a href="#__codelineno-22-88">88</a></span>
<span class="normal"><a href="#__codelineno-22-89">89</a></span>
<span class="normal"><a href="#__codelineno-22-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="nt">&lt;groupId&gt;</span>istia.st.springdata<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>intro-spring-data-01<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">    </span><span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">    </span><span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>intro-spring-data-01<span class="nt">&lt;/name&gt;</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>démo<span class="w"> </span>spring<span class="w"> </span>data<span class="w"> </span>avec<span class="w"> </span>table<span class="w"> </span>de<span class="w"> </span>produits<span class="nt">&lt;/description&gt;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">    </span><span class="nt">&lt;parent&gt;</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">        </span><span class="nt">&lt;version&gt;</span>1.2.7.RELEASE<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">    </span><span class="nt">&lt;/parent&gt;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">        </span><span class="cm">&lt;!-- Spring Data --&gt;</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.data<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><span class="w">        </span><span class="cm">&lt;!-- Hibernate --&gt;</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a><span class="w">        </span><span class="cm">&lt;!-- MySQL Database --&gt;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a><span class="w">        </span><span class="cm">&lt;!-- Tomcat JDBC --&gt;</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.apache.tomcat<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>tomcat-jdbc<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-41" name="__codelineno-22-41"></a><span class="w">        </span><span class="cm">&lt;!-- bibliothèque jSON --&gt;</span>
<a id="__codelineno-22-42" name="__codelineno-22-42"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-43" name="__codelineno-22-43"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-44" name="__codelineno-22-44"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>jackson-core<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-45" name="__codelineno-22-45"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-46" name="__codelineno-22-46"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-47" name="__codelineno-22-47"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-48" name="__codelineno-22-48"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>jackson-databind<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-49" name="__codelineno-22-49"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-50" name="__codelineno-22-50"></a><span class="w">        </span><span class="cm">&lt;!-- Google Guava --&gt;</span>
<a id="__codelineno-22-51" name="__codelineno-22-51"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-52" name="__codelineno-22-52"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>com.google.guava<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-53" name="__codelineno-22-53"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>guava<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-54" name="__codelineno-22-54"></a><span class="w">            </span><span class="nt">&lt;version&gt;</span>16.0.1<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-22-55" name="__codelineno-22-55"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-56" name="__codelineno-22-56"></a><span class="w">        </span><span class="cm">&lt;!-- Spring Boot Test --&gt;</span>
<a id="__codelineno-22-57" name="__codelineno-22-57"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-58" name="__codelineno-22-58"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-59" name="__codelineno-22-59"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-60" name="__codelineno-22-60"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-22-61" name="__codelineno-22-61"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-62" name="__codelineno-22-62"></a><span class="w">        </span><span class="cm">&lt;!-- Spring Boot --&gt;</span>
<a id="__codelineno-22-63" name="__codelineno-22-63"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-64" name="__codelineno-22-64"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-65" name="__codelineno-22-65"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-66" name="__codelineno-22-66"></a><span class="w">            </span><span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<a id="__codelineno-22-67" name="__codelineno-22-67"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-68" name="__codelineno-22-68"></a><span class="w">        </span><span class="cm">&lt;!-- bibliothèque de logs --&gt;</span>
<a id="__codelineno-22-69" name="__codelineno-22-69"></a><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<a id="__codelineno-22-70" name="__codelineno-22-70"></a><span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-71" name="__codelineno-22-71"></a><span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-logging<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-72" name="__codelineno-22-72"></a><span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
<a id="__codelineno-22-73" name="__codelineno-22-73"></a><span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>
<a id="__codelineno-22-74" name="__codelineno-22-74"></a>
<a id="__codelineno-22-75" name="__codelineno-22-75"></a><span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<a id="__codelineno-22-76" name="__codelineno-22-76"></a><span class="w">        </span><span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<a id="__codelineno-22-77" name="__codelineno-22-77"></a><span class="w">        </span><span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
<a id="__codelineno-22-78" name="__codelineno-22-78"></a><span class="w">    </span><span class="nt">&lt;/properties&gt;</span>
<a id="__codelineno-22-79" name="__codelineno-22-79"></a>
<a id="__codelineno-22-80" name="__codelineno-22-80"></a><span class="w">    </span><span class="nt">&lt;build&gt;</span>
<a id="__codelineno-22-81" name="__codelineno-22-81"></a><span class="w">        </span><span class="nt">&lt;plugins&gt;</span>
<a id="__codelineno-22-82" name="__codelineno-22-82"></a><span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<a id="__codelineno-22-83" name="__codelineno-22-83"></a><span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<a id="__codelineno-22-84" name="__codelineno-22-84"></a><span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
<a id="__codelineno-22-85" name="__codelineno-22-85"></a><span class="w">                </span><span class="nt">&lt;version&gt;</span>2.18.1<span class="nt">&lt;/version&gt;</span>
<a id="__codelineno-22-86" name="__codelineno-22-86"></a><span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>
<a id="__codelineno-22-87" name="__codelineno-22-87"></a><span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<a id="__codelineno-22-88" name="__codelineno-22-88"></a><span class="w">    </span><span class="nt">&lt;/build&gt;</span>
<a id="__codelineno-22-89" name="__codelineno-22-89"></a>
<a id="__codelineno-22-90" name="__codelineno-22-90"></a><span class="nt">&lt;/project&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Cette configuration est celle utilisée et expliquée au paragraphe 11.2.5, page 175. Nous y ajoutons les bibliothèques suivantes :</p>
<ul>
<li>lignes 42-49 : une bibliothèque jSON utilisée par la méthode [toString] de la classe [Produit] ;</li>
<li>lignes 51-55 : la bibliothèque [Google Guava] qui amène des méthodes utilitaires pour gérer des collections d'éléments. Elle sera utilisée par la classe [Dao] qui implémente la couche [DAO] ;</li>
<li>lignes 56-67 : les bibliothèques nécessaires aux tests JUnit ;</li>
<li>lignes 69-72 : une bibliothèque de logs ;</li>
<li>lignes 81-86 : les plugins Maven nécessaires au projet ;</li>
</ul>
<h3 id="1135-les-entites-de-la-couche-jpa">11.3.5. Les entités de la couche [JPA]</h3>
<p>Couche[<strong>DAO</strong>]Couche[<strong>console</strong>]Couche[<strong>JPA</strong>]Pilote[<strong>JDBC</strong>]Couche[<strong>Spring Data</strong>]Spring 4SGBD</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000DB000000CFBC5B5629.png" style="display:inline-block; margin:4px;width:4.06cm;height:3.829cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<h4 id="11351-la-classe-abstractentity">11.3.5.1. La classe [AbstractEntity]</h4>
<p>La classe [AbstractEntity] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span>
<span class="normal"><a href="#__codelineno-23-55">55</a></span>
<span class="normal"><a href="#__codelineno-23-56">56</a></span>
<span class="normal"><a href="#__codelineno-23-57">57</a></span>
<span class="normal"><a href="#__codelineno-23-58">58</a></span>
<span class="normal"><a href="#__codelineno-23-59">59</a></span>
<span class="normal"><a href="#__codelineno-23-60">60</a></span>
<span class="normal"><a href="#__codelineno-23-61">61</a></span>
<span class="normal"><a href="#__codelineno-23-62">62</a></span>
<span class="normal"><a href="#__codelineno-23-63">63</a></span>
<span class="normal"><a href="#__codelineno-23-64">64</a></span>
<span class="normal"><a href="#__codelineno-23-65">65</a></span>
<span class="normal"><a href="#__codelineno-23-66">66</a></span>
<span class="normal"><a href="#__codelineno-23-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">package</span> <span class="n">spring</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">entities</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Column</span><span class="p">;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Id</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.MappedSuperclass</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Version</span><span class="p">;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="nd">@MappedSuperclass</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span><span class="w"> </span><span class="nc">AbstractEntity</span> <span class="p">{</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="o">//</span> <span class="n">propriétés</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>    <span class="nd">@Id</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">)</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ID&quot;</span><span class="p">)</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>    <span class="n">protected</span> <span class="n">Long</span> <span class="nb">id</span><span class="p">;</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>    <span class="nd">@Version</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;VERSION&quot;</span><span class="p">)</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>    <span class="n">protected</span> <span class="n">Long</span> <span class="n">version</span><span class="p">;</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>    <span class="o">//</span> <span class="n">constructeurs</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>    <span class="n">public</span> <span class="n">AbstractEntity</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>    <span class="p">}</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>    <span class="n">public</span> <span class="n">AbstractEntity</span><span class="p">(</span><span class="n">Long</span> <span class="nb">id</span><span class="p">,</span> <span class="n">Long</span> <span class="n">version</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>        <span class="n">this</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>        <span class="n">this</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span><span class="p">;</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>    <span class="p">}</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>    <span class="o">//</span> <span class="n">redéfinition</span> <span class="p">[</span><span class="n">equals</span><span class="p">]</span> <span class="n">et</span> <span class="p">[</span><span class="n">hashcode</span><span class="p">]</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>    <span class="nd">@Override</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>    <span class="n">public</span> <span class="nb">int</span> <span class="n">hashCode</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>        <span class="k">return</span> <span class="p">(</span><span class="nb">id</span> <span class="o">!=</span> <span class="n">null</span> <span class="err">?</span> <span class="nb">id</span><span class="o">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>    <span class="p">}</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>    <span class="nd">@Override</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>    <span class="n">public</span> <span class="n">boolean</span> <span class="n">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">entity</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>        <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="p">(</span><span class="n">entity</span> <span class="n">instanceof</span> <span class="n">AbstractEntity</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>        <span class="p">}</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>        <span class="n">String</span> <span class="n">class1</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">();</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>        <span class="n">String</span> <span class="n">class2</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">();</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>        <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">class2</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">class1</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>        <span class="p">}</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>        <span class="n">AbstractEntity</span> <span class="n">other</span> <span class="o">=</span> <span class="p">(</span><span class="n">AbstractEntity</span><span class="p">)</span> <span class="n">entity</span><span class="p">;</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a>        <span class="k">return</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">this</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">longValue</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">longValue</span><span class="p">();</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>    <span class="p">}</span>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a>    <span class="o">//</span> <span class="n">signature</span> <span class="n">jSON</span>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a>    <span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-23-56" name="__codelineno-23-56"></a>        <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a>        <span class="k">try</span> <span class="p">{</span>
<a id="__codelineno-23-58" name="__codelineno-23-58"></a>            <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="n">writeValueAsString</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<a id="__codelineno-23-59" name="__codelineno-23-59"></a>        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">JsonProcessingException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-23-60" name="__codelineno-23-60"></a>            <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<a id="__codelineno-23-61" name="__codelineno-23-61"></a>            <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
<a id="__codelineno-23-62" name="__codelineno-23-62"></a>        <span class="p">}</span>
<a id="__codelineno-23-63" name="__codelineno-23-63"></a>    <span class="p">}</span>
<a id="__codelineno-23-64" name="__codelineno-23-64"></a>
<a id="__codelineno-23-65" name="__codelineno-23-65"></a>    <span class="o">//</span> <span class="n">getters</span> <span class="n">et</span> <span class="n">setters</span>
<a id="__codelineno-23-66" name="__codelineno-23-66"></a><span class="o">....</span>
<a id="__codelineno-23-67" name="__codelineno-23-67"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Cette classe a pour objectif de fournir une classe mère aux entités JPA en encapsulant à un unique endroit les propriétés [id, version] (lignes 19, 22) communes aux deux entités [Produit] et [Categorie] liées à la base de données. Ces propriétés sont liées aux colonnes [ID, VERSION] des tables (lignes 18, 21).</p>
<ul>
<li>ligne 13 : l'annotation [@MappedSuperclass] indique que la classe est une classe parent d'entités JPA ;</li>
<li>ligne 16 : l'annotation [@Id] indique que le champ [id] (il pourrait avoir un autre nom) est associé à la clé primaire d'une table ;</li>
<li>ligne 17 : l'annotation [@GeneratedValue(strategy=GenerationType.<strong>IDENTITY</strong>)] fixe le mode de génération des clés primaires. Le mode [GenerationType.<strong>IDENTITY</strong>] va utiliser avec MySQL le mode [AUTO_INCREMENT]. Avec un autre SGBD, ce mode utiliserait une autre méthode. L'intérêt est que le développeur n'a pas à s'en préoccuper et que son code reste valide quelque soit le SGBD utilisé ;</li>
<li>ligne 18 : l'annotation [@Column] indique la colonne associée au champ. Lorsque cette annotation n'est pas présente, JPA assume que la colonne porte le même nom que le champ. C'est le cas ici. On n'aurait donc pu ne pas mettre cette annotation ;</li>
<li>ligne 20 : l'annotation [@Version] indique que le champ [version] est associé à une colonne de versioning. L'implémentation JPA va incrémenter ce n° de version à chaque fois que l'entité sera modifiée. Ce n° sert à empêcher la mise à jour simultanée de l'entité par deux utilisateur différents : deux utilisateurs U1 et U2 lisent l'entité E avec un n° de version égal à V1. U1 modifie E et persiste cette modification en base : le n° de version passe alors à V1+1. U2 modifie E à son tour et persiste cette modification en base : il recevra une exception car il possède une version (V1) différente de celle en base (V1+1) ;</li>
<li>lignes 35-52 : redéfinition des méthodes [hashCode] et [equals]. Par défaut, [obj1.equals(obj2)] vaut true si [obj1==obj2], ç-à-d si ob1 et obj2 sont deux pointeurs égaux. Si on veut comparer les objets pointés plutôt que les pointeurs eux-mêmes, il faut redéfinir la méthode [equals] et la méthode [hashCode]. Celle-ci doit rendre la même valeur pour deux objets que la méthode [equals] dit égaux ;</li>
<li>lignes 42-51 : deux objets de type [AbstractEntity] ou dérivés seront dits égaux si leurs clés primaires [id] sont égales ;</li>
<li>lignes 35-38 : la méthode [hashCode] rend bien la même valeur pour deux objets [AbstractEntity] identiques et donc ayant la même clé primaire [id] ;</li>
<li>lignes 55-63 : la méthode [toString] rend la chaîne jSon de l'objet [this]. Si cet objet désigne une classe fille, cette méthode rendra alors la chaîne jSON de la classe fille. Cela nous dispense de créer une méthode [toString] dans les classes filles ;</li>
</ul>
<h4 id="11352-lentite-jpa-produit">11.3.5.2. L'entité JPA [Produit]</h4>
<p>La classe [Produit] est une entité JPA associée à une ligne de la table [PRODUITS] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000024F000000AC2E1845DE.png" style="display:inline-block; margin:4px;width:11.299cm;height:3.24cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span>
<span class="normal"><a href="#__codelineno-24-34">34</a></span>
<span class="normal"><a href="#__codelineno-24-35">35</a></span>
<span class="normal"><a href="#__codelineno-24-36">36</a></span>
<span class="normal"><a href="#__codelineno-24-37">37</a></span>
<span class="normal"><a href="#__codelineno-24-38">38</a></span>
<span class="normal"><a href="#__codelineno-24-39">39</a></span>
<span class="normal"><a href="#__codelineno-24-40">40</a></span>
<span class="normal"><a href="#__codelineno-24-41">41</a></span>
<span class="normal"><a href="#__codelineno-24-42">42</a></span>
<span class="normal"><a href="#__codelineno-24-43">43</a></span>
<span class="normal"><a href="#__codelineno-24-44">44</a></span>
<span class="normal"><a href="#__codelineno-24-45">45</a></span>
<span class="normal"><a href="#__codelineno-24-46">46</a></span>
<span class="normal"><a href="#__codelineno-24-47">47</a></span>
<span class="normal"><a href="#__codelineno-24-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">package</span> <span class="n">spring</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">entities</span><span class="p">;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Column</span><span class="p">;</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.FetchType</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Table</span><span class="p">;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonFilter</span><span class="p">;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="nd">@Entity</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;PRODUITS&quot;</span><span class="p">)</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="nd">@JsonFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterProduit&quot;</span><span class="p">)</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">Produit</span> <span class="n">extends</span> <span class="n">AbstractEntity</span> <span class="p">{</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>    <span class="o">//</span> <span class="n">propriétés</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a>    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;NOM&quot;</span><span class="p">)</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a>    <span class="n">private</span> <span class="n">String</span> <span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;CATEGORIE_ID&quot;</span><span class="p">,</span> <span class="n">insertable</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span> <span class="n">updatable</span> <span class="o">=</span> <span class="n">false</span><span class="p">)</span>    
<a id="__codelineno-24-22" name="__codelineno-24-22"></a>    <span class="n">private</span> <span class="n">Long</span> <span class="n">idCategorie</span><span class="p">;</span>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a>    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;PRIX&quot;</span><span class="p">)</span>
<a id="__codelineno-24-25" name="__codelineno-24-25"></a>    <span class="n">private</span> <span class="n">double</span> <span class="n">prix</span><span class="p">;</span>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a>
<a id="__codelineno-24-27" name="__codelineno-24-27"></a>    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">)</span>
<a id="__codelineno-24-28" name="__codelineno-24-28"></a>    <span class="n">private</span> <span class="n">String</span> <span class="n">description</span><span class="p">;</span>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a>    <span class="o">//</span> <span class="n">la</span> <span class="n">catégorie</span>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a>    <span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="n">LAZY</span><span class="p">)</span>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a>    <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;CATEGORIE_ID&quot;</span><span class="p">)</span>    
<a id="__codelineno-24-33" name="__codelineno-24-33"></a>    <span class="n">private</span> <span class="n">Categorie</span> <span class="n">categorie</span><span class="p">;</span>
<a id="__codelineno-24-34" name="__codelineno-24-34"></a>
<a id="__codelineno-24-35" name="__codelineno-24-35"></a>    <span class="o">//</span> <span class="n">constructeurs</span>
<a id="__codelineno-24-36" name="__codelineno-24-36"></a>    <span class="n">public</span> <span class="n">Produit</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-24-37" name="__codelineno-24-37"></a>
<a id="__codelineno-24-38" name="__codelineno-24-38"></a>    <span class="p">}</span>
<a id="__codelineno-24-39" name="__codelineno-24-39"></a>
<a id="__codelineno-24-40" name="__codelineno-24-40"></a>    <span class="n">public</span> <span class="n">Produit</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">,</span> <span class="n">double</span> <span class="n">prix</span><span class="p">,</span> <span class="n">String</span> <span class="n">description</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-24-41" name="__codelineno-24-41"></a>        <span class="n">this</span><span class="o">.</span><span class="n">nom</span> <span class="o">=</span> <span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-24-42" name="__codelineno-24-42"></a>        <span class="n">this</span><span class="o">.</span><span class="n">prix</span> <span class="o">=</span> <span class="n">prix</span><span class="p">;</span>
<a id="__codelineno-24-43" name="__codelineno-24-43"></a>        <span class="n">this</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">;</span>
<a id="__codelineno-24-44" name="__codelineno-24-44"></a>    <span class="p">}</span>
<a id="__codelineno-24-45" name="__codelineno-24-45"></a>
<a id="__codelineno-24-46" name="__codelineno-24-46"></a>    <span class="o">//</span> <span class="n">getters</span> <span class="n">et</span> <span class="n">setters</span>
<a id="__codelineno-24-47" name="__codelineno-24-47"></a><span class="o">...</span>
<a id="__codelineno-24-48" name="__codelineno-24-48"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 12 : l'annotation [@Entity] fait de la classe [Produit] une entité gérée par la couche [JPA] ;</li>
<li>ligne 13 : l'annotation [@Table(name = "PRODUITS")] indique que la classe [Produit] est l'image objet d'une ligne de la table [PRODUITS] de la base de données ;</li>
<li>ligne 14 : le nom du filtre jSON à appliquer à l'entité. Nous allons voir que la propriété [categorie] de la ligne 13 n'est pas toujours disponible. Il faut alors l'exclure de la représentation jSON de l'objet. Pour cela nous avons besoin d'un filtre. C'est donc dans un filtre nommé [jsonFilterCategorie] que nous indiquerons si on veut ou non la propriété [categorie] ;</li>
<li>ligne 18 : l'annotation [@Column] associe le champ [nom] à la colonne [NOM] de la table [PRODUITS]. Lorsque le champ porte le même nom que la colonne associée, l'annotation [@Column] peut être omise. Ce serait le cas ici ;</li>
<li>lignes 31-33 : la catégorie du produit ;</li>
<li>ligne 31 : l'annotation [@ManyToOne] indique que la colonne de l'annotation de la ligne 32 [@JoinColumn(name = "CATEGORIE_ID")] est clé étrangère de la table [PRODUITS] de l'entité [Produit] sur la table [CATEGORIES] associée à l'entité de la ligne 33. Cette annotation doit annoter une entité JPA. Ainsi la classe de  la ligne 33 doit être une entité JPA ;</li>
<li>ligne 31 : l'annotation [fetch = FetchType.<strong>LAZY</strong>] demande à ce que lorsqu'on ramène un produit de la table [PRODUITS], sa catégorie (ligne 33) ne soit pas ramenée immédiatement (lazy loading). Elle est alors obtenue lors du premier appel à la méthode [getCategorie]. Cet attribut <strong>n'est pas contraignant</strong>. L'implémentation JPA utilisée a le droit de l'ignorer. C'est parce que la propriété [categorie] peut être présente ou non que nous avons introduit le filtre jSON de la ligne 14. Les implémentations JPA existantes (Hibernate, Eclipselink, OpenJPA) ne gèrent pas cette annotation de la même façon. Hibernate enrichit la méthode [getCategorie] initiale (qui se contente de rendre le champ categorie) par un appel au SGBD pour aller chercher la catégorie. Pour que cela soit possible, il faut que la connexion au SGBD utilisée initialement pour obtenir le produit soit encore ouverte sinon on a une exception.</li>
</ul>
<h4 id="11353-lentite-jpa-categorie">11.3.5.3. L'entité JPA [Categorie]</h4>
<p>La classe [Categorie] est une entité JPA associée à une ligne de la table [CATEGORIES] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000219000000692D8D8733.png" style="display:inline-block; margin:4px;width:9.94cm;height:1.94cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Son code est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span>
<span class="normal"><a href="#__codelineno-25-29">29</a></span>
<span class="normal"><a href="#__codelineno-25-30">30</a></span>
<span class="normal"><a href="#__codelineno-25-31">31</a></span>
<span class="normal"><a href="#__codelineno-25-32">32</a></span>
<span class="normal"><a href="#__codelineno-25-33">33</a></span>
<span class="normal"><a href="#__codelineno-25-34">34</a></span>
<span class="normal"><a href="#__codelineno-25-35">35</a></span>
<span class="normal"><a href="#__codelineno-25-36">36</a></span>
<span class="normal"><a href="#__codelineno-25-37">37</a></span>
<span class="normal"><a href="#__codelineno-25-38">38</a></span>
<span class="normal"><a href="#__codelineno-25-39">39</a></span>
<span class="normal"><a href="#__codelineno-25-40">40</a></span>
<span class="normal"><a href="#__codelineno-25-41">41</a></span>
<span class="normal"><a href="#__codelineno-25-42">42</a></span>
<span class="normal"><a href="#__codelineno-25-43">43</a></span>
<span class="normal"><a href="#__codelineno-25-44">44</a></span>
<span class="normal"><a href="#__codelineno-25-45">45</a></span>
<span class="normal"><a href="#__codelineno-25-46">46</a></span>
<span class="normal"><a href="#__codelineno-25-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.data.entities</span><span class="p">;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashSet</span><span class="p">;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.CascadeType</span><span class="p">;</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Column</span><span class="p">;</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.FetchType</span><span class="p">;</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.OneToMany</span><span class="p">;</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.Table</span><span class="p">;</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonFilter</span><span class="p">;</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="nd">@Entity</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CATEGORIES&quot;</span><span class="p">)</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="nd">@JsonFilter</span><span class="p">(</span><span class="s">&quot;jsonFilterCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Categorie</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractEntity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="w">    </span><span class="c1">// propriétés</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="w">    </span><span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NOM&quot;</span><span class="p">)</span>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="w">    </span><span class="c1">// les produits associés</span>
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="w">    </span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">,</span><span class="w"> </span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;categorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cascade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">CascadeType</span><span class="p">.</span><span class="na">ALL</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-25-27" name="__codelineno-25-27"></a>
<a id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-25-29" name="__codelineno-25-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Categorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-30" name="__codelineno-25-30"></a>
<a id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-32" name="__codelineno-25-32"></a>
<a id="__codelineno-25-33" name="__codelineno-25-33"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Categorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-34" name="__codelineno-25-34"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nom</span><span class="p">;</span>
<a id="__codelineno-25-35" name="__codelineno-25-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-36" name="__codelineno-25-36"></a>
<a id="__codelineno-25-37" name="__codelineno-25-37"></a><span class="w">    </span><span class="c1">// méthodes</span>
<a id="__codelineno-25-38" name="__codelineno-25-38"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProduit</span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-39" name="__codelineno-25-39"></a><span class="w">        </span><span class="c1">// on ajoute le produit</span>
<a id="__codelineno-25-40" name="__codelineno-25-40"></a><span class="w">        </span><span class="n">produits</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
<a id="__codelineno-25-41" name="__codelineno-25-41"></a><span class="w">        </span><span class="c1">// on fixe sa catégorie</span>
<a id="__codelineno-25-42" name="__codelineno-25-42"></a><span class="w">        </span><span class="n">produit</span><span class="p">.</span><span class="na">setCategorie</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-25-43" name="__codelineno-25-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-44" name="__codelineno-25-44"></a>
<a id="__codelineno-25-45" name="__codelineno-25-45"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-25-46" name="__codelineno-25-46"></a><span class="p">...</span>
<a id="__codelineno-25-47" name="__codelineno-25-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 21-22 : le nom de la catégorie ;</li>
<li>lignes 25-26 : les produits de cette catégorie ;</li>
<li>ligne 25 : l'annotation [@OneToMany] est la <strong>relation inverse</strong> de la relation [@ManyToOne] que nous avons rencontrée dans l'entité [Produit]. L'attribut [mappedBy = "categorie"] indique le champ de l'entité [Produit] annoté par la relation inverse [@ManyToOne]. L'attribut [cascade = { CascadeType.<strong>ALL</strong> }] demande à ce que les opérations (persist, merge, remove) faites sur une @Entity [Categorie] soient cascadées sur les [produits] de la ligne 26. On peut indiquer des cascades partielles avec les constantes [CascadeType.<strong>PERSIST</strong>, CascadeType.<strong>MERGE</strong>, CascadeType.<strong>REMOVE</strong>] ;</li>
<li>ligne 25 : l'attribut [fetch = FetchType.<strong>LAZY</strong>] demande à ce que, lorsqu'on ramène une catégorie de la table [CATEGORIES], ses produits ne soient pas immédiatement ramenés. Ils le seront lors du premier appel à la méthode [getProduits]. Les implémentations JPA existantes (Hibernate, Eclipselink, OpenJPA) ne gèrent pas cette annotation de la même façon. Hibernate enrichit la méthode [getProduits] initiale (qui se contente de rendre le champ produits) par un appel au SGBD pour aller chercher les produits de la catégorie. Pour que cela soit possible, il faut que la connexion au SGBD utilisée initialement pour obtenir la catégorie soit encore ouverte. Cet attribut <strong>est contraignant</strong>. L'implémentation JPA ne peut l'ignorer. Parce que la propriété [produits] peut être ou non initialisée, nous avons introduit le filtre jSON de la ligne 17 qui nous permettra d'indiquer si on veut ou non cette propriété ;</li>
<li>ligne 26 : le type [Set] est une interface. Le type [HashSet] est une classe implémentant cette interface. Elle implémente une collection d'éléments appelée ensemble. Un ensemble ne peut contenir deux objets identiques. Ici les objets sont de type [Produit]. Ainsi dans l'ensemble, on ne pourra avoir deux objets identiques. Comme la méthode [equals] de la classe parent [AbstractEntity] a été redéfinie pour dire que deux produits sont identiques s'ils ont la même clé primaire, alors le champ [produits] ne pourra contenir deux produits de même clé primaire ;</li>
<li>lignes 38-43 : la méthode [addProduit] permet d'ajouter un produit à la catégorie ;</li>
</ul>
<h3 id="1136-la-couche-spring-data">11.3.6. La couche [Spring Data]</h3>
<p>Couche[<strong>DAO</strong>]Couche[<strong>console</strong>]Couche[<strong>JPA</strong>]Pilote[<strong>JDBC</strong>]Couche[<strong>Spring Data</strong>]Spring 4SGBD</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000010000000139D8D8F9D3.png" style="display:inline-block; margin:4px;width:4.74cm;height:5.791cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>L'interface [CategoriesRepository] gère les accès à la table [CATEGORIES] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">package</span> <span class="n">spring</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">repositories</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.Query</span><span class="p">;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="n">public</span> <span class="n">interface</span> <span class="n">CategoriesRepository</span> <span class="n">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>    <span class="o">//</span> <span class="n">categorie</span> <span class="n">avec</span> <span class="n">ses</span> <span class="n">produits</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>    <span class="nd">@Query</span><span class="p">(</span><span class="s2">&quot;select c from Categorie c left join fetch c.produits p where c.id=?1&quot;</span><span class="p">)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>    <span class="n">public</span> <span class="n">Categorie</span> <span class="n">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">Long</span> <span class="nb">id</span><span class="p">);</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>    <span class="nd">@Query</span><span class="p">(</span><span class="s2">&quot;select c from Categorie c left join fetch c.produits p where c.nom=?1&quot;</span><span class="p">)</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>    <span class="n">public</span> <span class="n">Categorie</span> <span class="n">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a>    <span class="o">//</span> <span class="n">une</span> <span class="n">catégorie</span> <span class="n">sans</span> <span class="n">ses</span> <span class="n">produits</span> <span class="n">désignée</span> <span class="n">par</span> <span class="n">son</span> <span class="n">nom</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>    <span class="n">public</span> <span class="n">Categorie</span> <span class="n">findByNom</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 8 : l'interface [CrudRepository] a été utilisée et expliquée page 171 . On rappelle que :</li>
<li>le 1er type de l'interface est l'entité JPA gérée pour des accès CRUD (findOne, findAll, save, delete, deleteAll),</li>
<li>le second type est celui de la clé primaire de l'entité JPA, ici un entier [Long] ;</li>
<li>ligne 12 : la méthode de la ligne 12 est implémentée par la requête JPQL (Java Persistence Query Language) de la ligne 11. Celle-ci requête des entités JPA. Dans une telle requête :</li>
<li>les tables sont remplacées par leurs entités JPA associées ;</li>
<li>les colonnes sont remplacées par des champs des entités JPA utilisées dans la requête ;</li>
<li>ligne 11 : la requête JPQL ramène une catégorie avec ses produits. On se rappelle que dans l'entité [Categorie], le champ [produits] avait l'attribut [fetch = FetchType.LAZY] (lazy loading). Dans la requête JPQL, on force le chargement des produits avec le mot clé [fetch]. Le paramètre <strong>?1</strong> de la requête sera remplacé à l'exécution par la valeur du 1er paramètre de la méthode de la ligne 12, donc par le paramètre [Long id] ;</li>
<li>lignes 14-15 : une méthode analogue pour une catégorie identifiée par son nom ;</li>
<li>ligne 18 : la méthode [findByNom] sera automatiquement implémentée par [Spring Data] car le type [Category] a un champ [nom] ;</li>
</ul>
<p>L'interface [ProduitsRepository] gère les accès à la table [PRODUITS] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">package</span> <span class="n">spring</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">repositories</span><span class="p">;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.Query</span><span class="p">;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="n">public</span> <span class="n">interface</span> <span class="n">ProduitsRepository</span> <span class="n">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Produit</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>    <span class="o">//</span> <span class="n">un</span> <span class="n">produit</span> <span class="n">avec</span> <span class="n">sa</span> <span class="n">catégorie</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>    <span class="nd">@Query</span><span class="p">(</span><span class="s2">&quot;select p from Produit p left join fetch p.categorie c where p.id=?1&quot;</span><span class="p">)</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>    <span class="n">public</span> <span class="n">Produit</span> <span class="n">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">Long</span> <span class="nb">id</span><span class="p">);</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>    <span class="nd">@Query</span><span class="p">(</span><span class="s2">&quot;select p from Produit p left join fetch p.categorie c where p.nom=?1&quot;</span><span class="p">)</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a>    <span class="n">public</span> <span class="n">Produit</span> <span class="n">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a>    <span class="o">//</span> <span class="n">un</span> <span class="n">produit</span> <span class="n">sans</span> <span class="n">sa</span> <span class="n">catégorie</span> <span class="n">désigné</span> <span class="n">par</span> <span class="n">son</span> <span class="n">nom</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a>    <span class="n">public</span> <span class="n">Produit</span> <span class="n">findByNom</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Les explications sont les mêmes que pour l'interface [CategoriesRepository].</p>
<p>Ces interfaces vont être implémentées par des classes générées par [Spring Data] au moment de l'exécution du projet. On appelle de telles classes des [proxy]. Par défaut, les méthodes de la classe d'implémentation <strong>s'exécutent dans une transaction</strong>. Le fait que ces interfaces étendent la classe [CrudRepository] font d'elles des composants Spring.</p>
<h3 id="1137-la-couche-dao">11.3.7. La couche [DAO]</h3>
<p>Couche[<strong>DAO</strong>]Couche[<strong>console</strong>]Couche[<strong>JPA</strong>]Pilote[<strong>JDBC</strong>]Couche[<strong>Spring Data</strong>]Spring 4SGBD</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D7000000C851D05EDC.png" style="display:inline-block; margin:4px;width:3.979cm;height:3.679cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>L'interface [IDao] de la couche [DAO] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span>
<span class="normal"><a href="#__codelineno-28-26">26</a></span>
<span class="normal"><a href="#__codelineno-28-27">27</a></span>
<span class="normal"><a href="#__codelineno-28-28">28</a></span>
<span class="normal"><a href="#__codelineno-28-29">29</a></span>
<span class="normal"><a href="#__codelineno-28-30">30</a></span>
<span class="normal"><a href="#__codelineno-28-31">31</a></span>
<span class="normal"><a href="#__codelineno-28-32">32</a></span>
<span class="normal"><a href="#__codelineno-28-33">33</a></span>
<span class="normal"><a href="#__codelineno-28-34">34</a></span>
<span class="normal"><a href="#__codelineno-28-35">35</a></span>
<span class="normal"><a href="#__codelineno-28-36">36</a></span>
<span class="normal"><a href="#__codelineno-28-37">37</a></span>
<span class="normal"><a href="#__codelineno-28-38">38</a></span>
<span class="normal"><a href="#__codelineno-28-39">39</a></span>
<span class="normal"><a href="#__codelineno-28-40">40</a></span>
<span class="normal"><a href="#__codelineno-28-41">41</a></span>
<span class="normal"><a href="#__codelineno-28-42">42</a></span>
<span class="normal"><a href="#__codelineno-28-43">43</a></span>
<span class="normal"><a href="#__codelineno-28-44">44</a></span>
<span class="normal"><a href="#__codelineno-28-45">45</a></span>
<span class="normal"><a href="#__codelineno-28-46">46</a></span>
<span class="normal"><a href="#__codelineno-28-47">47</a></span>
<span class="normal"><a href="#__codelineno-28-48">48</a></span>
<span class="normal"><a href="#__codelineno-28-49">49</a></span>
<span class="normal"><a href="#__codelineno-28-50">50</a></span>
<span class="normal"><a href="#__codelineno-28-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.data.dao</span><span class="p">;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">IDao</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">    </span><span class="c1">// insertion d&#39;une liste de produits</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">    </span><span class="c1">// suppression de tous les produits</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllProduits</span><span class="p">();</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">    </span><span class="c1">// mise à jour d&#39;une liste de produits</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">    </span><span class="c1">// obtention de tous les produits</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllProduits</span><span class="p">();</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a><span class="w">    </span><span class="c1">// insertion d&#39;une liste de categories</span>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="w">    </span><span class="c1">// suppression de tous les categories</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a><span class="w">    </span><span class="c1">// mise à jour d&#39;une liste de categories</span>
<a id="__codelineno-28-29" name="__codelineno-28-29"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-28-30" name="__codelineno-28-30"></a>
<a id="__codelineno-28-31" name="__codelineno-28-31"></a><span class="w">    </span><span class="c1">// obtention de tous les categories</span>
<a id="__codelineno-28-32" name="__codelineno-28-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllCategories</span><span class="p">();</span>
<a id="__codelineno-28-33" name="__codelineno-28-33"></a>
<a id="__codelineno-28-34" name="__codelineno-28-34"></a><span class="w">    </span><span class="c1">// un produit particulier avec ou non sa catégorie</span>
<a id="__codelineno-28-35" name="__codelineno-28-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-28-36" name="__codelineno-28-36"></a>
<a id="__codelineno-28-37" name="__codelineno-28-37"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-28-38" name="__codelineno-28-38"></a>
<a id="__codelineno-28-39" name="__codelineno-28-39"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-28-40" name="__codelineno-28-40"></a>
<a id="__codelineno-28-41" name="__codelineno-28-41"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithoutCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-28-42" name="__codelineno-28-42"></a>
<a id="__codelineno-28-43" name="__codelineno-28-43"></a><span class="w">    </span><span class="c1">// une catégorie particulière avec ou pas ses produits</span>
<a id="__codelineno-28-44" name="__codelineno-28-44"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-28-45" name="__codelineno-28-45"></a>
<a id="__codelineno-28-46" name="__codelineno-28-46"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-28-47" name="__codelineno-28-47"></a>
<a id="__codelineno-28-48" name="__codelineno-28-48"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-28-49" name="__codelineno-28-49"></a>
<a id="__codelineno-28-50" name="__codelineno-28-50"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-28-51" name="__codelineno-28-51"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>On a adopté ici la règle que toute méthode qui modifie les objets qu'elle a en paramètres d'entrée doit alors les rendre dans son résultat. La raison de cette règle a été expliquée au paragraphe 4.2, page 34 : elle permet à une couche et à son client d'être dans deux JVM séparées et donc de travailler en client / serveur.</p>
<p>L'implémentation [Dao] de cette interface est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">  1</a></span>
<span class="normal"><a href="#__codelineno-29-2">  2</a></span>
<span class="normal"><a href="#__codelineno-29-3">  3</a></span>
<span class="normal"><a href="#__codelineno-29-4">  4</a></span>
<span class="normal"><a href="#__codelineno-29-5">  5</a></span>
<span class="normal"><a href="#__codelineno-29-6">  6</a></span>
<span class="normal"><a href="#__codelineno-29-7">  7</a></span>
<span class="normal"><a href="#__codelineno-29-8">  8</a></span>
<span class="normal"><a href="#__codelineno-29-9">  9</a></span>
<span class="normal"><a href="#__codelineno-29-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-29-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-29-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-29-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-29-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-29-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-29-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-29-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-29-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-29-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-29-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-29-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-29-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-29-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-29-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-29-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-29-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-29-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-29-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-29-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-29-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-29-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-29-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-29-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-29-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-29-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-29-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-29-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-29-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-29-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-29-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-29-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-29-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-29-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-29-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-29-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-29-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-29-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-29-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-29-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-29-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-29-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-29-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-29-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-29-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-29-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-29-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-29-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-29-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-29-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-29-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-29-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-29-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-29-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-29-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-29-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-29-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-29-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-29-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-29-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-29-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-29-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-29-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-29-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-29-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-29-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-29-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-29-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-29-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-29-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-29-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-29-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-29-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-29-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-29-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-29-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-29-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-29-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-29-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-29-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-29-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-29-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-29-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-29-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-29-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-29-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-29-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-29-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-29-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-29-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-29-100">100</a></span>
<span class="normal"><a href="#__codelineno-29-101">101</a></span>
<span class="normal"><a href="#__codelineno-29-102">102</a></span>
<span class="normal"><a href="#__codelineno-29-103">103</a></span>
<span class="normal"><a href="#__codelineno-29-104">104</a></span>
<span class="normal"><a href="#__codelineno-29-105">105</a></span>
<span class="normal"><a href="#__codelineno-29-106">106</a></span>
<span class="normal"><a href="#__codelineno-29-107">107</a></span>
<span class="normal"><a href="#__codelineno-29-108">108</a></span>
<span class="normal"><a href="#__codelineno-29-109">109</a></span>
<span class="normal"><a href="#__codelineno-29-110">110</a></span>
<span class="normal"><a href="#__codelineno-29-111">111</a></span>
<span class="normal"><a href="#__codelineno-29-112">112</a></span>
<span class="normal"><a href="#__codelineno-29-113">113</a></span>
<span class="normal"><a href="#__codelineno-29-114">114</a></span>
<span class="normal"><a href="#__codelineno-29-115">115</a></span>
<span class="normal"><a href="#__codelineno-29-116">116</a></span>
<span class="normal"><a href="#__codelineno-29-117">117</a></span>
<span class="normal"><a href="#__codelineno-29-118">118</a></span>
<span class="normal"><a href="#__codelineno-29-119">119</a></span>
<span class="normal"><a href="#__codelineno-29-120">120</a></span>
<span class="normal"><a href="#__codelineno-29-121">121</a></span>
<span class="normal"><a href="#__codelineno-29-122">122</a></span>
<span class="normal"><a href="#__codelineno-29-123">123</a></span>
<span class="normal"><a href="#__codelineno-29-124">124</a></span>
<span class="normal"><a href="#__codelineno-29-125">125</a></span>
<span class="normal"><a href="#__codelineno-29-126">126</a></span>
<span class="normal"><a href="#__codelineno-29-127">127</a></span>
<span class="normal"><a href="#__codelineno-29-128">128</a></span>
<span class="normal"><a href="#__codelineno-29-129">129</a></span>
<span class="normal"><a href="#__codelineno-29-130">130</a></span>
<span class="normal"><a href="#__codelineno-29-131">131</a></span>
<span class="normal"><a href="#__codelineno-29-132">132</a></span>
<span class="normal"><a href="#__codelineno-29-133">133</a></span>
<span class="normal"><a href="#__codelineno-29-134">134</a></span>
<span class="normal"><a href="#__codelineno-29-135">135</a></span>
<span class="normal"><a href="#__codelineno-29-136">136</a></span>
<span class="normal"><a href="#__codelineno-29-137">137</a></span>
<span class="normal"><a href="#__codelineno-29-138">138</a></span>
<span class="normal"><a href="#__codelineno-29-139">139</a></span>
<span class="normal"><a href="#__codelineno-29-140">140</a></span>
<span class="normal"><a href="#__codelineno-29-141">141</a></span>
<span class="normal"><a href="#__codelineno-29-142">142</a></span>
<span class="normal"><a href="#__codelineno-29-143">143</a></span>
<span class="normal"><a href="#__codelineno-29-144">144</a></span>
<span class="normal"><a href="#__codelineno-29-145">145</a></span>
<span class="normal"><a href="#__codelineno-29-146">146</a></span>
<span class="normal"><a href="#__codelineno-29-147">147</a></span>
<span class="normal"><a href="#__codelineno-29-148">148</a></span>
<span class="normal"><a href="#__codelineno-29-149">149</a></span>
<span class="normal"><a href="#__codelineno-29-150">150</a></span>
<span class="normal"><a href="#__codelineno-29-151">151</a></span>
<span class="normal"><a href="#__codelineno-29-152">152</a></span>
<span class="normal"><a href="#__codelineno-29-153">153</a></span>
<span class="normal"><a href="#__codelineno-29-154">154</a></span>
<span class="normal"><a href="#__codelineno-29-155">155</a></span>
<span class="normal"><a href="#__codelineno-29-156">156</a></span>
<span class="normal"><a href="#__codelineno-29-157">157</a></span>
<span class="normal"><a href="#__codelineno-29-158">158</a></span>
<span class="normal"><a href="#__codelineno-29-159">159</a></span>
<span class="normal"><a href="#__codelineno-29-160">160</a></span>
<span class="normal"><a href="#__codelineno-29-161">161</a></span>
<span class="normal"><a href="#__codelineno-29-162">162</a></span>
<span class="normal"><a href="#__codelineno-29-163">163</a></span>
<span class="normal"><a href="#__codelineno-29-164">164</a></span>
<span class="normal"><a href="#__codelineno-29-165">165</a></span>
<span class="normal"><a href="#__codelineno-29-166">166</a></span>
<span class="normal"><a href="#__codelineno-29-167">167</a></span>
<span class="normal"><a href="#__codelineno-29-168">168</a></span>
<span class="normal"><a href="#__codelineno-29-169">169</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.data.dao</span><span class="p">;</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.collect.Lists</span><span class="p">;</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.repositories.CategoriesRepository</span><span class="p">;</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.repositories.ProduitsRepository</span><span class="p">;</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="nd">@Component</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Dao</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">IDao</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a>
<a id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ProduitsRepository</span><span class="w"> </span><span class="n">produitsRepository</span><span class="p">;</span>
<a id="__codelineno-29-21" name="__codelineno-29-21"></a>
<a id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CategoriesRepository</span><span class="w"> </span><span class="n">categoriesRepository</span><span class="p">;</span>
<a id="__codelineno-29-24" name="__codelineno-29-24"></a>
<a id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">produits</span><span class="p">));</span>
<a id="__codelineno-29-29" name="__codelineno-29-29"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-30" name="__codelineno-29-30"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-31" name="__codelineno-29-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-32" name="__codelineno-29-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-33" name="__codelineno-29-33"></a>
<a id="__codelineno-29-34" name="__codelineno-29-34"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-35" name="__codelineno-29-35"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-36" name="__codelineno-29-36"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-37" name="__codelineno-29-37"></a><span class="w">            </span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<a id="__codelineno-29-38" name="__codelineno-29-38"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-39" name="__codelineno-29-39"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-40" name="__codelineno-29-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-41" name="__codelineno-29-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-42" name="__codelineno-29-42"></a>
<a id="__codelineno-29-43" name="__codelineno-29-43"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-44" name="__codelineno-29-44"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateProduits</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-45" name="__codelineno-29-45"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-46" name="__codelineno-29-46"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">produits</span><span class="p">));</span>
<a id="__codelineno-29-47" name="__codelineno-29-47"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-48" name="__codelineno-29-48"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">103</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-49" name="__codelineno-29-49"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-50" name="__codelineno-29-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-51" name="__codelineno-29-51"></a>
<a id="__codelineno-29-52" name="__codelineno-29-52"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-53" name="__codelineno-29-53"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">addCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-54" name="__codelineno-29-54"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-55" name="__codelineno-29-55"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">categories</span><span class="p">));</span>
<a id="__codelineno-29-56" name="__codelineno-29-56"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-57" name="__codelineno-29-57"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-58" name="__codelineno-29-58"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-59" name="__codelineno-29-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-60" name="__codelineno-29-60"></a>
<a id="__codelineno-29-61" name="__codelineno-29-61"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-62" name="__codelineno-29-62"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deleteAllCategories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-63" name="__codelineno-29-63"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-64" name="__codelineno-29-64"></a><span class="w">            </span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">deleteAll</span><span class="p">();</span>
<a id="__codelineno-29-65" name="__codelineno-29-65"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-66" name="__codelineno-29-66"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-67" name="__codelineno-29-67"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-68" name="__codelineno-29-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-69" name="__codelineno-29-69"></a>
<a id="__codelineno-29-70" name="__codelineno-29-70"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-71" name="__codelineno-29-71"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">updateCategories</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-72" name="__codelineno-29-72"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-73" name="__codelineno-29-73"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">categories</span><span class="p">));</span>
<a id="__codelineno-29-74" name="__codelineno-29-74"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-75" name="__codelineno-29-75"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-76" name="__codelineno-29-76"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-77" name="__codelineno-29-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-78" name="__codelineno-29-78"></a>
<a id="__codelineno-29-79" name="__codelineno-29-79"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-80" name="__codelineno-29-80"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllCategories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-81" name="__codelineno-29-81"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-82" name="__codelineno-29-82"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">());</span>
<a id="__codelineno-29-83" name="__codelineno-29-83"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-84" name="__codelineno-29-84"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-85" name="__codelineno-29-85"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-86" name="__codelineno-29-86"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-87" name="__codelineno-29-87"></a>
<a id="__codelineno-29-88" name="__codelineno-29-88"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-89" name="__codelineno-29-89"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-90" name="__codelineno-29-90"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-91" name="__codelineno-29-91"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">());</span>
<a id="__codelineno-29-92" name="__codelineno-29-92"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-93" name="__codelineno-29-93"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">108</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-94" name="__codelineno-29-94"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-95" name="__codelineno-29-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-96" name="__codelineno-29-96"></a>
<a id="__codelineno-29-97" name="__codelineno-29-97"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-98" name="__codelineno-29-98"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-99" name="__codelineno-29-99"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-100" name="__codelineno-29-100"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-29-101" name="__codelineno-29-101"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-102" name="__codelineno-29-102"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">109</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-103" name="__codelineno-29-103"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-104" name="__codelineno-29-104"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-105" name="__codelineno-29-105"></a>
<a id="__codelineno-29-106" name="__codelineno-29-106"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-107" name="__codelineno-29-107"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-108" name="__codelineno-29-108"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-109" name="__codelineno-29-109"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">getCategorieByIdWithProduits</span><span class="p">(</span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-29-110" name="__codelineno-29-110"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-111" name="__codelineno-29-111"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-112" name="__codelineno-29-112"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-113" name="__codelineno-29-113"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-114" name="__codelineno-29-114"></a>
<a id="__codelineno-29-115" name="__codelineno-29-115"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-116" name="__codelineno-29-116"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-117" name="__codelineno-29-117"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-118" name="__codelineno-29-118"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-29-119" name="__codelineno-29-119"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-120" name="__codelineno-29-120"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-121" name="__codelineno-29-121"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-122" name="__codelineno-29-122"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-123" name="__codelineno-29-123"></a>
<a id="__codelineno-29-124" name="__codelineno-29-124"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-125" name="__codelineno-29-125"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-126" name="__codelineno-29-126"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-127" name="__codelineno-29-127"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-29-128" name="__codelineno-29-128"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-129" name="__codelineno-29-129"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-130" name="__codelineno-29-130"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-131" name="__codelineno-29-131"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-132" name="__codelineno-29-132"></a>
<a id="__codelineno-29-133" name="__codelineno-29-133"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-134" name="__codelineno-29-134"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idProduit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-135" name="__codelineno-29-135"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-136" name="__codelineno-29-136"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">idProduit</span><span class="p">);</span>
<a id="__codelineno-29-137" name="__codelineno-29-137"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-138" name="__codelineno-29-138"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">113</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-139" name="__codelineno-29-139"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-140" name="__codelineno-29-140"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-141" name="__codelineno-29-141"></a>
<a id="__codelineno-29-142" name="__codelineno-29-142"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-143" name="__codelineno-29-143"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByIdWithoutProduits</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-144" name="__codelineno-29-144"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-145" name="__codelineno-29-145"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-29-146" name="__codelineno-29-146"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-147" name="__codelineno-29-147"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-148" name="__codelineno-29-148"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-149" name="__codelineno-29-149"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-150" name="__codelineno-29-150"></a>
<a id="__codelineno-29-151" name="__codelineno-29-151"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-152" name="__codelineno-29-152"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">getProduitByNameWithoutCategorie</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-153" name="__codelineno-29-153"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-154" name="__codelineno-29-154"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">produitsRepository</span><span class="p">.</span><span class="na">findByNom</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-29-155" name="__codelineno-29-155"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-156" name="__codelineno-29-156"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-157" name="__codelineno-29-157"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-158" name="__codelineno-29-158"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-159" name="__codelineno-29-159"></a>
<a id="__codelineno-29-160" name="__codelineno-29-160"></a><span class="w">    </span><span class="nd">@Override</span>
<a id="__codelineno-29-161" name="__codelineno-29-161"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-162" name="__codelineno-29-162"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-163" name="__codelineno-29-163"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">categoriesRepository</span><span class="p">.</span><span class="na">findByNom</span><span class="p">(</span><span class="n">nom</span><span class="p">);</span>
<a id="__codelineno-29-164" name="__codelineno-29-164"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-165" name="__codelineno-29-165"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DaoException</span><span class="p">(</span><span class="mi">116</span><span class="p">,</span><span class="w"> </span><span class="n">getMessagesForException</span><span class="p">(</span><span class="n">e</span><span class="p">));</span>
<a id="__codelineno-29-166" name="__codelineno-29-166"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-29-167" name="__codelineno-29-167"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-168" name="__codelineno-29-168"></a>
<a id="__codelineno-29-169" name="__codelineno-29-169"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 16 : l'annotation [@Component] fait de la classe [Dao] un composant Spring ;</li>
<li>lignes 19-23 : injection des références sur les deux interfaces [CrudRepository] de [Spring Data]. Cette injection aura lieu lors de l'instantiation des objets Spring, en général au début de l'exécution du projet Spring ;</li>
<li>on notera lignes 28 et 46 que la méthode [save] de l'interface [produitsRepository] est utilisée aussi bien pour l'insertion que pour la mise à jour de produits. [Spring Data] utilise la clé primaire du produit pour savoir s'il doit faire une insertion ou une mise à jour. Si la clé primaire vaut [null], ce sera une insertion sinon ce sera une mise à jour ;</li>
<li>ligne 82 : on utilise la méthode [Lists.newArrayList] de la bibliothèque Guava pour obtenir une liste de produits. La méthode [produitsRepository.findAll()] rend un type [Iterable&lt;Produit&gt;] ;</li>
<li>ligne 28 : la méthode [produitsRepository.save(produits)] rend un type [Iterable&lt;Produit&gt;]. Il en est de même pour les autres opérations [save] de la classe ;</li>
</ul>
<p>Dans la classe [Dao] ci-dessus, les exceptions qui peuvent se produire sont encapsulées dans le type [DaoException] suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span>
<span class="normal"><a href="#__codelineno-30-24">24</a></span>
<span class="normal"><a href="#__codelineno-30-25">25</a></span>
<span class="normal"><a href="#__codelineno-30-26">26</a></span>
<span class="normal"><a href="#__codelineno-30-27">27</a></span>
<span class="normal"><a href="#__codelineno-30-28">28</a></span>
<span class="normal"><a href="#__codelineno-30-29">29</a></span>
<span class="normal"><a href="#__codelineno-30-30">30</a></span>
<span class="normal"><a href="#__codelineno-30-31">31</a></span>
<span class="normal"><a href="#__codelineno-30-32">32</a></span>
<span class="normal"><a href="#__codelineno-30-33">33</a></span>
<span class="normal"><a href="#__codelineno-30-34">34</a></span>
<span class="normal"><a href="#__codelineno-30-35">35</a></span>
<span class="normal"><a href="#__codelineno-30-36">36</a></span>
<span class="normal"><a href="#__codelineno-30-37">37</a></span>
<span class="normal"><a href="#__codelineno-30-38">38</a></span>
<span class="normal"><a href="#__codelineno-30-39">39</a></span>
<span class="normal"><a href="#__codelineno-30-40">40</a></span>
<span class="normal"><a href="#__codelineno-30-41">41</a></span>
<span class="normal"><a href="#__codelineno-30-42">42</a></span>
<span class="normal"><a href="#__codelineno-30-43">43</a></span>
<span class="normal"><a href="#__codelineno-30-44">44</a></span>
<span class="normal"><a href="#__codelineno-30-45">45</a></span>
<span class="normal"><a href="#__codelineno-30-46">46</a></span>
<span class="normal"><a href="#__codelineno-30-47">47</a></span>
<span class="normal"><a href="#__codelineno-30-48">48</a></span>
<span class="normal"><a href="#__codelineno-30-49">49</a></span>
<span class="normal"><a href="#__codelineno-30-50">50</a></span>
<span class="normal"><a href="#__codelineno-30-51">51</a></span>
<span class="normal"><a href="#__codelineno-30-52">52</a></span>
<span class="normal"><a href="#__codelineno-30-53">53</a></span>
<span class="normal"><a href="#__codelineno-30-54">54</a></span>
<span class="normal"><a href="#__codelineno-30-55">55</a></span>
<span class="normal"><a href="#__codelineno-30-56">56</a></span>
<span class="normal"><a href="#__codelineno-30-57">57</a></span>
<span class="normal"><a href="#__codelineno-30-58">58</a></span>
<span class="normal"><a href="#__codelineno-30-59">59</a></span>
<span class="normal"><a href="#__codelineno-30-60">60</a></span>
<span class="normal"><a href="#__codelineno-30-61">61</a></span>
<span class="normal"><a href="#__codelineno-30-62">62</a></span>
<span class="normal"><a href="#__codelineno-30-63">63</a></span>
<span class="normal"><a href="#__codelineno-30-64">64</a></span>
<span class="normal"><a href="#__codelineno-30-65">65</a></span>
<span class="normal"><a href="#__codelineno-30-66">66</a></span>
<span class="normal"><a href="#__codelineno-30-67">67</a></span>
<span class="normal"><a href="#__codelineno-30-68">68</a></span>
<span class="normal"><a href="#__codelineno-30-69">69</a></span>
<span class="normal"><a href="#__codelineno-30-70">70</a></span>
<span class="normal"><a href="#__codelineno-30-71">71</a></span>
<span class="normal"><a href="#__codelineno-30-72">72</a></span>
<span class="normal"><a href="#__codelineno-30-73">73</a></span>
<span class="normal"><a href="#__codelineno-30-74">74</a></span>
<span class="normal"><a href="#__codelineno-30-75">75</a></span>
<span class="normal"><a href="#__codelineno-30-76">76</a></span>
<span class="normal"><a href="#__codelineno-30-77">77</a></span>
<span class="normal"><a href="#__codelineno-30-78">78</a></span>
<span class="normal"><a href="#__codelineno-30-79">79</a></span>
<span class="normal"><a href="#__codelineno-30-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.data.dao</span><span class="p">;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Serializable</span><span class="p">;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="c1">// classe d&#39;exception pour l&#39;application Elections</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="c1">// l&#39;exception est non contrôlée</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DaoException</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RuntimeException</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="w">    </span><span class="c1">// serial ID</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="w">    </span><span class="c1">// champs locaux</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">erreurs</span><span class="p">;</span>
<a id="__codelineno-30-18" name="__codelineno-30-18"></a>
<a id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="w">    </span><span class="c1">// constructeurs</span>
<a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DaoException</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">        </span><span class="kd">super</span><span class="p">();</span>
<a id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-23" name="__codelineno-30-23"></a>
<a id="__codelineno-30-24" name="__codelineno-30-24"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DaoException</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="w">        </span><span class="c1">// parent</span>
<a id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="w">        </span><span class="c1">// local</span>
<a id="__codelineno-30-28" name="__codelineno-30-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<a id="__codelineno-30-29" name="__codelineno-30-29"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getErreursForException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-30-30" name="__codelineno-30-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-31" name="__codelineno-30-31"></a>
<a id="__codelineno-30-32" name="__codelineno-30-32"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DaoException</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-33" name="__codelineno-30-33"></a><span class="w">        </span><span class="c1">// parent</span>
<a id="__codelineno-30-34" name="__codelineno-30-34"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-30-35" name="__codelineno-30-35"></a><span class="w">        </span><span class="c1">// local</span>
<a id="__codelineno-30-36" name="__codelineno-30-36"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<a id="__codelineno-30-37" name="__codelineno-30-37"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getErreursForException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-30-38" name="__codelineno-30-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-39" name="__codelineno-30-39"></a>
<a id="__codelineno-30-40" name="__codelineno-30-40"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DaoException</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-41" name="__codelineno-30-41"></a><span class="w">        </span><span class="c1">// parent</span>
<a id="__codelineno-30-42" name="__codelineno-30-42"></a><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-30-43" name="__codelineno-30-43"></a><span class="w">        </span><span class="c1">// local</span>
<a id="__codelineno-30-44" name="__codelineno-30-44"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<a id="__codelineno-30-45" name="__codelineno-30-45"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-30-46" name="__codelineno-30-46"></a><span class="w">        </span><span class="n">erreurs</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-30-47" name="__codelineno-30-47"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erreurs</span><span class="p">;</span>
<a id="__codelineno-30-48" name="__codelineno-30-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-49" name="__codelineno-30-49"></a>
<a id="__codelineno-30-50" name="__codelineno-30-50"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DaoException</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">erreurs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-51" name="__codelineno-30-51"></a><span class="w">        </span><span class="c1">// parent</span>
<a id="__codelineno-30-52" name="__codelineno-30-52"></a><span class="w">        </span><span class="kd">super</span><span class="p">();</span>
<a id="__codelineno-30-53" name="__codelineno-30-53"></a><span class="w">        </span><span class="c1">// local</span>
<a id="__codelineno-30-54" name="__codelineno-30-54"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span><span class="p">;</span>
<a id="__codelineno-30-55" name="__codelineno-30-55"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">erreurs</span><span class="p">;</span>
<a id="__codelineno-30-56" name="__codelineno-30-56"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-57" name="__codelineno-30-57"></a>
<a id="__codelineno-30-58" name="__codelineno-30-58"></a><span class="w">    </span><span class="c1">// liste des messages d&#39;erreur d&#39;une exception</span>
<a id="__codelineno-30-59" name="__codelineno-30-59"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getErreursForException</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">th</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-60" name="__codelineno-30-60"></a><span class="w">        </span><span class="c1">// on récupère la liste des messages d&#39;erreur de l&#39;exception</span>
<a id="__codelineno-30-61" name="__codelineno-30-61"></a><span class="w">        </span><span class="n">Throwable</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">th</span><span class="p">;</span>
<a id="__codelineno-30-62" name="__codelineno-30-62"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">erreurs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-30-63" name="__codelineno-30-63"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">cause</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-64" name="__codelineno-30-64"></a><span class="w">            </span><span class="c1">// on récupère le message seulement s&#39;il est !=null et non blanc</span>
<a id="__codelineno-30-65" name="__codelineno-30-65"></a><span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cause</span><span class="p">.</span><span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-30-66" name="__codelineno-30-66"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">message</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-67" name="__codelineno-30-67"></a><span class="w">                </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">trim</span><span class="p">();</span>
<a id="__codelineno-30-68" name="__codelineno-30-68"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-69" name="__codelineno-30-69"></a><span class="w">                    </span><span class="n">erreurs</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-30-70" name="__codelineno-30-70"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-30-71" name="__codelineno-30-71"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-30-72" name="__codelineno-30-72"></a><span class="w">            </span><span class="c1">// cause suivante</span>
<a id="__codelineno-30-73" name="__codelineno-30-73"></a><span class="w">            </span><span class="n">cause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cause</span><span class="p">.</span><span class="na">getCause</span><span class="p">();</span>
<a id="__codelineno-30-74" name="__codelineno-30-74"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-30-75" name="__codelineno-30-75"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">erreurs</span><span class="p">;</span>
<a id="__codelineno-30-76" name="__codelineno-30-76"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-77" name="__codelineno-30-77"></a>
<a id="__codelineno-30-78" name="__codelineno-30-78"></a><span class="w">    </span><span class="c1">// getters et setters</span>
<a id="__codelineno-30-79" name="__codelineno-30-79"></a><span class="p">...</span>
<a id="__codelineno-30-80" name="__codelineno-30-80"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 10 : la classe dérive de la classe [RuntimeException] et est donc une exception non contrôlée ;</li>
<li>ligne 16 : un code d'erreur ;</li>
<li>ligne 17 : une liste de messages d'erreur, ceux associés à la pile des exceptions qui ont provoqué la [DaoException] ;</li>
<li>lignes 59-76 : la méthode privée [getMessagesForException] permet d'obtenir la liste des messages d'erreurs associées aux exception de la pile d'exceptions. Il est en effet possible d'empiler les exceptions avec les constructeurs suivants de la classe <strong>Exception</strong> :</li>
<li><strong>Exception(String message, Throwable cause)</strong> : crée une exception avec un message et l'exception qu'on veut encapsuler ;</li>
<li><strong>Exception(Throwable cause)</strong> : crée une exception avec l'exception qu'on veut encapsuler ;</li>
</ul>
<p>Le type [Throwable] est la classe parent de la classe [Exception]. Si les constructeurs précédents sont exécutés de façon répétée, l'exception finale contient alors plusieurs exceptions. On dit qu'on a une pile d'exceptions. </p>
<ul>
<li>la dernière cause d'une exception e1 est obtenue par l'expression [e1.getCause()] ;</li>
<li>l'avant-dernière cause d'une exception e1 est obtenue par l'expression [e1.getCause().getCause()] ;</li>
<li>on poursuit ainsi jusqu'à obtenir [getCause()==null] ;</li>
</ul>
<h3 id="1138-configuration-du-projet-spring">11.3.8. Configuration du projet Spring</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000EB000000C97BBACDD4.png" style="display:inline-block; margin:4px;width:4.35cm;height:3.72cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [DaoConfig] configure la couche [DAO] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span>
<span class="normal"><a href="#__codelineno-31-35">35</a></span>
<span class="normal"><a href="#__codelineno-31-36">36</a></span>
<span class="normal"><a href="#__codelineno-31-37">37</a></span>
<span class="normal"><a href="#__codelineno-31-38">38</a></span>
<span class="normal"><a href="#__codelineno-31-39">39</a></span>
<span class="normal"><a href="#__codelineno-31-40">40</a></span>
<span class="normal"><a href="#__codelineno-31-41">41</a></span>
<span class="normal"><a href="#__codelineno-31-42">42</a></span>
<span class="normal"><a href="#__codelineno-31-43">43</a></span>
<span class="normal"><a href="#__codelineno-31-44">44</a></span>
<span class="normal"><a href="#__codelineno-31-45">45</a></span>
<span class="normal"><a href="#__codelineno-31-46">46</a></span>
<span class="normal"><a href="#__codelineno-31-47">47</a></span>
<span class="normal"><a href="#__codelineno-31-48">48</a></span>
<span class="normal"><a href="#__codelineno-31-49">49</a></span>
<span class="normal"><a href="#__codelineno-31-50">50</a></span>
<span class="normal"><a href="#__codelineno-31-51">51</a></span>
<span class="normal"><a href="#__codelineno-31-52">52</a></span>
<span class="normal"><a href="#__codelineno-31-53">53</a></span>
<span class="normal"><a href="#__codelineno-31-54">54</a></span>
<span class="normal"><a href="#__codelineno-31-55">55</a></span>
<span class="normal"><a href="#__codelineno-31-56">56</a></span>
<span class="normal"><a href="#__codelineno-31-57">57</a></span>
<span class="normal"><a href="#__codelineno-31-58">58</a></span>
<span class="normal"><a href="#__codelineno-31-59">59</a></span>
<span class="normal"><a href="#__codelineno-31-60">60</a></span>
<span class="normal"><a href="#__codelineno-31-61">61</a></span>
<span class="normal"><a href="#__codelineno-31-62">62</a></span>
<span class="normal"><a href="#__codelineno-31-63">63</a></span>
<span class="normal"><a href="#__codelineno-31-64">64</a></span>
<span class="normal"><a href="#__codelineno-31-65">65</a></span>
<span class="normal"><a href="#__codelineno-31-66">66</a></span>
<span class="normal"><a href="#__codelineno-31-67">67</a></span>
<span class="normal"><a href="#__codelineno-31-68">68</a></span>
<span class="normal"><a href="#__codelineno-31-69">69</a></span>
<span class="normal"><a href="#__codelineno-31-70">70</a></span>
<span class="normal"><a href="#__codelineno-31-71">71</a></span>
<span class="normal"><a href="#__codelineno-31-72">72</a></span>
<span class="normal"><a href="#__codelineno-31-73">73</a></span>
<span class="normal"><a href="#__codelineno-31-74">74</a></span>
<span class="normal"><a href="#__codelineno-31-75">75</a></span>
<span class="normal"><a href="#__codelineno-31-76">76</a></span>
<span class="normal"><a href="#__codelineno-31-77">77</a></span>
<span class="normal"><a href="#__codelineno-31-78">78</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">package</span> <span class="n">spring</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">config</span><span class="p">;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">javax.persistence.EntityManagerFactory</span><span class="p">;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.tomcat.jdbc.pool.DataSource</span><span class="p">;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span><span class="p">;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="p">;</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="p">;</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="p">;</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="p">;</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="p">;</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="p">;</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="nd">@EnableJpaRepositories</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;spring.data.repositories&quot;</span> <span class="p">})</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="nd">@Configuration</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="nd">@ComponentScan</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;spring.data.dao&quot;</span> <span class="p">})</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">DaoConfig</span> <span class="p">{</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a>    <span class="o">//</span> <span class="n">constantes</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>    <span class="n">final</span> <span class="n">static</span> <span class="n">String</span> <span class="n">URL</span> <span class="o">=</span> <span class="s2">&quot;jdbc:mysql://localhost:3306/dbIntroSpringData&quot;</span><span class="p">;</span>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a>    <span class="n">final</span> <span class="n">static</span> <span class="n">String</span> <span class="n">USER</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span><span class="p">;</span>
<a id="__codelineno-31-25" name="__codelineno-31-25"></a>    <span class="n">final</span> <span class="n">static</span> <span class="n">String</span> <span class="n">PASSWD</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-31-26" name="__codelineno-31-26"></a>    <span class="n">final</span> <span class="n">static</span> <span class="n">String</span> <span class="n">DRIVER_CLASSNAME</span> <span class="o">=</span> <span class="s2">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">;</span>
<a id="__codelineno-31-27" name="__codelineno-31-27"></a>    <span class="n">final</span> <span class="n">static</span> <span class="n">String</span><span class="p">[]</span> <span class="n">ENTITIES_PACKAGES</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;spring.data.entities&quot;</span> <span class="p">};</span>
<a id="__codelineno-31-28" name="__codelineno-31-28"></a>
<a id="__codelineno-31-29" name="__codelineno-31-29"></a>    <span class="o">//</span> <span class="n">la</span> <span class="n">source</span> <span class="n">de</span> <span class="n">données</span> <span class="p">[</span><span class="n">tomcat</span><span class="o">-</span><span class="n">jdbc</span><span class="p">]</span>
<a id="__codelineno-31-30" name="__codelineno-31-30"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-31-31" name="__codelineno-31-31"></a>    <span class="n">public</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-31-32" name="__codelineno-31-32"></a>        <span class="o">//</span> <span class="n">source</span> <span class="n">de</span> <span class="n">données</span> <span class="n">TomcatJdbc</span>
<a id="__codelineno-31-33" name="__codelineno-31-33"></a>        <span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DataSource</span><span class="p">();</span>
<a id="__codelineno-31-34" name="__codelineno-31-34"></a>        <span class="o">//</span> <span class="n">configuration</span> <span class="n">accès</span> <span class="n">JDBC</span>
<a id="__codelineno-31-35" name="__codelineno-31-35"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setDriverClassName</span><span class="p">(</span><span class="n">DRIVER_CLASSNAME</span><span class="p">);</span>
<a id="__codelineno-31-36" name="__codelineno-31-36"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setUsername</span><span class="p">(</span><span class="n">USER</span><span class="p">);</span>
<a id="__codelineno-31-37" name="__codelineno-31-37"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setPassword</span><span class="p">(</span><span class="n">PASSWD</span><span class="p">);</span>
<a id="__codelineno-31-38" name="__codelineno-31-38"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setUrl</span><span class="p">(</span><span class="n">URL</span><span class="p">);</span>
<a id="__codelineno-31-39" name="__codelineno-31-39"></a>        <span class="o">//</span> <span class="n">une</span> <span class="n">connexion</span> <span class="n">ouverte</span> <span class="n">initialement</span>
<a id="__codelineno-31-40" name="__codelineno-31-40"></a>        <span class="n">dataSource</span><span class="o">.</span><span class="n">setInitialSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-31-41" name="__codelineno-31-41"></a>        <span class="o">//</span> <span class="n">résultat</span>
<a id="__codelineno-31-42" name="__codelineno-31-42"></a>        <span class="k">return</span> <span class="n">dataSource</span><span class="p">;</span>
<a id="__codelineno-31-43" name="__codelineno-31-43"></a>    <span class="p">}</span>
<a id="__codelineno-31-44" name="__codelineno-31-44"></a>
<a id="__codelineno-31-45" name="__codelineno-31-45"></a>    <span class="o">//</span> <span class="n">le</span> <span class="n">provider</span> <span class="n">JPA</span>
<a id="__codelineno-31-46" name="__codelineno-31-46"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-31-47" name="__codelineno-31-47"></a>    <span class="n">public</span> <span class="n">JpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-31-48" name="__codelineno-31-48"></a>        <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="p">();</span>
<a id="__codelineno-31-49" name="__codelineno-31-49"></a>        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="n">setShowSql</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<a id="__codelineno-31-50" name="__codelineno-31-50"></a>        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="n">setDatabase</span><span class="p">(</span><span class="n">Database</span><span class="o">.</span><span class="n">MYSQL</span><span class="p">);</span>
<a id="__codelineno-31-51" name="__codelineno-31-51"></a>        <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="p">;</span>
<a id="__codelineno-31-52" name="__codelineno-31-52"></a>    <span class="p">}</span>
<a id="__codelineno-31-53" name="__codelineno-31-53"></a>
<a id="__codelineno-31-54" name="__codelineno-31-54"></a>    <span class="o">//</span> <span class="n">EntityManagerFactory</span>
<a id="__codelineno-31-55" name="__codelineno-31-55"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-31-56" name="__codelineno-31-56"></a>    <span class="n">public</span> <span class="n">EntityManagerFactory</span> <span class="n">entityManagerFactory</span><span class="p">(</span><span class="n">JpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span><span class="p">,</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-31-57" name="__codelineno-31-57"></a>        <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="p">();</span>
<a id="__codelineno-31-58" name="__codelineno-31-58"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">setJpaVendorAdapter</span><span class="p">(</span><span class="n">jpaVendorAdapter</span><span class="p">);</span>
<a id="__codelineno-31-59" name="__codelineno-31-59"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">setPackagesToScan</span><span class="p">(</span><span class="n">packagesToScan</span><span class="p">());</span>
<a id="__codelineno-31-60" name="__codelineno-31-60"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">setDataSource</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<a id="__codelineno-31-61" name="__codelineno-31-61"></a>        <span class="n">factory</span><span class="o">.</span><span class="n">afterPropertiesSet</span><span class="p">();</span>
<a id="__codelineno-31-62" name="__codelineno-31-62"></a>        <span class="k">return</span> <span class="n">factory</span><span class="o">.</span><span class="n">getObject</span><span class="p">();</span>
<a id="__codelineno-31-63" name="__codelineno-31-63"></a>    <span class="p">}</span>
<a id="__codelineno-31-64" name="__codelineno-31-64"></a>
<a id="__codelineno-31-65" name="__codelineno-31-65"></a>    <span class="o">//</span> <span class="n">Transaction</span> <span class="n">manager</span>
<a id="__codelineno-31-66" name="__codelineno-31-66"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-31-67" name="__codelineno-31-67"></a>    <span class="n">public</span> <span class="n">PlatformTransactionManager</span> <span class="n">transactionManager</span><span class="p">(</span><span class="n">EntityManagerFactory</span> <span class="n">entityManagerFactory</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-31-68" name="__codelineno-31-68"></a>        <span class="n">JpaTransactionManager</span> <span class="n">txManager</span> <span class="o">=</span> <span class="n">new</span> <span class="n">JpaTransactionManager</span><span class="p">();</span>
<a id="__codelineno-31-69" name="__codelineno-31-69"></a>        <span class="n">txManager</span><span class="o">.</span><span class="n">setEntityManagerFactory</span><span class="p">(</span><span class="n">entityManagerFactory</span><span class="p">);</span>
<a id="__codelineno-31-70" name="__codelineno-31-70"></a>        <span class="k">return</span> <span class="n">txManager</span><span class="p">;</span>
<a id="__codelineno-31-71" name="__codelineno-31-71"></a>    <span class="p">}</span>
<a id="__codelineno-31-72" name="__codelineno-31-72"></a>
<a id="__codelineno-31-73" name="__codelineno-31-73"></a>    <span class="nd">@Bean</span>
<a id="__codelineno-31-74" name="__codelineno-31-74"></a>    <span class="n">public</span> <span class="n">String</span><span class="p">[]</span> <span class="n">packagesToScan</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-31-75" name="__codelineno-31-75"></a>        <span class="k">return</span> <span class="n">ENTITIES_PACKAGES</span><span class="p">;</span>
<a id="__codelineno-31-76" name="__codelineno-31-76"></a>    <span class="p">}</span>
<a id="__codelineno-31-77" name="__codelineno-31-77"></a>
<a id="__codelineno-31-78" name="__codelineno-31-78"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Une configuration analogue a été rencontrée et expliquée page 177. Nous y avons ajouté les annotations Spring suivantes :</p>
<ul>
<li>ligne 17 : l'annotation [@EnableJpaRepositories] sert à indiquer les packages où se trouvent les interfaces [CrudRepository] de [Spring Data] ;</li>
<li>ligne 18 : la classe est une classe de configuration Spring. Cette information est importante. Si on l'enlève le projet fonctionne. Mais plus loin dans le document, lorsqu'on construira des projets qui s'appuient sur celui-ci, alors certains d'entre-eux ne fonctionnent plus si l'annotation de la ligne 18 est enlevée ;</li>
<li>ligne 19 : l'annotation [@ComponentScan] indique les packages où se trouvent les objets Spring. Ce sont les classes annotées par [@Component, @Service, @Controller, ...]. Ici le composant Spring [Dao] va être trouvé et instancié ;</li>
<li>lignes 73-76 : nous avons défini un bean qui représente le tableau des packages à scanner pour trouver des entités JPA. Cela permettra à un projet qui importe la classe [DaoConfig] de redéfinir ce bean et de changer ainsi les packages scannés ligne 59. Plus loin dans le document, nous allons rencontrer cette problématique ;</li>
</ul>
<p>La classe [AppConfig] configure l'ensemble du projet :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span>
<span class="normal"><a href="#__codelineno-32-24">24</a></span>
<span class="normal"><a href="#__codelineno-32-25">25</a></span>
<span class="normal"><a href="#__codelineno-32-26">26</a></span>
<span class="normal"><a href="#__codelineno-32-27">27</a></span>
<span class="normal"><a href="#__codelineno-32-28">28</a></span>
<span class="normal"><a href="#__codelineno-32-29">29</a></span>
<span class="normal"><a href="#__codelineno-32-30">30</a></span>
<span class="normal"><a href="#__codelineno-32-31">31</a></span>
<span class="normal"><a href="#__codelineno-32-32">32</a></span>
<span class="normal"><a href="#__codelineno-32-33">33</a></span>
<span class="normal"><a href="#__codelineno-32-34">34</a></span>
<span class="normal"><a href="#__codelineno-32-35">35</a></span>
<span class="normal"><a href="#__codelineno-32-36">36</a></span>
<span class="normal"><a href="#__codelineno-32-37">37</a></span>
<span class="normal"><a href="#__codelineno-32-38">38</a></span>
<span class="normal"><a href="#__codelineno-32-39">39</a></span>
<span class="normal"><a href="#__codelineno-32-40">40</a></span>
<span class="normal"><a href="#__codelineno-32-41">41</a></span>
<span class="normal"><a href="#__codelineno-32-42">42</a></span>
<span class="normal"><a href="#__codelineno-32-43">43</a></span>
<span class="normal"><a href="#__codelineno-32-44">44</a></span>
<span class="normal"><a href="#__codelineno-32-45">45</a></span>
<span class="normal"><a href="#__codelineno-32-46">46</a></span>
<span class="normal"><a href="#__codelineno-32-47">47</a></span>
<span class="normal"><a href="#__codelineno-32-48">48</a></span>
<span class="normal"><a href="#__codelineno-32-49">49</a></span>
<span class="normal"><a href="#__codelineno-32-50">50</a></span>
<span class="normal"><a href="#__codelineno-32-51">51</a></span>
<span class="normal"><a href="#__codelineno-32-52">52</a></span>
<span class="normal"><a href="#__codelineno-32-53">53</a></span>
<span class="normal"><a href="#__codelineno-32-54">54</a></span>
<span class="normal"><a href="#__codelineno-32-55">55</a></span>
<span class="normal"><a href="#__codelineno-32-56">56</a></span>
<span class="normal"><a href="#__codelineno-32-57">57</a></span>
<span class="normal"><a href="#__codelineno-32-58">58</a></span>
<span class="normal"><a href="#__codelineno-32-59">59</a></span>
<span class="normal"><a href="#__codelineno-32-60">60</a></span>
<span class="normal"><a href="#__codelineno-32-61">61</a></span>
<span class="normal"><a href="#__codelineno-32-62">62</a></span>
<span class="normal"><a href="#__codelineno-32-63">63</a></span>
<span class="normal"><a href="#__codelineno-32-64">64</a></span>
<span class="normal"><a href="#__codelineno-32-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">package</span> <span class="n">spring</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">config</span><span class="p">;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Import</span><span class="p">;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter</span><span class="p">;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider</span><span class="p">;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="nd">@Configuration</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="nd">@Import</span><span class="p">({</span><span class="n">DaoConfig</span><span class="o">.</span><span class="n">class</span><span class="p">})</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="n">public</span> <span class="k">class</span><span class="w"> </span><span class="nc">AppConfig</span> <span class="p">{</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a>    <span class="o">//</span> <span class="n">filtres</span> <span class="n">jSON</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a>    <span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a>    <span class="n">public</span> <span class="n">ObjectMapper</span> <span class="n">jsonMapper</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a>        <span class="k">return</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a>    <span class="p">}</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a>    <span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a>    <span class="n">public</span> <span class="n">ObjectMapper</span> <span class="n">jsonMapperCategorieWithProduits</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a>        <span class="o">//</span> <span class="n">mappeur</span> <span class="n">jSON</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a>        <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a>        <span class="o">//</span> <span class="n">filtres</span>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a>        <span class="n">mapper</span><span class="o">.</span><span class="n">setFilters</span><span class="p">(</span>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a>                <span class="n">new</span> <span class="n">SimpleFilterProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span> <span class="n">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="n">serializeAllExcept</span><span class="p">())</span>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a>                        <span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterProduit&quot;</span><span class="p">,</span> <span class="n">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="n">serializeAllExcept</span><span class="p">(</span><span class="s2">&quot;categorie&quot;</span><span class="p">)));</span>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a>        <span class="o">//</span> <span class="n">résultat</span>
<a id="__codelineno-32-29" name="__codelineno-32-29"></a>        <span class="k">return</span> <span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-32-30" name="__codelineno-32-30"></a>    <span class="p">}</span>
<a id="__codelineno-32-31" name="__codelineno-32-31"></a>
<a id="__codelineno-32-32" name="__codelineno-32-32"></a>    <span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-32-33" name="__codelineno-32-33"></a>    <span class="n">public</span> <span class="n">ObjectMapper</span> <span class="n">jsonMapperProduitWithCategorie</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-32-34" name="__codelineno-32-34"></a>        <span class="o">//</span> <span class="n">mappeur</span> <span class="n">jSON</span>
<a id="__codelineno-32-35" name="__codelineno-32-35"></a>        <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-32-36" name="__codelineno-32-36"></a>        <span class="o">//</span> <span class="n">filtres</span>
<a id="__codelineno-32-37" name="__codelineno-32-37"></a>        <span class="n">mapper</span><span class="o">.</span><span class="n">setFilters</span><span class="p">(</span>
<a id="__codelineno-32-38" name="__codelineno-32-38"></a>                <span class="n">new</span> <span class="n">SimpleFilterProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterProduit&quot;</span><span class="p">,</span> <span class="n">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="n">serializeAllExcept</span><span class="p">())</span>
<a id="__codelineno-32-39" name="__codelineno-32-39"></a>                        <span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span> <span class="n">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="n">serializeAllExcept</span><span class="p">(</span><span class="s2">&quot;produits&quot;</span><span class="p">)));</span>
<a id="__codelineno-32-40" name="__codelineno-32-40"></a>        <span class="o">//</span> <span class="n">résultat</span>
<a id="__codelineno-32-41" name="__codelineno-32-41"></a>        <span class="k">return</span> <span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-32-42" name="__codelineno-32-42"></a>    <span class="p">}</span>
<a id="__codelineno-32-43" name="__codelineno-32-43"></a>
<a id="__codelineno-32-44" name="__codelineno-32-44"></a>    <span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-32-45" name="__codelineno-32-45"></a>    <span class="n">public</span> <span class="n">ObjectMapper</span> <span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-32-46" name="__codelineno-32-46"></a>        <span class="o">//</span> <span class="n">mappeur</span> <span class="n">jSON</span>
<a id="__codelineno-32-47" name="__codelineno-32-47"></a>        <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-32-48" name="__codelineno-32-48"></a>        <span class="o">//</span> <span class="n">filtres</span>
<a id="__codelineno-32-49" name="__codelineno-32-49"></a>        <span class="n">mapper</span><span class="o">.</span><span class="n">setFilters</span><span class="p">(</span><span class="n">new</span> <span class="n">SimpleFilterProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterCategorie&quot;</span><span class="p">,</span>
<a id="__codelineno-32-50" name="__codelineno-32-50"></a>                <span class="n">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="n">serializeAllExcept</span><span class="p">(</span><span class="s2">&quot;produits&quot;</span><span class="p">)));</span>
<a id="__codelineno-32-51" name="__codelineno-32-51"></a>        <span class="o">//</span> <span class="n">résultat</span>
<a id="__codelineno-32-52" name="__codelineno-32-52"></a>        <span class="k">return</span> <span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-32-53" name="__codelineno-32-53"></a>    <span class="p">}</span>
<a id="__codelineno-32-54" name="__codelineno-32-54"></a>
<a id="__codelineno-32-55" name="__codelineno-32-55"></a>    <span class="nd">@Bean</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-32-56" name="__codelineno-32-56"></a>    <span class="n">public</span> <span class="n">ObjectMapper</span> <span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-32-57" name="__codelineno-32-57"></a>        <span class="o">//</span> <span class="n">mappeur</span> <span class="n">jSON</span>
<a id="__codelineno-32-58" name="__codelineno-32-58"></a>        <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ObjectMapper</span><span class="p">();</span>
<a id="__codelineno-32-59" name="__codelineno-32-59"></a>        <span class="o">//</span> <span class="n">filtres</span>
<a id="__codelineno-32-60" name="__codelineno-32-60"></a>        <span class="n">mapper</span><span class="o">.</span><span class="n">setFilters</span><span class="p">(</span><span class="n">new</span> <span class="n">SimpleFilterProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="s2">&quot;jsonFilterProduit&quot;</span><span class="p">,</span>
<a id="__codelineno-32-61" name="__codelineno-32-61"></a>                <span class="n">SimpleBeanPropertyFilter</span><span class="o">.</span><span class="n">serializeAllExcept</span><span class="p">(</span><span class="s2">&quot;categorie&quot;</span><span class="p">)));</span>
<a id="__codelineno-32-62" name="__codelineno-32-62"></a>        <span class="o">//</span> <span class="n">résultat</span>
<a id="__codelineno-32-63" name="__codelineno-32-63"></a>        <span class="k">return</span> <span class="n">mapper</span><span class="p">;</span>
<a id="__codelineno-32-64" name="__codelineno-32-64"></a>    <span class="p">}</span>
<a id="__codelineno-32-65" name="__codelineno-32-65"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 11 : la classe est une classe de configuration Spring ;</li>
<li>ligne 12 : qui importe les beans définis par la classe [DaoConfig] que nous venons de voir ;</li>
<li>la couche [console] utilise des mappeurs jSON qui sont définis ici ;</li>
<li>lignes 14-64 : définissent cinq mappeurs jSON ;</li>
<li>lignes 15-18 : le filtre jSON [jsonMapper] n'a pas de filtres ;</li>
<li>lignes 20-30 : le filtre jSON [jsonMapperCategorieWithProduits] permet de sérialiser / désérialiser un objet [Categorie] <strong>avec</strong> ses produits ;</li>
<li>lignes 32-42 : le filtre jSON [jsonMapperProduitWithCategorie] permet de sérialiser / désérialiser un objet [Produit] <strong>avec</strong> sa catégorie ;</li>
<li>lignes 43-53 : le filtre jSON [jsonMapperCategorieWithoutProduits] permet de sérialiser / désérialiser un objet [Categorie] <strong>sans</strong> ses produits ;</li>
<li>lignes 55-64 : le filtre jSON [jsonMapperProduitWithoutCategorie] permet de sérialiser / désérialiser un objet [Produit] <strong>sans</strong> sa catégorie ;</li>
</ul>
<p>On notera que l'on construit un filtre jSON pour une entité T, on doit configurer non seulement le filtre de l'entité T mais également ceux des entités Ti qu'elle-même peut contenir.</p>
<h3 id="1139-la-couche-console">11.3.9. La couche [console]</h3>
<p>Couche[<strong>DAO</strong>]Couche[<strong>console</strong>]Couche[<strong>JPA</strong>]Pilote[<strong>JDBC</strong>]Couche[<strong>Spring Data</strong>]Spring 4SGBD</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000D7000000CA3A9BDE61.png" style="display:inline-block; margin:4px;width:3.979cm;height:3.739cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [Main] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">  1</a></span>
<span class="normal"><a href="#__codelineno-33-2">  2</a></span>
<span class="normal"><a href="#__codelineno-33-3">  3</a></span>
<span class="normal"><a href="#__codelineno-33-4">  4</a></span>
<span class="normal"><a href="#__codelineno-33-5">  5</a></span>
<span class="normal"><a href="#__codelineno-33-6">  6</a></span>
<span class="normal"><a href="#__codelineno-33-7">  7</a></span>
<span class="normal"><a href="#__codelineno-33-8">  8</a></span>
<span class="normal"><a href="#__codelineno-33-9">  9</a></span>
<span class="normal"><a href="#__codelineno-33-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-33-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-33-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-33-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-33-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-33-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-33-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-33-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-33-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-33-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-33-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-33-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-33-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-33-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-33-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-33-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-33-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-33-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-33-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-33-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-33-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-33-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-33-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-33-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-33-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-33-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-33-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-33-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-33-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-33-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-33-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-33-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-33-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-33-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-33-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-33-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-33-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-33-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-33-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-33-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-33-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-33-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-33-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-33-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-33-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-33-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-33-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-33-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-33-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-33-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-33-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-33-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-33-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-33-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-33-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-33-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-33-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-33-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-33-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-33-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-33-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-33-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-33-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-33-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-33-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-33-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-33-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-33-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-33-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-33-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-33-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-33-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-33-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-33-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-33-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-33-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-33-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-33-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-33-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-33-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-33-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-33-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-33-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-33-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-33-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-33-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-33-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-33-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-33-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-33-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-33-100">100</a></span>
<span class="normal"><a href="#__codelineno-33-101">101</a></span>
<span class="normal"><a href="#__codelineno-33-102">102</a></span>
<span class="normal"><a href="#__codelineno-33-103">103</a></span>
<span class="normal"><a href="#__codelineno-33-104">104</a></span>
<span class="normal"><a href="#__codelineno-33-105">105</a></span>
<span class="normal"><a href="#__codelineno-33-106">106</a></span>
<span class="normal"><a href="#__codelineno-33-107">107</a></span>
<span class="normal"><a href="#__codelineno-33-108">108</a></span>
<span class="normal"><a href="#__codelineno-33-109">109</a></span>
<span class="normal"><a href="#__codelineno-33-110">110</a></span>
<span class="normal"><a href="#__codelineno-33-111">111</a></span>
<span class="normal"><a href="#__codelineno-33-112">112</a></span>
<span class="normal"><a href="#__codelineno-33-113">113</a></span>
<span class="normal"><a href="#__codelineno-33-114">114</a></span>
<span class="normal"><a href="#__codelineno-33-115">115</a></span>
<span class="normal"><a href="#__codelineno-33-116">116</a></span>
<span class="normal"><a href="#__codelineno-33-117">117</a></span>
<span class="normal"><a href="#__codelineno-33-118">118</a></span>
<span class="normal"><a href="#__codelineno-33-119">119</a></span>
<span class="normal"><a href="#__codelineno-33-120">120</a></span>
<span class="normal"><a href="#__codelineno-33-121">121</a></span>
<span class="normal"><a href="#__codelineno-33-122">122</a></span>
<span class="normal"><a href="#__codelineno-33-123">123</a></span>
<span class="normal"><a href="#__codelineno-33-124">124</a></span>
<span class="normal"><a href="#__codelineno-33-125">125</a></span>
<span class="normal"><a href="#__codelineno-33-126">126</a></span>
<span class="normal"><a href="#__codelineno-33-127">127</a></span>
<span class="normal"><a href="#__codelineno-33-128">128</a></span>
<span class="normal"><a href="#__codelineno-33-129">129</a></span>
<span class="normal"><a href="#__codelineno-33-130">130</a></span>
<span class="normal"><a href="#__codelineno-33-131">131</a></span>
<span class="normal"><a href="#__codelineno-33-132">132</a></span>
<span class="normal"><a href="#__codelineno-33-133">133</a></span>
<span class="normal"><a href="#__codelineno-33-134">134</a></span>
<span class="normal"><a href="#__codelineno-33-135">135</a></span>
<span class="normal"><a href="#__codelineno-33-136">136</a></span>
<span class="normal"><a href="#__codelineno-33-137">137</a></span>
<span class="normal"><a href="#__codelineno-33-138">138</a></span>
<span class="normal"><a href="#__codelineno-33-139">139</a></span>
<span class="normal"><a href="#__codelineno-33-140">140</a></span>
<span class="normal"><a href="#__codelineno-33-141">141</a></span>
<span class="normal"><a href="#__codelineno-33-142">142</a></span>
<span class="normal"><a href="#__codelineno-33-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.data.console</span><span class="p">;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="p">;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.collect.Lists</span><span class="p">;</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.config.AppConfig</span><span class="p">;</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.dao.DaoException</span><span class="p">;</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.dao.IDao</span><span class="p">;</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="w">        </span><span class="n">AnnotationConfigApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-24" name="__codelineno-33-24"></a><span class="w">            </span><span class="c1">// instanciation contexte Spring</span>
<a id="__codelineno-33-25" name="__codelineno-33-25"></a><span class="w">            </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnnotationConfigApplicationContext</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-26" name="__codelineno-33-26"></a><span class="w">            </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">,</span>
<a id="__codelineno-33-27" name="__codelineno-33-27"></a><span class="w">                    </span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-28" name="__codelineno-33-28"></a><span class="w">            </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithCategorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">,</span>
<a id="__codelineno-33-29" name="__codelineno-33-29"></a><span class="w">                    </span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-30" name="__codelineno-33-30"></a><span class="w">            </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">,</span>
<a id="__codelineno-33-31" name="__codelineno-33-31"></a><span class="w">                    </span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-32" name="__codelineno-33-32"></a><span class="w">            </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">,</span>
<a id="__codelineno-33-33" name="__codelineno-33-33"></a><span class="w">                    </span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-34" name="__codelineno-33-34"></a><span class="w">            </span><span class="n">IDao</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="n">IDao</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-33-35" name="__codelineno-33-35"></a><span class="w">            </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-33-36" name="__codelineno-33-36"></a><span class="w">            </span><span class="c1">// on vide la base de données</span>
<a id="__codelineno-33-37" name="__codelineno-33-37"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Vidage de la base de données&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-38" name="__codelineno-33-38"></a><span class="w">            </span><span class="c1">// on vide la table [CATEGORIES] - par cascade la table [PRODUITS] va être vidée</span>
<a id="__codelineno-33-39" name="__codelineno-33-39"></a><span class="w">            </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-33-40" name="__codelineno-33-40"></a><span class="w">            </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-33-41" name="__codelineno-33-41"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Remplissage de la base&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-42" name="__codelineno-33-42"></a><span class="w">            </span><span class="c1">// on remplit les tables</span>
<a id="__codelineno-33-43" name="__codelineno-33-43"></a><span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-33-44" name="__codelineno-33-44"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-45" name="__codelineno-33-45"></a><span class="w">                </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Categorie</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;categorie%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">));</span>
<a id="__codelineno-33-46" name="__codelineno-33-46"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-47" name="__codelineno-33-47"></a><span class="w">                    </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;produit%d%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">),</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-33-48" name="__codelineno-33-48"></a><span class="w">                            </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;desc%d%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)));</span>
<a id="__codelineno-33-49" name="__codelineno-33-49"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-33-50" name="__codelineno-33-50"></a><span class="w">                </span><span class="n">categories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">categorie</span><span class="p">);</span>
<a id="__codelineno-33-51" name="__codelineno-33-51"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-33-52" name="__codelineno-33-52"></a><span class="w">            </span><span class="c1">// ajout de la catégorie - par cascade les produits vont eux aussi être insérés</span>
<a id="__codelineno-33-53" name="__codelineno-33-53"></a><span class="w">            </span><span class="n">dao</span><span class="p">.</span><span class="na">addCategories</span><span class="p">(</span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-33-54" name="__codelineno-33-54"></a><span class="w">            </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-33-55" name="__codelineno-33-55"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Affichage de la base&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-56" name="__codelineno-33-56"></a><span class="w">            </span><span class="c1">// liste des catégories</span>
<a id="__codelineno-33-57" name="__codelineno-33-57"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des catégories&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-58" name="__codelineno-33-58"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">(),</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">);</span>
<a id="__codelineno-33-59" name="__codelineno-33-59"></a><span class="w">            </span><span class="c1">// liste des produits</span>
<a id="__codelineno-33-60" name="__codelineno-33-60"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des produits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-61" name="__codelineno-33-61"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">(),</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">);</span>
<a id="__codelineno-33-62" name="__codelineno-33-62"></a><span class="w">            </span><span class="c1">// catégorie 1 avec ses produits</span>
<a id="__codelineno-33-63" name="__codelineno-33-63"></a><span class="w">            </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-33-64" name="__codelineno-33-64"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Catégorie 1 avec ses produits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-65" name="__codelineno-33-65"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">categorie</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">);</span>
<a id="__codelineno-33-66" name="__codelineno-33-66"></a><span class="w">            </span><span class="c1">// le produit [produit14] avec sa catégorie</span>
<a id="__codelineno-33-67" name="__codelineno-33-67"></a><span class="w">            </span><span class="n">Produit</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="s">&quot;produit14&quot;</span><span class="p">);</span>
<a id="__codelineno-33-68" name="__codelineno-33-68"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Produit [produit14] avec sa catégorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-69" name="__codelineno-33-69"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperProduitWithCategorie</span><span class="p">);</span>
<a id="__codelineno-33-70" name="__codelineno-33-70"></a><span class="w">            </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-33-71" name="__codelineno-33-71"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Mise à jour du prix des produits de [categorie1]&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-72" name="__codelineno-33-72"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Produits de la catégorie [categorie1] avant la mise à jour&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-73" name="__codelineno-33-73"></a><span class="w">            </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-33-74" name="__codelineno-33-74"></a><span class="w">            </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categorie1</span><span class="p">.</span><span class="na">getProduits</span><span class="p">();</span>
<a id="__codelineno-33-75" name="__codelineno-33-75"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">categorie1</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">);</span>
<a id="__codelineno-33-76" name="__codelineno-33-76"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-77" name="__codelineno-33-77"></a><span class="w">                </span><span class="n">produit</span><span class="p">.</span><span class="na">setPrix</span><span class="p">(</span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getPrix</span><span class="p">());</span>
<a id="__codelineno-33-78" name="__codelineno-33-78"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-33-79" name="__codelineno-33-79"></a><span class="w">            </span><span class="n">dao</span><span class="p">.</span><span class="na">updateProduits</span><span class="p">(</span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">produits</span><span class="p">));</span>
<a id="__codelineno-33-80" name="__codelineno-33-80"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Produits de la catégorie [categorie1] après la mise à jour&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-81" name="__codelineno-33-81"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">);</span>
<a id="__codelineno-33-82" name="__codelineno-33-82"></a><span class="w">            </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-33-83" name="__codelineno-33-83"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Vidage de la base de données&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-84" name="__codelineno-33-84"></a><span class="w">            </span><span class="c1">// on vide la table [CATEGORIES] - par cascade la table [PRODUITS] va être vidée</span>
<a id="__codelineno-33-85" name="__codelineno-33-85"></a><span class="w">            </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-33-86" name="__codelineno-33-86"></a><span class="w">            </span><span class="c1">// affichage de la base</span>
<a id="__codelineno-33-87" name="__codelineno-33-87"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des categories avant l&#39;ajout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-88" name="__codelineno-33-88"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">(),</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">);</span>
<a id="__codelineno-33-89" name="__codelineno-33-89"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des produits avant l&#39;ajout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-90" name="__codelineno-33-90"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">(),</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">);</span>
<a id="__codelineno-33-91" name="__codelineno-33-91"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Ajout d&#39;une catégorie [cat1] avec deux produits de même nom&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-92" name="__codelineno-33-92"></a><span class="w">            </span><span class="c1">// on fait l&#39;insertion</span>
<a id="__codelineno-33-93" name="__codelineno-33-93"></a><span class="w">            </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Categorie</span><span class="p">(</span><span class="s">&quot;cat1&quot;</span><span class="p">);</span>
<a id="__codelineno-33-94" name="__codelineno-33-94"></a><span class="w">            </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">));</span>
<a id="__codelineno-33-95" name="__codelineno-33-95"></a><span class="w">            </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">));</span>
<a id="__codelineno-33-96" name="__codelineno-33-96"></a><span class="w">            </span><span class="c1">// ajout de la catégorie - par cascade les produits vont eux aussi être insérés</span>
<a id="__codelineno-33-97" name="__codelineno-33-97"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-98" name="__codelineno-33-98"></a><span class="w">                </span><span class="n">dao</span><span class="p">.</span><span class="na">addCategories</span><span class="p">(</span><span class="n">Lists</span><span class="p">.</span><span class="na">newArrayList</span><span class="p">(</span><span class="n">categorie</span><span class="p">));</span>
<a id="__codelineno-33-99" name="__codelineno-33-99"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DaoException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-100" name="__codelineno-33-100"></a><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-33-101" name="__codelineno-33-101"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-33-102" name="__codelineno-33-102"></a><span class="w">            </span><span class="c1">// vérification</span>
<a id="__codelineno-33-103" name="__codelineno-33-103"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des categories après l&#39;ajout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-104" name="__codelineno-33-104"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">(),</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">);</span>
<a id="__codelineno-33-105" name="__codelineno-33-105"></a><span class="w">            </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des produits après l&#39;ajout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-33-106" name="__codelineno-33-106"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">(),</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">);</span>
<a id="__codelineno-33-107" name="__codelineno-33-107"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DaoException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-108" name="__codelineno-33-108"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<a id="__codelineno-33-109" name="__codelineno-33-109"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-110" name="__codelineno-33-110"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">context</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-111" name="__codelineno-33-111"></a><span class="w">                </span><span class="c1">// fini</span>
<a id="__codelineno-33-112" name="__codelineno-33-112"></a><span class="w">                </span><span class="n">context</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<a id="__codelineno-33-113" name="__codelineno-33-113"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-33-114" name="__codelineno-33-114"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-33-115" name="__codelineno-33-115"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Travail terminé&quot;</span><span class="p">);</span>
<a id="__codelineno-33-116" name="__codelineno-33-116"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-117" name="__codelineno-33-117"></a>
<a id="__codelineno-33-118" name="__codelineno-33-118"></a><span class="w">    </span><span class="c1">// affichage d&#39;un élément de type T</span>
<a id="__codelineno-33-119" name="__codelineno-33-119"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-120" name="__codelineno-33-120"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jsonMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">element</span><span class="p">));</span>
<a id="__codelineno-33-121" name="__codelineno-33-121"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-122" name="__codelineno-33-122"></a>
<a id="__codelineno-33-123" name="__codelineno-33-123"></a><span class="w">    </span><span class="c1">// affichage d&#39;une liste d&#39;éléments de type T</span>
<a id="__codelineno-33-124" name="__codelineno-33-124"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">elements</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-125" name="__codelineno-33-125"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">elements</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-126" name="__codelineno-33-126"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">);</span>
<a id="__codelineno-33-127" name="__codelineno-33-127"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-33-128" name="__codelineno-33-128"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-129" name="__codelineno-33-129"></a>
<a id="__codelineno-33-130" name="__codelineno-33-130"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-131" name="__codelineno-33-131"></a><span class="w">        </span><span class="c1">// affiche message</span>
<a id="__codelineno-33-132" name="__codelineno-33-132"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-33-133" name="__codelineno-33-133"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-134" name="__codelineno-33-134"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-33-135" name="__codelineno-33-135"></a><span class="w">            </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s --------------------------------&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-33-136" name="__codelineno-33-136"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-33-137" name="__codelineno-33-137"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-33-138" name="__codelineno-33-138"></a><span class="w">            </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;-- %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-33-139" name="__codelineno-33-139"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-33-140" name="__codelineno-33-140"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-33-141" name="__codelineno-33-141"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">toPrint</span><span class="p">);</span>
<a id="__codelineno-33-142" name="__codelineno-33-142"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-143" name="__codelineno-33-143"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 25 : instanciation des beans Spring à partir de la classe de configuration [AppConfig] ;</li>
<li>lignes 26-33 : récupération des références sur les mappeurs jSON. On utilise la signature suivante de la méthode [ApplicationContext].getBean :</li>
<li><strong>[ApplicationContext].getBean(String id, Class classe)</strong> : qu'on utilise lorsqu'il y a plusieurs beans ayant le type [classe]. Dans ce cas, on précise l'identifiant du bean demandé. Si celui-ci a été défini avec l'annotation [<strong>@Bean</strong>], son identifiant est le nom de la méthode annotée. S'il a été défini avec l'annotation [<strong>@Bean(« identifiant »</strong>], son identifiant est celui indiqué dans l'annotation ;</li>
<li>ligne 34 : récupération d'une référence sur la couche [DAO] ;</li>
<li>lignes 37-39 : vidage de la base de données. On vide la table des catégories (ligne 39). Parce qu'on a écrit :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>    @OneToMany(fetch = FetchType.LAZY, mappedBy = &quot;categorie&quot;, cascade = { CascadeType.ALL })
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>    public Set&lt;Produit&gt; produits = new HashSet&lt;Produit&gt;();
</code></pre></div></td></tr></table></div>
<p>lorsqu'une catégorie est supprimée, tous les produits qui lui sont liés le sont aussi ;</p>
<ul>
<li>lignes 43-53 : remplissage de la table avec 2 catégories de 5 produits chacune. Ligne 50, l'insertion des deux catégories va provoquer en même temps l'insertion de leurs produits, toujours parce qu'on a écrit [cascade = { CascadeType.<strong>ALL</strong> }] ;</li>
<li>ligne 58 : on affiche les catégories. On utilise le mappeur jSON [jsonMapperCategorieWithoutProduits] pour afficher les catégories sans leurs produits. En effet la méthode [dao.getAllCategories()] rend les catégories sans leurs produits (lazy loading) ;</li>
<li>ligne 61 : on affiche les produits sans leur catégorie. En effet la méthode [dao.getAllProduits()] rend les produits sans leur catégorie (lazy loading) ;</li>
<li>lignes 63-65 : affichent la catégorie de nom [categorie1] avec ses produits (eager loading) ;</li>
<li>lignes 67-69 : affiche un produit avec sa catégorie ;</li>
<li>lignes 71-81 : on augmente de 10% tous les prix des produits de la catégorie [categorie1] ;</li>
<li>lignes 91-101 : on ajoute une catégorie avec deux produits de même nom. Or dans la table [PRODUITS] on a une contrainte d'unicité sur la colonne [NOM]. L'insertion du 2ième produit va donc être rejetée et une exception lancée. Or la méthode [dao.addProduits] s'exécute dans une transaction. Le fait que la seconde insertion échoue doit donc également annuler l'insertion du premier produit ainsi que celle de leur catégorie [cat1]. C'est ce qu'on veut vérifier ;</li>
<li>lignes 119-121 : une méthode générique capable d'afficher la chaîne jSON de tout élément de type T. La sérialisation jSON est contrôlée par le mappeur passé en paramètre ;</li>
<li>lignes 124-128 : une méthode analogue, cette-fois pour une liste d'éléments de type T ;</li>
</ul>
<p>L'exécution de la classe [Main] donne les résultats suivants (hors logs de Spring) :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span>
<span class="normal"><a href="#__codelineno-35-20">20</a></span>
<span class="normal"><a href="#__codelineno-35-21">21</a></span>
<span class="normal"><a href="#__codelineno-35-22">22</a></span>
<span class="normal"><a href="#__codelineno-35-23">23</a></span>
<span class="normal"><a href="#__codelineno-35-24">24</a></span>
<span class="normal"><a href="#__codelineno-35-25">25</a></span>
<span class="normal"><a href="#__codelineno-35-26">26</a></span>
<span class="normal"><a href="#__codelineno-35-27">27</a></span>
<span class="normal"><a href="#__codelineno-35-28">28</a></span>
<span class="normal"><a href="#__codelineno-35-29">29</a></span>
<span class="normal"><a href="#__codelineno-35-30">30</a></span>
<span class="normal"><a href="#__codelineno-35-31">31</a></span>
<span class="normal"><a href="#__codelineno-35-32">32</a></span>
<span class="normal"><a href="#__codelineno-35-33">33</a></span>
<span class="normal"><a href="#__codelineno-35-34">34</a></span>
<span class="normal"><a href="#__codelineno-35-35">35</a></span>
<span class="normal"><a href="#__codelineno-35-36">36</a></span>
<span class="normal"><a href="#__codelineno-35-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>Remplissage de la base --------------------------------
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>Affichage de la base --------------------------------
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>-- Liste des catégories
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>{&quot;id&quot;:4,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie0&quot;}
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>{&quot;id&quot;:5,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;}
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>-- Liste des produits
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>{&quot;id&quot;:13,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit00&quot;,&quot;idCategorie&quot;:4,&quot;prix&quot;:100.0,&quot;description&quot;:&quot;desc00&quot;}
<a id="__codelineno-35-9" name="__codelineno-35-9"></a>{&quot;id&quot;:14,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit01&quot;,&quot;idCategorie&quot;:4,&quot;prix&quot;:101.0,&quot;description&quot;:&quot;desc01&quot;}
<a id="__codelineno-35-10" name="__codelineno-35-10"></a>{&quot;id&quot;:15,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit02&quot;,&quot;idCategorie&quot;:4,&quot;prix&quot;:102.0,&quot;description&quot;:&quot;desc02&quot;}
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>{&quot;id&quot;:16,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit03&quot;,&quot;idCategorie&quot;:4,&quot;prix&quot;:103.0,&quot;description&quot;:&quot;desc03&quot;}
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>{&quot;id&quot;:17,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit04&quot;,&quot;idCategorie&quot;:4,&quot;prix&quot;:104.0,&quot;description&quot;:&quot;desc04&quot;}
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>{&quot;id&quot;:18,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit10&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;desc10&quot;}
<a id="__codelineno-35-14" name="__codelineno-35-14"></a>{&quot;id&quot;:19,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit11&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;desc11&quot;}
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>{&quot;id&quot;:20,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit12&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;desc12&quot;}
<a id="__codelineno-35-16" name="__codelineno-35-16"></a>{&quot;id&quot;:21,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit13&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;desc13&quot;}
<a id="__codelineno-35-17" name="__codelineno-35-17"></a>{&quot;id&quot;:22,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:114.0,&quot;description&quot;:&quot;desc14&quot;}
<a id="__codelineno-35-18" name="__codelineno-35-18"></a>-- Catégorie 1 avec ses produits
<a id="__codelineno-35-19" name="__codelineno-35-19"></a>{&quot;id&quot;:5,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;,&quot;produits&quot;:[{&quot;id&quot;:18,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit10&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;desc10&quot;},{&quot;id&quot;:19,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit11&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;desc11&quot;},{&quot;id&quot;:20,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit12&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;desc12&quot;},{&quot;id&quot;:21,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit13&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;desc13&quot;},{&quot;id&quot;:22,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:114.0,&quot;description&quot;:&quot;desc14&quot;}]}
<a id="__codelineno-35-20" name="__codelineno-35-20"></a>-- Produit [produit14] avec sa catégorie
<a id="__codelineno-35-21" name="__codelineno-35-21"></a>{&quot;id&quot;:22,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:114.0,&quot;description&quot;:&quot;desc14&quot;,&quot;categorie&quot;:{&quot;id&quot;:5,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;}}
<a id="__codelineno-35-22" name="__codelineno-35-22"></a>Mise à jour du prix des produits de [categorie1] --------------------------------
<a id="__codelineno-35-23" name="__codelineno-35-23"></a>-- Produits de la catégorie [categorie1] avant la mise à jour
<a id="__codelineno-35-24" name="__codelineno-35-24"></a>{&quot;id&quot;:5,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;,&quot;produits&quot;:[{&quot;id&quot;:18,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit10&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:110.0,&quot;description&quot;:&quot;desc10&quot;},{&quot;id&quot;:19,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit11&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:111.0,&quot;description&quot;:&quot;desc11&quot;},{&quot;id&quot;:20,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit12&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:112.0,&quot;description&quot;:&quot;desc12&quot;},{&quot;id&quot;:21,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit13&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:113.0,&quot;description&quot;:&quot;desc13&quot;},{&quot;id&quot;:22,&quot;version&quot;:0,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:114.0,&quot;description&quot;:&quot;desc14&quot;}]}
<a id="__codelineno-35-25" name="__codelineno-35-25"></a>-- Produits de la catégorie [categorie1] après la mise à jour
<a id="__codelineno-35-26" name="__codelineno-35-26"></a>{&quot;id&quot;:5,&quot;version&quot;:0,&quot;nom&quot;:&quot;categorie1&quot;,&quot;produits&quot;:[{&quot;id&quot;:18,&quot;version&quot;:1,&quot;nom&quot;:&quot;produit10&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:121.0,&quot;description&quot;:&quot;desc10&quot;},{&quot;id&quot;:19,&quot;version&quot;:1,&quot;nom&quot;:&quot;produit11&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:122.1,&quot;description&quot;:&quot;desc11&quot;},{&quot;id&quot;:20,&quot;version&quot;:1,&quot;nom&quot;:&quot;produit12&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:123.2,&quot;description&quot;:&quot;desc12&quot;},{&quot;id&quot;:21,&quot;version&quot;:1,&quot;nom&quot;:&quot;produit13&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:124.3,&quot;description&quot;:&quot;desc13&quot;},{&quot;id&quot;:22,&quot;version&quot;:1,&quot;nom&quot;:&quot;produit14&quot;,&quot;idCategorie&quot;:5,&quot;prix&quot;:125.4,&quot;description&quot;:&quot;desc14&quot;}]}
<a id="__codelineno-35-27" name="__codelineno-35-27"></a>Vidage de la base de données --------------------------------
<a id="__codelineno-35-28" name="__codelineno-35-28"></a>-- Liste des categories avant l&#39;ajout
<a id="__codelineno-35-29" name="__codelineno-35-29"></a>-- Liste des produits avant l&#39;ajout
<a id="__codelineno-35-30" name="__codelineno-35-30"></a>Ajout d&#39;une catégorie [cat1] avec deux produits de même nom --------------------------------
<a id="__codelineno-35-31" name="__codelineno-35-31"></a>Les erreurs suivantes se sont produites : 
<a id="__codelineno-35-32" name="__codelineno-35-32"></a>- org.hibernate.exception.ConstraintViolationException: could not execute statement
<a id="__codelineno-35-33" name="__codelineno-35-33"></a>- could not execute statement
<a id="__codelineno-35-34" name="__codelineno-35-34"></a>- Duplicate entry &#39;x&#39; for key &#39;NOM&#39;
<a id="__codelineno-35-35" name="__codelineno-35-35"></a>-- Liste des categories après l&#39;ajout
<a id="__codelineno-35-36" name="__codelineno-35-36"></a>-- Liste des produits après l&#39;ajout
<a id="__codelineno-35-37" name="__codelineno-35-37"></a>Travail terminé
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-17 : les catégories et produits insérés dans la table ;</li>
<li>lignes 18-19 : une catégorie avec ses produits ;</li>
<li>lignes 20-21 : un produit avec sa catégorie ;</li>
<li>lignes 22-26 : mise à jour du prix de certains produits. Ligne 24, on voit que les prix ont bien augmenté de 10% ;</li>
<li>lignes 27-36 : ajout de la catégorie [cat1] avec deux produits de même nom. On voit que la table est la même avant (lignes 28-29) et après ajout (lignes 35-36) montrant par là que toutes les insertions de la transaction ont bien été annulées ;</li>
<li>lignes 31-34 : l'exception qui s'est produite lors de l'insertion du second produit et qui a fait échouer toute la transaction ;</li>
</ul>
<h3 id="11310-le-test-unitaire-junit">11.3.10. Le test unitaire JUnit</h3>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000049300000118B0C0B6D1.png" style="display:inline-block; margin:4px;width:15.492cm;height:3.704cm;" /></td></tr></table>

<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000C40000008E249C2D8E.png" style="display:inline-block; margin:4px;width:3.63cm;height:2.63cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>La classe [Test01] est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">  1</a></span>
<span class="normal"><a href="#__codelineno-36-2">  2</a></span>
<span class="normal"><a href="#__codelineno-36-3">  3</a></span>
<span class="normal"><a href="#__codelineno-36-4">  4</a></span>
<span class="normal"><a href="#__codelineno-36-5">  5</a></span>
<span class="normal"><a href="#__codelineno-36-6">  6</a></span>
<span class="normal"><a href="#__codelineno-36-7">  7</a></span>
<span class="normal"><a href="#__codelineno-36-8">  8</a></span>
<span class="normal"><a href="#__codelineno-36-9">  9</a></span>
<span class="normal"><a href="#__codelineno-36-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-36-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-36-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-36-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-36-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-36-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-36-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-36-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-36-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-36-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-36-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-36-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-36-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-36-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-36-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-36-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-36-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-36-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-36-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-36-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-36-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-36-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-36-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-36-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-36-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-36-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-36-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-36-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-36-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-36-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-36-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-36-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-36-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-36-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-36-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-36-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-36-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-36-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-36-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-36-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-36-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-36-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-36-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-36-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-36-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-36-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-36-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-36-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-36-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-36-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-36-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-36-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-36-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-36-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-36-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-36-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-36-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-36-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-36-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-36-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-36-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-36-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-36-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-36-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-36-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-36-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-36-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-36-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-36-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-36-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-36-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-36-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-36-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-36-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-36-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-36-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-36-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-36-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-36-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-36-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-36-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-36-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-36-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-36-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-36-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-36-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-36-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-36-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-36-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-36-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-36-100">100</a></span>
<span class="normal"><a href="#__codelineno-36-101">101</a></span>
<span class="normal"><a href="#__codelineno-36-102">102</a></span>
<span class="normal"><a href="#__codelineno-36-103">103</a></span>
<span class="normal"><a href="#__codelineno-36-104">104</a></span>
<span class="normal"><a href="#__codelineno-36-105">105</a></span>
<span class="normal"><a href="#__codelineno-36-106">106</a></span>
<span class="normal"><a href="#__codelineno-36-107">107</a></span>
<span class="normal"><a href="#__codelineno-36-108">108</a></span>
<span class="normal"><a href="#__codelineno-36-109">109</a></span>
<span class="normal"><a href="#__codelineno-36-110">110</a></span>
<span class="normal"><a href="#__codelineno-36-111">111</a></span>
<span class="normal"><a href="#__codelineno-36-112">112</a></span>
<span class="normal"><a href="#__codelineno-36-113">113</a></span>
<span class="normal"><a href="#__codelineno-36-114">114</a></span>
<span class="normal"><a href="#__codelineno-36-115">115</a></span>
<span class="normal"><a href="#__codelineno-36-116">116</a></span>
<span class="normal"><a href="#__codelineno-36-117">117</a></span>
<span class="normal"><a href="#__codelineno-36-118">118</a></span>
<span class="normal"><a href="#__codelineno-36-119">119</a></span>
<span class="normal"><a href="#__codelineno-36-120">120</a></span>
<span class="normal"><a href="#__codelineno-36-121">121</a></span>
<span class="normal"><a href="#__codelineno-36-122">122</a></span>
<span class="normal"><a href="#__codelineno-36-123">123</a></span>
<span class="normal"><a href="#__codelineno-36-124">124</a></span>
<span class="normal"><a href="#__codelineno-36-125">125</a></span>
<span class="normal"><a href="#__codelineno-36-126">126</a></span>
<span class="normal"><a href="#__codelineno-36-127">127</a></span>
<span class="normal"><a href="#__codelineno-36-128">128</a></span>
<span class="normal"><a href="#__codelineno-36-129">129</a></span>
<span class="normal"><a href="#__codelineno-36-130">130</a></span>
<span class="normal"><a href="#__codelineno-36-131">131</a></span>
<span class="normal"><a href="#__codelineno-36-132">132</a></span>
<span class="normal"><a href="#__codelineno-36-133">133</a></span>
<span class="normal"><a href="#__codelineno-36-134">134</a></span>
<span class="normal"><a href="#__codelineno-36-135">135</a></span>
<span class="normal"><a href="#__codelineno-36-136">136</a></span>
<span class="normal"><a href="#__codelineno-36-137">137</a></span>
<span class="normal"><a href="#__codelineno-36-138">138</a></span>
<span class="normal"><a href="#__codelineno-36-139">139</a></span>
<span class="normal"><a href="#__codelineno-36-140">140</a></span>
<span class="normal"><a href="#__codelineno-36-141">141</a></span>
<span class="normal"><a href="#__codelineno-36-142">142</a></span>
<span class="normal"><a href="#__codelineno-36-143">143</a></span>
<span class="normal"><a href="#__codelineno-36-144">144</a></span>
<span class="normal"><a href="#__codelineno-36-145">145</a></span>
<span class="normal"><a href="#__codelineno-36-146">146</a></span>
<span class="normal"><a href="#__codelineno-36-147">147</a></span>
<span class="normal"><a href="#__codelineno-36-148">148</a></span>
<span class="normal"><a href="#__codelineno-36-149">149</a></span>
<span class="normal"><a href="#__codelineno-36-150">150</a></span>
<span class="normal"><a href="#__codelineno-36-151">151</a></span>
<span class="normal"><a href="#__codelineno-36-152">152</a></span>
<span class="normal"><a href="#__codelineno-36-153">153</a></span>
<span class="normal"><a href="#__codelineno-36-154">154</a></span>
<span class="normal"><a href="#__codelineno-36-155">155</a></span>
<span class="normal"><a href="#__codelineno-36-156">156</a></span>
<span class="normal"><a href="#__codelineno-36-157">157</a></span>
<span class="normal"><a href="#__codelineno-36-158">158</a></span>
<span class="normal"><a href="#__codelineno-36-159">159</a></span>
<span class="normal"><a href="#__codelineno-36-160">160</a></span>
<span class="normal"><a href="#__codelineno-36-161">161</a></span>
<span class="normal"><a href="#__codelineno-36-162">162</a></span>
<span class="normal"><a href="#__codelineno-36-163">163</a></span>
<span class="normal"><a href="#__codelineno-36-164">164</a></span>
<span class="normal"><a href="#__codelineno-36-165">165</a></span>
<span class="normal"><a href="#__codelineno-36-166">166</a></span>
<span class="normal"><a href="#__codelineno-36-167">167</a></span>
<span class="normal"><a href="#__codelineno-36-168">168</a></span>
<span class="normal"><a href="#__codelineno-36-169">169</a></span>
<span class="normal"><a href="#__codelineno-36-170">170</a></span>
<span class="normal"><a href="#__codelineno-36-171">171</a></span>
<span class="normal"><a href="#__codelineno-36-172">172</a></span>
<span class="normal"><a href="#__codelineno-36-173">173</a></span>
<span class="normal"><a href="#__codelineno-36-174">174</a></span>
<span class="normal"><a href="#__codelineno-36-175">175</a></span>
<span class="normal"><a href="#__codelineno-36-176">176</a></span>
<span class="normal"><a href="#__codelineno-36-177">177</a></span>
<span class="normal"><a href="#__codelineno-36-178">178</a></span>
<span class="normal"><a href="#__codelineno-36-179">179</a></span>
<span class="normal"><a href="#__codelineno-36-180">180</a></span>
<span class="normal"><a href="#__codelineno-36-181">181</a></span>
<span class="normal"><a href="#__codelineno-36-182">182</a></span>
<span class="normal"><a href="#__codelineno-36-183">183</a></span>
<span class="normal"><a href="#__codelineno-36-184">184</a></span>
<span class="normal"><a href="#__codelineno-36-185">185</a></span>
<span class="normal"><a href="#__codelineno-36-186">186</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kn">package</span><span class="w"> </span><span class="nn">spring.data.tests</span><span class="p">;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Assert</span><span class="p">;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Before</span><span class="p">;</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.BeansException</span><span class="p">;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="p">;</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.test.SpringApplicationConfiguration</span><span class="p">;</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span class="p">;</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="p">;</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">com.google.common.collect.Lists</span><span class="p">;</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.config.AppConfig</span><span class="p">;</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.dao.DaoException</span><span class="p">;</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.dao.IDao</span><span class="p">;</span>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Categorie</span><span class="p">;</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a><span class="kn">import</span><span class="w"> </span><span class="nn">spring.data.entities.Produit</span><span class="p">;</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a><span class="nd">@SpringApplicationConfiguration</span><span class="p">(</span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppConfig</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Test01</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-30" name="__codelineno-36-30"></a>
<a id="__codelineno-36-31" name="__codelineno-36-31"></a><span class="w">    </span><span class="c1">// couche [DAO]</span>
<a id="__codelineno-36-32" name="__codelineno-36-32"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-36-33" name="__codelineno-36-33"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">IDao</span><span class="w"> </span><span class="n">dao</span><span class="p">;</span>
<a id="__codelineno-36-34" name="__codelineno-36-34"></a>
<a id="__codelineno-36-35" name="__codelineno-36-35"></a><span class="w">    </span><span class="c1">// filtres jSON</span>
<a id="__codelineno-36-36" name="__codelineno-36-36"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-36-37" name="__codelineno-36-37"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapper&quot;</span><span class="p">)</span>
<a id="__codelineno-36-38" name="__codelineno-36-38"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">;</span>
<a id="__codelineno-36-39" name="__codelineno-36-39"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-36-40" name="__codelineno-36-40"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-36-41" name="__codelineno-36-41"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithProduits</span><span class="p">;</span>
<a id="__codelineno-36-42" name="__codelineno-36-42"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-36-43" name="__codelineno-36-43"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-36-44" name="__codelineno-36-44"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithCategorie</span><span class="p">;</span>
<a id="__codelineno-36-45" name="__codelineno-36-45"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-36-46" name="__codelineno-36-46"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperCategorieWithoutProduits&quot;</span><span class="p">)</span>
<a id="__codelineno-36-47" name="__codelineno-36-47"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">;</span>
<a id="__codelineno-36-48" name="__codelineno-36-48"></a><span class="w">    </span><span class="nd">@Autowired</span>
<a id="__codelineno-36-49" name="__codelineno-36-49"></a><span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jsonMapperProduitWithoutCategorie&quot;</span><span class="p">)</span>
<a id="__codelineno-36-50" name="__codelineno-36-50"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">;</span>
<a id="__codelineno-36-51" name="__codelineno-36-51"></a>
<a id="__codelineno-36-52" name="__codelineno-36-52"></a><span class="w">    </span><span class="nd">@Before</span>
<a id="__codelineno-36-53" name="__codelineno-36-53"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cleanAndFill</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-54" name="__codelineno-36-54"></a><span class="w">        </span><span class="c1">// on nettoie la base avant chaque test</span>
<a id="__codelineno-36-55" name="__codelineno-36-55"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Vidage de la base de données&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-56" name="__codelineno-36-56"></a><span class="w">        </span><span class="c1">// on vide la table [CATEGORIES] - par cascade la table [PRODUITS] va être vidée</span>
<a id="__codelineno-36-57" name="__codelineno-36-57"></a><span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteAllCategories</span><span class="p">();</span>
<a id="__codelineno-36-58" name="__codelineno-36-58"></a><span class="w">        </span><span class="c1">// --------------------------------------------------------------------------------------</span>
<a id="__codelineno-36-59" name="__codelineno-36-59"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Remplissage de la base&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-60" name="__codelineno-36-60"></a><span class="w">        </span><span class="c1">// on remplit les tables</span>
<a id="__codelineno-36-61" name="__codelineno-36-61"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-36-62" name="__codelineno-36-62"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-63" name="__codelineno-36-63"></a><span class="w">            </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Categorie</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;categorie%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">));</span>
<a id="__codelineno-36-64" name="__codelineno-36-64"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-65" name="__codelineno-36-65"></a><span class="w">                </span><span class="n">categorie</span><span class="p">.</span><span class="na">addProduit</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Produit</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;produit%d%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">),</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span>
<a id="__codelineno-36-66" name="__codelineno-36-66"></a><span class="w">                        </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;desc%d%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)));</span>
<a id="__codelineno-36-67" name="__codelineno-36-67"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-36-68" name="__codelineno-36-68"></a><span class="w">            </span><span class="n">categories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">categorie</span><span class="p">);</span>
<a id="__codelineno-36-69" name="__codelineno-36-69"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-70" name="__codelineno-36-70"></a><span class="w">        </span><span class="c1">// ajout de la catégorie - par cascade les produits vont eux aussi être insérés</span>
<a id="__codelineno-36-71" name="__codelineno-36-71"></a><span class="w">        </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">addCategories</span><span class="p">(</span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-36-72" name="__codelineno-36-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-73" name="__codelineno-36-73"></a>
<a id="__codelineno-36-74" name="__codelineno-36-74"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-36-75" name="__codelineno-36-75"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showDataBase</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">BeansException</span><span class="p">,</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-76" name="__codelineno-36-76"></a><span class="w">        </span><span class="c1">// liste des catégories</span>
<a id="__codelineno-36-77" name="__codelineno-36-77"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des catégories&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-36-78" name="__codelineno-36-78"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllCategories</span><span class="p">();</span>
<a id="__codelineno-36-79" name="__codelineno-36-79"></a><span class="w">        </span><span class="n">affiche</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperCategorieWithoutProduits</span><span class="p">);</span>
<a id="__codelineno-36-80" name="__codelineno-36-80"></a><span class="w">        </span><span class="c1">// liste des produits</span>
<a id="__codelineno-36-81" name="__codelineno-36-81"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Liste des produits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-36-82" name="__codelineno-36-82"></a><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getAllProduits</span><span class="p">();</span>
<a id="__codelineno-36-83" name="__codelineno-36-83"></a><span class="w">        </span><span class="n">affiche</span><span class="p">(</span><span class="n">produits</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapperProduitWithoutCategorie</span><span class="p">);</span>
<a id="__codelineno-36-84" name="__codelineno-36-84"></a><span class="w">        </span><span class="c1">// quelques vérifications</span>
<a id="__codelineno-36-85" name="__codelineno-36-85"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-36-86" name="__codelineno-36-86"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">produits</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-36-87" name="__codelineno-36-87"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findCategorieByName</span><span class="p">(</span><span class="s">&quot;categorie0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="p">);</span>
<a id="__codelineno-36-88" name="__codelineno-36-88"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie</span><span class="p">);</span>
<a id="__codelineno-36-89" name="__codelineno-36-89"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findProduitByName</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produits</span><span class="p">);</span>
<a id="__codelineno-36-90" name="__codelineno-36-90"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
<a id="__codelineno-36-91" name="__codelineno-36-91"></a><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">idCategorie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getIdCategorie</span><span class="p">();</span>
<a id="__codelineno-36-92" name="__codelineno-36-92"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">categorie</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">idCategorie</span><span class="p">);</span>
<a id="__codelineno-36-93" name="__codelineno-36-93"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-94" name="__codelineno-36-94"></a>
<a id="__codelineno-36-95" name="__codelineno-36-95"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-36-96" name="__codelineno-36-96"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCategorieByNameWithProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-97" name="__codelineno-36-97"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getCategorieByNameWithProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-98" name="__codelineno-36-98"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-36-99" name="__codelineno-36-99"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie1</span><span class="p">);</span>
<a id="__codelineno-36-100" name="__codelineno-36-100"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">categorie1</span><span class="p">.</span><span class="na">getProduits</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
<a id="__codelineno-36-101" name="__codelineno-36-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-102" name="__codelineno-36-102"></a>
<a id="__codelineno-36-103" name="__codelineno-36-103"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-36-104" name="__codelineno-36-104"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getCategorieByNameWithoutProduits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-105" name="__codelineno-36-105"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getCategorieByNameWithoutProduits&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-106" name="__codelineno-36-106"></a><span class="w">        </span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getCategorieByNameWithoutProduits</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">);</span>
<a id="__codelineno-36-107" name="__codelineno-36-107"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">categorie1</span><span class="p">);</span>
<a id="__codelineno-36-108" name="__codelineno-36-108"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;categorie1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">categorie1</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-36-109" name="__codelineno-36-109"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-110" name="__codelineno-36-110"></a>
<a id="__codelineno-36-111" name="__codelineno-36-111"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-36-112" name="__codelineno-36-112"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getProduitByIdWithCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-113" name="__codelineno-36-113"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getProduitByNameWithCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-114" name="__codelineno-36-114"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">);</span>
<a id="__codelineno-36-115" name="__codelineno-36-115"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByIdWithCategorie</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-36-116" name="__codelineno-36-116"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit2</span><span class="p">);</span>
<a id="__codelineno-36-117" name="__codelineno-36-117"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-36-118" name="__codelineno-36-118"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-36-119" name="__codelineno-36-119"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getCategorie</span><span class="p">().</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">produit2</span><span class="p">.</span><span class="na">getCategorie</span><span class="p">().</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-36-120" name="__codelineno-36-120"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-121" name="__codelineno-36-121"></a>
<a id="__codelineno-36-122" name="__codelineno-36-122"></a><span class="w">    </span><span class="nd">@Test</span>
<a id="__codelineno-36-123" name="__codelineno-36-123"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getProduitByIdWithoutCategorie</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-124" name="__codelineno-36-124"></a><span class="w">        </span><span class="n">log</span><span class="p">(</span><span class="s">&quot;getProduitByIdWithoutCategorie&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-125" name="__codelineno-36-125"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByNameWithCategorie</span><span class="p">(</span><span class="s">&quot;produit03&quot;</span><span class="p">);</span>
<a id="__codelineno-36-126" name="__codelineno-36-126"></a><span class="w">        </span><span class="n">Produit</span><span class="w"> </span><span class="n">produit2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">getProduitByIdWithoutCategorie</span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-36-127" name="__codelineno-36-127"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertNotNull</span><span class="p">(</span><span class="n">produit2</span><span class="p">);</span>
<a id="__codelineno-36-128" name="__codelineno-36-128"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getNom</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">());</span>
<a id="__codelineno-36-129" name="__codelineno-36-129"></a><span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">produit2</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">produit</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<a id="__codelineno-36-130" name="__codelineno-36-130"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-131" name="__codelineno-36-131"></a><span class="p">...</span>
<a id="__codelineno-36-132" name="__codelineno-36-132"></a><span class="w">    </span><span class="c1">// -------------- méthodes privées</span>
<a id="__codelineno-36-133" name="__codelineno-36-133"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Produit</span><span class="w"> </span><span class="nf">findProduitByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Produit</span><span class="o">&gt;</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-134" name="__codelineno-36-134"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Produit</span><span class="w"> </span><span class="n">produit</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">produits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-135" name="__codelineno-36-135"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">produit</span><span class="p">.</span><span class="na">getNom</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">nom</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-136" name="__codelineno-36-136"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">produit</span><span class="p">;</span>
<a id="__codelineno-36-137" name="__codelineno-36-137"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-36-138" name="__codelineno-36-138"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-139" name="__codelineno-36-139"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-36-140" name="__codelineno-36-140"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-141" name="__codelineno-36-141"></a>
<a id="__codelineno-36-142" name="__codelineno-36-142"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Categorie</span><span class="w"> </span><span class="nf">findCategorieByName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">nom</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Categorie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-143" name="__codelineno-36-143"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Categorie</span><span class="w"> </span><span class="n">categorie</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-144" name="__codelineno-36-144"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">categorie</span><span class="p">.</span><span class="na">getNom</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">nom</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-145" name="__codelineno-36-145"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">categorie</span><span class="p">;</span>
<a id="__codelineno-36-146" name="__codelineno-36-146"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-36-147" name="__codelineno-36-147"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-148" name="__codelineno-36-148"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-36-149" name="__codelineno-36-149"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-150" name="__codelineno-36-150"></a>
<a id="__codelineno-36-151" name="__codelineno-36-151"></a><span class="w">    </span><span class="c1">// affichage d&#39;un élément de type T</span>
<a id="__codelineno-36-152" name="__codelineno-36-152"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-153" name="__codelineno-36-153"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jsonMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">element</span><span class="p">));</span>
<a id="__codelineno-36-154" name="__codelineno-36-154"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-155" name="__codelineno-36-155"></a>
<a id="__codelineno-36-156" name="__codelineno-36-156"></a><span class="w">    </span><span class="c1">// affichage d&#39;une liste d&#39;éléments de type T</span>
<a id="__codelineno-36-157" name="__codelineno-36-157"></a><span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">elements</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-158" name="__codelineno-36-158"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">elements</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-159" name="__codelineno-36-159"></a><span class="w">            </span><span class="n">affiche</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="n">jsonMapper</span><span class="p">);</span>
<a id="__codelineno-36-160" name="__codelineno-36-160"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-161" name="__codelineno-36-161"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-162" name="__codelineno-36-162"></a>
<a id="__codelineno-36-163" name="__codelineno-36-163"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-164" name="__codelineno-36-164"></a><span class="w">        </span><span class="c1">// affiche message</span>
<a id="__codelineno-36-165" name="__codelineno-36-165"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-36-166" name="__codelineno-36-166"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-167" name="__codelineno-36-167"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-36-168" name="__codelineno-36-168"></a><span class="w">            </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s --------------------------------&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-36-169" name="__codelineno-36-169"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-36-170" name="__codelineno-36-170"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-36-171" name="__codelineno-36-171"></a><span class="w">            </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;-- %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span>
<a id="__codelineno-36-172" name="__codelineno-36-172"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-36-173" name="__codelineno-36-173"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-174" name="__codelineno-36-174"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">toPrint</span><span class="p">);</span>
<a id="__codelineno-36-175" name="__codelineno-36-175"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-176" name="__codelineno-36-176"></a>
<a id="__codelineno-36-177" name="__codelineno-36-177"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-178" name="__codelineno-36-178"></a><span class="w">        </span><span class="c1">// titre</span>
<a id="__codelineno-36-179" name="__codelineno-36-179"></a><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s : &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">));</span>
<a id="__codelineno-36-180" name="__codelineno-36-180"></a><span class="w">        </span><span class="c1">// messages</span>
<a id="__codelineno-36-181" name="__codelineno-36-181"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">messages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-182" name="__codelineno-36-182"></a><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;- %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">));</span>
<a id="__codelineno-36-183" name="__codelineno-36-183"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-184" name="__codelineno-36-184"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-185" name="__codelineno-36-185"></a>
<a id="__codelineno-36-186" name="__codelineno-36-186"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 27 : le test unitaire est configuré par la classe [AppConfig] déjà présentée au paragraphe 11.3.8, page 197 ;</li>
<li>lignes 32-33 : injection  d'une référence sur la couche [DAO] ;</li>
<li>lignes 36-50 : injection des cinq mappeurs jSON ;</li>
<li>lignes 60-71 : après avoir vidé la base (ligne 57), on remplit la base de données avec 2 catégories contenant chacune 5 produits. Cette méthode est exécutée avant chaque test à cause de l'annotation [@Before] de la ligne 52 ;</li>
<li>lignes 75-93 : affiche le contenu de la base ;</li>
<li>lignes 95-101 : demande une catégorie avec ses produits, catégorie identifiée par son nom ;</li>
<li>lignes 103-109 : demande une catégorie sans ses produits, catégorie identifiée par son nom ;</li>
<li>lignes 111-120 : demande un produit avec sa catégorie, produit identifié par son n° ;</li>
<li>lignes 122-130 : demande un produit sans sa catégorie, produit identifié par son n° ;</li>
<li>lignes 133-184 : des méthodes privées partagées par les différents tests ;</li>
</ul>
<p><strong>Travail à faire</strong> : exécutez le test. Il doit réussir.</p>
<h3 id="11311-gestion-des-logs">11.3.11. Gestion des logs</h3>
<p>Les logs de l'application console ou du test JUnit sont configurés par le fichier [logback.xml] suivant :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/10000000000000ED000000CC76F2BE04.png" style="display:inline-block; margin:4px;width:4.39cm;height:3.78cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Le fichier doit s'appeler [logback.xml] et être dans le Classpath du projet. Pour cela, il a été placé ici dans le dossier [src/main/resources] qui fait partie du Classpath. Son contenu est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a>&lt;configuration&gt; 
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>  &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt; 
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>    &lt;!-- encoders are  by default assigned the type
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>         ch.qos.logback.classic.encoder.PatternLayoutEncoder --&gt;
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>    &lt;encoder&gt;
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
<a id="__codelineno-37-8" name="__codelineno-37-8"></a>    &lt;/encoder&gt;
<a id="__codelineno-37-9" name="__codelineno-37-9"></a>  &lt;/appender&gt;
<a id="__codelineno-37-10" name="__codelineno-37-10"></a>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a>  &lt;!-- contrôle niveau des logs --&gt;
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>  &lt;root level=&quot;info&quot;&gt; &lt;!-- info, debug, warn --&gt;
<a id="__codelineno-37-13" name="__codelineno-37-13"></a>    &lt;appender-ref ref=&quot;STDOUT&quot; /&gt;
<a id="__codelineno-37-14" name="__codelineno-37-14"></a>  &lt;/root&gt;
<a id="__codelineno-37-15" name="__codelineno-37-15"></a>&lt;/configuration&gt;
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 12 : la balise [&lt;root level="info"&gt;] affiche les logs de niveau [info]. A la place de [info], on peut mettre :</li>
<li>[debug] : c'est le niveau le plus détaillé de logs. Il est conseillé de l'utiliser pendant la phase de débogage du projet car il y a des logs très intéressants sur les échanges client / serveur. C'est une façon de comprendre ce qui se passe 'sous le capot' ;</li>
<li>[off] : pas de logs du tout ;</li>
<li>[warn] : un niveau de logs intermédiaire où Spring affiche des anomalies qui ne pas pour autant des erreurs. Il faut les regarder si on n'obtient pas le résultat escompté ;</li>
</ul>
<p><strong>Travail à faire</strong> : passez le niveau de la ligne 12 à [debug] puis exécutez le test unitaire. Regardez la différence de logs.</p>
<h3 id="11312-generation-de-larchive-maven-du-projet">11.3.12. Génération de l'archive Maven du projet</h3>
<p>Pour installer l'archive du projet dans le dépôt local Maven, procédez comme suit [1-3] :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/1000000000000405000004CAD7507622.png" style="display:inline-block; margin:4px;width:13.614cm;height:16.219cm;" /></td></tr></table>

<p>L'archive va être générée avec les identifiants trouvés dans le fichier [pom.xml] :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>    &lt;groupId&gt;istia.st.springdata&lt;/groupId&gt;
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>    &lt;artifactId&gt;intro-spring-data-01&lt;/artifactId&gt;
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>&lt;packaging&gt;jar&lt;/packaging&gt;
</code></pre></div></td></tr></table></div>
<p>La localisation du dépôt local Maven peut être trouvé dans la configuration d'Eclipse :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000024B00000200824CCAC4.png" style="display:inline-block; margin:4px;width:10.871cm;height:9.479cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Il est alors possible de vérifier la bonne installation de l'artifact Maven :</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><img src="images/100000000000022F0000009B72132AEB.png" style="display:inline-block; margin:4px;width:10.351cm;height:2.87cm;" /></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;">&nbsp;</td></tr></table>

<p>Désormais, un autre projet Maven local pourra utiliser cette archive.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "navigation.expand", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>